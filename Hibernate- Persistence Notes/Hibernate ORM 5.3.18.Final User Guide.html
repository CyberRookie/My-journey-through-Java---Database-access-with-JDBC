<!DOCTYPE html>
<!-- saved from url=(0092)https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Vlad Mihalcea, Steve Ebersole, Andrea Boriero, Gunnar Morling, Gail Badner, Chris Cranford, Emmanuel Bernard, Sanne Grinovero, Brett Meyer, Hardy Ferentschik, Gavin King, Christian Bauer, Max Rydahl Andersen, Karel Maesen, Radim Vansa, Louis Jacomet">
<title>Hibernate ORM 5.3.18.Final User Guide</title>
<link rel="stylesheet" href="./Hibernate ORM 5.3.18.Final User Guide_files/hibernate.css">
<link rel="stylesheet" href="./Hibernate ORM 5.3.18.Final User Guide_files/font-awesome.min.css">
<script src="./Hibernate ORM 5.3.18.Final User Guide_files/jquery.min.js.download"></script>
<script src="./Hibernate ORM 5.3.18.Final User Guide_files/jstree.min.js.download"></script>

<script src="./Hibernate ORM 5.3.18.Final User Guide_files/toc.js.download"></script>

<link rel="stylesheet" href="./Hibernate ORM 5.3.18.Final User Guide_files/jstree-style.css">
<link rel="stylesheet" href="./Hibernate ORM 5.3.18.Final User Guide_files/jstree-toc.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Hibernate ORM 5.3.18.Final User Guide</h1>
<div class="details">
<span id="author" class="author">Vlad Mihalcea, Steve Ebersole, Andrea Boriero, Gunnar Morling, Gail Badner, Chris Cranford, Emmanuel Bernard, Sanne Grinovero, Brett Meyer, Hardy Ferentschik, Gavin King, Christian Bauer, Max Rydahl Andersen, Karel Maesen, Radim Vansa, Louis Jacomet</span><br>
</div>
<div id="toc" class="toc2">
<select id="vchooser"><option>Choose version</option><option value="http://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html">current</option><option value="http://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html">5.2</option><option value="http://docs.jboss.org/hibernate/orm/5.1/userguide/html_single/Hibernate_User_Guide.html">5.1</option><option value="http://docs.jboss.org/hibernate/orm/5.0/userguide/html_single/Hibernate_User_Guide.html">5.0</option><option value="http://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html_single/">4.3</option><option value="http://docs.jboss.org/hibernate/orm/4.2/manual/en-US/html_single/">4.2</option><option value="http://docs.jboss.org/hibernate/orm/4.1/manual/en-US/html_single/">4.1</option><option value="http://docs.jboss.org/hibernate/orm/4.0/manual/en-US/html_single/">4.0</option><option value="http://docs.jboss.org/hibernate/orm/3.6/reference/en-US/html_single/">3.6</option><option value="http://docs.jboss.org/hibernate/orm/3.5/reference/en-US/html_single/">3.5</option><option value="http://docs.jboss.org/hibernate/orm/3.3/reference/en-US/html_single/">3.3</option><option value="http://docs.jboss.org/hibernate/orm/3.2/reference/en/html_single/">3.2</option></select><div id="toctitle">Table of Contents</div>
<input placeholder="ï€‚ Search" id="tocsearch" type="text"><a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#" id="toctreeexpand" title="Expand"><i class="fa fa-plus-square" aria-hidden="true"></i></a><a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#" id="toctreecollapse" title="Collapse"><i class="fa fa-minus-square" aria-hidden="true"></i></a><div id="toctree" class="jstree jstree-1 jstree-default jstree-default-small" role="tree" aria-multiselectable="true" tabindex="0" aria-activedescendant="j1_186" aria-busy="false"><ul class="jstree-container-ul jstree-children jstree-no-icons jstree-wholerow-ul jstree-no-dots" role="group"><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_1_anchor" aria-expanded="false" id="j1_1" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#preface" tabindex="-1" id="j1_1_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>Preface</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_3_anchor" aria-expanded="false" id="j1_3" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_system_requirements" tabindex="-1" id="j1_3_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>System Requirements</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_5_anchor" aria-expanded="false" id="j1_5" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#architecture" tabindex="-1" id="j1_5_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>1. Architecture</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_7_anchor" aria-expanded="false" id="j1_7" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#domain-model" tabindex="-1" id="j1_7_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>2. Domain Model</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_116_anchor" aria-expanded="false" id="j1_116" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap" tabindex="-1" id="j1_116_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>3. Bootstrap</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_126_anchor" aria-expanded="false" id="j1_126" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation" tabindex="-1" id="j1_126_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>4. Schema generation</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_133_anchor" aria-expanded="false" id="j1_133" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc" tabindex="-1" id="j1_133_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>5. Persistence Context</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_162_anchor" aria-expanded="false" id="j1_162" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing" tabindex="-1" id="j1_162_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>6. Flushing</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_171_anchor" aria-expanded="false" id="j1_171" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database" tabindex="-1" id="j1_171_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>7. Database access</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_186_anchor" aria-expanded="false" id="j1_186" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions" tabindex="-1" id="j1_186_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>8. Transactions and concurrency control</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_196_anchor" id="j1_196" class="jstree-node  jstree-leaf"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jndi" tabindex="-1" id="j1_196_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>9. JNDI</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_197_anchor" aria-expanded="false" id="j1_197" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking" tabindex="-1" id="j1_197_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>10. Locking</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_205_anchor" aria-expanded="false" id="j1_205" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching" tabindex="-1" id="j1_205_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>11. Fetching</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_220_anchor" aria-expanded="false" id="j1_220" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch" tabindex="-1" id="j1_220_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>12. Batching</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_230_anchor" aria-expanded="false" id="j1_230" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching" tabindex="-1" id="j1_230_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>13. Caching</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_251_anchor" aria-expanded="false" id="j1_251" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events" tabindex="-1" id="j1_251_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>14. Interceptors and events</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_259_anchor" aria-expanded="false" id="j1_259" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql" tabindex="-1" id="j1_259_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>15. HQL and JPQL</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_317_anchor" aria-expanded="false" id="j1_317" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria" tabindex="-1" id="j1_317_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>16. Criteria</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_331_anchor" aria-expanded="false" id="j1_331" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql" tabindex="-1" id="j1_331_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>17. Native SQL Queries</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_348_anchor" aria-expanded="false" id="j1_348" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial" tabindex="-1" id="j1_348_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>18. Spatial</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_354_anchor" aria-expanded="false" id="j1_354" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy" tabindex="-1" id="j1_354_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>19. Multitenancy</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_364_anchor" aria-expanded="false" id="j1_364" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi" tabindex="-1" id="j1_364_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>20. OSGi</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_385_anchor" aria-expanded="false" id="j1_385" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers" tabindex="-1" id="j1_385_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>21. Envers</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_417_anchor" aria-expanded="false" id="j1_417" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability" tabindex="-1" id="j1_417_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>22. Database Portability Considerations</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_426_anchor" aria-expanded="false" id="j1_426" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations" tabindex="-1" id="j1_426_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>23. Configurations</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_466_anchor" aria-expanded="false" id="j1_466" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations" tabindex="-1" id="j1_466_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>24. Mapping annotations</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_652_anchor" aria-expanded="false" id="j1_652" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices" tabindex="-1" id="j1_652_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>25. Performance Tuning and Best Practices</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_663_anchor" id="j1_663" class="jstree-node  jstree-leaf"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-bootstrap" tabindex="-1" id="j1_663_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>26. Legacy Bootstrapping</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_664_anchor" id="j1_664" class="jstree-node  jstree-leaf"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_migration" tabindex="-1" id="j1_664_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>27. Migration</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_665_anchor" id="j1_665" class="jstree-node  jstree-leaf"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-domain-model" tabindex="-1" id="j1_665_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>28. Legacy Domain Model</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_666_anchor" aria-expanded="false" id="j1_666" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-criteria" tabindex="-1" id="j1_666_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>29. Legacy Hibernate Criteria Queries</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_679_anchor" aria-expanded="false" id="j1_679" class="jstree-node  jstree-closed"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-native-queries" tabindex="-1" id="j1_679_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>30. Legacy Hibernate Native Queries</a></li><li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j1_686_anchor" id="j1_686" class="jstree-node  jstree-leaf jstree-last"><div unselectable="on" role="presentation" class="jstree-wholerow">&nbsp;</div><i class="jstree-icon jstree-ocl" role="presentation"></i><a class="jstree-anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_references" tabindex="-1" id="j1_686_anchor"><i class="jstree-icon jstree-themeicon" role="presentation"></i>31. References</a></li></ul></div>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#preface"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working with both Object-Oriented software and Relational Databases can be cumbersome and time-consuming.
Development costs are significantly higher due to a paradigm mismatch between how data is represented in objects versus relational databases.
Hibernate is an Object/Relational Mapping solution for Java environments.
The term <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">Object/Relational Mapping</a> refers to the technique of mapping data from an object model representation to a relational data model representation (and vice versa).</p>
</div>
<div class="paragraph">
<p>Hibernate not only takes care of the mapping from Java classes to database tables (and from Java data types to SQL data types), but also provides data query and retrieval facilities.
It can significantly reduce development time otherwise spent with manual data handling in SQL and JDBC.
Hibernateâ€™s design goal is to relieve the developer from 95% of common data persistence-related programming tasks by eliminating the need for manual, hand-crafted data processing using SQL and JDBC.
However, unlike many other persistence solutions, Hibernate does not hide the power of SQL from you and guarantees that your investment in relational technology and knowledge is as valid as always.</p>
</div>
<div class="paragraph">
<p>Hibernate may not be the best solution for data-centric applications that only use stored-procedures to implement the business logic in the database, it is most useful with object-oriented domain models and business logic in the Java-based middle-tier.
However, Hibernate can certainly help you to remove or encapsulate vendor-specific SQL code and will help with the common task of result set translation from a tabular representation to a graph of objects.</p>
</div>
<div class="sect2">
<h3 id="_get_involved"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_get_involved"></a>Get Involved</h3>
<div class="ulist">
<ul>
<li>
<p>Use Hibernate and report any bugs or issues you find. See <a href="http://hibernate.org/issuetracker">Issue Tracker</a> for details.</p>
</li>
<li>
<p>Try your hand at fixing some bugs or implementing enhancements. Again, see <a href="http://hibernate.org/issuetracker">Issue Tracker</a>.</p>
</li>
<li>
<p>Engage with the community using mailing lists, forums, IRC, or other ways listed in the <a href="http://hibernate.org/community">Community section</a>.</p>
</li>
<li>
<p>Help improve or translate this documentation. Contact us on the developer mailing list if you have interest.</p>
</li>
<li>
<p>Spread the word. Let the rest of your organization know about the benefits of Hibernate.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_requirements"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_system_requirements"></a>System Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate 5.2 and later versions require at least Java 1.8 and JDBC 4.2.</p>
</div>
<div class="paragraph">
<p>Hibernate 5.1 and older versions require at least Java 1.6 and JDBC 4.0.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When building Hibernate 5.1 or older from sources, you need Java 1.7 due to a bug in the JDK 1.6 compiler.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_getting_started_guide"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_getting_started_guide"></a>Getting Started Guide</h3>
<div class="paragraph">
<p>New users may want to first look through the <a href="https://docs.jboss.org/hibernate/orm/5.3/quickstart/html_single/">Hibernate Getting Started Guide</a> for basic information as well as tutorials.
There is also a series of <a href="http://docs.jboss.org/hibernate/orm/5.3/topical/html_single/">topical guides</a> providing deep dives into various topics.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While having a strong background in SQL is not required to use Hibernate, it certainly helps a lot because it all boils down to SQL statements.
Probably even more important is an understanding of data modeling principles.
You might want to consider these resources as a good starting point:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://en.wikipedia.org/wiki/Data_modeling">Data Modeling Wikipedia definition</a></p>
</li>
<li>
<p><a href="http://www.agiledata.org/essays/dataModeling101.html">Data Modeling 101</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Understanding the basics of transactions and design patterns such as <em>Unit of Work</em> <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#PoEAA">PoEAA</a> or <em>Application Transaction</em> are important as well.
These topics will be discussed in the documentation, but a prior understanding will certainly help.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#architecture"></a>1. Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="architecture-overview"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#architecture-overview"></a>1.1. Overview</h3>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/data_access_layers.svg" alt="Data Access Layers"></span></p>
</div>
<div class="paragraph">
<p>Hibernate, as an ORM solution, effectively "sits between" the Java application data access layer and the Relational Database, as can be seen in the diagram above.
The Java application makes use of the Hibernate APIs to load, store, query, etc its domain data.
Here we will introduce the essential Hibernate APIs.
This will be a brief introduction; we will discuss these contracts in detail later.</p>
</div>
<div class="paragraph">
<p>As a JPA provider, Hibernate implements the Java Persistence API specifications and the association between JPA interfaces and Hibernate specific implementations can be visualized in the following diagram:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/JPA_Hibernate.svg" alt="image"></span></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SessionFactory (<code>org.hibernate.SessionFactory</code>)</dt>
<dd>
<p>A thread-safe (and immutable) representation of the mapping of the application domain model to a database.
Acts as a factory for <code>org.hibernate.Session</code> instances. The <code>EntityManagerFactory</code> is the JPA equivalent of a <code>SessionFactory</code> and basically, those two converge into the same <code>SessionFactory</code> implementation.</p>
<div class="paragraph">
<p>A <code>SessionFactory</code> is very expensive to create, so, for any given database, the application should have only one associated <code>SessionFactory</code>.
The <code>SessionFactory</code> maintains services that Hibernate uses across all <code>Session(s)</code> such as second level caches, connection pools, transaction system integrations, etc.</p>
</div>
</dd>
<dt class="hdlist1">Session (<code>org.hibernate.Session</code>)</dt>
<dd>
<p>A single-threaded, short-lived object conceptually modeling a "Unit of Work" <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#PoEAA">PoEAA</a>.
In JPA nomenclature, the <code>Session</code> is represented by an <code>EntityManager</code>.</p>
<div class="paragraph">
<p>Behind the scenes, the Hibernate <code>Session</code> wraps a JDBC <code>java.sql.Connection</code> and acts as a factory for <code>org.hibernate.Transaction</code> instances.
It maintains a generally "repeatable read" persistence context (first level cache) of the application domain model.</p>
</div>
</dd>
<dt class="hdlist1">Transaction (<code>org.hibernate.Transaction</code>)</dt>
<dd>
<p>A single-threaded, short-lived object used by the application to demarcate individual physical transaction boundaries.
<code>EntityTransaction</code> is the JPA equivalent and both act as an abstraction API to isolate the application from the underlying transaction system in use (JDBC or JTA).</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domain-model"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#domain-model"></a>2. Domain Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The term <a href="https://en.wikipedia.org/wiki/Domain_model">domain model</a> comes from the realm of data modeling.
It is the model that ultimately describes the <a href="https://en.wikipedia.org/wiki/Problem_domain">problem domain</a> you are working in.
Sometimes you will also hear the term <em>persistent classes</em>.</p>
</div>
<div class="paragraph">
<p>Ultimately the application domain model is the central character in an ORM.
They make up the classes you wish to map. Hibernate works best if these classes follow the Plain Old Java Object (POJO) / JavaBean programming model.
However, none of these rules are hard requirements.
Indeed, Hibernate assumes very little about the nature of your persistent objects. You can express a domain model in other ways (using trees of <code>java.util.Map</code> instances, for example).</p>
</div>
<div class="paragraph">
<p>Historically applications using Hibernate would have used its proprietary XML mapping file format for this purpose.
With the coming of JPA, most of this information is now defined in a way that is portable across ORM/JPA providers using annotations (and/or standardized XML format).
This chapter will focus on JPA mapping where possible.
For Hibernate mapping features not supported by JPA we will prefer Hibernate extension annotations.</p>
</div>
<div class="sect2">
<h3 id="mapping-types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-types"></a>2.1. Mapping types</h3>
<div class="paragraph">
<p>Hibernate understands both the Java and JDBC representations of application data.
The ability to read/write this data from/to the database is the function of a Hibernate <em>type</em>.
A type, in this usage, is an implementation of the <code>org.hibernate.type.Type</code> interface.
This Hibernate type also describes various behavioral aspects of the Java type such as how to check for equality, how to clone values, etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>type</em></div>
<div class="paragraph">
<p>The Hibernate type is neither a Java type nor a SQL data type.
It provides information about both of these as well as understanding marshalling between.</p>
</div>
<div class="paragraph">
<p>When you encounter the term type in discussions of Hibernate, it may refer to the Java type, the JDBC type, or the Hibernate type, depending on context.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To help understand the type categorizations, letâ€™s look at a simple table and domain model that we wish to map.</p>
</div>
<div id="mapping-types-basic-example" class="exampleblock">
<div class="title">Example 1. A simple table and domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Contact</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    first varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">last</span><span class="pln"> varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    middle varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    notes varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    starred </span><span class="kwd">boolean</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    website varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Contact"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Contact</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> notes</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> URL website</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> starred</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> first</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middle</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">;</span><span class="pln">

	</span><span class="com">// getters and setters omitted</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the broadest sense, Hibernate categorizes types into two groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#categorization-value">Value types</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#categorization-entity">Entity types</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="categorization-value"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#categorization-value"></a>2.1.1. Value types</h4>
<div class="paragraph">
<p>A value type is a piece of data that does not define its own lifecycle.
It is, in effect, owned by an entity, which defines its lifecycle.</p>
</div>
<div class="paragraph">
<p>Looked at another way, all the state of an entity is made up entirely of value types.
These state fields or JavaBean properties are termed <em>persistent attributes</em>.
The persistent attributes of the <code>Contact</code> class are value types.</p>
</div>
<div class="paragraph">
<p>Value types are further classified into three sub-categories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic types</dt>
<dd>
<p>in mapping the <code>Contact</code> table, all attributes except for name would be basic types. Basic types are discussed in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic"><em>Basic Types</em></a></p>
</dd>
<dt class="hdlist1">Embeddable types</dt>
<dd>
<p>the name attribute is an example of an embeddable type, which is discussed in details in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddables"><em>Embeddable Types</em></a></p>
</dd>
<dt class="hdlist1">Collection types</dt>
<dd>
<p>although not featured in the aforementioned example, collection types are also a distinct category among value types. Collection types are further discussed in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections"><em>Collections</em></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="categorization-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#categorization-entity"></a>2.1.2. Entity types</h4>
<div class="paragraph">
<p>Entities, by nature of their unique identifier, exist independently of other objects whereas values do not.
Entities are domain model classes which correlate to rows in a database table, using a unique identifier.
Because of the requirement for a unique identifier, entities exist independently and define their own lifecycle.
The <code>Contact</code> class itself would be an example of an entity.</p>
</div>
<div class="paragraph">
<p>Mapping entities is discussed in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity"><em>Entity</em></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="naming"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naming"></a>2.2. Naming strategies</h3>
<div class="paragraph">
<p>Part of the mapping of an object model to the relational database is
mapping names from the object model to the corresponding database names.
Hibernate looks at this as 2 stage process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first stage is determining a proper logical name from the domain model mapping.  A
logical name can be either explicitly specified by the user (using <code>@Column</code> or
<code>@Table</code> e.g.) or it can be implicitly determined by Hibernate through an
<a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#ImplicitNamingStrategy">ImplicitNamingStrategy</a> contract.</p>
</li>
<li>
<p>Second is the resolving of this logical name to a physical name which is defined
by the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#PhysicalNamingStrategy">PhysicalNamingStrategy</a> contract.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Historical NamingStrategy contract</div>
<div class="paragraph">
<p>Historically Hibernate defined just a single <code>org.hibernate.cfg.NamingStrategy</code>.  That singular
NamingStrategy contract actually combined the separate concerns that are now modeled individually
as ImplicitNamingStrategy and PhysicalNamingStrategy.</p>
</div>
<div class="paragraph">
<p>Also, the NamingStrategy contract was often not flexible enough to properly apply a given naming
"rule", either because the API lacked the information to decide or because the API was honestly
not well defined as it grew.</p>
</div>
<div class="paragraph">
<p>Due to these limitation, <code>org.hibernate.cfg.NamingStrategy</code> has been deprecated and then removed
in favor of ImplicitNamingStrategy and PhysicalNamingStrategy.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At the core, the idea behind each naming strategy is to minimize the amount of
repetitive information a developer must provide for mapping a domain model.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">JPA Compatibility</div>
<div class="paragraph">
<p>JPA defines inherent rules about implicit logical name determination.  If JPA provider
portability is a major concern, or if you really just like the JPA-defined implicit
naming rules, be sure to stick with ImplicitNamingStrategyJpaCompliantImpl (the default)</p>
</div>
<div class="paragraph">
<p>Also, JPA defines no separation between logical and physical name.  Following the JPA
specification, the logical name <strong>is</strong> the physical name.  If JPA provider portability
is important, applications should prefer not to specify a PhysicalNamingStrategy.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="ImplicitNamingStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#ImplicitNamingStrategy"></a>2.2.1. ImplicitNamingStrategy</h4>
<div class="paragraph">
<p>When an entity does not explicitly name the database table that it maps to, we need
to implicitly determine that table name.  Or when a particular attribute does not explicitly name
the database column that it maps to, we need to implicitly determine that column name.  There are
examples of the role of the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract to
determine a logical name when the mapping did not provide an explicit name.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/implicit_naming_strategy_diagram.svg" alt="Implicit Naming Strategy Diagram"></span></p>
</div>
<div class="paragraph">
<p>Hibernate defines multiple ImplicitNamingStrategy implementations out-of-the-box.  Applications
are also free to plug-in custom implementations.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to specify the ImplicitNamingStrategy to use.  First, applications can specify
the implementation using the <code>hibernate.implicit_naming_strategy</code> configuration setting which accepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pre-defined "short names" for the out-of-the-box implementations</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl</code> - an alias for <code>jpa</code></p>
</dd>
<dt class="hdlist1"><code>jpa</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl</code> - the JPA 2.0 compliant naming strategy</p>
</dd>
<dt class="hdlist1"><code>legacy-hbm</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyHbmImpl</code> - compliant with the original Hibernate NamingStrategy</p>
</dd>
<dt class="hdlist1"><code>legacy-jpa</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl</code> - compliant with the legacy NamingStrategy developed for JPA 1.0, which was unfortunately unclear in many respects regarding implicit naming rules</p>
</dd>
<dt class="hdlist1"><code>component-path</code></dt>
<dd>
<p>for <code>org.hibernate.boot.model.naming.ImplicitNamingStrategyComponentPathImpl</code> - mostly follows <code>ImplicitNamingStrategyJpaCompliantImpl</code> rules, except that it uses the full composite paths, as opposed to just the ending property part</p>
</dd>
</dl>
</div>
</li>
<li>
<p>reference to a Class that implements the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract</p>
</li>
<li>
<p>FQN of a class that implements the <code>org.hibernate.boot.model.naming.ImplicitNamingStrategy</code> contract</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secondly, applications and integrations can leverage <code>org.hibernate.boot.MetadataBuilder#applyImplicitNamingStrategy</code>
to specify the ImplicitNamingStrategy to use.  See
<a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap">Bootstrap</a> for additional details on bootstrapping.</p>
</div>
</div>
<div class="sect3">
<h4 id="PhysicalNamingStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#PhysicalNamingStrategy"></a>2.2.2. PhysicalNamingStrategy</h4>
<div class="paragraph">
<p>Many organizations define rules around the naming of database objects (tables, columns, foreign keys, etc).
The idea of a PhysicalNamingStrategy is to help implement such naming rules without having to hard-code them
into the mapping via explicit names.</p>
</div>
<div class="paragraph">
<p>While the purpose of an ImplicitNamingStrategy is to determine that an attribute named <code>accountNumber</code> maps to
a logical column name of <code>accountNumber</code> when not explicitly specified, the purpose of a PhysicalNamingStrategy
would be, for example, to say that the physical column name should instead be abbreviated <code>acct_num</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is true that the resolution to <code>acct_num</code> could have been handled in an ImplicitNamingStrategy in this case.
But the point is separation of concerns. The PhysicalNamingStrategy will be applied regardless of whether
the attribute explicitly specified the column name or whether we determined that implicitly. The
ImplicitNamingStrategy would only be applied if an explicit name was not given.  So it depends on needs
and intent.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The default implementation is to simply use the logical name as the physical name.  However
applications and integrations can define custom implementations of this PhysicalNamingStrategy
contract.  Here is an example PhysicalNamingStrategy for a fictitious company named Acme Corp
whose naming standards are to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prefer underscore-delimited words rather than camel-casing</p>
</li>
<li>
<p>replace certain words with standard abbreviations</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Example PhysicalNamingStrategy implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="com">/*
 * Hibernate, Relational Persistence for Idiomatic Java
 *
 * License: GNU Lesser General Public License (LGPL), version 2.1 or later.
 * See the lgpl.txt file in the root directory or &lt;http://www.gnu.org/licenses/lgpl-2.1.html&gt;.
 */</span><span class="pln">
</span><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">userguide</span><span class="pun">.</span><span class="pln">naming</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">LinkedList</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Locale</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">TreeMap</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">boot</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">naming</span><span class="pun">.</span><span class="typ">Identifier</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">boot</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">naming</span><span class="pun">.</span><span class="typ">PhysicalNamingStrategy</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">engine</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">.</span><span class="pln">env</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="typ">JdbcEnvironment</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">lang3</span><span class="pun">.</span><span class="typ">StringUtils</span><span class="pun">;</span><span class="pln">

</span><span class="com">/**
 * An example PhysicalNamingStrategy that implements database object naming standards
 * for our fictitious company Acme Corp.
 * &lt;p/&gt;
 * In general Acme Corp prefers underscore-delimited words rather than camel casing.
 * &lt;p/&gt;
 * Additionally standards call for the replacement of certain words with abbreviations.
 *
 * @author Steve Ebersole
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AcmeCorpPhysicalNamingStrategy</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PhysicalNamingStrategy</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> ABBREVIATIONS </span><span class="pun">=</span><span class="pln"> buildAbbreviationMap</span><span class="pun">();</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Identifier</span><span class="pln"> toPhysicalCatalogName</span><span class="pun">(</span><span class="typ">Identifier</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JdbcEnvironment</span><span class="pln"> jdbcEnvironment</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="com">// Acme naming standards do not apply to catalog names</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Identifier</span><span class="pln"> toPhysicalSchemaName</span><span class="pun">(</span><span class="typ">Identifier</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JdbcEnvironment</span><span class="pln"> jdbcEnvironment</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="com">// Acme naming standards do not apply to schema names</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Identifier</span><span class="pln"> toPhysicalTableName</span><span class="pun">(</span><span class="typ">Identifier</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JdbcEnvironment</span><span class="pln"> jdbcEnvironment</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> splitAndReplace</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> jdbcEnvironment</span><span class="pun">.</span><span class="pln">getIdentifierHelper</span><span class="pun">().</span><span class="pln">toIdentifier</span><span class="pun">(</span><span class="pln">
				join</span><span class="pun">(</span><span class="pln"> parts </span><span class="pun">),</span><span class="pln">
				name</span><span class="pun">.</span><span class="pln">isQuoted</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Identifier</span><span class="pln"> toPhysicalSequenceName</span><span class="pun">(</span><span class="typ">Identifier</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JdbcEnvironment</span><span class="pln"> jdbcEnvironment</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> splitAndReplace</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="com">// Acme Corp says all sequences should end with _seq</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="str">"seq"</span><span class="pun">.</span><span class="pln">equalsIgnoreCase</span><span class="pun">(</span><span class="pln"> parts</span><span class="pun">.</span><span class="pln">getLast</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			parts</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"seq"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> jdbcEnvironment</span><span class="pun">.</span><span class="pln">getIdentifierHelper</span><span class="pun">().</span><span class="pln">toIdentifier</span><span class="pun">(</span><span class="pln">
				join</span><span class="pun">(</span><span class="pln"> parts </span><span class="pun">),</span><span class="pln">
				name</span><span class="pun">.</span><span class="pln">isQuoted</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Identifier</span><span class="pln"> toPhysicalColumnName</span><span class="pun">(</span><span class="typ">Identifier</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JdbcEnvironment</span><span class="pln"> jdbcEnvironment</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> splitAndReplace</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> jdbcEnvironment</span><span class="pun">.</span><span class="pln">getIdentifierHelper</span><span class="pun">().</span><span class="pln">toIdentifier</span><span class="pun">(</span><span class="pln">
				join</span><span class="pun">(</span><span class="pln"> parts </span><span class="pun">),</span><span class="pln">
				name</span><span class="pun">.</span><span class="pln">isQuoted</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> buildAbbreviationMap</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">TreeMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> abbreviationMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TreeMap</span><span class="pun">&lt;&gt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">CASE_INSENSITIVE_ORDER </span><span class="pun">);</span><span class="pln">
		abbreviationMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"account"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"acct"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		abbreviationMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"num"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> abbreviationMap</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> splitAndReplace</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">LinkedList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;&gt;();</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> part </span><span class="pun">:</span><span class="pln"> </span><span class="typ">StringUtils</span><span class="pun">.</span><span class="pln">splitByCharacterTypeCamelCase</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> part </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> part</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				</span><span class="com">// skip null and space</span><span class="pln">
				</span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			part </span><span class="pun">=</span><span class="pln"> applyAbbreviationReplacement</span><span class="pun">(</span><span class="pln"> part </span><span class="pun">);</span><span class="pln">
			result</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> part</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Locale</span><span class="pun">.</span><span class="pln">ROOT </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> applyAbbreviationReplacement</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> word</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> ABBREVIATIONS</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln"> word </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> ABBREVIATIONS</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> word </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">return</span><span class="pln"> word</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> join</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">boolean</span><span class="pln"> firstPass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="typ">String</span><span class="pln"> separator </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln">
		</span><span class="typ">StringBuilder</span><span class="pln"> joined </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> part </span><span class="pun">:</span><span class="pln"> parts </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			joined</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln"> separator </span><span class="pun">).</span><span class="pln">append</span><span class="pun">(</span><span class="pln"> part </span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> firstPass </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				firstPass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
				separator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"_"</span><span class="pun">;</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> joined</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are multiple ways to specify the PhysicalNamingStrategy to use.  First, applications can specify
the implementation using the <code>hibernate.physical_naming_strategy</code> configuration setting which accepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>reference to a Class that implements the <code>org.hibernate.boot.model.naming.PhysicalNamingStrategy</code> contract</p>
</li>
<li>
<p>FQN of a class that implements the <code>org.hibernate.boot.model.naming.PhysicalNamingStrategy</code> contract</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secondly, applications and integrations can leverage <code>org.hibernate.boot.MetadataBuilder#applyPhysicalNamingStrategy</code>.
See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap">Bootstrap</a> for additional details on bootstrapping.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic"></a>2.3. Basic Types</h3>
<div class="paragraph">
<p>Basic value types usually map a single database column, to a single, non-aggregated Java type.
Hibernate provides a number of built-in basic types, which follow the natural mappings recommended by the JDBC specifications.</p>
</div>
<div class="paragraph">
<p>Internally Hibernate uses a registry of basic types when it needs to resolve a specific <code>org.hibernate.type.Type</code>.</p>
</div>
<div class="sect3">
<h4 id="basic-provided"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-provided"></a>2.3.1. Hibernate-provided BasicTypes</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Standard BasicTypes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hibernate type (org.hibernate.type package)</th>
<th class="tableblock halign-left valign-top">JDBC type</th>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">BasicTypeRegistry key(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StringType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaterializedClob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">materialized_clob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TextType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONGVARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharacterType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char, java.lang.Character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char, java.lang.Character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BooleanType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean, java.lang.Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NumericBooleanType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTEGER, 0 is false, 1 is true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numeric_boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YesNoType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR, 'N'/'n' is false, 'Y'/'y' is true. The uppercase value is written to the database.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes_no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TrueFalseType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR, 'F'/'f' is false, 'T'/'t' is true. The uppercase value is written to the database.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean, java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true_false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ByteType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TINYINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte, java.lang.Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte, java.lang.Byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ShortType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMALLINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, java.lang.Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, java.lang.Short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IntegerTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTEGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int, java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int, java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LongType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long, java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long, java.lang.Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FloatType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float, java.lang.Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float, java.lang.Float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DoubleType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double, java.lang.Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double, java.lang.Double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigIntegerType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NUMERIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">big_integer, java.math.BigInteger</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimalType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NUMERIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.math.BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">big_decimal, java.math.bigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimestampType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp, java.sql.Timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time, java.sql.Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date, java.sql.Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CalendarType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar, java.util.Calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CalendarDateType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar_date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CalendarTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar_time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CurrencyType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Currency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">currency, java.util.Currency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocaleType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale, java.utility.locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeZoneType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR, using the TimeZone ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.TimeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timezone, java.util.TimeZone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UrlType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.net.URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">url, java.net.URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClassType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR (class FQN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">class, java.lang.Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BlobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blob, java.sql.Blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Clob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clob, java.sql.Clob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BinaryType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary, byte[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaterializedBlobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">materialized_blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ImageType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONGVARBINARY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WrapperBinaryType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrapper-binary, Byte[], java.lang.Byte[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharArrayType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">characters, char[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharacterArrayType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrapper-characters, Character[], java.lang.Character[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUIDBinaryType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BINARY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid-binary, java.util.UUID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUIDCharType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR, can also read VARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid-char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgresUUIDType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL UUID, through Types#OTHER, which complies to the PostgreSQL JDBC driver definition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pg-uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SerializableType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARBINARY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implementors of java.lang.Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unlike the other value types, multiple instances of this type are registered. It is registered once under java.io.Serializable, and registered under the specific java.io.Serializable implementation class names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StringNVarcharType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NVARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nstring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTextType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LONGNVARCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntext</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NClobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.NClob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nclob, java.sql.NClob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaterializedNClobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">materialized_nclob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrimitiveCharacterArrayNClobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharacterNCharType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ncharacter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharacterArrayNClobType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCLOB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Java 8 BasicTypes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hibernate type (org.hibernate.type package)</th>
<th class="tableblock halign-left valign-top">JDBC type</th>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">BasicTypeRegistry key(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DurationType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIGINT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration, java.time.Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InstantType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Instant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant, java.time.Instant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.LocalDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateTime, java.time.LocalDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.LocalDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDate, java.time.LocalDate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.LocalTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalTime, java.time.LocalTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OffsetDateTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.OffsetDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OffsetDateTime, java.time.OffsetDateTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OffsetTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.OffsetTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OffsetTime, java.time.OffsetTime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZonedDateTimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMESTAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.ZonedDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZonedDateTime, java.time.ZonedDateTime</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Hibernate Spatial BasicTypes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hibernate type (org.hibernate.spatial package)</th>
<th class="tableblock halign-left valign-top">JDBC type</th>
<th class="tableblock halign-left valign-top">Java type</th>
<th class="tableblock halign-left valign-top">BasicTypeRegistry key(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JTSGeometryType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on the dialect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.vividsolutions.jts.geom.Geometry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jts_geometry, or the class name of Geometry or any of its subclasses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GeolatteGeometryType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on the dialect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.geolatte.geom.Geometry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">geolatte_geometry, or the class name of Geometry or any of its subclasses</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use these hibernate-spatial types, you must add the <code>hibernate-spatial</code> dependency to your classpath <em>and</em> use a <code>org.hibernate.spatial.SpatialDialect</code> implementation.
See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial">Spatial</a> for more details about spatial types.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>These mappings are managed by a service inside Hibernate called the <code>org.hibernate.type.BasicTypeRegistry</code>, which essentially maintains a map of <code>org.hibernate.type.BasicType</code> (a <code>org.hibernate.type.Type</code> specialization) instances keyed by a name.
That is the purpose of the "BasicTypeRegistry key(s)" column in the previous tables.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-annotation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-annotation"></a>2.3.2. The <code>@Basic</code> annotation</h4>
<div class="paragraph">
<p>Strictly speaking, a basic type is denoted by the <code>javax.persistence.Basic</code> annotation.
Generally speaking, the <code>@Basic</code> annotation can be ignored, as it is assumed by default.
Both of the following examples are ultimately the same.</p>
</div>
<div id="basic-annotation-explicit-example" class="exampleblock">
<div class="title">Example 3. <code>@Basic</code> declared explicitly</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@Basic</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Basic</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sku</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Basic</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Basic</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="basic-annotation-implicit-example" class="exampleblock">
<div class="title">Example 4. <code>@Basic</code> being implicitly implied</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sku</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JPA specification strictly limits the Java types that can be marked as basic to the following listing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java primitive types (<code>boolean</code>, <code>int</code>, etc)</p>
</li>
<li>
<p>wrappers for the primitive types (<code>java.lang.Boolean</code>, <code>java.lang.Integer</code>, etc)</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.util.Calendar</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.sql.Time</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
<li>
<p><code>byte[]</code> or <code>Byte[]</code></p>
</li>
<li>
<p><code>char[]</code> or <code>Character[]</code></p>
</li>
<li>
<p><code>enums</code></p>
</li>
<li>
<p>any other type that implements <code>Serializable</code> (JPAâ€™s "support" for <code>Serializable</code> types is to directly serialize their state to the database).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If provider portability is a concern, you should stick to just these basic types.
Note that JPA 2.1 did add the notion of a <code>javax.persistence.AttributeConverter</code> to help alleviate some of these concerns; see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert">JPA 2.1 AttributeConverters</a> for more on this topic.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>@Basic</code> annotation defines 2 attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>optional</code> - boolean (defaults to true)</dt>
<dd>
<p>Defines whether this attribute allows nulls.
JPA defines this as "a hint", which essentially means that it effect is specifically required.
As long as the type is not primitive, Hibernate takes this to mean that the underlying column should be <code>NULLABLE</code>.</p>
</dd>
<dt class="hdlist1"><code>fetch</code> - FetchType (defaults to EAGER)</dt>
<dd>
<p>Defines whether this attribute should be fetched eagerly or lazily.
JPA says that EAGER is a requirement to the provider (Hibernate) that the value should be fetched when the owner is fetched, while LAZY is merely a hint that the value is fetched when the attribute is accessed.
Hibernate ignores this setting for basic types unless you are using bytecode enhancement.
See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement">BytecodeEnhancement</a> for additional information on fetching and on bytecode enhancement.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="basic-column-annotation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-column-annotation"></a>2.3.3. The <code>@Column</code> annotation</h4>
<div class="paragraph">
<p>JPA defines rules for implicitly determining the name of tables and columns.
For a detailed discussion of implicit naming see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naming">Naming</a>.</p>
</div>
<div class="paragraph">
<p>For basic type attributes, the implicit naming rule is that the column name is the same as the attribute name.
If that implicit naming rule does not meet your requirements, you can explicitly tell Hibernate (and other providers) the column name to use.</p>
</div>
<div id="basic-annotation-explicit-column-example" class="exampleblock">
<div class="title">Example 5. Explicit column naming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sku</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"NOTES"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we use <code>@Column</code> to explicitly map the <code>description</code> attribute to the <code>NOTES</code> column, as opposed to the implicit column name <code>description</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Column</code> annotation defines other mapping information as well. See its Javadocs for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-registry"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-registry"></a>2.3.4. BasicTypeRegistry</h4>
<div class="paragraph">
<p>We said before that a Hibernate type is not a Java type, nor a SQL type, but that it understands both and performs the marshalling between them.
But looking at the basic type mappings from the previous examples,
how did Hibernate know to use its <code>org.hibernate.type.StringType</code> for mapping for <code>java.lang.String</code> attributes,
or its <code>org.hibernate.type.IntegerType</code> for mapping <code>java.lang.Integer</code> attributes?</p>
</div>
<div class="paragraph">
<p>The answer lies in a service inside Hibernate called the <code>org.hibernate.type.BasicTypeRegistry</code>, which essentially maintains a map of <code>org.hibernate.type.BasicType</code> (a <code>org.hibernate.type.Type</code> specialization) instances keyed by a name.</p>
</div>
<div class="paragraph">
<p>We will see later, in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-type-annotation">Explicit BasicTypes</a> section, that we can explicitly tell Hibernate which BasicType to use for a particular attribute.
But first, letâ€™s explore how implicit resolution works and how applications can adjust the implicit resolution.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A thorough discussion of the <code>BasicTypeRegistry</code> and all the different ways to contribute types to it is beyond the scope of this documentation.
Please see Integrations Guide for complete details.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As an example, take a String attribute such as we saw before with Product#sku.
Since there was no explicit type mapping, Hibernate looks to the <code>BasicTypeRegistry</code> to find the registered mapping for <code>java.lang.String</code>.
This goes back to the "BasicTypeRegistry key(s)" column we saw in the tables at the start of this chapter.</p>
</div>
<div class="paragraph">
<p>As a baseline within <code>BasicTypeRegistry</code>, Hibernate follows the recommended mappings of JDBC for Java types.
JDBC recommends mapping Strings to VARCHAR, which is the exact mapping that <code>StringType</code> handles.
So that is the baseline mapping within <code>BasicTypeRegistry</code> for Strings.</p>
</div>
<div class="paragraph">
<p>Applications can also extend (add new <code>BasicType</code> registrations) or override (replace an existing <code>BasicType</code> registration) using one of the
<code>MetadataBuilder#applyBasicType</code> methods or the <code>MetadataBuilder#applyTypes</code> method during bootstrap.
For more details, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type">Custom BasicTypes</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-type-annotation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-type-annotation"></a>2.3.5. Explicit BasicTypes</h4>
<div class="paragraph">
<p>Sometimes you want a particular attribute to be handled differently.
Occasionally Hibernate will implicitly pick a <code>BasicType</code> that you do not want (and for some reason you do not want to adjust the <code>BasicTypeRegistry</code>).</p>
</div>
<div class="paragraph">
<p>In these cases, you must explicitly tell Hibernate the <code>BasicType</code> to use, via the <code>org.hibernate.annotations.Type</code> annotation.</p>
</div>
<div id="basic-type-annotation-example" class="exampleblock">
<div class="title">Example 6. Using <code>@org.hibernate.annotations.Type</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sku</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nstring"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"materialized_nclob"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This tells Hibernate to store the Strings as nationalized data.
This is just for illustration purposes; for better ways to indicate nationalized character data see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-nationalized">Mapping Nationalized Character Data</a> section.</p>
</div>
<div class="paragraph">
<p>Additionally, the description is to be handled as a LOB. Again, for better ways to indicate LOBs see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-lob">Mapping LOBs</a> section.</p>
</div>
<div class="paragraph">
<p>The <code>org.hibernate.annotations.Type#type</code> attribute can name any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fully qualified name of any <code>org.hibernate.type.Type</code> implementation</p>
</li>
<li>
<p>Any key registered with <code>BasicTypeRegistry</code></p>
</li>
<li>
<p>The name of any known <em>type definitions</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="basic-custom-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type"></a>2.3.6. Custom BasicTypes</h4>
<div class="paragraph">
<p>Hibernate makes it relatively easy for developers to create their own basic type mappings type.
For example, you might want to persist properties of type <code>java.util.BigInteger</code> to <code>VARCHAR</code> columns, or support completely new types.</p>
</div>
<div class="paragraph">
<p>There are two approaches to developing a custom type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>implementing a <code>BasicType</code> and registering it</p>
</li>
<li>
<p>implementing a <code>UserType</code> which doesnâ€™t require type registration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a means of illustrating the different approaches, letâ€™s consider a use case where we need to support a <code>java.util.BitSet</code> mapping thatâ€™s stored as a VARCHAR.</p>
</div>
<div class="sect4">
<h5 id="basic-custom-type-BasicType"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type-BasicType"></a>Implementing a <code>BasicType</code></h5>
<div class="paragraph">
<p>The first approach is to directly implement the <code>BasicType</code> interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the <code>BasicType</code> interface has a lot of methods to implement, itâ€™s much more convenient to extend the <code>AbstractStandardBasicType</code>,
or the <code>AbstractSingleColumnStandardBasicType</code> if the value is stored in a single database column.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>First, we need to extend the <code>AbstractSingleColumnStandardBasicType</code> like this:</p>
</div>
<div id="basic-custom-type-BitSetType-example" class="exampleblock">
<div class="title">Example 7. Custom <code>BasicType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pln">
        </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractSingleColumnStandardBasicType</span><span class="pun">&lt;</span><span class="typ">BitSet</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DiscriminatorType</span><span class="pun">&lt;</span><span class="typ">BitSet</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> </span><span class="typ">VarcharTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> stringToObject</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> xml</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> fromString</span><span class="pun">(</span><span class="pln"> xml </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> objectToSQLString</span><span class="pun">(</span><span class="typ">BitSet</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Dialect</span><span class="pln"> dialect</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>AbstractSingleColumnStandardBasicType</code> requires an <code>sqlTypeDescriptor</code> and a <code>javaTypeDescriptor</code>.
The <code>sqlTypeDescriptor</code> is <code>VarcharTypeDescriptor.INSTANCE</code> because the database column is a VARCHAR.
On the Java side, we need to use a <code>BitSetTypeDescriptor</code> instance which can be implemented like this:</p>
</div>
<div id="basic-custom-type-BitSetTypeDescriptor-example" class="exampleblock">
<div class="title">Example 8. Custom <code>AbstractTypeDescriptor</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractTypeDescriptor</span><span class="pun">&lt;</span><span class="typ">BitSet</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> DELIMITER </span><span class="pun">=</span><span class="pln"> </span><span class="str">","</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">(</span><span class="typ">BitSet</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">StringBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> token </span><span class="pun">:</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">toLongArray</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                builder</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln"> DELIMITER </span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            builder</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln"> token</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> fromString</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> tokens </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="pln"> DELIMITER </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">long</span><span class="pun">[]</span><span class="pln"> values </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">[</span><span class="pln">tokens</span><span class="pun">.</span><span class="pln">length</span><span class="pun">];</span><span class="pln">

        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> tokens</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            values</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> tokens</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> values </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@SuppressWarnings</span><span class="pun">({</span><span class="str">"unchecked"</span><span class="pun">})</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> X unwrap</span><span class="pun">(</span><span class="typ">BitSet</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isAssignableFrom</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isAssignableFrom</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln"> value</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> unknownUnwrap</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> wrap</span><span class="pun">(</span><span class="pln">X value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isInstance</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> fromString</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isInstance</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BitSet</span><span class="pun">)</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> unknownWrap</span><span class="pun">(</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>unwrap</code> method is used when passing a <code>BitSet</code> as a <code>PreparedStatement</code> bind parameter, while the <code>wrap</code> method is used to transform the JDBC column value object (e.g. <code>String</code> in our case) to the actual mapping object type (e.g. <code>BitSet</code> in this example).</p>
</div>
<div class="paragraph">
<p>The <code>BasicType</code> must be registered, and this can be done at bootstrapping time:</p>
</div>
<div id="basic-custom-type-register-BasicType-example" class="exampleblock">
<div class="title">Example 9. Register a Custom <code>BasicType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">configuration</span><span class="pun">.</span><span class="pln">registerTypeContributor</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">typeContributions</span><span class="pun">,</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	typeContributions</span><span class="pun">.</span><span class="pln">contributeType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <code>MetadataBuilder</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MetadataSources</span><span class="pln"> sources </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">);</span><span class="pln">

</span><span class="typ">MetadataBuilder</span><span class="pln"> metadataBuilder </span><span class="pun">=</span><span class="pln"> sources</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">();</span><span class="pln">

metadataBuilder</span><span class="pun">.</span><span class="pln">applyBasicType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the new <code>BitSetType</code> being registered as <code>bitset</code>, the entity mapping looks like this:</p>
</div>
<div id="basic-custom-type-BitSetType-mapping-example" class="exampleblock">
<div class="title">Example 10. Custom <code>BasicType</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> bitSet</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>@TypeDef</code> and skip the registration phase:</p>
</div>
<div id="basic-custom-type-BitSetTypeDef-mapping-example" class="exampleblock">
<div class="title">Example 11. Using <code>@TypeDef</code> to register a custom Type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@TypeDef</span><span class="pun">(</span><span class="pln">
	name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pun">,</span><span class="pln">
	defaultForType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	typeClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BitSetType</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> bitSet</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To validate this new <code>BasicType</code> implementation, we can test it as follows:</p>
</div>
<div id="basic-custom-type-BitSetType-persistence-example" class="exampleblock">
<div class="title">Example 12. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">BitSet</span><span class="pln"> bitSet </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInHibernate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">sessionFactory</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	product</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	product</span><span class="pun">.</span><span class="pln">setBitSet</span><span class="pun">(</span><span class="pln"> bitSet </span><span class="pun">);</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInHibernate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">sessionFactory</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln">bitSet</span><span class="pun">,</span><span class="pln"> product</span><span class="pun">.</span><span class="pln">getBitSet</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing this unit test, Hibernate generates the following SQL statements:</p>
</div>
<div id="basic-custom-type-BitSetType-persistence-sql-example" class="exampleblock">
<div class="title">Example 13. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">DEBUG SQL</span><span class="pun">:</span><span class="lit">92</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
    insert
    </span><span class="kwd">into</span><span class="pln">
        </span><span class="typ">Product</span><span class="pln">
        </span><span class="pun">(</span><span class="pln">bitSet</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
    values
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

TRACE </span><span class="typ">BasicBinder</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">65</span><span class="pun">,</span><span class="pln"> </span><span class="lit">128</span><span class="pun">,</span><span class="pln"> </span><span class="lit">129</span><span class="pun">}]</span><span class="pln">
TRACE </span><span class="typ">BasicBinder</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

DEBUG SQL</span><span class="pun">:</span><span class="lit">92</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
    </span><span class="kwd">select</span><span class="pln">
        bitsettype0_</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
        bitsettype0_</span><span class="pun">.</span><span class="pln">bitSet </span><span class="kwd">as</span><span class="pln"> bitSet2_0_0_
    </span><span class="kwd">from</span><span class="pln">
        </span><span class="typ">Product</span><span class="pln"> bitsettype0_
    </span><span class="kwd">where</span><span class="pln">
        bitsettype0_</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

TRACE </span><span class="typ">BasicBinder</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
TRACE </span><span class="typ">BasicExtractor</span><span class="pun">:</span><span class="lit">61</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">bitSet2_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">65</span><span class="pun">,</span><span class="pln"> </span><span class="lit">128</span><span class="pun">,</span><span class="pln"> </span><span class="lit">129</span><span class="pun">}]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>BitSetType</code> takes care of the <em>Java-to-SQL</em> and <em>SQL-to-Java</em> type conversion.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-custom-type-UserType"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type-UserType"></a>Implementing a <code>UserType</code></h5>
<div class="paragraph">
<p>The second approach is to implement the <code>UserType</code> interface.</p>
</div>
<div id="basic-custom-type-BitSetUserType-example" class="exampleblock">
<div class="title">Example 14. Custom <code>UserType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> sqlTypes</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="typ">StringType</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">sqlType</span><span class="pun">()};</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Class</span><span class="pln"> returnedClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> x</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">(</span><span class="pln"> x </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> nullSafeGet</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">ResultSet</span><span class="pln"> rs</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> names</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> owner</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SQLException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> columnName </span><span class="pun">=</span><span class="pln"> names</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> columnValue </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> rs</span><span class="pun">.</span><span class="pln">getObject</span><span class="pun">(</span><span class="pln"> columnName </span><span class="pun">);</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">debugv</span><span class="pun">(</span><span class="str">"Result set column {0} value is {1}"</span><span class="pun">,</span><span class="pln"> columnName</span><span class="pun">,</span><span class="pln"> columnValue</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> columnValue </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln">
				</span><span class="typ">BitSetTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">fromString</span><span class="pun">(</span><span class="pln"> columnValue </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> nullSafeSet</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">PreparedStatement</span><span class="pln"> st</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SQLException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debugv</span><span class="pun">(</span><span class="str">"Binding null to parameter {0} "</span><span class="pun">,</span><span class="pln">index</span><span class="pun">);</span><span class="pln">
            st</span><span class="pun">.</span><span class="pln">setNull</span><span class="pun">(</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Types</span><span class="pun">.</span><span class="pln">VARCHAR </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> stringValue </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BitSetTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BitSet</span><span class="pun">)</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debugv</span><span class="pun">(</span><span class="str">"Binding {0} to parameter {1} "</span><span class="pun">,</span><span class="pln"> stringValue</span><span class="pun">,</span><span class="pln"> index</span><span class="pun">);</span><span class="pln">
            st</span><span class="pun">.</span><span class="pln">setString</span><span class="pun">(</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> stringValue </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> deepCopy</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln">
            </span><span class="typ">BitSet</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">cast</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">).</span><span class="pln">toLongArray</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isMutable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> disassemble</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BitSet</span><span class="pun">)</span><span class="pln"> deepCopy</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> assemble</span><span class="pun">(</span><span class="typ">Serializable</span><span class="pln"> cached</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> owner</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> deepCopy</span><span class="pun">(</span><span class="pln"> cached </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> replace</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> original</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> target</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> owner</span><span class="pun">)</span><span class="pln">
			</span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> deepCopy</span><span class="pun">(</span><span class="pln"> original </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The entity mapping looks as follows:</p>
</div>
<div id="basic-custom-type-BitSetUserType-mapping-example" class="exampleblock">
<div class="title">Example 15. Custom <code>UserType</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BitSet</span><span class="pln"> bitSet</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Constructors, getters, and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>UserType</code> is registered under the <code>bitset</code> name, and this is done like this:</p>
</div>
<div id="basic-custom-type-register-UserType-example" class="exampleblock">
<div class="title">Example 16. Register a Custom <code>UserType</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">configuration</span><span class="pun">.</span><span class="pln">registerTypeContributor</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">typeContributions</span><span class="pun">,</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	typeContributions</span><span class="pun">.</span><span class="pln">contributeType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or using the <code>MetadataBuilder</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MetadataSources</span><span class="pln"> sources </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">);</span><span class="pln">

</span><span class="typ">MetadataBuilder</span><span class="pln"> metadataBuilder </span><span class="pun">=</span><span class="pln"> sources</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">();</span><span class="pln">

metadataBuilder</span><span class="pun">.</span><span class="pln">applyBasicType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BitSetUserType</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"bitset"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Like <code>BasicType</code>, you can also register the <code>UserType</code> using a simple name.</p>
</div>
<div class="paragraph">
<p>Without registration, the <code>UserType</code> mapping requires the fully-classified name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.userguide.mapping.basic.BitSetUserType"</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When running the previous test case against the <code>BitSetUserType</code> entity mapping, Hibernate executed the following SQL statements:</p>
</div>
<div id="basic-custom-type-BitSetUserType-persistence-sql-example" class="exampleblock">
<div class="title">Example 17. Persisting the custom <code>BasicType</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">DEBUG SQL</span><span class="pun">:</span><span class="lit">92</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
    insert
    </span><span class="kwd">into</span><span class="pln">
        </span><span class="typ">Product</span><span class="pln">
        </span><span class="pun">(</span><span class="pln">bitSet</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
    values
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

DEBUG </span><span class="typ">BitSetUserType</span><span class="pun">:</span><span class="lit">71</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="typ">Binding</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="lit">10</span><span class="pun">,</span><span class="lit">11</span><span class="pln"> to parameter </span><span class="lit">1</span><span class="pln">
TRACE </span><span class="typ">BasicBinder</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

DEBUG SQL</span><span class="pun">:</span><span class="lit">92</span><span class="pln"> </span><span class="pun">-</span><span class="pln">
    </span><span class="kwd">select</span><span class="pln">
        bitsetuser0_</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
        bitsetuser0_</span><span class="pun">.</span><span class="pln">bitSet </span><span class="kwd">as</span><span class="pln"> bitSet2_0_0_
    </span><span class="kwd">from</span><span class="pln">
        </span><span class="typ">Product</span><span class="pln"> bitsetuser0_
    </span><span class="kwd">where</span><span class="pln">
        bitsetuser0_</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

TRACE </span><span class="typ">BasicBinder</span><span class="pun">:</span><span class="lit">65</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
DEBUG </span><span class="typ">BitSetUserType</span><span class="pun">:</span><span class="lit">56</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="typ">Result</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> column bitSet2_0_0_ value </span><span class="kwd">is</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="lit">10</span><span class="pun">,</span><span class="lit">11</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-enums"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums"></a>2.3.7. Mapping enums</h4>
<div class="paragraph">
<p>Hibernate supports the mapping of Java enums as basic value types in a number of different ways.</p>
</div>
<div class="sect4">
<h5 id="basic-enums-Enumerated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-Enumerated"></a><code>@Enumerated</code></h5>
<div class="paragraph">
<p>The original JPA-compliant way to map enums was via the <code>@Enumerated</code> or <code>@MapKeyEnumerated</code> for map keys annotations, working on the principle that the enum values are stored according to one of 2 strategies indicated by <code>javax.persistence.EnumType</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ORDINAL</code></dt>
<dd>
<p>stored according to the enum valueâ€™s ordinal position within the enum class, as indicated by <code>java.lang.Enum#ordinal</code></p>
</dd>
<dt class="hdlist1"><code>STRING</code></dt>
<dd>
<p>stored according to the enum valueâ€™s name, as indicated by <code>java.lang.Enum#name</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Assuming the following enumeration:</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. <code>PhoneType</code> enumeration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    LAND_LINE</span><span class="pun">,</span><span class="pln">
    MOBILE</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the ORDINAL example, the <code>phone_type</code> column is defined as a (nullable) INTEGER type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>0</code></dt>
<dd>
<p>For the <code>LAND_LINE</code> enum</p>
</dd>
<dt class="hdlist1"><code>1</code></dt>
<dd>
<p>For the <code>MOBILE</code> enum</p>
</dd>
</dl>
</div>
<div id="basic-enums-Enumerated-ordinal-example" class="exampleblock">
<div class="title">Example 19. <code>@Enumerated(ORDINAL)</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_number"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">ORDINAL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_type"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting this entity, Hibernate generates the following SQL statement:</p>
</div>
<div id="basic-enums-Enumerated-ordinal-persistence-example" class="exampleblock">
<div class="title">Example 20. Persisting an entity with an <code>@Enumerated(ORDINAL)</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-78990"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">MOBILE </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">phone_number</span><span class="pun">,</span><span class="pln"> phone_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'123-456-78990'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the STRING example, the <code>phone_type</code> column is defined as a (nullable) VARCHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>LAND_LINE</code></dt>
<dd>
<p>For the <code>LAND_LINE</code> enum</p>
</dd>
<dt class="hdlist1"><code>MOBILE</code></dt>
<dd>
<p>For the <code>MOBILE</code> enum</p>
</dd>
</dl>
</div>
<div id="basic-enums-Enumerated-string-example" class="exampleblock">
<div class="title">Example 21. <code>@Enumerated(STRING)</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_number"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_type"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Persisting the same entity as in the <code>@Enumerated(ORDINAL)</code> example, Hibernate generates the following SQL statement:</p>
</div>
<div id="basic-enums-Enumerated-string-persistence-example" class="exampleblock">
<div class="title">Example 22. Persisting an entity with an <code>@Enumerated(STRING)</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">phone_number</span><span class="pun">,</span><span class="pln"> phone_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'123-456-78990'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'MOBILE'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-enums-attribute-converter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-attribute-converter"></a>AttributeConverter</h5>
<div class="paragraph">
<p>Letâ€™s consider the following <code>Gender</code> enum which stores its values using the <code>'M'</code> and <code>'F'</code> codes.</p>
</div>
<div id="basic-enums-converter-example" class="exampleblock">
<div class="title">Example 23. Enum with a custom constructor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    MALE</span><span class="pun">(</span><span class="pln"> </span><span class="str">'M'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
    FEMALE</span><span class="pun">(</span><span class="pln"> </span><span class="str">'F'</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> code</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Gender</span><span class="pun">(</span><span class="kwd">char</span><span class="pln"> code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">code </span><span class="pun">=</span><span class="pln"> code</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> fromCode</span><span class="pun">(</span><span class="kwd">char</span><span class="pln"> code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> code </span><span class="pun">==</span><span class="pln"> </span><span class="str">'M'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> code </span><span class="pun">==</span><span class="pln"> </span><span class="str">'m'</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> MALE</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> code </span><span class="pun">==</span><span class="pln"> </span><span class="str">'F'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> code </span><span class="pun">==</span><span class="pln"> </span><span class="str">'f'</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> FEMALE</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UnsupportedOperationException</span><span class="pun">(</span><span class="pln">
            </span><span class="str">"The code "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> code </span><span class="pun">+</span><span class="pln"> </span><span class="str">" is not supported!"</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> getCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> code</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can map enums in a JPA compliant way using a JPA 2.1 AttributeConverter.</p>
</div>
<div id="basic-enums-attribute-converter-example" class="exampleblock">
<div class="title">Example 24. Enum mapping with <code>AttributeConverter</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Convert</span><span class="pun">(</span><span class="pln"> converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenderConverter</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> gender</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Converter</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GenderConverter</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AttributeConverter</span><span class="pun">&lt;</span><span class="typ">Gender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Character</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Character</span><span class="pln"> convertToDatabaseColumn</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> value </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">return</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">getCode</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> convertToEntityAttribute</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Character</span><span class="pln"> value </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Gender</span><span class="pun">.</span><span class="pln">fromCode</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the gender column is defined as a CHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>'M'</code></dt>
<dd>
<p>For the <code>MALE</code> enum</p>
</dd>
<dt class="hdlist1"><code>'F'</code></dt>
<dd>
<p>For the <code>FEMALE</code> enum</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For additional details on using AttributeConverters, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert">JPA 2.1 AttributeConverters</a> section.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPA explicitly disallows the use of an AttributeConverter with an attribute marked as <code>@Enumerated</code>.
So if using the AttributeConverter approach, be sure not to mark the attribute as <code>@Enumerated</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="basic-attribute-converter-query-parameter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-attribute-converter-query-parameter"></a>Using the AttributeConverter entity property as a query parameter</h6>
<div class="paragraph">
<p>Assuming you have the following entity:</p>
</div>
<div id="basic-attribute-converter-query-parameter-entity-example" class="exampleblock">
<div class="title">Example 25. <code>Photo</code> entity with <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Photo"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Photo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Convert</span><span class="pun">(</span><span class="pln">converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CaptionConverter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Caption</span><span class="pln"> caption</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And the <code>Caption</code> class looks as follows:</p>
</div>
<div id="basic-attribute-converter-query-parameter-object-example" class="exampleblock">
<div class="title">Example 26. <code>Caption</code> Java object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Caption</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> text</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Caption</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getText</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> text</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setText</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Caption</span><span class="pln"> caption </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Caption</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> text </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> text</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> caption</span><span class="pun">.</span><span class="pln">text </span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> caption</span><span class="pun">.</span><span class="pln">text </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">

	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> text </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> text</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And we have an <code>AttributeConverter</code> to handle the <code>Caption</code> Java object:</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-example" class="exampleblock">
<div class="title">Example 27. <code>Caption</code> Java object AttributeConverter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CaptionConverter</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AttributeConverter</span><span class="pun">&lt;</span><span class="typ">Caption</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> convertToDatabaseColumn</span><span class="pun">(</span><span class="typ">Caption</span><span class="pln"> attribute</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> attribute</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Caption</span><span class="pln"> convertToEntityAttribute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> dbData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Caption</span><span class="pun">(</span><span class="pln"> dbData </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Traditionally, you could only use the dbData <code>Caption</code> representation, which in our case is a <code>String</code>, when referencing the <code>caption</code> entity property.</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-dbdata-example" class="exampleblock">
<div class="title">Example 28. Filtering by the <code>Caption</code> property using the DB data representation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Photo</span><span class="pln"> photo </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Photo p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where upper(caption) = upper(:caption) "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Photo</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"caption"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Nicolae Grigorescu"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to use the Java object <code>Caption</code> representation, you have to get the associated Hibernate <code>Type</code>.</p>
</div>
<div id="basic-attribute-converter-query-parameter-converter-object-example" class="exampleblock">
<div class="title">Example 29. Filtering by the <code>Caption</code> property using the Java Object representation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getEntityManagerFactory</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">MetamodelImplementor</span><span class="pln"> metamodelImplementor </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MetamodelImplementor</span><span class="pun">)</span><span class="pln"> sessionFactory</span><span class="pun">.</span><span class="pln">getMetamodel</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Type</span><span class="pln"> captionType </span><span class="pun">=</span><span class="pln"> metamodelImplementor
		</span><span class="pun">.</span><span class="pln">entityPersister</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Photo</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getPropertyType</span><span class="pun">(</span><span class="pln"> </span><span class="str">"caption"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Photo</span><span class="pln"> photo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Photo</span><span class="pun">)</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Photo p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where upper(caption) = upper(:caption) "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Photo</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Query</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"caption"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Caption</span><span class="pun">(</span><span class="str">"Nicolae Grigorescu"</span><span class="pun">),</span><span class="pln"> captionType</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By passing the associated Hibernate <code>Type</code>, you can use the <code>Caption</code> object when binding the query parameter value.</p>
</div>
</div>
<div class="sect5">
<h6 id="basic-hbm-attribute-converter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-hbm-attribute-converter"></a>Mapping an AttributeConverter using HBM mappings</h6>
<div class="paragraph">
<p>When using HBM mappings, you can still make use of the JPA <code>AttributeConverter</code> because Hibernate supports
such mapping via the <code>type</code> attribute as demonstrated by the following example.</p>
</div>
<div class="paragraph">
<p>Letâ€™s consider we have an application-specific <code>Money</code> type:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-money-example" class="exampleblock">
<div class="title">Example 30. Application-specific <code>Money</code> type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Money</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> cents</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">cents </span><span class="pun">=</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> getCents</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setCents</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> cents</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">cents </span><span class="pun">=</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we want to use the <code>Money</code> type when mapping the <code>Account</code> entity:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-account-example" class="exampleblock">
<div class="title">Example 31. <code>Account</code> entity using the <code>Money</code> type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since Hibernate has no knowledge how to persist the <code>Money</code> type, we could use a JPA <code>AttributeConverter</code>
to transform the <code>Money</code> type as a <code>Long</code>. For this purpose, we are going to use the following
<code>MoneyConverter</code> utility:</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-moneyconverter-example" class="exampleblock">
<div class="title">Example 32. <code>MoneyConverter</code> implementing the JPA <code>AttributeConverter</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MoneyConverter</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AttributeConverter</span><span class="pun">&lt;</span><span class="typ">Money</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> convertToDatabaseColumn</span><span class="pun">(</span><span class="typ">Money</span><span class="pln"> attribute</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> attribute </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> attribute</span><span class="pun">.</span><span class="pln">getCents</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> convertToEntityAttribute</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> dbData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> dbData </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Money</span><span class="pun">(</span><span class="pln"> dbData </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To map the <code>MoneyConverter</code> using HBM configuration files you need to use the <code>converted::</code> prefix in the <code>type</code>
attribute of the <code>property</code> element.</p>
</div>
<div id="basic-hbm-attribute-converter-mapping-xml-config-example" class="exampleblock">
<div class="title">Example 33. HBM mapping for <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="dec">&lt;!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span><span class="pln">

</span><span class="tag">&lt;hibernate-mapping</span><span class="pln"> </span><span class="atn">package</span><span class="pun">=</span><span class="atv">"org.hibernate.userguide.mapping.converter.hbm"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Account"</span><span class="pln"> </span><span class="atn">table</span><span class="pun">=</span><span class="atv">"account"</span><span class="pln"> </span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;id</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"id"</span><span class="tag">/&gt;</span><span class="pln">

        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"owner"</span><span class="tag">/&gt;</span><span class="pln">

        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"balance"</span><span class="pln">
            </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"converted::org.hibernate.userguide.mapping.converter.hbm.MoneyConverter"</span><span class="tag">/&gt;</span><span class="pln">

    </span><span class="tag">&lt;/class&gt;</span><span class="pln">
</span><span class="tag">&lt;/hibernate-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-enums-custom-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-custom-type"></a>Custom type</h5>
<div class="paragraph">
<p>You can also map enums using a Hibernate custom type mapping.
Letâ€™s again revisit the Gender enum example, this time using a custom Type to store the more standardized <code>'M'</code> and <code>'F'</code> codes.</p>
</div>
<div id="basic-enums-custom-type-example" class="exampleblock">
<div class="title">Example 34. Enum mapping with custom Type example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.userguide.mapping.basic.GenderType"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> gender</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GenderType</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractSingleColumnStandardBasicType</span><span class="pun">&lt;</span><span class="typ">Gender</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">GenderType</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GenderType</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">GenderType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">CharTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">GenderJavaTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"gender"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> registerUnderJavaType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GenderJavaTypeDescriptor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractTypeDescriptor</span><span class="pun">&lt;</span><span class="typ">Gender</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">GenderJavaTypeDescriptor</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GenderJavaTypeDescriptor</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">GenderJavaTypeDescriptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Gender</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">(</span><span class="typ">Gender</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">name</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> fromString</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Gender</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> X unwrap</span><span class="pun">(</span><span class="typ">Gender</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">CharacterTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln">
            value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">getCode</span><span class="pun">(),</span><span class="pln">
            type</span><span class="pun">,</span><span class="pln">
            options
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">Gender</span><span class="pln"> wrap</span><span class="pun">(</span><span class="pln">X value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Gender</span><span class="pun">.</span><span class="pln">fromCode</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">CharacterTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">wrap</span><span class="pun">(</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> options </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again, the gender column is defined as a CHAR type and would hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NULL</code></dt>
<dd>
<p>For null values</p>
</dd>
<dt class="hdlist1"><code>'M'</code></dt>
<dd>
<p>For the <code>MALE</code> enum</p>
</dd>
<dt class="hdlist1"><code>'F'</code></dt>
<dd>
<p>For the <code>FEMALE</code> enum</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For additional details on using custom types, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type">Custom BasicTypes</a> section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-lob"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-lob"></a>2.3.8. Mapping LOBs</h4>
<div class="paragraph">
<p>Mapping LOBs (database Large Objects) come in 2 forms, those using the JDBC locator types and those materializing the LOB data.</p>
</div>
<div class="paragraph">
<p>JDBC LOB locators exist to allow efficient access to the LOB data.
They allow the JDBC driver to stream parts of the LOB data as needed, potentially freeing up memory space.
However, they can be unnatural to deal with and have certain limitations.
For example, a LOB locator is only portably valid during the duration of the transaction in which it was obtained.</p>
</div>
<div class="paragraph">
<p>The idea of materialized LOBs is to trade-off the potential efficiency (not all drivers handle LOB data efficiently) for a more natural programming paradigm using familiar Java types such as <code>String</code> or <code>byte[]</code>, etc for these LOBs.</p>
</div>
<div class="paragraph">
<p>Materialized deals with the entire LOB contents in memory, whereas LOB locators (in theory) allow streaming parts of the LOB contents into memory as needed.</p>
</div>
<div class="paragraph">
<p>The JDBC LOB locator types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.sql.Blob</code></p>
</li>
<li>
<p><code>java.sql.Clob</code></p>
</li>
<li>
<p><code>java.sql.NClob</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mapping materialized forms of these LOB values would use more familiar Java types such as <code>String</code>, <code>char[]</code>, <code>byte[]</code>, etc.
The trade-off for <em>more familiar</em> is usually performance.</p>
</div>
<div class="sect4">
<h5 id="basic-clob"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-clob"></a>Mapping CLOB</h5>
<div class="paragraph">
<p>For a first look, letâ€™s assume we have a <code>CLOB</code> column that we would like to map (<code>NCLOB</code> character <code>LOB</code> data will be covered in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-nationalized">Mapping Nationalized Character Data</a> section).</p>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-clob-sql-example" class="exampleblock">
<div class="title">Example 35. CLOB - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
  id INTEGER NOT NULL</span><span class="pun">,</span><span class="pln">
  name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
  warranty CLOB</span><span class="pun">,</span><span class="pln">
  PRIMARY KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s first map this using the <code>@Lob</code> JPA annotation and the <code>java.sql.Clob</code> type:</p>
</div>
<div id="basic-clob-example" class="exampleblock">
<div class="title">Example 36. <code>CLOB</code> mapped to <code>java.sql.Clob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Clob</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create a <code>Clob</code> using the <code>ClobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-clob-persist-example" class="exampleblock">
<div class="title">Example 37. Persisting a <code>java.sql.Clob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">String</span><span class="pln"> warranty </span><span class="pun">=</span><span class="pln"> </span><span class="str">"My product warranty"</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mobile phone"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

product</span><span class="pun">.</span><span class="pln">setWarranty</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ClobProxy</span><span class="pun">.</span><span class="pln">generateProxy</span><span class="pun">(</span><span class="pln"> warranty </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>Clob</code> content, you need to transform the underlying <code>java.io.Reader</code>:</p>
</div>
<div id="basic-clob-find-example" class="exampleblock">
<div class="title">Example 38. Returning a <code>java.sql.Clob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> productId </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Reader</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> product</span><span class="pun">.</span><span class="pln">getWarranty</span><span class="pun">().</span><span class="pln">getCharacterStream</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"My product warranty"</span><span class="pun">,</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln"> reader </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the CLOB in a materialized form. This way, we can either use a <code>String</code> or a <code>char[]</code>.</p>
</div>
<div id="basic-clob-string-example" class="exampleblock">
<div class="title">Example 39. <code>CLOB</code> mapped to <code>String</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Lob</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>How JDBC deals with <code>LOB</code> data varies from driver to driver, and Hibernate tries to handle all these variances on your behalf.</p>
</div>
<div class="paragraph">
<p>However, some drivers are trickier (e.g. PostgreSQL), and, in such cases, you may have to do some extra to get LOBs working.
Such discussions are beyond the scope of this guide.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>We might even want the materialized data as a char array (although this might not be a very good idea).</p>
</div>
<div id="basic-clob-char-array-example" class="exampleblock">
<div class="title">Example 40. CLOB - materialized <code>char[]</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Lob</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">[]</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-blob"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-blob"></a>Mapping BLOB</h5>
<div class="paragraph">
<p><code>BLOB</code> data is mapped in a similar fashion.</p>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-blob-sql-example" class="exampleblock">
<div class="title">Example 41. BLOB - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id INTEGER NOT NULL </span><span class="pun">,</span><span class="pln">
    image blob </span><span class="pun">,</span><span class="pln">
    name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s first map this using the JDBC <code>java.sql.Blob</code> type.</p>
</div>
<div id="basic-blob-example" class="exampleblock">
<div class="title">Example 42. <code>BLOB</code> mapped to <code>java.sql.Blob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Blob</span><span class="pln"> image</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create a <code>Blob</code> using the <code>BlobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-blob-persist-example" class="exampleblock">
<div class="title">Example 43. Persisting a <code>java.sql.Blob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> image </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mobile phone"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

product</span><span class="pun">.</span><span class="pln">setImage</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BlobProxy</span><span class="pun">.</span><span class="pln">generateProxy</span><span class="pun">(</span><span class="pln"> image </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>Blob</code> content, you need to transform the underlying <code>java.io.InputStream</code>:</p>
</div>
<div id="basic-blob-find-example" class="exampleblock">
<div class="title">Example 44. Returning a <code>java.sql.Blob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> productId </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">InputStream</span><span class="pln"> inputStream </span><span class="pun">=</span><span class="pln"> product</span><span class="pun">.</span><span class="pln">getImage</span><span class="pun">().</span><span class="pln">getBinaryStream</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertArrayEquals</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">},</span><span class="pln"> toBytes</span><span class="pun">(</span><span class="pln"> inputStream </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the BLOB in a materialized form (e.g. <code>byte[]</code>).</p>
</div>
<div id="basic-blob-byte-array-example" class="exampleblock">
<div class="title">Example 45. <code>BLOB</code> mapped to <code>byte[]</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> image</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-nationalized"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-nationalized"></a>2.3.9. Mapping Nationalized Character Data</h4>
<div class="paragraph">
<p>JDBC 4 added the ability to explicitly handle nationalized character data.
To this end, it added specific nationalized character data types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NCHAR</code></p>
</li>
<li>
<p><code>NVARCHAR</code></p>
</li>
<li>
<p><code>LONGNVARCHAR</code></p>
</li>
<li>
<p><code>NCLOB</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering we have the following database table:</p>
</div>
<div id="basic-nationalized-sql-example" class="exampleblock">
<div class="title">Example 46. <code>NVARCHAR</code> - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">CREATE TABLE </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id INTEGER NOT NULL </span><span class="pun">,</span><span class="pln">
    name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    warranty NVARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To map a specific attribute to a nationalized variant data type, Hibernate defines the <code>@Nationalized</code> annotation.</p>
</div>
<div id="basic-nationalized-example" class="exampleblock">
<div class="title">Example 47. <code>NVARCHAR</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Nationalized</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with <code>CLOB</code>, Hibernate can also deal with <code>NCLOB</code> SQL data types:</p>
</div>
<div id="basic-nclob-sql-example" class="exampleblock">
<div class="title">Example 48. <code>NCLOB</code> - SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">CREATE TABLE </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id INTEGER NOT NULL </span><span class="pun">,</span><span class="pln">
    name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    warranty nclob </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate can map the <code>NCLOB</code> to a <code>java.sql.NClob</code></p>
</div>
<div id="basic-nclob-example" class="exampleblock">
<div class="title">Example 49. <code>NCLOB</code> mapped to <code>java.sql.NClob</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="lit">@Nationalized</span><span class="pln">
    </span><span class="com">// Clob also works, because NClob extends Clob.</span><span class="pln">
    </span><span class="com">// The database type is still NCLOB either way and handled as such.</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">NClob</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To persist such an entity, you have to create an <code>NClob</code> using the <code>NClobProxy</code> Hibernate utility:</p>
</div>
<div id="basic-nclob-persist-example" class="exampleblock">
<div class="title">Example 50. Persisting a <code>java.sql.NClob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">String</span><span class="pln"> warranty </span><span class="pun">=</span><span class="pln"> </span><span class="str">"My product warranty"</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mobile phone"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

product</span><span class="pun">.</span><span class="pln">setWarranty</span><span class="pun">(</span><span class="pln"> </span><span class="typ">NClobProxy</span><span class="pun">.</span><span class="pln">generateProxy</span><span class="pun">(</span><span class="pln"> warranty </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To retrieve the <code>NClob</code> content, you need to transform the underlying <code>java.io.Reader</code>:</p>
</div>
<div id="basic-nclob-find-example" class="exampleblock">
<div class="title">Example 51. Returning a <code>java.sql.NClob</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> productId </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Reader</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> product</span><span class="pun">.</span><span class="pln">getWarranty</span><span class="pun">().</span><span class="pln">getCharacterStream</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"My product warranty"</span><span class="pun">,</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln"> reader </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We could also map the <code>NCLOB</code> in a materialized form. This way, we can either use a <code>String</code> or a <code>char[]</code>.</p>
</div>
<div id="basic-nclob-string-example" class="exampleblock">
<div class="title">Example 52. <code>NCLOB</code> mapped to <code>String</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="lit">@Nationalized</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We might even want the materialized data as a char array.</p>
</div>
<div id="basic-nclob-char-array-example" class="exampleblock">
<div class="title">Example 53. NCLOB - materialized <code>char[]</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Lob</span><span class="pln">
    </span><span class="lit">@Nationalized</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">[]</span><span class="pln"> warranty</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you application and database are entirely nationalized you may instead want to enable nationalized character data as the default.
You can do this via the <code>hibernate.use_nationalized_character_data</code> setting or by calling <code>MetadataBuilder#enableGlobalNationalizedCharacterDataSupport</code> during bootstrap.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="basic-uuid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-uuid"></a>2.3.10. Mapping UUID Values</h4>
<div class="paragraph">
<p>Hibernate also allows you to map UUID values, again in a number of ways.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default UUID mapping is as binary because it represents more efficient storage.
However, many applications prefer the readability of character storage.
To switch the default mapping, simply call <code>MetadataBuilder.applyBasicType( UUIDCharType.INSTANCE, UUID.class.getName() )</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_uuid_as_binary"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_uuid_as_binary"></a>2.3.11. UUID as binary</h4>
<div class="paragraph">
<p>As mentioned, the default mapping for UUID attributes.
Maps the UUID to a <code>byte[]</code> using <code>java.util.UUID#getMostSignificantBits</code> and <code>java.util.UUID#getLeastSignificantBits</code> and stores that as <code>BINARY</code> data.</p>
</div>
<div class="paragraph">
<p>Chosen as the default simply because it is generally more efficient from a storage perspective.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uuid_as_var_char"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_uuid_as_var_char"></a>2.3.12. UUID as (var)char</h4>
<div class="paragraph">
<p>Maps the UUID to a String using <code>java.util.UUID#toString</code> and <code>java.util.UUID#fromString</code> and stores that as <code>CHAR</code> or <code>VARCHAR</code> data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_postgresql_specific_uuid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_postgresql_specific_uuid"></a>2.3.13. PostgreSQL-specific UUID</h4>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using one of the PostgreSQL Dialects, this becomes the default UUID mapping.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Maps the UUID using PostgreSQLâ€™s specific UUID data type.
The PostgreSQL JDBC driver chooses to map its UUID type to the <code>OTHER</code> code.
Note that this can cause difficulty as the driver chooses to map many different data types to <code>OTHER</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uuid_as_identifier"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_uuid_as_identifier"></a>2.3.14. UUID as identifier</h4>
<div class="paragraph">
<p>Hibernate supports using UUID values as identifiers, and they can even be generated on the userâ€™s behalf.
For details, see the discussion of generators in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers"><em>Identifier generators</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-datetime"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-datetime"></a>2.3.15. Mapping Date/Time Values</h4>
<div class="paragraph">
<p>Hibernate allows various Java Date/Time classes to be mapped as persistent domain model entity properties.
The SQL standard defines three Date/Time types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DATE</dt>
<dd>
<p>Represents a calendar date by storing years, months and days. The JDBC equivalent is <code>java.sql.Date</code></p>
</dd>
<dt class="hdlist1">TIME</dt>
<dd>
<p>Represents the time of a day and it stores hours, minutes and seconds. The JDBC equivalent is <code>java.sql.Time</code></p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p>It stores both a DATE and a TIME plus nanoseconds. The JDBC equivalent is <code>java.sql.Timestamp</code></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid dependencies on the <code>java.sql</code> package, itâ€™s common to use the <code>java.util</code> or <code>java.time</code> Date/Time classes instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>While the <code>java.sql</code> classes define a direct association to the SQL Date/Time data types,
the <code>java.util</code> or <code>java.time</code> properties need to explicitly mark the SQL type correlation with the <code>@Temporal</code> annotation.
This way, a <code>java.util.Date</code> or a <code>java.util.Calendar</code> can be mapped to either an SQL <code>DATE</code>, <code>TIME</code> or <code>TIMESTAMP</code> type.</p>
</div>
<div class="paragraph">
<p>Considering the following entity:</p>
</div>
<div id="basic-datetime-temporal-date-example" class="exampleblock">
<div class="title">Example 54. <code>java.util.Date</code> mapped as <code>DATE</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DateEvent"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DateEvent</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">DATE</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting such entity:</p>
</div>
<div id="basic-datetime-temporal-date-persist-example" class="exampleblock">
<div class="title">Example 55. Persisting a <code>java.util.Date</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">DateEvent</span><span class="pln"> dateEvent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DateEvent</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> dateEvent </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate generates the following INSERT statement:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">DateEvent</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> timestamp</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'2015-12-29'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only the year, month and the day field were saved into the database.</p>
</div>
<div class="paragraph">
<p>If we change the <code>@Temporal</code> type to <code>TIME</code>:</p>
</div>
<div id="basic-datetime-temporal-time-example" class="exampleblock">
<div class="title">Example 56. <code>java.util.Date</code> mapped as <code>TIME</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIME</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate will issue an INSERT statement containing the hour, minutes and seconds.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">DateEvent</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> timestamp</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'16:51:58'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>@Temporal</code> type is set to <code>TIMESTAMP</code>:</p>
</div>
<div id="basic-datetime-temporal-timestamp-example" class="exampleblock">
<div class="title">Example 57. <code>java.util.Date</code> mapped as <code>TIMESTAMP</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate will include both the <code>DATE</code>, the <code>TIME</code> and the nanoseconds in the INSERT statement:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">DateEvent</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> timestamp</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'2015-12-29 16:54:04.544'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just like the <code>java.util.Date</code>, the <code>java.util.Calendar</code> requires the <code>@Temporal</code> annotation in order to know what JDBC data type to be chosen: DATE, TIME or TIMESTAMP.
If the <code>java.util.Date</code> marks a point in time, the <code>java.util.Calendar</code> takes into consideration the default Time Zone.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="basic-datetime-java8"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-datetime-java8"></a>Mapping Java 8 Date/Time Values</h5>
<div class="paragraph">
<p>Java 8 came with a new Date/Time API, offering support for instant dates, intervals, local and zoned Date/Time immutable instances, bundled in the <code>java.time</code> package.</p>
</div>
<div class="paragraph">
<p>The mapping between the standard SQL Date/Time types and the supported Java 8 Date/Time class types looks as follows;</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DATE</dt>
<dd>
<p><code>java.time.LocalDate</code></p>
</dd>
<dt class="hdlist1">TIME</dt>
<dd>
<p><code>java.time.LocalTime</code>, <code>java.time.OffsetTime</code></p>
</dd>
<dt class="hdlist1">TIMESTAMP</dt>
<dd>
<p><code>java.time.Instant</code>, <code>java.time.LocalDateTime</code>, <code>java.time.OffsetDateTime</code> and <code>java.time.ZonedDateTime</code></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the mapping between Java 8 Date/Time classes and the SQL types is implicit, there is not need to specify the <code>@Temporal</code> annotation.
Setting it on the <code>java.time</code> classes throws the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.hibernate.AnnotationException: @Temporal should only be set on a java.util.Date or java.util.Calendar property</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="basic-datetime-time-zone"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-datetime-time-zone"></a>Using a specific time zone</h5>
<div class="paragraph">
<p>By default, Hibernate is going to use the <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTimestamp-int-java.sql.Timestamp-"><code>PreparedStatement.setTimestamp(int parameterIndex, java.sql.Timestamp)</code></a> or
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTime-int-java.sql.Time-"><code>PreparedStatement.setTime(int parameterIndex, java.sql.Time x)</code></a> when saving a <code>java.sql.Timestamp</code> or a <code>java.sql.Time</code> property.</p>
</div>
<div class="paragraph">
<p>When the time zone is not specified, the JDBC driver is going to use the underlying JVM default time zone, which might not be suitable if the application is used from all across the globe.
For this reason, it is very common to use a single reference time zone (e.g. UTC) whenever saving/loading data from the database.</p>
</div>
<div class="paragraph">
<p>One alternative would be to configure all JVMs to use the reference time zone:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaratively</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">java </span><span class="pun">-</span><span class="typ">Duser</span><span class="pun">.</span><span class="pln">timezone</span><span class="pun">=</span><span class="pln">UTC </span><span class="pun">...</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Programmatically</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">TimeZone</span><span class="pun">.</span><span class="pln">setDefault</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TimeZone</span><span class="pun">.</span><span class="pln">getTimeZone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UTC"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>However, as explained in <a href="http://in.relation.to/2016/09/12/jdbc-time-zone-configuration-property/">this article</a>, this is not always practical, especially for front-end nodes.
For this reason, Hibernate offers the <code>hibernate.jdbc.time_zone</code> configuration property which can be configured:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Declaratively, at the <code>SessionFactory</code> level</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">settings</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">
    </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">JDBC_TIME_ZONE</span><span class="pun">,</span><span class="pln">
    </span><span class="typ">TimeZone</span><span class="pun">.</span><span class="pln">getTimeZone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UTC"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Programmatically, on a per <code>Session</code> basis</dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">withOptions</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">jdbcTimeZone</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TimeZone</span><span class="pun">.</span><span class="pln">getTimeZone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UTC"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With this configuration property in place, Hibernate is going to call the <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTimestamp-int-java.sql.Timestamp-java.util.Calendar-"><code>PreparedStatement.setTimestamp(int parameterIndex, java.sql.Timestamp, Calendar cal)</code></a> or
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTime-int-java.sql.Time-java.util.Calendar-"><code>PreparedStatement.setTime(int parameterIndex, java.sql.Time x, Calendar cal)</code></a>, where the <code>java.util.Calendar</code> references the time zone provided via the <code>hibernate.jdbc.time_zone</code> property.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-jpa-convert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert"></a>2.3.16. JPA 2.1 AttributeConverters</h4>
<div class="paragraph">
<p>Although Hibernate has long been offering <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type">custom types</a>, as a JPA 2.1 provider,
it also supports <code>AttributeConverter</code> as well.</p>
</div>
<div class="paragraph">
<p>With a custom <code>AttributeConverter</code>, the application developer can map a given JDBC type to an entity basic type.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>java.time.Period</code> is going to be mapped to a <code>VARCHAR</code> database column.</p>
</div>
<div id="basic-jpa-convert-period-string-converter-example" class="exampleblock">
<div class="title">Example 58. <code>java.time.Period</code> custom <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Converter</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PeriodStringConverter</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AttributeConverter</span><span class="pun">&lt;</span><span class="typ">Period</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> convertToDatabaseColumn</span><span class="pun">(</span><span class="typ">Period</span><span class="pln"> attribute</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> attribute</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Period</span><span class="pln"> convertToEntityAttribute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> dbData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Period</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln"> dbData </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To make use of this custom converter, the <code>@Convert</code> annotation must decorate the entity attribute.</p>
</div>
<div id="basic-jpa-convert-period-string-converter-mapping-example" class="exampleblock">
<div class="title">Example 59. Entity using the custom <code>java.time.Period</code> <code>AttributeConverter</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Convert</span><span class="pun">(</span><span class="pln">converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PeriodStringConverter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">columnDefinition </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Period</span><span class="pln"> span</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting such entity, Hibernate will do the type conversion based on the <code>AttributeConverter</code> logic:</p>
</div>
<div id="basic-jpa-convert-period-string-converter-sql-example" class="exampleblock">
<div class="title">Example 60. Persisting entity using the custom <code>AttributeConverter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> span</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'P1Y2M3D'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="basic-jpa-convert-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert-type"></a><code>AttributeConverter</code> Java and JDBC types</h5>
<div class="paragraph">
<p>In cases when the Java type specified for the "database side" of the conversion (the second <code>AttributeConverter</code> bind parameter) is not known,
Hibernate will fallback to a <code>java.io.Serializable</code> type.</p>
</div>
<div class="paragraph">
<p>If the Java type is not known to Hibernate, you will encounter the following message:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>HHH000481: Encountered Java type for which we could not locate a JavaTypeDescriptor and which does not appear to implement equals and/or hashCode.
This can lead to significant performance problems when performing equality/dirty checking involving this Java type.
Consider registering a custom JavaTypeDescriptor or at least implementing equals/hashCode.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Whether a Java type is "known" means it has an entry in the <code>JavaTypeDescriptorRegistry</code>.
While by default Hibernate loads many JDK types into the <code>JavaTypeDescriptorRegistry</code>, an application can also expand the <code>JavaTypeDescriptorRegistry</code> by
adding new <code>JavaTypeDescriptor</code> entries.</p>
</div>
<div class="paragraph">
<p>This way, Hibernate will also know how to handle a specific Java Object type at the JDBC level.</p>
</div>
</div>
<div class="sect4">
<h5 id="basic-jpa-convert-mutability"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert-mutability"></a>JPA 2.1 <code>AttributeConverter</code> Mutability Plan</h5>
<div class="paragraph">
<p>A basic type thatâ€™s converted by a JPA <code>AttributeConverter</code> is immutable if the underlying Java type is immutable
and is mutable if the associated attribute type is mutable as well.</p>
</div>
<div class="paragraph">
<p>Therefore, mutability is given by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/type/descriptor/java/JavaTypeDescriptor.html#getMutabilityPlan--"><code>JavaTypeDescriptor#getMutabilityPlan</code></a>
of the associated entity attribute type.</p>
</div>
<div class="sect5">
<h6 id="_immutable_types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_immutable_types"></a>Immutable types</h6>
<div class="paragraph">
<p>If the entity attribute is a <code>String</code>, a primitive wrapper (e.g. <code>Integer</code>, <code>Long</code>) an Enum type, or any other immutable <code>Object</code> type,
then you can only change the entity attribute value by reassigning it to a new value.</p>
</div>
<div class="paragraph">
<p>Considering we have the same <code>Period</code> entity attribute as illustrated in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-jpa-convert">JPA 2.1 AttributeConverters</a> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Convert</span><span class="pun">(</span><span class="pln">converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PeriodStringConverter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">columnDefinition </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Period</span><span class="pln"> span</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only way to change the <code>span</code> attribute is to reassign it to a different value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"from Event"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setSpan</span><span class="pun">(</span><span class="typ">Period</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">ofYears</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">plusMonths</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">plusDays</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mutable_types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_mutable_types"></a>Mutable types</h6>
<div class="paragraph">
<p>On the other hand, consider the following example where the <code>Money</code> type is a mutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Convert</span><span class="pun">(</span><span class="pln">converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MoneyConverter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MoneyConverter</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AttributeConverter</span><span class="pun">&lt;</span><span class="typ">Money</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> convertToDatabaseColumn</span><span class="pun">(</span><span class="typ">Money</span><span class="pln"> attribute</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> attribute </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> attribute</span><span class="pun">.</span><span class="pln">getCents</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Money</span><span class="pln"> convertToEntityAttribute</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> dbData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> dbData </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Money</span><span class="pun">(</span><span class="pln"> dbData </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A mutable <code>Object</code> allows you to modify its internal structure, and Hibernate dirty checking mechanism is going to propagate the change to the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
account</span><span class="pun">.</span><span class="pln">getBalance</span><span class="pun">().</span><span class="pln">setCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">150</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>AttributeConverter</code> types can be mutable so that dirty checking, deep copying and second-level caching work properly,
treating these as immutable (when they really are) is more efficient.</p>
</div>
<div class="paragraph">
<p>For this reason, prefer immutable types over mutable ones whenever possible.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-quoted-identifiers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-quoted-identifiers"></a>2.3.17. SQL quoted identifiers</h4>
<div class="paragraph">
<p>You can force Hibernate to quote an identifier in the generated SQL by enclosing the table or column name in backticks in the mapping document.
While traditionally, Hibernate used backticks for escaping SQL reserved keywords, JPA uses double quotes instead.</p>
</div>
<div class="paragraph">
<p>Once the reserved keywords are escaped, Hibernate will use the correct quotation style for the SQL <code>Dialect</code>.
This is usually double quotes, but SQL Server uses brackets and MySQL uses backticks.</p>
</div>
<div id="basic-quoting-example" class="exampleblock">
<div class="title">Example 61. Hibernate legacy quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="basic-jpa-quoting-example" class="exampleblock">
<div class="title">Example 62. JPA quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"\"name\""</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"\"number\""</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because <code>name</code> and <code>number</code> are reserved words, the <code>Product</code> entity mapping uses backticks to quote these column names.</p>
</div>
<div class="paragraph">
<p>When saving the following <code>Product entity</code>, Hibernate generates the following SQL insert statement:</p>
</div>
<div id="basic-quoting-persistence-example" class="exampleblock">
<div class="title">Example 63. Persisting a quoted column name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mobile phone"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
product</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'Mobile phone'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-global-quoted-identifiers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-global-quoted-identifiers"></a>Global quoting</h5>
<div class="paragraph">
<p>Hibernate can also quote all identifiers (e.g. table, columns) using the following configuration property:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.globally_quoted_identifiers"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, we donâ€™t need to manually quote any identifier:</p>
</div>
<div id="basic-auto-quoting-example" class="exampleblock">
<div class="title">Example 64. JPA quoting</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Product</code> entity, Hibernate is going to quote all identifiers as in the following example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="str">"Product"</span><span class="pln"> </span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'Mobile phone'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, both the table name and all the column have been quoted.</p>
</div>
<div class="paragraph">
<p>For more about quoting-related configuration properties, check out the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-mapping">Mapping configurations</a> section as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-generated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated"></a>2.3.18. Generated properties</h4>
<div class="paragraph">
<p>Generated properties are properties that have their values generated by the database.
Typically, Hibernate applications needed to <code>refresh</code> objects that contain any properties for which the database was generating values.
Marking properties as generated, however, lets the application delegate this responsibility to Hibernate.
When Hibernate issues an SQL INSERT or UPDATE for an entity that has defined generated properties, it immediately issues a select to retrieve the generated values.</p>
</div>
<div class="paragraph">
<p>Properties marked as generated must additionally be <em>non-insertable</em> and <em>non-updateable</em>.
Only <code>@Version</code> and <code>@Basic</code> types can be marked as generated.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NEVER</code> (the default)</dt>
<dd>
<p>the given property value is not generated within the database.</p>
</dd>
<dt class="hdlist1"><code>INSERT</code></dt>
<dd>
<p>the given property value is generated on insert but is not regenerated on subsequent updates. Properties like <em>creationTimestamp</em> fall into this category.</p>
</dd>
<dt class="hdlist1"><code>ALWAYS</code></dt>
<dd>
<p>the property value is generated both on insert and update.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To mark a property as generated, use The Hibernate specific <code>@Generated</code> annotation.</p>
</div>
<div class="sect4">
<h5 id="mapping-generated-Generated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-Generated"></a><code>@Generated</code> annotation</h5>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Generated.html"><code>@Generated</code></a> annotation is used so that Hibernate can fetch the currently annotated property after the entity has been persisted or updated.
For this reason, the <code>@Generated</code> annotation accepts a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenerationTime.html"><code>GenerationTime</code></a> enum value.</p>
</div>
<div class="paragraph">
<p>Considering the following entity:</p>
</div>
<div id="mapping-generated-Generated-example" class="exampleblock">
<div class="title">Example 65. <code>@Generated</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middleName1</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middleName2</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middleName3</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middleName4</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> middleName5</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Generated</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationTime</span><span class="pun">.</span><span class="pln">ALWAYS </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">columnDefinition </span><span class="pun">=</span><span class="pln">
		</span><span class="str">"AS CONCAT("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(firstName, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + middleName1, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + middleName2, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + middleName3, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + middleName4, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + middleName5, ''), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"	COALESCE(' ' + lastName, '') "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">")"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> fullName</span><span class="pun">;</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>Person</code> entity is persisted, Hibernate is going to fetch the calculated <code>fullName</code> column from the database,
which concatenates the first, middle, and last name.</p>
</div>
<div id="mapping-generated-Generated-persist-example" class="exampleblock">
<div class="title">Example 66. <code>@Generated</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setMiddleName1</span><span class="pun">(</span><span class="pln"> </span><span class="str">"FlÃ¡vio"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setMiddleName2</span><span class="pun">(</span><span class="pln"> </span><span class="str">"AndrÃ©"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setMiddleName3</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Frederico"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setMiddleName4</span><span class="pun">(</span><span class="pln"> </span><span class="str">"RÃºben"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setMiddleName5</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Artur"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="str">"John FlÃ¡vio AndrÃ© Frederico RÃºben Artur Doe"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getFullName</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln">
</span><span class="pun">(</span><span class="pln">
    firstName</span><span class="pun">,</span><span class="pln">
    lastName</span><span class="pun">,</span><span class="pln">
    middleName1</span><span class="pun">,</span><span class="pln">
    middleName2</span><span class="pun">,</span><span class="pln">
    middleName3</span><span class="pun">,</span><span class="pln">
    middleName4</span><span class="pun">,</span><span class="pln">
    middleName5</span><span class="pun">,</span><span class="pln">
    id
</span><span class="pun">)</span><span class="pln">
values
</span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Fl</span><span class="pun">Ã¡</span><span class="pln">vio</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Andr</span><span class="pun">Ã©]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Frederico</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">R</span><span class="pun">Ãº</span><span class="pln">ben</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Artur</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    p</span><span class="pun">.</span><span class="pln">fullName </span><span class="kwd">as</span><span class="pln"> fullName3_0_
FROM
    </span><span class="typ">Person</span><span class="pln"> p
WHERE
    p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">fullName3_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Fl</span><span class="pun">Ã¡</span><span class="pln">vio </span><span class="typ">Andr</span><span class="pun">Ã©</span><span class="pln"> </span><span class="typ">Frederico</span><span class="pln"> R</span><span class="pun">Ãº</span><span class="pln">ben </span><span class="typ">Artur</span><span class="pln"> </span><span class="typ">Doe</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same goes when the <code>Person</code> entity is updated.
Hibernate is going to fetch the calculated <code>fullName</code> column from the database after the entity is modified.</p>
</div>
<div id="mapping-generated-Generated-update-example" class="exampleblock">
<div class="title">Example 67. <code>@Generated</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe Jr"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"John FlÃ¡vio AndrÃ© Frederico RÃºben Artur Doe Jr"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getFullName</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE
    </span><span class="typ">Person</span><span class="pln">
SET
    firstName</span><span class="pun">=?,</span><span class="pln">
    lastName</span><span class="pun">=?,</span><span class="pln">
    middleName1</span><span class="pun">=?,</span><span class="pln">
    middleName2</span><span class="pun">=?,</span><span class="pln">
    middleName3</span><span class="pun">=?,</span><span class="pln">
    middleName4</span><span class="pun">=?,</span><span class="pln">
    middleName5</span><span class="pun">=?</span><span class="pln">
WHERE
    id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Fl</span><span class="pun">Ã¡</span><span class="pln">vio</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Andr</span><span class="pun">Ã©]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Frederico</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">R</span><span class="pun">Ãº</span><span class="pln">ben</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Artur</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    p</span><span class="pun">.</span><span class="pln">fullName </span><span class="kwd">as</span><span class="pln"> fullName3_0_
FROM
    </span><span class="typ">Person</span><span class="pln"> p
WHERE
    p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">fullName3_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Fl</span><span class="pun">Ã¡</span><span class="pln">vio </span><span class="typ">Andr</span><span class="pun">Ã©</span><span class="pln"> </span><span class="typ">Frederico</span><span class="pln"> R</span><span class="pun">Ãº</span><span class="pln">ben </span><span class="typ">Artur</span><span class="pln"> </span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-GeneratorType"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-GeneratorType"></a><code>@GeneratorType</code> annotation</h5>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GeneratorType.html"><code>@GeneratorType</code></a> annotation is used so that
you can provide a custom generator to set the value of the currently annotated property.</p>
</div>
<div class="paragraph">
<p>For this reason, the <code>@GeneratorType</code> annotation accepts a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenerationTime.html"><code>GenerationTime</code></a> enum value
and a custom <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ValueGenerator.html"><code>ValueGenerator</code></a> class type.</p>
</div>
<div class="paragraph">
<p>Considering the following entity:</p>
</div>
<div id="mapping-generated-GeneratorType-example" class="exampleblock">
<div class="title">Example 68. <code>@GeneratorType</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ThreadLocal</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> storage </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ThreadLocal</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> logIn</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> user</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		storage</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="pln"> user </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> logOut</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		storage</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> storage</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">LoggedUserGenerator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueGenerator</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> generateValue</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">Session</span><span class="pln"> session</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> owner</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@GeneratorType</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LoggedUserGenerator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationTime</span><span class="pun">.</span><span class="pln">INSERT</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> createdBy</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@GeneratorType</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LoggedUserGenerator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationTime</span><span class="pun">.</span><span class="pln">ALWAYS</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> updatedBy</span><span class="pun">;</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>Person</code> entity is persisted, Hibernate is going to populate the <code>createdBy</code> column with the currently logged user.</p>
</div>
<div id="mapping-generated-GeneratorType-persist-example" class="exampleblock">
<div class="title">Example 69. <code>@Generated</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logIn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Alice"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logOut</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln">
</span><span class="pun">(</span><span class="pln">
    createdBy</span><span class="pun">,</span><span class="pln">
    firstName</span><span class="pun">,</span><span class="pln">
    lastName</span><span class="pun">,</span><span class="pln">
    updatedBy</span><span class="pun">,</span><span class="pln">
    id
</span><span class="pun">)</span><span class="pln">
VALUES
</span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Alice</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Alice</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same goes when the <code>Person</code> entity is updated.
Hibernate is going to populate the <code>updatedBy</code> column with the currently logged user.</p>
</div>
<div id="mapping-generated-GeneratorType-update-example" class="exampleblock">
<div class="title">Example 70. <code>@Generated</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logIn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logOut</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE </span><span class="typ">Person</span><span class="pln">
SET
    createdBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    firstName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    lastName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    updatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Alice</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Mr</span><span class="pun">.</span><span class="pln"> </span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Bob</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-CreationTimestamp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-CreationTimestamp"></a><code>@CreationTimestamp</code> annotation</h5>
<div class="paragraph">
<p>The <code>@CreationTimestamp</code> annotation instructs Hibernate to set the annotated entity attribute with the current timestamp value of the JVM
when the entity is being persisted.</p>
</div>
<div class="paragraph">
<p>The supported property types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.util.Calendar</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.sql.Time</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div id="mapping-generated-CreationTimestamp-example" class="exampleblock">
<div class="title">Example 71. <code>@CreationTimestamp</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Constructors, getters, and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>Event</code> entity is persisted, Hibernate is going to populate the underlying <code>timestamp</code> column with the current JVM timestamp value:</p>
</div>
<div id="mapping-generated-CreationTimestamp-persist-example" class="exampleblock">
<div class="title">Example 72. <code>@CreationTimestamp</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Event</span><span class="pln"> dateEvent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> dateEvent </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">(</span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Tue</span><span class="pln"> </span><span class="typ">Nov</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">16</span><span class="pun">:</span><span class="lit">24</span><span class="pun">:</span><span class="lit">20</span><span class="pln"> EET </span><span class="lit">2016</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-UpdateTimestamp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-UpdateTimestamp"></a><code>@UpdateTimestamp</code> annotation</h5>
<div class="paragraph">
<p>The <code>@UpdateTimestamp</code> annotation instructs Hibernate to set the annotated entity attribute with the current timestamp value of the JVM
when the entity is being persisted.</p>
</div>
<div class="paragraph">
<p>The supported property types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.util.Calendar</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.sql.Time</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div id="mapping-generated-UpdateTimestamp-example" class="exampleblock">
<div class="title">Example 73. <code>@UpdateTimestamp</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Bid"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bid</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"updated_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@UpdateTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> updatedOn</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"updated_by"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> updatedBy</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>Bid</code> entity is persisted, Hibernate is going to populate the underlying <code>updated_on</code> column with the current JVM timestamp value:</p>
</div>
<div id="mapping-generated-UpdateTimestamp-persist-example" class="exampleblock">
<div class="title">Example 74. <code>@UpdateTimestamp</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Bid</span><span class="pln"> bid </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bid</span><span class="pun">();</span><span class="pln">
bid</span><span class="pun">.</span><span class="pln">setUpdatedBy</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
bid</span><span class="pun">.</span><span class="pln">setCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">150</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> bid </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Bid</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cents</span><span class="pun">,</span><span class="pln"> updated_by</span><span class="pun">,</span><span class="pln"> updated_on</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">15000</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Tue</span><span class="pln"> </span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">21</span><span class="pun">:</span><span class="lit">46</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When updating the <code>Bid</code> entity, Hibernate is going to modify the <code>updated_on</code> column with the current JVM timestamp value:</p>
</div>
<div id="mapping-generated-UpdateTimestamp-update-example" class="exampleblock">
<div class="title">Example 75. <code>@UpdateTimestamp</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Bid</span><span class="pln"> bid </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Bid</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

bid</span><span class="pun">.</span><span class="pln">setUpdatedBy</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe Jr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
bid</span><span class="pun">.</span><span class="pln">setCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">160</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> bid </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE </span><span class="typ">Bid</span><span class="pln"> SET
    cents </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    updated_by </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    updated_on </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">16000</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Tue</span><span class="pln"> </span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">49</span><span class="pun">:</span><span class="lit">24</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-generated-ValueGenerationType"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-ValueGenerationType"></a><code>@ValueGenerationType</code> meta-annotation</h5>
<div class="paragraph">
<p>Hibernate 4.3 introduced the <code>@ValueGenerationType</code> meta-annotation, which is a new approach to declaring generated attributes or customizing generators.</p>
</div>
<div class="paragraph">
<p><code>@Generated</code> has been retrofitted to use the <code>@ValueGenerationType</code> meta-annotation.
But <code>@ValueGenerationType</code> exposes more features than what <code>@Generated</code> currently supports, and,
to leverage some of those features, youâ€™d simply wire up a new generator annotation.</p>
</div>
<div class="paragraph">
<p>As youâ€™ll see in the following examples, the <code>@ValueGenerationType</code> meta-annotation is used when declaring the custom annotation used to mark the entity properties that need a specific generation strategy.
The actual generation logic must be added to the class that implements the <code>AnnotationValueGeneration</code> interface.</p>
</div>
<div class="sect5">
<h6 id="mapping-database-generated-value"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-database-generated-value"></a>Database-generated values</h6>
<div class="paragraph">
<p>For example, letâ€™s say we want the timestamps to be generated by calls to the standard ANSI SQL function <code>current_timestamp</code> (rather than triggers or DEFAULT values):</p>
</div>
<div id="mapping-database-generated-value-example" class="exampleblock">
<div class="title">Example 76. A <code>ValueGenerationType</code> mapping for database generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@FunctionCreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Constructors, getters, and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@ValueGenerationType</span><span class="pun">(</span><span class="pln">generatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FunctionCreationValueGeneration</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">FunctionCreationTimestamp</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FunctionCreationValueGeneration</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AnnotationValueGeneration</span><span class="pun">&lt;</span><span class="typ">FunctionCreationTimestamp</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">FunctionCreationTimestamp</span><span class="pln"> annotation</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">&lt;?&gt;</span><span class="pln"> propertyType</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Generate value on INSERT
	 * @return when to generate the value
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">GenerationTiming</span><span class="pln"> getGenerationTiming</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">GenerationTiming</span><span class="pun">.</span><span class="pln">INSERT</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns null because the value is generated by the database.
	 * @return null
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ValueGenerator</span><span class="pun">&lt;?&gt;</span><span class="pln"> getValueGenerator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns true because the value is generated by the database.
	 * @return true
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> referenceColumnInSql</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns the database-generated value
	 * @return database-generated value
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getDatabaseGeneratedReferencedColumnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="str">"current_timestamp"</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting an <code>Event</code> entity, Hibernate generates the following SQL statement:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">(</span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln">current_timestamp</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>current_timestamp</code> value was used for assigning the <code>timestamp</code> column value.</p>
</div>
</div>
<div class="sect5">
<h6 id="mapping-in-memory-generated-value"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-in-memory-generated-value"></a>In-memory-generated values</h6>
<div class="paragraph">
<p>If the timestamp value needs to be generated in-memory, the following mapping must be used instead:</p>
</div>
<div id="mapping-in-memory-generated-value-example" class="exampleblock">
<div class="title">Example 77. A <code>ValueGenerationType</code> mapping for in-memory value generation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`timestamp`"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@FunctionCreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Constructors, getters, and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@ValueGenerationType</span><span class="pun">(</span><span class="pln">generatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FunctionCreationValueGeneration</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">FunctionCreationTimestamp</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FunctionCreationValueGeneration</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AnnotationValueGeneration</span><span class="pun">&lt;</span><span class="typ">FunctionCreationTimestamp</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">FunctionCreationTimestamp</span><span class="pln"> annotation</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">&lt;?&gt;</span><span class="pln"> propertyType</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Generate value on INSERT
	 * @return when to generate the value
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">GenerationTiming</span><span class="pln"> getGenerationTiming</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">GenerationTiming</span><span class="pun">.</span><span class="pln">INSERT</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns the in-memory generated value
	 * @return {@code true}
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ValueGenerator</span><span class="pun">&lt;?&gt;</span><span class="pln"> getValueGenerator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">session</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns false because the value is generated by the database.
	 * @return false
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> referenceColumnInSql</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Returns null because the value is generated in-memory.
	 * @return null
	 */</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getDatabaseGeneratedReferencedColumnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting an <code>Event</code> entity, Hibernate generates the following SQL statement:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">(</span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'Tue Mar 01 10:58:18 EET 2016'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>new Date()</code> object value was used for assigning the <code>timestamp</code> column value.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-read-and-write"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write"></a>2.3.19. Column transformers: read and write expressions</h4>
<div class="paragraph">
<p>Hibernate allows you to customize the SQL it uses to read and write the values of columns mapped to <code>@Basic</code> types.
For example, if your database provides a set of data encryption functions, you can invoke them for individual columns like in the following example.</p>
</div>
<div id="mapping-column-read-and-write-example" class="exampleblock">
<div class="title">Example 78. <code>@ColumnTransformer</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pswd"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@ColumnTransformer</span><span class="pun">(</span><span class="pln">
		read </span><span class="pun">=</span><span class="pln"> </span><span class="str">"decrypt( 'AES', '00', pswd  )"</span><span class="pun">,</span><span class="pln">
		write </span><span class="pun">=</span><span class="pln"> </span><span class="str">"encrypt('AES', '00', ?)"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> accessLevel</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"employees"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Project</span><span class="pun">&gt;</span><span class="pln"> projects </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the plural form <code>@ColumnTransformers</code> if more than one columns need to define either of these rules.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If a property uses more than one column, you must use the <code>forColumn</code> attribute to specify which column, the expressions are targeting.</p>
</div>
<div id="mapping-column-read-and-write-composite-type-example" class="exampleblock">
<div class="title">Example 79. <code>@ColumnTransformer</code> <code>forColumn</code> attribute usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Savings"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Savings</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.userguide.mapping.basic.MonetaryAmountUserType"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Columns</span><span class="pun">(</span><span class="pln">columns </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"money"</span><span class="pun">),</span><span class="pln">
		</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"currency"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">})</span><span class="pln">
	</span><span class="lit">@ColumnTransformer</span><span class="pun">(</span><span class="pln">
		forColumn </span><span class="pun">=</span><span class="pln"> </span><span class="str">"money"</span><span class="pun">,</span><span class="pln">
		read </span><span class="pun">=</span><span class="pln"> </span><span class="str">"money / 100"</span><span class="pun">,</span><span class="pln">
		write </span><span class="pun">=</span><span class="pln"> </span><span class="str">"? * 100"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">MonetaryAmount</span><span class="pln"> wallet</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate applies the custom expressions automatically whenever the property is referenced in a query.
This functionality is similar to a derived-property <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-formula"><code>@Formula</code></a> with two differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The property is backed by one or more columns that are exported as part of automatic schema generation.</p>
</li>
<li>
<p>The property is read-write, not read-only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>write</code> expression, if specified, must contain exactly one '?' placeholder for the value.</p>
</div>
<div id="mapping-column-read-and-write-composite-type-persistence-example" class="exampleblock">
<div class="title">Example 80. Persisting an entity with a <code>@ColumnTransformer</code> and a composite type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Savings</span><span class="pln"> savings </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Savings</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	savings</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	savings</span><span class="pun">.</span><span class="pln">setWallet</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MonetaryAmount</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">TEN</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Currency</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Locale</span><span class="pun">.</span><span class="pln">US </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> savings </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Savings</span><span class="pln"> savings </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Savings</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> savings</span><span class="pun">.</span><span class="pln">getWallet</span><span class="pun">().</span><span class="pln">getAmount</span><span class="pun">().</span><span class="pln">intValue</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Savings</span><span class="pln"> </span><span class="pun">(</span><span class="pln">money</span><span class="pun">,</span><span class="pln"> currency</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">10</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="str">'USD'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT
    s</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    s</span><span class="pun">.</span><span class="pln">money </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> money2_0_0_</span><span class="pun">,</span><span class="pln">
    s</span><span class="pun">.</span><span class="pln">currency </span><span class="kwd">as</span><span class="pln"> currency3_0_0_
FROM
    </span><span class="typ">Savings</span><span class="pln"> s
WHERE
    s</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-formula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-formula"></a>2.3.20. <code>@Formula</code></h4>
<div class="paragraph">
<p>Sometimes, you want the Database to do some computation for you rather than in the JVM, you might also create some kind of virtual column.
You can use a SQL fragment (aka formula) instead of mapping a property into a column. This kind of property is read-only (its value is calculated by your formula fragment)</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should be aware that the <code>@Formula</code> annotation takes a native SQL clause which can affect database portability.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="mapping-column-formula-example" class="exampleblock">
<div class="title">Example 81. <code>@Formula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> credit</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> rate</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Formula</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"credit * rate"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> interest</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the <code>Account</code> entity, Hibernate is going to calculate the <code>interest</code> property using the configured <code>@Formula</code>:</p>
</div>
<div id="mapping-column-formula-persistence-example" class="exampleblock">
<div class="title">Example 82. Persisting an entity with a <code>@Formula</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setCredit</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000d</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.25</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">62.5d</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> account</span><span class="pun">.</span><span class="pln">getInterest</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">credit</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">5000.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">credit </span><span class="kwd">as</span><span class="pln"> credit2_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate3_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">credit </span><span class="pun">*</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> formula0_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE
    a</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SQL fragment can be as complex as you want and even include subselects.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-where"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-where"></a>2.3.21. <code>@Where</code></h4>
<div class="paragraph">
<p>Sometimes, you want to filter out entities or collections using custom SQL criteria.
This can be achieved using the <code>@Where</code> annotation, which can be applied to entities and collections.</p>
</div>
<div id="mapping-where-example" class="exampleblock">
<div class="title">Example 83. <code>@Where</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	DEBIT</span><span class="pun">,</span><span class="pln">
	CREDIT
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Client"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Where</span><span class="pun">(</span><span class="pln"> clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_type = 'DEBIT'"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"client"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> debitAccounts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="lit">@Where</span><span class="pun">(</span><span class="pln"> clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_type = 'CREDIT'"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"client"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> creditAccounts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Where</span><span class="pun">(</span><span class="pln"> clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"active = true"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> client</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_type"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> rate</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> active</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the database contains the following entities:</p>
</div>
<div id="mapping-where-persistence-example" class="exampleblock">
<div class="title">Example 84. Persisting and fetching entities with a <code>@Where</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">();</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Account</span><span class="pln"> account1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">CREDIT </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000d</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.25</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account1</span><span class="pun">.</span><span class="pln">setClient</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">getCreditAccounts</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> account1 </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account1 </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Account</span><span class="pln"> account2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0d</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account2</span><span class="pun">.</span><span class="pln">setClient</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">getDebitAccounts</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> account2 </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account2 </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Account</span><span class="pln"> account3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">250d</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account3</span><span class="pun">.</span><span class="pln">setClient</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">getDebitAccounts</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> account3 </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account3 </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5000.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0125</span><span class="pun">,</span><span class="pln"> </span><span class="str">'CREDIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="lit">250.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing an <code>Account</code> entity query, Hibernate is going to filter out all records that are not active.</p>
</div>
<div id="mapping-where-entity-query-example" class="exampleblock">
<div class="title">Example 85. Query entities mapped with <code>@Where</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"select a from Account a"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE </span><span class="pun">(</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">active </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>debitAccounts</code> or the <code>creditAccounts</code> collections, Hibernate is going to apply the <code>@Where</code> clause filtering criteria to the associated child entities.</p>
</div>
<div id="mapping-where-collection-query-example" class="exampleblock">
<div class="title">Example 86. Traversing collections mapped with <code>@Where</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getCreditAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getDebitAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    c</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">active </span><span class="kwd">as</span><span class="pln"> active2_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_1_
FROM
    </span><span class="typ">Account</span><span class="pln"> c
WHERE </span><span class="pun">(</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">active </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">account_type </span><span class="pun">=</span><span class="pln"> </span><span class="str">'CREDIT'</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> AND c</span><span class="pun">.</span><span class="pln">client_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT
    d</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_0_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">active </span><span class="kwd">as</span><span class="pln"> active2_0_1_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_1_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_1_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_1_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_1_
FROM
    </span><span class="typ">Account</span><span class="pln"> d
WHERE </span><span class="pun">(</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">active </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">account_type </span><span class="pun">=</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> AND d</span><span class="pun">.</span><span class="pln">client_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-where-join-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-where-join-table"></a>2.3.22. <code>@WhereJoinTable</code></h4>
<div class="paragraph">
<p>Just like <code>@Where</code> annotation, <code>@WhereJoinTable</code> is used to filter out collections using a joined table (e.g. @ManyToMany association).</p>
</div>
<div id="mapping-where-join-table-example" class="exampleblock">
<div class="title">Example 87. <code>@WhereJoinTable</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pln">
	</span><span class="lit">@JoinTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book_Reader"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_id"</span><span class="pun">),</span><span class="pln">
		inverseJoinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"reader_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@WhereJoinTable</span><span class="pun">(</span><span class="pln"> clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on &gt; DATEADD( 'DAY', -7, CURRENT_TIMESTAMP() )"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Reader</span><span class="pun">&gt;</span><span class="pln"> currentWeekReaders </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Reader"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Reader</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    author varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Book_Reader</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    book_id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    reader_id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Reader</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Book_Reader</span><span class="pln">
    add constraint </span><span class="typ">FKsscixgaa5f8lphs9bjdtpf9g</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">reader_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Reader</span><span class="pln">

alter table </span><span class="typ">Book_Reader</span><span class="pln">
    add constraint </span><span class="typ">FKoyrwu9tnwlukd1616qhck21ra</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">book_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Book</span><span class="pln">

alter table </span><span class="typ">Book_Reader</span><span class="pln">
    add created_on timestamp
    </span><span class="kwd">default</span><span class="pln"> current_timestamp</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the current week <code>Reader</code> entities are included in the <code>currentWeekReaders</code> collection
which uses the <code>@WhereJoinTable</code> annotation to filter the joined table rows according to the provided SQL clause.</p>
</div>
<div class="paragraph">
<p>Considering that the following two <code>Book_Reader</code> entries are added into our system:</p>
</div>
<div id="mapping-where-join-table-persist-example" class="exampleblock">
<div class="title">Example 88. <code>@WhereJoinTable</code> test data</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Reader</span><span class="pln"> reader1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Reader</span><span class="pun">();</span><span class="pln">
reader1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
reader1</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> reader1 </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Reader</span><span class="pln"> reader2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Reader</span><span class="pun">();</span><span class="pln">
reader2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
reader2</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe Jr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> reader2 </span><span class="pun">);</span><span class="pln">

statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"INSERT INTO Book_Reader "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(book_id, reader_id) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"VALUES "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(1, 1) "</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"INSERT INTO Book_Reader "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(book_id, reader_id, created_on) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"VALUES "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(1, 2, DATEADD( 'DAY', -10, CURRENT_TIMESTAMP() )) "</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>currentWeekReaders</code> collection, Hibernate is going to find one one entry:</p>
</div>
<div id="mapping-where-join-table-fetch-example" class="exampleblock">
<div class="title">Example 89. <code>@WhereJoinTable</code> fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">getCurrentWeekReaders</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-filter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-filter"></a>2.3.23. <code>@Filter</code></h4>
<div class="paragraph">
<p>The <code>@Filter</code> annotation is another way to filter out entities or collections using custom SQL criteria.
Unlike the <code>@Where</code> annotation, <code>@Filter</code> allows you to parameterize the filter clause at runtime.</p>
</div>
<div class="paragraph">
<p>Now, considering we have the following <code>Account</code> entity:</p>
</div>
<div id="mapping-filter-account-example" class="exampleblock">
<div class="title">Example 90. <code>@Filter</code> mapping entity-level usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@FilterDef</span><span class="pun">(</span><span class="pln">
    name</span><span class="pun">=</span><span class="str">"activeAccount"</span><span class="pun">,</span><span class="pln">
    parameters </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ParamDef</span><span class="pun">(</span><span class="pln">
        name</span><span class="pun">=</span><span class="str">"active"</span><span class="pun">,</span><span class="pln">
        type</span><span class="pun">=</span><span class="str">"boolean"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Filter</span><span class="pun">(</span><span class="pln">
    name</span><span class="pun">=</span><span class="str">"activeAccount"</span><span class="pun">,</span><span class="pln">
    condition</span><span class="pun">=</span><span class="str">"active_status = :active"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> client</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_type"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> rate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"active_status"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> active</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that the <code>active</code> property is mapped to the <code>active_status</code> column.</p>
</div>
<div class="paragraph">
<p>This mapping was done to show you that the <code>@Filter</code> condition uses a SQL condition and not a JPQL filtering predicate.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As already explained, we can also apply the <code>@Filter</code> annotation for collections as illustrated by the <code>Client</code> entity:</p>
</div>
<div id="mapping-filter-client-example" class="exampleblock">
<div class="title">Example 91. <code>@Filter</code> mapping collection-level usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Client"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">
        mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"client"</span><span class="pun">,</span><span class="pln">
        cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL
    </span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Filter</span><span class="pun">(</span><span class="pln">
        name</span><span class="pun">=</span><span class="str">"activeAccount"</span><span class="pun">,</span><span class="pln">
        condition</span><span class="pun">=</span><span class="str">"active_status = :active"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addAccount</span><span class="pun">(</span><span class="typ">Account</span><span class="pln"> account</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        account</span><span class="pun">.</span><span class="pln">setClient</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">accounts</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we persist a <code>Client</code> with three associated <code>Account</code> entities,
Hibernate will execute the following SQL statements:</p>
</div>
<div id="mapping-filter-persistence-example" class="exampleblock">
<div class="title">Example 92. Persisting and fetching entities with a <code>@Filter</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">CREDIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.25</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">250d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setActive</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active_status</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5000.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0125</span><span class="pun">,</span><span class="pln"> </span><span class="str">'CREDIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active_status</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">active_status</span><span class="pun">,</span><span class="pln"> amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="lit">250.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, without explicitly enabling the filter, Hibernate is going to fetch all <code>Account</code> entities.</p>
</div>
<div id="mapping-no-filter-entity-query-example" class="exampleblock">
<div class="title">Example 93. Query entities mapped without activating the <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"select a from Account a"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the filter is enabled and the filter parameter value is provided,
then Hibernate is going to apply the filtering criteria to the associated <code>Account</code> entities.</p>
</div>
<div id="mapping-filter-entity-query-example" class="exampleblock">
<div class="title">Example 94. Query entities mapped with <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager
    </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">enableFilter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"activeAccount"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"active"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"select a from Account a"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Filters apply to entity queries, but not to direct fetching.</p>
</div>
<div class="paragraph">
<p>Therefore, in the following example, the filter is not taken into consideration when fetching an entity from the Persistence Context.</p>
</div>
<div id="mapping-filter-entity-example" class="listingblock">
<div class="title">Fetching entities mapped with <code>@Filter</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager
    </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">enableFilter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"activeAccount"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"active"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertFalse</span><span class="pun">(</span><span class="pln"> account</span><span class="pun">.</span><span class="pln">isActive</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="kwd">as</span><span class="pln"> active2_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_1_1_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE
    a</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, contrary to an entity query, the filter does not prevent the entity from being loaded.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Just like with entity queries, collections can be filtered as well, but only if the filter is explicitly enabled on the currently running Hibernate <code>Session</code>.</p>
</div>
<div id="mapping-no-filter-collection-query-example" class="exampleblock">
<div class="title">Example 95. Traversing collections without activating the <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_1_0_
FROM
    </span><span class="typ">Client</span><span class="pln"> c
WHERE
    c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When activating the <code>@Filter</code> and fetching the <code>accounts</code> collections, Hibernate is going to apply the filter condition to the associated collection entries.</p>
</div>
<div id="mapping-filter-collection-query-example" class="exampleblock">
<div class="title">Example 96. Traversing collections mapped with <code>@Filter</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager
    </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">enableFilter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"activeAccount"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"active"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_1_0_
FROM
    </span><span class="typ">Client</span><span class="pln"> c
WHERE
    c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">active_status </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">client_id </span><span class="kwd">as</span><span class="pln"> client_i6_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_
FROM
    </span><span class="typ">Account</span><span class="pln"> a
WHERE
    accounts0_</span><span class="pun">.</span><span class="pln">active_status </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">client_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of <code>@Filter</code> over the <code>@Where</code> clause is that the filtering criteria can be customized at runtime.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Itâ€™s not possible to combine the <code>@Filter</code> and <code>@Cache</code> collection annotations.
This limitation is due to ensuring consistency and because the filtering information is not stored in the second-level cache.</p>
</div>
<div class="paragraph">
<p>If caching were allowed for a currently filtered collection, then the second-level cache would store only a subset of the whole collection.
Afterward, every other Session will get the filtered collection from the cache, even if the Session-level filters have not been explicitly activated.</p>
</div>
<div class="paragraph">
<p>For this reason, the second-level collection cache is limited to storing whole collections, and not subsets.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-filter-join-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-filter-join-table"></a>2.3.24. <code>@FilterJoinTable</code></h4>
<div class="paragraph">
<p>When using the <code>@Filter</code> annotation with collections, the filtering is done against the child entries (entities or embeddables).
However, if you have a link table between the parent entity and the child table, then you need to use the <code>@FilterJoinTable</code> to filter child entries according to some column contained in the join table.</p>
</div>
<div class="paragraph">
<p>The <code>@FilterJoinTable</code> annotation can be, therefore, applied to a unidirectional <code>@OneToMany</code> collection as illustrated in the following mapping:</p>
</div>
<div id="mapping-filter-join-table-example" class="exampleblock">
<div class="title">Example 97. <code>@FilterJoinTable</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Client"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@FilterDef</span><span class="pun">(</span><span class="pln">
    name</span><span class="pun">=</span><span class="str">"firstAccounts"</span><span class="pun">,</span><span class="pln">
    parameters</span><span class="pun">=</span><span class="lit">@ParamDef</span><span class="pun">(</span><span class="pln">
        name</span><span class="pun">=</span><span class="str">"maxOrderId"</span><span class="pun">,</span><span class="pln">
        type</span><span class="pun">=</span><span class="str">"int"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Filter</span><span class="pun">(</span><span class="pln">
    name</span><span class="pun">=</span><span class="str">"firstAccounts"</span><span class="pun">,</span><span class="pln">
    condition</span><span class="pun">=</span><span class="str">"order_id &lt;= :maxOrderId"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@FilterJoinTable</span><span class="pun">(</span><span class="pln">
        name</span><span class="pun">=</span><span class="str">"firstAccounts"</span><span class="pun">,</span><span class="pln">
        condition</span><span class="pun">=</span><span class="str">"order_id &lt;= :maxOrderId"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addAccount</span><span class="pun">(</span><span class="typ">Account</span><span class="pln"> account</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">accounts</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_type"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> rate</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>firstAccounts</code> filter will allow us to get only the <code>Account</code> entities that have the <code>order_id</code>
(which tells the position of every entry inside the <code>accounts</code> collection)
less than a given number (e.g. <code>maxOrderId</code>).</p>
</div>
<div class="paragraph">
<p>Letâ€™s assume our database contains the following entities:</p>
</div>
<div id="mapping-filter-join-table-persistence-example" class="exampleblock">
<div class="title">Example 98. Persisting and fetching entities with a <code>@FilterJoinTable</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">CREDIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.25</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

client</span><span class="pun">.</span><span class="pln">addAccount</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountType</span><span class="pun">.</span><span class="pln">DEBIT </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setAmount</span><span class="pun">(</span><span class="pln"> </span><span class="lit">250d</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setRate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.05</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">5000.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0125</span><span class="pun">,</span><span class="pln"> </span><span class="str">'CREDIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">0.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">amount</span><span class="pun">,</span><span class="pln"> client_id</span><span class="pun">,</span><span class="pln"> rate</span><span class="pun">,</span><span class="pln"> account_type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">250.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0105</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DEBIT'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Client_Account</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Client_id</span><span class="pun">,</span><span class="pln"> order_id</span><span class="pun">,</span><span class="pln"> accounts_id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Client_Account</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Client_id</span><span class="pun">,</span><span class="pln"> order_id</span><span class="pun">,</span><span class="pln"> accounts_id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Client_Account</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Client_id</span><span class="pun">,</span><span class="pln"> order_id</span><span class="pun">,</span><span class="pln"> accounts_id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Client_Account</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Client_id</span><span class="pun">,</span><span class="pln"> order_id</span><span class="pun">,</span><span class="pln"> accounts_id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The collections can be filtered only if the associated filter is enabled on the currently running Hibernate <code>Session</code>.</p>
</div>
<div id="mapping-no-filter-join-table-collection-query-example" class="exampleblock">
<div class="title">Example 99. Traversing collections mapped with <code>@FilterJoinTable</code> without enabling the filter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    ca</span><span class="pun">.</span><span class="typ">Client_id</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Client_i1_2_0_</span><span class="pun">,</span><span class="pln">
    ca</span><span class="pun">.</span><span class="pln">accounts_id </span><span class="kwd">as</span><span class="pln"> accounts2_2_0_</span><span class="pun">,</span><span class="pln">
    ca</span><span class="pun">.</span><span class="pln">order_id </span><span class="kwd">as</span><span class="pln"> order_id3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_1_
FROM
    </span><span class="typ">Client_Account</span><span class="pln"> ca
INNER JOIN
    </span><span class="typ">Account</span><span class="pln"> a
ON  ca</span><span class="pun">.</span><span class="pln">accounts_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
WHERE
    ca</span><span class="pun">.</span><span class="typ">Client_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we enable the filter and set the <code>maxOrderId</code> to <code>1</code> when fetching the <code>accounts</code> collections, Hibernate is going to apply the <code>@FilterJoinTable</code> clause filtering criteria, and we will get just
<code>2</code> <code>Account</code> entities, with the <code>order_id</code> values of <code>0</code> and <code>1</code>.</p>
</div>
<div id="mapping-filter-join-table-collection-query-example" class="exampleblock">
<div class="title">Example 100. Traversing collections mapped with <code>@FilterJoinTable</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager
    </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">enableFilter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"firstAccounts"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"maxOrderId"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">getAccounts</span><span class="pun">().</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    ca</span><span class="pun">.</span><span class="typ">Client_id</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Client_i1_2_0_</span><span class="pun">,</span><span class="pln">
    ca</span><span class="pun">.</span><span class="pln">accounts_id </span><span class="kwd">as</span><span class="pln"> accounts2_2_0_</span><span class="pun">,</span><span class="pln">
    ca</span><span class="pun">.</span><span class="pln">order_id </span><span class="kwd">as</span><span class="pln"> order_id3_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">account_type </span><span class="kwd">as</span><span class="pln"> account_5_0_1_
FROM
    </span><span class="typ">Client_Account</span><span class="pln"> ca
INNER JOIN
    </span><span class="typ">Account</span><span class="pln"> a
ON  ca</span><span class="pun">.</span><span class="pln">accounts_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
WHERE
    ca</span><span class="pun">.</span><span class="pln">order_id </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    AND ca</span><span class="pun">.</span><span class="typ">Client_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-filter-sql-fragment-alias"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-filter-sql-fragment-alias"></a>2.3.25. <code>@Filter</code> with <code>@SqlFragmentAlias</code></h4>
<div class="paragraph">
<p>When using the <code>@Filter</code> annotation and working with entities that are mapped onto multiple database tables,
you will need to use the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SqlFragmentAlias.html"><code>@SqlFragmentAlias</code></a> annotation
if the <code>@Filter</code> defines a condition that uses predicates across multiple tables.</p>
</div>
<div id="mapping-filter-sql-fragment-alias-example" class="exampleblock">
<div class="title">Example 101. <code>@SqlFragmentAlias</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SecondaryTable</span><span class="pun">(</span><span class="pln">
	name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_details"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLDelete</span><span class="pun">(</span><span class="pln">
	sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE account_details SET deleted = true WHERE id = ? "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@FilterDef</span><span class="pun">(</span><span class="pln">
	name</span><span class="pun">=</span><span class="str">"activeAccount"</span><span class="pun">,</span><span class="pln">
	parameters </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ParamDef</span><span class="pun">(</span><span class="pln">
		name</span><span class="pun">=</span><span class="str">"active"</span><span class="pun">,</span><span class="pln">
		type</span><span class="pun">=</span><span class="str">"boolean"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Filter</span><span class="pun">(</span><span class="pln">
	name</span><span class="pun">=</span><span class="str">"activeAccount"</span><span class="pun">,</span><span class="pln">
	condition</span><span class="pun">=</span><span class="str">"{a}.active = :active and {ad}.deleted = false"</span><span class="pun">,</span><span class="pln">
	aliases </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="lit">@SqlFragmentAlias</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> table</span><span class="pun">=</span><span class="pln"> </span><span class="str">"account"</span><span class="pun">),</span><span class="pln">
		</span><span class="lit">@SqlFragmentAlias</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ad"</span><span class="pun">,</span><span class="pln"> table</span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_details"</span><span class="pun">),</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> rate</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> active</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">table </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_details"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> deleted</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching the <code>Account</code> entities and activating the filter,
Hibernate is going to apply the right table aliases to the filter predicates:</p>
</div>
<div id="mapping-filter-sql-fragment-alias-query-example" class="exampleblock">
<div class="title">Example 102. Fetching a collection filtered with <code>@SqlFragmentAlias</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">enableFilter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"activeAccount"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"active"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select a from Account a"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    filtersqlf0_</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln">
    filtersqlf0_</span><span class="pun">.</span><span class="pln">active </span><span class="kwd">as</span><span class="pln"> active2_0_</span><span class="pun">,</span><span class="pln">
    filtersqlf0_</span><span class="pun">.</span><span class="pln">amount </span><span class="kwd">as</span><span class="pln"> amount3_0_</span><span class="pun">,</span><span class="pln">
    filtersqlf0_</span><span class="pun">.</span><span class="pln">rate </span><span class="kwd">as</span><span class="pln"> rate4_0_</span><span class="pun">,</span><span class="pln">
    filtersqlf0_1_</span><span class="pun">.</span><span class="pln">deleted </span><span class="kwd">as</span><span class="pln"> deleted1_1_
</span><span class="kwd">from</span><span class="pln">
    account filtersqlf0_
left outer join
    account_details filtersqlf0_1_
        on filtersqlf0_</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">filtersqlf0_1_</span><span class="pun">.</span><span class="pln">id
</span><span class="kwd">where</span><span class="pln">
    filtersqlf0_</span><span class="pun">.</span><span class="pln">active </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> filtersqlf0_1_</span><span class="pun">.</span><span class="pln">deleted </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-column-any"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-any"></a>2.3.26. <code>@Any</code> mapping</h4>
<div class="paragraph">
<p>There is one more type of property mapping.
The <code>@Any</code> mapping defines a polymorphic association to classes from multiple tables.
This type of mapping requires more than one column.
The first column contains the type of the associated entity.
The remaining columns contain the identifier.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is impossible to specify a foreign key constraint for this kind of association.
This is not the usual way of mapping polymorphic associations and you should use this only in special cases (e.g. audit logs, user session data, etc).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>@Any</code> annotation describes the column holding the metadata information.
To link the value of the metadata information and an actual entity type, the <code>@AnyDef</code> and <code>@AnyDefs</code> annotations are used.
The <code>metaType</code> attribute allows the application to specify a custom type that maps database column values to persistent classes that have identifier properties of the type specified by <code>idType</code>.
You must specify the mapping from values of the <code>metaType</code> to class names.</p>
</div>
<div class="paragraph">
<p>For the next examples, consider the following <code>Property</code> class hierarchy:</p>
</div>
<div id="mapping-column-any-property-example" class="exampleblock">
<div class="title">Example 103. <code>Property</code> class hierarchy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">();</span><span class="pln">

    T getValue</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"integer_property"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">IntegerProperty</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`value`"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"string_property"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">StringProperty</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`value`"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>PropertyHolder</code> can reference any such property, and, because each <code>Property</code> belongs to a separate table, the <code>@Any</code> annotation is, therefore, required.</p>
</div>
<div id="mapping-column-any-example" class="exampleblock">
<div class="title">Example 104. <code>@Any</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_holder"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PropertyHolder</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Any</span><span class="pun">(</span><span class="pln">
        metaDef </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PropertyMetaDef"</span><span class="pun">,</span><span class="pln">
        metaColumn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_type"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Property</span><span class="pln"> </span><span class="kwd">property</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CREATE TABLE property_holder </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
    property_type VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    property_id BIGINT</span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are two columns used to reference a <code>Property</code> instance: <code>property_id</code> and <code>property_type</code>.
The <code>property_id</code> is used to match the <code>id</code> column of either the <code>string_property</code> or <code>integer_property</code> tables,
while the <code>property_type</code> is used to match the <code>string_property</code> or the  <code>integer_property</code> table.</p>
</div>
<div class="paragraph">
<p>The table resolving mapping is defined by the <code>metaDef</code> attribute which references an <code>@AnyMetaDef</code> mapping.
Although the <code>@AnyMetaDef</code> mapping could be set right next to the <code>@Any</code> annotation,
itâ€™s good practice to reuse it, therefore it makes sense to configure it on a class or package-level basis.</p>
</div>
<div class="paragraph">
<p>The <code>package-info.java</code> contains the <code>@AnyMetaDef</code> mapping:</p>
</div>
<div id="mapping-column-any-meta-def-example" class="exampleblock">
<div class="title">Example 105. <code>@Any</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@AnyMetaDef</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">=</span><span class="pln"> </span><span class="str">"PropertyMetaDef"</span><span class="pun">,</span><span class="pln"> metaType </span><span class="pun">=</span><span class="pln"> </span><span class="str">"string"</span><span class="pun">,</span><span class="pln"> idType </span><span class="pun">=</span><span class="pln"> </span><span class="str">"long"</span><span class="pun">,</span><span class="pln">
    metaValues </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@MetaValue</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"S"</span><span class="pun">,</span><span class="pln"> targetEntity </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StringProperty</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@MetaValue</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"I"</span><span class="pun">,</span><span class="pln"> targetEntity </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IntegerProperty</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">userguide</span><span class="pun">.</span><span class="pln">mapping</span><span class="pun">.</span><span class="pln">basic</span><span class="pun">.</span><span class="pln">any</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">AnyMetaDef</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">MetaValue</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is recommended to place the <code>@AnyMetaDef</code> mapping as a package metadata.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To see the <code>@Any</code> annotation in action, consider the next examples.</p>
</div>
<div class="paragraph">
<p>If we persist an <code>IntegerProperty</code> as well as a <code>StringProperty</code> entity, and associate
the <code>StringProperty</code> entity with a <code>PropertyHolder</code>,
Hibernate will generate the following SQL queries:</p>
</div>
<div id="mapping-column-any-persist-example" class="exampleblock">
<div class="title">Example 106. <code>@Any</code> mapping persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">IntegerProperty</span><span class="pln"> ageProperty </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IntegerProperty</span><span class="pun">();</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"age"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setValue</span><span class="pun">(</span><span class="pln"> </span><span class="lit">23</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> ageProperty </span><span class="pun">);</span><span class="pln">

</span><span class="typ">StringProperty</span><span class="pln"> nameProperty </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringProperty</span><span class="pun">();</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> nameProperty </span><span class="pun">);</span><span class="pln">

</span><span class="typ">PropertyHolder</span><span class="pln"> namePropertyHolder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PropertyHolder</span><span class="pun">();</span><span class="pln">
namePropertyHolder</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
namePropertyHolder</span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="pln"> nameProperty </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> namePropertyHolder </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO integer_property
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'age'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO string_property
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO property_holder
       </span><span class="pun">(</span><span class="pln"> property_type</span><span class="pun">,</span><span class="pln"> property_id</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'S'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>PropertyHolder</code> entity and navigating its <code>property</code> association,
Hibernate will fetch the associated <code>StringProperty</code> entity like this:</p>
</div>
<div id="mapping-column-any-query-example" class="exampleblock">
<div class="title">Example 107. <code>@Any</code> mapping query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyHolder</span><span class="pln"> propertyHolder </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PropertyHolder</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> propertyHolder</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">());</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">,</span><span class="pln"> propertyHolder</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">().</span><span class="pln">getValue</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT ph</span><span class="pun">.</span><span class="pln">id AS id1_1_0_</span><span class="pun">,</span><span class="pln">
       ph</span><span class="pun">.</span><span class="pln">property_type AS property2_1_0_</span><span class="pun">,</span><span class="pln">
       ph</span><span class="pun">.</span><span class="pln">property_id AS property3_1_0_
FROM   property_holder ph
WHERE  ph</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">


SELECT sp</span><span class="pun">.</span><span class="pln">id AS id1_2_0_</span><span class="pun">,</span><span class="pln">
       sp</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> AS name2_2_0_</span><span class="pun">,</span><span class="pln">
       sp</span><span class="pun">.</span><span class="str">"value"</span><span class="pln"> AS value3_2_0_
FROM   string_property sp
WHERE  sp</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-column-many-to-any"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-many-to-any"></a><code>@ManyToAny</code> mapping</h5>
<div class="paragraph">
<p>The <code>@Any</code> mapping is useful to emulate a <code>@ManyToOne</code> association when there can be multiple target entities.
To emulate a <code>@OneToMany</code> association, the <code>@ManyToAny</code> annotation must be used.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>PropertyRepository</code> entity has a collection of <code>Property</code> entities.</p>
</div>
<div class="paragraph">
<p>The <code>repository_properties</code> link table holds the associations between <code>PropertyRepository</code> and <code>Property</code> entities.</p>
</div>
<div id="mapping-column-many-to-any-example" class="exampleblock">
<div class="title">Example 108. <code>@ManyToAny</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_repository"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PropertyRepository</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToAny</span><span class="pun">(</span><span class="pln">
        metaDef </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PropertyMetaDef"</span><span class="pun">,</span><span class="pln">
        metaColumn </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_type"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Cascade</span><span class="pun">(</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL </span><span class="pun">})</span><span class="pln">
    </span><span class="lit">@JoinTable</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"repository_properties"</span><span class="pun">,</span><span class="pln">
        joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"repository_id"</span><span class="pun">),</span><span class="pln">
        inverseJoinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"property_id"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Property</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln"> properties </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CREATE TABLE property_repository </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE repository_properties </span><span class="pun">(</span><span class="pln">
    repository_id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
    property_type VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    property_id BIGINT NOT NULL
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see the <code>@ManyToAny</code> annotation in action, consider the next examples.</p>
</div>
<div class="paragraph">
<p>If we persist an <code>IntegerProperty</code> as well as a <code>StringProperty</code> entity,
and associate both of them with a <code>PropertyRepository</code> parent entity,
Hibernate will generate the following SQL queries:</p>
</div>
<div id="mapping-column-many-to-any-persist-example" class="exampleblock">
<div class="title">Example 109. <code>@ManyToAny</code> mapping persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">IntegerProperty</span><span class="pln"> ageProperty </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IntegerProperty</span><span class="pun">();</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"age"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
ageProperty</span><span class="pun">.</span><span class="pln">setValue</span><span class="pun">(</span><span class="pln"> </span><span class="lit">23</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> ageProperty </span><span class="pun">);</span><span class="pln">

</span><span class="typ">StringProperty</span><span class="pln"> nameProperty </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringProperty</span><span class="pun">();</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
nameProperty</span><span class="pun">.</span><span class="pln">setValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> nameProperty </span><span class="pun">);</span><span class="pln">

</span><span class="typ">PropertyRepository</span><span class="pln"> propertyRepository </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PropertyRepository</span><span class="pun">();</span><span class="pln">
propertyRepository</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

propertyRepository</span><span class="pun">.</span><span class="pln">getProperties</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> ageProperty </span><span class="pun">);</span><span class="pln">
propertyRepository</span><span class="pun">.</span><span class="pln">getProperties</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> nameProperty </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> propertyRepository </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO integer_property
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'age'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO string_property
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO property_repository </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO repository_properties
    </span><span class="pun">(</span><span class="pln"> repository_id </span><span class="pun">,</span><span class="pln"> property_type </span><span class="pun">,</span><span class="pln"> property_id </span><span class="pun">)</span><span class="pln">
VALUES
    </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="str">'I'</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>PropertyRepository</code> entity and navigating its <code>properties</code> association,
Hibernate will fetch the associated <code>IntegerProperty</code> and <code>StringProperty</code> entities like this:</p>
</div>
<div id="mapping-column-many-to-any-query-example" class="exampleblock">
<div class="title">Example 110. <code>@ManyToAny</code> mapping query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyRepository</span><span class="pln"> propertyRepository </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PropertyRepository</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> propertyRepository</span><span class="pun">.</span><span class="pln">getProperties</span><span class="pun">().</span><span class="pln">size</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Property</span><span class="pln"> </span><span class="kwd">property</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> propertyRepository</span><span class="pun">.</span><span class="pln">getProperties</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertNotNull</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">property</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT pr</span><span class="pun">.</span><span class="pln">id AS id1_1_0_
FROM   property_repository pr
WHERE  pr</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT ip</span><span class="pun">.</span><span class="pln">id AS id1_0_0_ </span><span class="pun">,</span><span class="pln">
       ip</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> AS name2_0_0_ </span><span class="pun">,</span><span class="pln">
       ip</span><span class="pun">.</span><span class="str">"value"</span><span class="pln"> AS value3_0_0_
FROM   integer_property ip
WHERE  ip</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT sp</span><span class="pun">.</span><span class="pln">id AS id1_3_0_ </span><span class="pun">,</span><span class="pln">
       sp</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> AS name2_3_0_ </span><span class="pun">,</span><span class="pln">
       sp</span><span class="pun">.</span><span class="str">"value"</span><span class="pln"> AS value3_3_0_
FROM   string_property sp
WHERE  sp</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-JoinFormula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-JoinFormula"></a>2.3.27. <code>@JoinFormula</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/JoinFormula.html"><code>@JoinFormula</code></a> annotation is used to customize the join between a child Foreign Key and a parent row Primary Key.</p>
</div>
<div id="mapping-JoinFormula-example" class="exampleblock">
<div class="title">Example 111. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"User"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"users"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> phoneNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="lit">@JoinFormula</span><span class="pun">(</span><span class="pln"> </span><span class="str">"REGEXP_REPLACE(phoneNumber, '\\+(\\d+)-.*', '\\1')::int"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Country"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"countries"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters, equals and hashCode methods omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CREATE TABLE countries </span><span class="pun">(</span><span class="pln">
    id int4 NOT NULL</span><span class="pun">,</span><span class="pln">
    name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE users </span><span class="pun">(</span><span class="pln">
    id int8 NOT NULL</span><span class="pun">,</span><span class="pln">
    firstName VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    phoneNumber VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>country</code> association in the <code>User</code> entity is mapped by the country identifier provided by the <code>phoneNumber</code> property.</p>
</div>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div id="mapping-JoinFormula-persistence-example" class="exampleblock">
<div class="title">Example 112. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Country</span><span class="pln"> US </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Country</span><span class="pun">();</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"United States"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Country</span><span class="pln"> </span><span class="typ">Romania</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Country</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Romania"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> US </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Romania</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">User</span><span class="pln"> user1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setPhoneNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"+1-234-5678"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> user1 </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> user2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setPhoneNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"+40-123-4567"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> user2 </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>User</code> entities, the <code>country</code> property is mapped by the <code>@JoinFormula</code> expression:</p>
</div>
<div id="mapping-JoinFormula-fetching-example" class="exampleblock">
<div class="title">Example 113. <code>@JoinFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetch User entities"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> US</span><span class="pun">,</span><span class="pln"> john</span><span class="pun">.</span><span class="pln">getCountry</span><span class="pun">());</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> vlad </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Romania</span><span class="pun">,</span><span class="pln"> vlad</span><span class="pun">.</span><span class="pln">getCountry</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pun">--</span><span class="pln"> </span><span class="typ">Fetch</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> entities

SELECT
    u</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam2_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName3_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">phoneNumber </span><span class="kwd">as</span><span class="pln"> phoneNum4_1_0_</span><span class="pun">,</span><span class="pln">
    REGEXP_REPLACE</span><span class="pun">(</span><span class="pln">u</span><span class="pun">.</span><span class="pln">phoneNumber</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\+(\d+)-.*'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\1'</span><span class="pun">)::</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> formula1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON REGEXP_REPLACE</span><span class="pun">(</span><span class="pln">u</span><span class="pun">.</span><span class="pln">phoneNumber</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\+(\d+)-.*'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\1'</span><span class="pun">)::</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">id
WHERE
    u</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    u</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam2_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName3_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">phoneNumber </span><span class="kwd">as</span><span class="pln"> phoneNum4_1_0_</span><span class="pun">,</span><span class="pln">
    REGEXP_REPLACE</span><span class="pun">(</span><span class="pln">u</span><span class="pun">.</span><span class="pln">phoneNumber</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\+(\d+)-.*'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\1'</span><span class="pun">)::</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> formula1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON REGEXP_REPLACE</span><span class="pun">(</span><span class="pln">u</span><span class="pun">.</span><span class="pln">phoneNumber</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\+(\d+)-.*'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'\1'</span><span class="pun">)::</span><span class="kwd">int</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">id
WHERE
    u</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@JoinFormula</code> annotation is used to define a custom join association between the parent-child association.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-JoinColumnOrFormula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-JoinColumnOrFormula"></a>2.3.28. <code>@JoinColumnOrFormula</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/JoinColumnOrFormula.html"><code>@JoinColumnOrFormula</code></a> annotation is used to customize the join between a child Foreign Key and a parent row Primary Key when we need to take into consideration a column value as well as a <code>@JoinFormula</code>.</p>
</div>
<div id="mapping-JoinColumnOrFormula-example" class="exampleblock">
<div class="title">Example 114. <code>@JoinColumnOrFormula</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"User"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"users"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> language</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="lit">@JoinColumnOrFormula</span><span class="pun">(</span><span class="pln"> column </span><span class="pun">=</span><span class="pln">
		</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">
			name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"language"</span><span class="pun">,</span><span class="pln">
			referencedColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"primaryLanguage"</span><span class="pun">,</span><span class="pln">
			insertable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
			updatable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumnOrFormula</span><span class="pun">(</span><span class="pln"> formula </span><span class="pun">=</span><span class="pln">
		</span><span class="lit">@JoinFormula</span><span class="pun">(</span><span class="pln">
			value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">,</span><span class="pln">
			referencedColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"is_default"</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Country"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"countries"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> primaryLanguage</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"is_default"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> _default</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters, equals and hashCode methods omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CREATE TABLE countries </span><span class="pun">(</span><span class="pln">
    id INTEGER NOT NULL</span><span class="pun">,</span><span class="pln">
    is_default </span><span class="kwd">boolean</span><span class="pun">,</span><span class="pln">
    name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primaryLanguage VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE users </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
    firstName VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    language VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>country</code> association in the <code>User</code> entity is mapped by the <code>language</code> property value and the associated <code>Country</code> <code>is_default</code> column value.</p>
</div>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div id="mapping-JoinColumnOrFormula-persistence-example" class="exampleblock">
<div class="title">Example 115. <code>@JoinColumnOrFormula</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Country</span><span class="pln"> US </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Country</span><span class="pun">();</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setDefault</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setPrimaryLanguage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"English"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
US</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"United States"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Country</span><span class="pln"> </span><span class="typ">Romania</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Country</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setDefault</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Romania"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Romania</span><span class="pun">.</span><span class="pln">setPrimaryLanguage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Romanian"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> US </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Romania</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">User</span><span class="pln"> user1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user1</span><span class="pun">.</span><span class="pln">setLanguage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"English"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> user1 </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> user2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	user2</span><span class="pun">.</span><span class="pln">setLanguage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Romanian"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> user2 </span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>User</code> entities, the <code>country</code> property is mapped by the <code>@JoinColumnOrFormula</code> expression:</p>
</div>
<div id="mapping-JoinColumnOrFormula-fetching-example" class="exampleblock">
<div class="title">Example 116. <code>@JoinColumnOrFormula</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetch User entities"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> US</span><span class="pun">,</span><span class="pln"> john</span><span class="pun">.</span><span class="pln">getCountry</span><span class="pun">());</span><span class="pln">

	</span><span class="typ">User</span><span class="pln"> vlad </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Romania</span><span class="pun">,</span><span class="pln"> vlad</span><span class="pun">.</span><span class="pln">getCountry</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    u</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">language </span><span class="kwd">as</span><span class="pln"> language3_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam2_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName4_1_0_</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> formula1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">is_default </span><span class="kwd">as</span><span class="pln"> is_defau2_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name3_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">primaryLanguage </span><span class="kwd">as</span><span class="pln"> primaryL4_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON u</span><span class="pun">.</span><span class="pln">language </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">primaryLanguage
        AND </span><span class="lit">1</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">is_default
WHERE
    u</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    u</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">language </span><span class="kwd">as</span><span class="pln"> language3_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam2_1_0_</span><span class="pun">,</span><span class="pln">
    u</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName4_1_0_</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> formula1_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">is_default </span><span class="kwd">as</span><span class="pln"> is_defau2_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name3_0_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">primaryLanguage </span><span class="kwd">as</span><span class="pln"> primaryL4_0_1_
FROM
    users u
LEFT OUTER JOIN
    countries c
        ON u</span><span class="pun">.</span><span class="pln">language </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">primaryLanguage
        AND </span><span class="lit">1</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">is_default
WHERE
    u</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@JoinColumnOrFormula</code> annotation is used to define a custom join association between the parent-child association.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-Target"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-Target"></a>2.3.29. <code>@Target</code> mapping</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Target.html"><code>@Target</code></a> annotation is used to specify the implementation class of a given association that is mapped via an interface.
The
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html"><code>@ManyToOne</code></a>,
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html"><code>@OneToOne</code></a>,
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html"><code>@OneToMany</code></a>, and
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html"><code>@ManyToMany</code></a>
feature a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html#targetEntity--"><code>targetEntity</code></a> attribute to specify the actual class of the entity association when an interface is used for the mapping.</p>
</div>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ElementCollection.html"><code>@ElementCollection</code></a> association has a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ElementCollection.html#targetClass--"><code>targetClass</code></a> attribute for the same purpose.</p>
</div>
<div class="paragraph">
<p>However, for simple embeddable types, there is no such construct and so you need to use the Hibernate-specific <code>@Target</code> annotation instead.</p>
</div>
<div id="mapping-Target-example" class="exampleblock">
<div class="title">Example 117. <code>@Target</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Coordinates</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">double</span><span class="pln"> x</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">double</span><span class="pln"> y</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> GPS </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Coordinates</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> latitude</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> longitude</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> GPS</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> GPS</span><span class="pun">(</span><span class="kwd">double</span><span class="pln"> latitude</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> longitude</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">latitude </span><span class="pun">=</span><span class="pln"> latitude</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">longitude </span><span class="pun">=</span><span class="pln"> longitude</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> x</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> latitude</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> y</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> longitude</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"City"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">City</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Embedded</span><span class="pln">
	</span><span class="lit">@Target</span><span class="pun">(</span><span class="pln"> GPS</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Coordinates</span><span class="pln"> coordinates</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>coordinates</code> embeddable type is mapped as the <code>Coordinates</code> interface.
However, Hibernate needs to know the actual implementation tye, which is <code>GPS</code> in this case,
hence the <code>@Target</code> annotation is used to provide this information.</p>
</div>
<div class="paragraph">
<p>Assuming we have persisted the following <code>City</code> entity:</p>
</div>
<div id="mapping-Target-persist-example" class="exampleblock">
<div class="title">Example 118. <code>@Target</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">City</span><span class="pln"> cluj </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">City</span><span class="pun">();</span><span class="pln">
	cluj</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Cluj"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	cluj</span><span class="pun">.</span><span class="pln">setCoordinates</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> GPS</span><span class="pun">(</span><span class="pln"> </span><span class="lit">46.77120</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23.62360</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> cluj </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>City</code> entity, the <code>coordinates</code> property is mapped by the <code>@Target</code> expression:</p>
</div>
<div id="mapping-Target-fetching-example" class="exampleblock">
<div class="title">Example 119. <code>@Target</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">City</span><span class="pln"> cluj </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">City</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">46.77120</span><span class="pun">,</span><span class="pln"> cluj</span><span class="pun">.</span><span class="pln">getCoordinates</span><span class="pun">().</span><span class="pln">x</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">0.00001</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">23.62360</span><span class="pun">,</span><span class="pln"> cluj</span><span class="pun">.</span><span class="pln">getCoordinates</span><span class="pun">().</span><span class="pln">y</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">0.00001</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">latitude </span><span class="kwd">as</span><span class="pln"> latitude2_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">longitude </span><span class="kwd">as</span><span class="pln"> longitud3_0_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name4_0_0_
FROM
    </span><span class="typ">City</span><span class="pln"> c
WHERE
    c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">latitude2_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">DOUBLE</span><span class="pun">])</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">46.7712</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">longitud3_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">DOUBLE</span><span class="pun">])</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">23.6236</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">name4_0_0_</span><span class="pun">]</span><span class="pln">     </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Cluj</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@Target</code> annotation is used to define a custom join association between the parent-child association.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-Parent"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-Parent"></a>2.3.30. <code>@Parent</code> mapping</h4>
<div class="paragraph">
<p>The Hibernate-specific <code>@Parent</code> annotation allows you to reference the owner entity from within an embeddable.</p>
</div>
<div id="mapping-Parent-example" class="exampleblock">
<div class="title">Example 120. <code>@Parent</code> mapping usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> GPS </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> latitude</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> longitude</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Parent</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">City</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"City"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">City</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Embedded</span><span class="pln">
	</span><span class="lit">@Target</span><span class="pun">(</span><span class="pln"> GPS</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> GPS coordinates</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assuming we have persisted the following <code>City</code> entity:</p>
</div>
<div id="mapping-Parent-persist-example" class="exampleblock">
<div class="title">Example 121. <code>@Parent</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">City</span><span class="pln"> cluj </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">City</span><span class="pun">();</span><span class="pln">
	cluj</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Cluj"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	cluj</span><span class="pun">.</span><span class="pln">setCoordinates</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> GPS</span><span class="pun">(</span><span class="pln"> </span><span class="lit">46.77120</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23.62360</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> cluj </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>City</code> entity, the <code>city</code> property of the embeddable type acts as a back reference to the owning parent entity:</p>
</div>
<div id="mapping-Parent-fetching-example" class="exampleblock">
<div class="title">Example 122. <code>@Parent</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">City</span><span class="pln"> cluj </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">City</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	assertSame</span><span class="pun">(</span><span class="pln"> cluj</span><span class="pun">,</span><span class="pln"> cluj</span><span class="pun">.</span><span class="pln">getCoordinates</span><span class="pun">().</span><span class="pln">getCity</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>@Parent</code> annotation is used to define the association between an embeddable type and the owning entity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="embeddables"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddables"></a>2.4. Embeddable types</h3>
<div class="paragraph">
<p>Historically Hibernate called these components.
JPA calls them embeddables.
Either way, the concept is the same: a composition of values.</p>
</div>
<div class="paragraph">
<p>For example, we might have a <code>Publisher</code> class that is a composition of <code>name</code> and <code>country</code>,
or a <code>Location</code> class that is a composition of <code>country</code> and <code>city</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>embeddable</em></div>
<div class="paragraph">
<p>To avoid any confusion with the annotation that marks a given embeddable type, the annotation will be further referred to as <code>@Embeddable</code>.</p>
</div>
<div class="paragraph">
<p>Throughout this chapter and thereafter, for brevity sake, embeddable types may also be referred to as <em>embeddable</em>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 123. Embeddable type example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Location</span><span class="pln"> location</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Location</span><span class="pln"> location</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">location </span><span class="pun">=</span><span class="pln"> location</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Location</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Location</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> country</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> city</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">country </span><span class="pun">=</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">city </span><span class="pun">=</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Location</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An embeddable type is another form of a value type, and its lifecycle is bound to a parent entity type, therefore inheriting the attribute access from its parent (for details on attribute access, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#access-embeddable-types">Access strategies</a>).</p>
</div>
<div class="paragraph">
<p>Embeddable types can be made up of basic values as well as associations, with the caveat that, when used as collection elements, they cannot define collections themselves.</p>
</div>
<div class="sect3">
<h4 id="_component_embedded"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_component_embedded"></a>2.4.1. Component / Embedded</h4>
<div class="paragraph">
<p>Most often, embeddable types are used to group multiple basic type mappings and reuse them across several entities.</p>
</div>
<div id="simple-embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 124. Simple Embeddable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> publisher</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"publisher_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"publisher_country"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters, equals and hashCode methods omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    author varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    publisher_country varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    publisher_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPA defines two terms for working with an embeddable type: <code>@Embeddable</code> and <code>@Embedded</code>.</p>
</div>
<div class="paragraph">
<p><code>@Embeddable</code> is used to describe the mapping type itself (e.g. <code>Publisher</code>).</p>
</div>
<div class="paragraph">
<p><code>@Embedded</code> is for referencing a given embeddable type (e.g. <code>book#publisher</code>).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So, the embeddable type is represented by the <code>Publisher</code> class and
the parent entity makes use of it through the <code>book#publisher</code> object composition.</p>
</div>
<div class="paragraph">
<p>The composed values are mapped to the same table as the parent table.
Composition is part of good object-oriented data modeling (idiomatic Java).
In fact, that table could also be mapped by the following entity type instead.</p>
</div>
<div id="alternative-to-embeddable-type-mapping-example" class="exampleblock">
<div class="title">Example 125. Alternative to embeddable type composition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"publisher_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> publisherName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"publisher_country"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> publisherCountry</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The composition form is certainly more object-oriented, and that becomes more evident as we work with multiple embeddable types.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-multiple"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-multiple"></a>2.4.2. Multiple embeddable types</h4>
<div class="paragraph">
<p>Although from an object-oriented perspective, itâ€™s much more convenient to work with embeddable types, this example doesnâ€™t work as-is.
When the same embeddable type is included multiple times in the same parent entity type, the JPA specification demands to set the associated column names explicitly.</p>
</div>
<div class="paragraph">
<p>This requirement is due to how object properties are mapped to database columns.
By default, JPA expects a database column having the same name with its associated object property.
When including multiple embeddables, the implicit name-based mapping rule doesnâ€™t work anymore because multiple object properties could end-up being mapped to the same database column.</p>
</div>
<div class="paragraph">
<p>We have a few options to handle this issue.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-override"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-override"></a>2.4.3. Overriding Embeddable types</h4>
<div class="paragraph">
<p>JPA defines the <code>@AttributeOverride</code> annotation to handle this scenario.
This way, the mapping conflict is resolved by setting up explicit name-based property-column type mappings.</p>
</div>
<div class="paragraph">
<p>If an Embeddable type is used multiple times in some entity, you need to use the
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AttributeOverride.html"><code>@AttributeOverride</code></a> and
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AssociationOverride.html"><code>@AssociationOverride</code></a> annotations
to override the default column names defined by the Embeddable.</p>
</div>
<div class="paragraph">
<p>Considering you have the following <code>Publisher</code> embeddable type
which defines a <code>@ManyToOne</code> association with the <code>Country</code> entity:</p>
</div>
<div id="embeddable-type-association-mapping-example" class="exampleblock">
<div class="title">Example 126. Embeddable type with a <code>@ManyToOne</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters, equals and hashCode methods omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Country"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Country</span><span class="pln">
    add constraint UK_p1n05aafu73sbm3ggsxqeditd
    unique </span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, if you have a <code>Book</code> entity which declares two <code>Publisher</code> embeddable types for the ebook and paperback version,
you cannot use the default <code>Publisher</code> embeddable mapping since there will be a conflict between the two embeddable column mappings.</p>
</div>
<div class="paragraph">
<p>Therefore, the <code>Book</code> entity needs to override the embeddable type mappings for each <code>Publisher</code> attribute:</p>
</div>
<div id="embeddable-type-override-mapping-example" class="exampleblock">
<div class="title">Example 127. Overriding embeddable type attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@AttributeOverrides</span><span class="pun">({</span><span class="pln">
	</span><span class="lit">@AttributeOverride</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ebookPublisher.name"</span><span class="pun">,</span><span class="pln">
		column </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ebook_publisher_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">),</span><span class="pln">
	</span><span class="lit">@AttributeOverride</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"paperBackPublisher.name"</span><span class="pun">,</span><span class="pln">
		column </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"paper_back_publisher_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@AssociationOverrides</span><span class="pun">({</span><span class="pln">
	</span><span class="lit">@AssociationOverride</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ebookPublisher.country"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ebook_publisher_country_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">),</span><span class="pln">
	</span><span class="lit">@AssociationOverride</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"paperBackPublisher.country"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"paper_back_publisher_country_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> ebookPublisher</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> paperBackPublisher</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    author varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    ebook_publisher_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    paper_back_publisher_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    ebook_publisher_country_id bigint</span><span class="pun">,</span><span class="pln">
    paper_back_publisher_country_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Book</span><span class="pln">
    add constraint </span><span class="typ">FKm39ibh5jstybnslaoojkbac2g</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">ebook_publisher_country_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Country</span><span class="pln">

alter table </span><span class="typ">Book</span><span class="pln">
    add constraint FK7kqy9da323p7jw7wvqgs6aek7
    foreign key </span><span class="pun">(</span><span class="pln">paper_back_publisher_country_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Country</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-multiple-namingstrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-multiple-namingstrategy"></a>2.4.4. Embeddables and ImplicitNamingStrategy</h4>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a Hibernate specific feature.
Users concerned with JPA provider portability should instead prefer explicit column naming with <code>@AttributeOverride</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate naming strategies are covered in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naming">Naming</a>.
However, for the purposes of this discussion, Hibernate has the capability to interpret implicit column names in a way that is safe for use with multiple embeddable types.</p>
</div>
<div id="embeddable-multiple-namingstrategy-entity-mapping" class="exampleblock">
<div class="title">Example 128. Implicit multiple embeddable type mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> ebookPublisher</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> paperBackPublisher</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters, equals and hashCode methods omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Country"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To make it work, you need to use the <code>ImplicitNamingStrategyComponentPathImpl</code> naming strategy.</p>
</div>
<div id="embeddable-multiple-ImplicitNamingStrategyComponentPathImpl" class="exampleblock">
<div class="title">Example 129. Enabling implicit embeddable type mapping using the component path naming strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">metadataBuilder</span><span class="pun">.</span><span class="pln">applyImplicitNamingStrategy</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">ImplicitNamingStrategyComponentPathImpl</span><span class="pun">.</span><span class="pln">INSTANCE
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the "path" to attributes are used in the implicit column naming:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    author varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    ebookPublisher_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    paperBackPublisher_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    ebookPublisher_country_id bigint</span><span class="pun">,</span><span class="pln">
    paperBackPublisher_country_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could even develop your own naming strategy to do other types of implicit naming strategies.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-collections"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-collections"></a>2.4.5. Collections of embeddable types</h4>
<div class="paragraph">
<p>Collections of embeddable types are specifically valued collections (as embeddable types are a value type).
Value collections are covered in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-value">Collections of value types</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-mapkey"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-mapkey"></a>2.4.6. Embeddable type as a Map key</h4>
<div class="paragraph">
<p>Embeddable types can also be used as <code>Map</code> keys.
This topic is converted in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map">Map - key</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-identifier"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-identifier"></a>2.4.7. Embeddable type as identifier</h4>
<div class="paragraph">
<p>Embeddable types can also be used as entity type identifiers.
This usage is covered in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite">Composite identifiers</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Embeddable types that are used as collection entries, map keys or entity type identifiers cannot include their own collection mappings.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity"></a>2.5. Entity types</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Usage of the word <em>entity</em></div>
<div class="paragraph">
<p>The entity type describes the mapping between the actual persistable domain model object and a database table row.
To avoid any confusion with the annotation that marks a given entity type, the annotation will be further referred to as <code>@Entity</code>.</p>
</div>
<div class="paragraph">
<p>Throughout this chapter and thereafter, entity types will be simply referred to as <em>entity</em>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="entity-pojo"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo"></a>2.5.1. POJO Models</h4>
<div class="paragraph">
<p>Section <em>2.1 The Entity Class</em> of the <em>JPA 2.1 specification</em> defines its requirements for an entity class.
Applications that wish to remain portable across JPA providers should adhere to these requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity class must be annotated with the <code>javax.persistence.Entity</code> annotation (or be denoted as such in XML mapping)</p>
</li>
<li>
<p>The entity class must have a public or protected no-argument constructor. It may define additional constructors as well.</p>
</li>
<li>
<p>The entity class must be a top-level class.</p>
</li>
<li>
<p>An enum or interface may not be designated as an entity.</p>
</li>
<li>
<p>The entity class must not be final. No methods or persistent instance variables of the entity class may be final.</p>
</li>
<li>
<p>If an entity instance is to be used remotely as a detached object, the entity class must implement the <code>Serializable</code> interface.</p>
</li>
<li>
<p>Both abstract and concrete classes can be entities. Entities may extend non-entity classes as well as entity classes, and non-entity classes may extend entity classes.</p>
</li>
<li>
<p>The persistent state of an entity is represented by instance variables, which may correspond to JavaBean-style properties.
An instance variable must be directly accessed only from within the methods of the entity by the entity instance itself.
The state of the entity is available to clients only through the entityâ€™s accessor methods (getter/setter methods) or other business methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate, however, is not as strict in its requirements. The differences from the list above include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity class must have a no-argument constructor, which may be public, protected or package visibility. It may define additional constructors as well.</p>
</li>
<li>
<p>The entity class <em>need not</em> be a top-level class.</p>
</li>
<li>
<p>Technically Hibernate can persist final classes or classes with final persistent state accessor (getter/setter) methods.
However, it is generally not a good idea as doing so will stop Hibernate from being able to generate proxies for lazy-loading the entity.</p>
</li>
<li>
<p>Hibernate does not restrict the application developer from exposing instance variables and reference them from outside the entity class itself.
The validity of such a paradigm, however, is debatable at best.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Letâ€™s look at each requirement in detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-final"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo-final"></a>2.5.2. Prefer non-final classes</h4>
<div class="paragraph">
<p>A central feature of Hibernate is the ability to load lazily certain entity instance variables (attributes) via runtime proxies.
This feature depends upon the entity class being non-final or else implementing an interface that declares all the attribute getters/setters.
You can still persist final classes that do not implement such an interface with Hibernate,
but you will not be able to use proxies for fetching lazy associations, therefore limiting your options for performance tuning.
For the very same reason, you should also avoid declaring persistent attribute getters and setters as final.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting in 5.0 Hibernate offers a more robust version of bytecode enhancement as another means for handling lazy loading.
Hibernate had some bytecode re-writing capabilities prior to 5.0 but they were very rudimentary.
See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement">BytecodeEnhancement</a> for additional information on fetching and on bytecode enhancement.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-constructor"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo-constructor"></a>2.5.3. Implement a no-argument constructor</h4>
<div class="paragraph">
<p>The entity class should have a no-argument constructor. Both Hibernate and JPA require this.</p>
</div>
<div class="paragraph">
<p>JPA requires that this constructor be defined as public or protected.
Hibernate, for the most part, does not care about the constructor visibility, as long as the system SecurityManager allows overriding the visibility setting.
That said, the constructor should be defined with at least package visibility if you wish to leverage runtime proxy generation.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-accessors"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo-accessors"></a>2.5.4. Declare getters and setters for persistent attributes</h4>
<div class="paragraph">
<p>The JPA specification requires this, otherwise, the model would prevent accessing the entity persistent state fields directly from outside the entity itself.</p>
</div>
<div class="paragraph">
<p>Although Hibernate does not require it, it is recommended to follow the JavaBean conventions and define getters and setters for entity persistent attributes.
Nevertheless, you can still tell Hibernate to directly access the entity fields.</p>
</div>
<div class="paragraph">
<p>Attributes (whether fields or getters/setters) need not be declared public.
Hibernate can deal with attributes declared with the public, protected, package or private visibility.
Again, if wanting to use runtime proxy generation for lazy loading, the getter/setter should grant access to at least package visibility.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-identifier"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo-identifier"></a>2.5.5. Providing identifier attribute(s)</h4>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Historically this was considered optional.
However, not defining identifier attribute(s) on the entity should be considered a deprecated feature that will be removed in an upcoming release.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The identifier attribute does not necessarily need to be mapped to the column(s) that physically define the primary key.
However, it should map to column(s) that can uniquely identify each row.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend that you declare consistently-named identifier attributes on persistent classes and that you use a nullable (i.e., non-primitive) type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The placement of the <code>@Id</code> annotation marks the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#access">persistence state access strategy</a>.</p>
</div>
<div id="entity-pojo-identifier-mapping-example" class="exampleblock">
<div class="title">Example 130. Identifier mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Id</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers multiple identifier generation strategies, see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers">Identifier Generators</a> chapter for more about this topic.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-pojo-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-pojo-mapping"></a>2.5.6. Mapping the entity</h4>
<div class="paragraph">
<p>The main piece in mapping the entity is the <code>javax.persistence.Entity</code> annotation.
The <code>@Entity</code> annotation defines just one attribute <code>name</code> which is used to give a specific entity name for use in JPQL queries.
By default, the entity name represents the unqualified name of the entity class itself.</p>
</div>
<div id="entity-pojo-mapping-example" class="exampleblock">
<div class="title">Example 131. Simple <code>@Entity</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An entity models a database table.
The identifier uniquely identifies each row in that table.
By default, the name of the table is assumed to be the same as the name of the entity.
To explicitly give the name of the table or to specify other information about the table, we would use the <code>javax.persistence.Table</code> annotation.</p>
</div>
<div id="entity-pojo-table-mapping-example" class="exampleblock">
<div class="title">Example 132. Simple <code>@Entity</code> with <code>@Table</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">
	catalog </span><span class="pun">=</span><span class="pln"> </span><span class="str">"public"</span><span class="pun">,</span><span class="pln">
	schema </span><span class="pun">=</span><span class="pln"> </span><span class="str">"store"</span><span class="pun">,</span><span class="pln">
	name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapping-model-pojo-equalshashcode"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-model-pojo-equalshashcode"></a>2.5.7. Implementing <code>equals()</code> and <code>hashCode()</code></h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Much of the discussion in this section deals with the relation of an entity to a Hibernate Session, whether the entity is managed, transient or detached.
If you are unfamiliar with these topics, they are explained in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc">Persistence Context</a> chapter.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Whether to implement <code>equals()</code> and <code>hashCode()</code> methods in your domain model, let alone how to implement them, is a surprisingly tricky discussion when it comes to ORM.</p>
</div>
<div class="paragraph">
<p>There is really just one absolute case: a class that acts as an identifier must implement equals/hashCode based on the id value(s).
Generally, this is pertinent for user-defined classes used as composite identifiers.
Beyond this one very specific use case and few others we will discuss below, you may want to consider not implementing equals/hashCode altogether.</p>
</div>
<div class="paragraph">
<p>So whatâ€™s all the fuss? Normally, most Java objects provide a built-in <code>equals()</code> and <code>hashCode()</code> based on the objectâ€™s identity, so each new object will be different from all others.
This is generally what you want in ordinary Java programming.
Conceptually however this starts to break down when you start to think about the possibility of multiple instances of a class representing the same data.</p>
</div>
<div class="paragraph">
<p>This is, in fact, exactly the case when dealing with data coming from a database.
Every time we load a specific <code>Person</code> from the database we would naturally get a unique instance.
Hibernate, however, works hard to make sure that does not happen within a given <code>Session</code>.
In fact, Hibernate guarantees equivalence of persistent identity (database row) and Java identity inside a particular session scope.
So if we ask a Hibernate <code>Session</code> to load that specific Person multiple times we will actually get back the same <em>instance</em>:</p>
</div>
<div id="entity-pojo-identity-scope-example" class="exampleblock">
<div class="title">Example 133. Scope of identity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">==</span><span class="pln"> book2 </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider we have a <code>Library</code> parent entity which contains a <code>java.util.Set</code> of <code>Book</code> entities:</p>
</div>
<div id="entity-pojo-set-mapping-example" class="paragraph">
<p>Library entity mapping</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Library"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Library</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="entity-pojo-set-identity-scope-example" class="exampleblock">
<div class="title">Example 134. Set usage with Session-scoped identity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Library</span><span class="pln"> library </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Library</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, the semantic changes when we mix instances loaded from different Sessions:</p>
</div>
<div id="entity-pojo-multi-session-identity-scope-example" class="exampleblock">
<div class="title">Example 135. Mixed Sessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertFalse</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">==</span><span class="pln"> book2 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	books</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
	books</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">

	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> books</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifically, the outcome in this last example will depend on whether the <code>Book</code> class
implemented equals/hashCode, and, if so, how.</p>
</div>
<div class="paragraph">
<p>If the <code>Book</code> class did not override the default equals/hashCode,
then the two <code>Book</code> object references are not going to be equal since their references are different.</p>
</div>
<div class="paragraph">
<p>Consider yet another case:</p>
</div>
<div id="entity-pojo-transient-set-identity-scope-example" class="exampleblock">
<div class="title">Example 136. Sets with transient entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Library</span><span class="pln"> library </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Library</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">101L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book2</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Java Persistence with Hibernate"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In cases where you will be dealing with entities outside of a Session (whether they be transient or detached),
especially in cases where you will be using them in Java collections,
you should consider implementing equals/hashCode.</p>
</div>
<div class="paragraph">
<p>A common initial approach is to use the entityâ€™s identifier attribute as the basis for equals/hashCode calculations:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-example" class="exampleblock">
<div class="title">Example 137. Naive equals/hashCode implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Library"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Library</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Book</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">id </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> id </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It turns out that this still breaks when adding transient instance of <code>Book</code> to a set as we saw in the last example:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-persist-example" class="exampleblock">
<div class="title">Example 138. Auto-generated identifiers with Sets and naive equals/hashCode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book2</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Java Persistence with Hibernate"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Library</span><span class="pln"> library </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Library</span><span class="pln"> _library </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Library</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	_library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
	_library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">return</span><span class="pln"> _library</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertFalse</span><span class="pun">(</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The issue here is a conflict between the use of the generated identifier, the contract of <code>Set</code>, and the equals/hashCode implementations.
<code>Set</code> says that the equals/hashCode value for an object should not change while the object is part of the <code>Set</code>.
But that is exactly what happened here because the equals/hasCode are based on the (generated) id, which was not set until the JPA transaction is committed.</p>
</div>
<div class="paragraph">
<p>Note that this is just a concern when using generated identifiers.
If you are using assigned identifiers this will not be a problem, assuming the identifier value is assigned prior to adding to the <code>Set</code>.</p>
</div>
<div class="paragraph">
<p>Another option is to force the identifier to be generated and set prior to adding to the <code>Set</code>:</p>
</div>
<div id="entity-pojo-naive-equals-hashcode-persist-force-flush-example" class="exampleblock">
<div class="title">Example 139. Forcing the flush before adding to the Set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book2</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Java Persistence with Hibernate"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Library</span><span class="pln"> library </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Library</span><span class="pln"> _library </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Library</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

	_library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">
	_library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">return</span><span class="pln"> _library</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> book2 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>But this is often not feasible.</p>
</div>
<div class="paragraph">
<p>The final approach is to use a "better" equals/hashCode implementation, making use of a natural-id or business-key.</p>
</div>
<div id="entity-pojo-natural-id-equals-hashcode-example" class="exampleblock">
<div class="title">Example 140. Natural Id equals/hashCode</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Library"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Library</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Book</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> isbn</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">isbn </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> isbn </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, when adding a <code>Book</code> to the <code>Library</code> <code>Set</code>, you can retrieve the <code>Book</code> even after itâ€™s being persisted:</p>
</div>
<div id="entity-pojo-natural-id-equals-hashcode-persist-example" class="exampleblock">
<div class="title">Example 141. Natural Id equals/hashCode persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book1</span><span class="pun">.</span><span class="pln">setIsbn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"978-9730228236"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Library</span><span class="pln"> library </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Library</span><span class="pln"> _library </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Library</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	_library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">return</span><span class="pln"> _library</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> library</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> book1 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see the question of equals/hashCode is not trivial, nor is there a one-size-fits-all solution.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although using a natural-id is best for <code>equals</code> and <code>hashCode</code>, sometimes you only have the entity identifier that provides a unique constraint.</p>
</div>
<div class="paragraph">
<p>Itâ€™s possible to use the entity identifier for equality check, but it needs a workaround:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you need to provide a constant value for <code>hashCode</code> so that the hash code value does not change before and after the entity is flushed.</p>
</li>
<li>
<p>you need to compare the entity identifier equality only for non-transient entities.</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For details on mapping the identifier, see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers">Identifiers</a> chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-sql-query-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-sql-query-mapping"></a>2.5.8. Mapping the entity to a SQL query</h4>
<div class="paragraph">
<p>You can map an entity to a SQL query using the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Subselect.html"><code>@Subselect</code></a> annotation.</p>
</div>
<div id="mapping-Subselect-example" class="exampleblock">
<div class="title">Example 142. <code>@Subselect</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Client"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"client"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"first_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"last_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> client</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"AccountTransaction"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_transaction"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AccountTransaction</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> account</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> cents</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"AccountSummary"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Subselect</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	a.id as id, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	concat(concat(c.first_name, ' '), c.last_name) as clientName, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	sum(at.cents) as balance "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from account a "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join client c on c.id = a.client_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join account_transaction at on a.id = at.account_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by a.id, concat(concat(c.first_name, ' '), c.last_name)"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Synchronize</span><span class="pun">(</span><span class="pln"> </span><span class="pun">{</span><span class="str">"client"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"account"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"account_transaction"</span><span class="pun">}</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AccountSummary</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> clientName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>Account</code> entity does not retain any balance since every account operation is registered as an <code>AccountTransaction</code>.
To find the <code>Account</code> balance, we need to query the <code>AccountSummary</code> which shares the same identifier with the <code>Account</code> entity.</p>
</div>
<div class="paragraph">
<p>However, the <code>AccountSummary</code> is not mapped to a physical table, but to an SQL query.</p>
</div>
<div class="paragraph">
<p>So, if we have the following <code>AccountTransaction</code> record, the <code>AccountSummary</code> balance will match the proper amount of money in this <code>Account</code>.</p>
</div>
<div id="mapping-Subselect-entity-find-example" class="exampleblock">
<div class="title">Example 143. Finding a <code>@Subselect</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Client</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">();</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	client</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">();</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setClient</span><span class="pun">(</span><span class="pln"> client </span><span class="pun">);</span><span class="pln">
	account</span><span class="pun">.</span><span class="pln">setDescription</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Checking account"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">AccountTransaction</span><span class="pln"> transaction </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AccountTransaction</span><span class="pun">();</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setAccount</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setDescription</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Salary"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">7000</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> transaction </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">AccountSummary</span><span class="pln"> summary </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"select s "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"from AccountSummary s "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"where s.id = :id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">AccountSummary</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> account</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pun">,</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">getClientName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">7000</span><span class="pun">,</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">getBalance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we add a new <code>AccountTransaction</code> entity and refresh the <code>AccountSummary</code> entity, the balance is updated accordingly:</p>
</div>
<div id="mapping-Subselect-refresh-find-example" class="exampleblock">
<div class="title">Example 144. Refreshing a <code>@Subselect</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">AccountSummary</span><span class="pln"> summary </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccountSummary</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pun">,</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">getClientName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">7000</span><span class="pun">,</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">getBalance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">AccountTransaction</span><span class="pln"> transaction </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AccountTransaction</span><span class="pun">();</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setAccount</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setDescription</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Shopping"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	transaction</span><span class="pun">.</span><span class="pln">setCents</span><span class="pun">(</span><span class="pln"> </span><span class="pun">-</span><span class="lit">100</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2200</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> transaction </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">refresh</span><span class="pun">(</span><span class="pln"> summary </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4800</span><span class="pun">,</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">getBalance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The goal of the <code>@Synchronize</code> annotation in the <code>AccountSummary</code> entity mapping is to instruct Hibernate which database tables are needed by the
underlying <code>@Subselect</code> SQL query. This is because, unlike JPQL and HQL queries, Hibernate cannot parse the underlying native SQL query.</p>
</div>
<div class="paragraph">
<p>With the <code>@Synchronize</code> annotation in place,
when executing an HQL or JPQL which selects from the <code>AccountSummary</code> entity,
Hibernate will trigger a Persistence Context flush if there are pending <code>Account</code>, <code>Client</code> or <code>AccountTransaction</code> entity state transitions.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="entity-proxy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-proxy"></a>2.5.9. Define a custom entity proxy</h4>
<div class="paragraph">
<p>By default, when it needs to use a proxy instead of the actual Pojo, Hibernate is going to use a Bytecode manipulation library like
<a href="http://jboss-javassist.github.io/javassist/">Javassist</a> or
<a href="http://bytebuddy.net/">Byte Buddy</a>.</p>
</div>
<div class="paragraph">
<p>However, if the entity class is final, Javassist will not create a proxy and you will get a Pojo even when you only need a proxy reference.
In this case, you could proxy an interface that this particular entity implements, as illustrated by the following example.</p>
</div>
<div id="entity-proxy-interface-mapping" class="exampleblock">
<div class="title">Example 145. Final entity class implementing the <code>Identifiable</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Proxy</span><span class="pun">(</span><span class="pln">proxyClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Other getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Proxy.html"><code>@Proxy</code></a>
annotation is used to specify a custom proxy implementation for the current annotated entity.</p>
</div>
<div class="paragraph">
<p>When loading the <code>Book</code> entity proxy, Hibernate is going to proxy the <code>Identifiable</code> interface instead as illustrated by the following example:</p>
</div>
<div id="entity-proxy-persist-mapping" class="exampleblock">
<div class="title">Example 146. Proxying the final entity class implementing the <code>Identifiable</code> interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">doInHibernate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">sessionFactory</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInHibernate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">sessionFactory</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Identifiable</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	assertTrue</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"Loaded entity is not an instance of the proxy interface"</span><span class="pun">,</span><span class="pln">
		book </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln">
	</span><span class="pun">);</span><span class="pln">
	assertFalse</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"Proxy class was not created"</span><span class="pun">,</span><span class="pln">
		book </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Book</span><span class="pln">
	</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Book</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">author</span><span class="pun">,</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pln"> </span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see in the associated SQL snippet, Hibernate issues no SQL SELECT query since the proxy can be
constructed without needing to fetch the actual entity Pojo.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-tuplizer"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-tuplizer"></a>2.5.10. Dynamic entity proxies using the @Tuplizer annotation</h4>
<div class="paragraph">
<p>It is possible to map your entities as dynamic proxies using
the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Tuplizer.html"><code>@Tuplizer</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>In the following entity mapping, both the embeddable and the entity are mapped as interfaces, not Pojos.</p>
</div>
<div id="entity-tuplizer-entity-mapping" class="exampleblock">
<div class="title">Example 147. Dynamic entity proxy mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Tuplizer</span><span class="pun">(</span><span class="pln">impl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DynamicEntityTuplizer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Cuisine</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">);</span><span class="pln">

    </span><span class="lit">@Tuplizer</span><span class="pun">(</span><span class="pln">impl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DynamicEmbeddableTuplizer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">Country</span><span class="pln"> getCountry</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setCountry</span><span class="pun">(</span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CountryName"</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> setName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@Tuplizer</code> instructs Hibernate to use the <code>DynamicEntityTuplizer</code> and <code>DynamicEmbeddableTuplizer</code> to handle
the associated entity and embeddable object types.</p>
</div>
<div class="paragraph">
<p>Both the <code>Cuisine</code> entity and the <code>Country</code> embeddable types are going to be instantiated as Java dynamic proxies,
as you can see in the following <code>DynamicInstantiator</code> example:</p>
</div>
<div id="entity-tuplizer-instantiator" class="exampleblock">
<div class="title">Example 148. Instantiating entities and embeddables as dynamic proxies</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DynamicEntityTuplizer</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">PojoEntityTuplizer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">DynamicEntityTuplizer</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">EntityMetamodel</span><span class="pln"> entityMetamodel</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">PersistentClass</span><span class="pln"> mappedEntity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> entityMetamodel</span><span class="pun">,</span><span class="pln"> mappedEntity </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">Instantiator</span><span class="pln"> buildInstantiator</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">EntityMetamodel</span><span class="pln"> entityMetamodel</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">PersistentClass</span><span class="pln"> persistentClass</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DynamicInstantiator</span><span class="pun">(</span><span class="pln">
            persistentClass</span><span class="pun">.</span><span class="pln">getClassName</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">ProxyFactory</span><span class="pln"> buildProxyFactory</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">PersistentClass</span><span class="pln"> persistentClass</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Getter</span><span class="pln"> idGetter</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Setter</span><span class="pln"> idSetter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">buildProxyFactory</span><span class="pun">(</span><span class="pln">
            persistentClass</span><span class="pun">,</span><span class="pln"> idGetter</span><span class="pun">,</span><span class="pln">
            idSetter
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DynamicEmbeddableTuplizer</span><span class="pln">
        </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">PojoComponentTuplizer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">DynamicEmbeddableTuplizer</span><span class="pun">(</span><span class="typ">Component</span><span class="pln"> embeddable</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> embeddable </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">Instantiator</span><span class="pln"> buildInstantiator</span><span class="pun">(</span><span class="typ">Component</span><span class="pln"> embeddable</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DynamicInstantiator</span><span class="pun">(</span><span class="pln">
            embeddable</span><span class="pun">.</span><span class="pln">getComponentClassName</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DynamicInstantiator</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Instantiator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Class</span><span class="pln"> targetClass</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">DynamicInstantiator</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> targetClassName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">targetClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="pln"> targetClassName </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ClassNotFoundException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pun">(</span><span class="pln"> e </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> instantiate</span><span class="pun">(</span><span class="typ">Serializable</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">ProxyHelper</span><span class="pun">.</span><span class="pln">newProxy</span><span class="pun">(</span><span class="pln"> targetClass</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> instantiate</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> instantiate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isInstance</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> object</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> targetClass</span><span class="pun">.</span><span class="pln">isInstance</span><span class="pun">(</span><span class="pln"> object </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Throwable</span><span class="pln"> t </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pun">(</span><span class="pln">
                </span><span class="str">"could not get handle to entity as interface : "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t
            </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ProxyHelper</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> T newProxy</span><span class="pun">(</span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> targetClass</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> T </span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proxy</span><span class="pun">.</span><span class="pln">newProxyInstance</span><span class="pun">(</span><span class="pln">
            targetClass</span><span class="pun">.</span><span class="pln">getClassLoader</span><span class="pun">(),</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                targetClass
            </span><span class="pun">},</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DataProxyHandler</span><span class="pun">(</span><span class="pln">
                targetClass</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln">
                id
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> extractEntityName</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> object</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Proxy</span><span class="pun">.</span><span class="pln">isProxyClass</span><span class="pun">(</span><span class="pln"> object</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">InvocationHandler</span><span class="pln"> handler </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Proxy</span><span class="pun">.</span><span class="pln">getInvocationHandler</span><span class="pun">(</span><span class="pln">
                object
            </span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">DataProxyHandler</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isAssignableFrom</span><span class="pun">(</span><span class="pln"> handler</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">DataProxyHandler</span><span class="pln"> myHandler </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">DataProxyHandler</span><span class="pun">)</span><span class="pln"> handler</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> myHandler</span><span class="pun">.</span><span class="pln">getEntityName</span><span class="pun">();</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DataProxyHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">InvocationHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> entityName</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">DataProxyHandler</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> entityName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">entityName </span><span class="pun">=</span><span class="pln"> entityName</span><span class="pun">;</span><span class="pln">
        data</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> invoke</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> proxy</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Method</span><span class="pln"> method</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">Throwable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> methodName </span><span class="pun">=</span><span class="pln"> method</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> methodName</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="pln"> </span><span class="str">"set"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> propertyName </span><span class="pun">=</span><span class="pln"> methodName</span><span class="pun">.</span><span class="pln">substring</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
            data</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> propertyName</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> methodName</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="pln"> </span><span class="str">"get"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> propertyName </span><span class="pun">=</span><span class="pln"> methodName</span><span class="pun">.</span><span class="pln">substring</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> propertyName </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">"toString"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> methodName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> entityName </span><span class="pun">+</span><span class="pln"> </span><span class="str">"#"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Id"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">"hashCode"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> methodName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getEntityName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> entityName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>DynamicInstantiator</code> in place, we can work with the dynamic proxy entities just like with Pojo entities.</p>
</div>
<div id="entity-tuplizer-dynamic-proxy-example" class="exampleblock">
<div class="title">Example 149. Persisting entities and embeddables as dynamic proxies</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Cuisine</span><span class="pln"> _cuisine </span><span class="pun">=</span><span class="pln"> doInHibernateSessionBuilder</span><span class="pun">(</span><span class="pln">
		</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> sessionFactory</span><span class="pun">()</span><span class="pln">
				</span><span class="pun">.</span><span class="pln">withOptions</span><span class="pun">()</span><span class="pln">
				</span><span class="pun">.</span><span class="pln">interceptor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EntityNameInterceptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
		session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Cuisine</span><span class="pln"> cuisine </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ProxyHelper</span><span class="pun">.</span><span class="pln">newProxy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Cuisine</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	cuisine</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"FranÃ§aise"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Country</span><span class="pln"> country </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ProxyHelper</span><span class="pun">.</span><span class="pln">newProxy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Country</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	country</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"France"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	cuisine</span><span class="pun">.</span><span class="pln">setCountry</span><span class="pun">(</span><span class="pln"> country </span><span class="pun">);</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> cuisine </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">return</span><span class="pln"> cuisine</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInHibernateSessionBuilder</span><span class="pun">(</span><span class="pln">
		</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> sessionFactory</span><span class="pun">()</span><span class="pln">
				</span><span class="pun">.</span><span class="pln">withOptions</span><span class="pun">()</span><span class="pln">
				</span><span class="pun">.</span><span class="pln">interceptor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EntityNameInterceptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
		session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Cuisine</span><span class="pln"> cuisine </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Cuisine</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> _cuisine</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"FranÃ§aise"</span><span class="pun">,</span><span class="pln"> cuisine</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"France"</span><span class="pun">,</span><span class="pln"> cuisine</span><span class="pun">.</span><span class="pln">getCountry</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-persister"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-persister"></a>2.5.11. Define a custom entity persister</h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Persister.html"><code>@Persister</code></a> annotation is used to specify a custom entity or collection persister.</p>
</div>
<div class="paragraph">
<p>For entities, the custom persister must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/entity/EntityPersister.html"><code>EntityPersister</code></a> interface.</p>
</div>
<div class="paragraph">
<p>For collections, the custom persister must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/collection/CollectionPersister.html"><code>CollectionPersister</code></a> interface.</p>
</div>
<div id="entity-persister-mapping" class="exampleblock">
<div class="title">Example 150. Entity persister mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Persister</span><span class="pun">(</span><span class="pln"> impl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">EntityPersister</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln"> mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Persister</span><span class="pun">(</span><span class="pln"> impl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CollectionPersister</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addBook</span><span class="pun">(</span><span class="typ">Book</span><span class="pln"> book</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
        book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Persister</span><span class="pun">(</span><span class="pln"> impl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">EntityPersister</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By providing your own <code>EntityPersister</code> and <code>CollectionPersister</code> implementations,
you can control how entities and collections are persisted in to the database.</p>
</div>
</div>
<div class="sect3">
<h4 id="access"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#access"></a>2.5.12. Access strategies</h4>
<div class="paragraph">
<p>As a JPA provider, Hibernate can introspect both the entity attributes (instance fields) or the accessors (instance properties).
By default, the placement of the <code>@Id</code> annotation gives the default access strategy.
When placed on a field, Hibernate will assume field-based access.
When placed on the identifier getter, Hibernate will use property-based access.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should pay attention to <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html#decapitalize(java.lang.String)">Java Beans specification</a> in regard to naming properties to avoid
issues such as <a href="https://hibernate.atlassian.net/browse/HCANN-63">Property name beginning with at least two uppercase characters has odd functionality in HQL</a>!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Embeddable types inherit the access strategy from their parent entities.</p>
</div>
<div class="sect4">
<h5 id="field-based-access"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#field-based-access"></a>Field-based access</h5>
<div id="access-field-mapping-example" class="exampleblock">
<div class="title">Example 151. Field-based access</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using field-based access, adding other entity-level methods is much more flexible because Hibernate wonâ€™t consider those part of the persistence state.
To exclude a field from being part of the entity persistent state, the field must be marked with the <code>@Transient</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Another advantage of using field-based access is that some entity attributes can be hidden from outside the entity.
An example of such attribute is the entity <code>@Version</code> field, which, usually, does not need to be manipulated by the data access layer.
With field-based access, we can simply omit the getter and the setter for this version field, and Hibernate can still leverage the optimistic concurrency control mechanism.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="property-based-access"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#property-based-access"></a>Property-based access</h5>
<div id="access-property-mapping-example" class="exampleblock">
<div class="title">Example 152. Property-based access</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getTitle</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setTitle</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">title </span><span class="pun">=</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getAuthor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setAuthor</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> author</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">author </span><span class="pun">=</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using property-based access, Hibernate uses the accessors for both reading and writing the entity state.
Every other method that will be added to the entity (e.g. helper methods for synchronizing both ends of a bidirectional one-to-many association) will have to be marked with the <code>@Transient</code> annotation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_overriding_the_default_access_strategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_overriding_the_default_access_strategy"></a>Overriding the default access strategy</h5>
<div class="paragraph">
<p>The default access strategy mechanism can be overridden with the JPA <code>@Access</code> annotation.
In the following example, the <code>@Version</code> attribute is accessed by its field and not by its getter, like the rest of entity attributes.</p>
</div>
<div id="access-property-override-mapping-example" class="exampleblock">
<div class="title">Example 153. Overriding access strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Access</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccessType</span><span class="pun">.</span><span class="pln">FIELD </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getTitle</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setTitle</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">title </span><span class="pun">=</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getAuthor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setAuthor</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> author</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">author </span><span class="pun">=</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="access-embeddable-types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#access-embeddable-types"></a>Embeddable types and access strategy</h5>
<div class="paragraph">
<p>Because embeddables are managed by their owning entities, the access strategy is therefore inherited from the entity too.
This applies to both simple embeddable types as well as for collection of embeddables.</p>
</div>
<div class="paragraph">
<p>The embeddable types can overrule the default implicit access strategy (inherited from the owning entity).
In the following example, the embeddable uses property-based access, no matter what access strategy the owning entity is choosing:</p>
</div>
<div id="access-embeddable-mapping-example" class="exampleblock">
<div class="title">Example 154. Embeddable with exclusive access strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="lit">@Access</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AccessType</span><span class="pun">.</span><span class="pln">PROPERTY </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">=</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">=</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getFirstName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setFirstName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">=</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getLastName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setLastName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">=</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The owning entity can use field-based access while the embeddable uses property-based access as it has chosen explicitly:</p>
</div>
<div id="access-embedded-mapping-example" class="exampleblock">
<div class="title">Example 155. Entity including a single embeddable type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Embedded</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This works also for collection of embeddable types:</p>
</div>
<div id="access-element-collection-mapping-example" class="exampleblock">
<div class="title">Example 156. Entity including a collection of embeddable types</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@CollectionTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_author"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Author</span><span class="pun">&gt;</span><span class="pln"> authors </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="identifiers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers"></a>2.6. Identifiers</h3>
<div class="paragraph">
<p>Identifiers model the primary key of an entity. They are used to uniquely identify each specific entity.</p>
</div>
<div class="paragraph">
<p>Hibernate and JPA both make the following assumptions about the corresponding database column(s):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>UNIQUE</code></dt>
<dd>
<p>The values must uniquely identify each row.</p>
</dd>
<dt class="hdlist1"><code>NOT NULL</code></dt>
<dd>
<p>The values cannot be null. For composite ids, no part can
be null.</p>
</dd>
<dt class="hdlist1"><code>IMMUTABLE</code></dt>
<dd>
<p>The values, once inserted, can never be changed.
This is more a general guide, than a hard-fast rule as opinions vary.
JPA defines the behavior of changing the value of the identifier attribute to be undefined; Hibernate simply does not support that.
In cases where the values for the PK you have chosen will be updated, Hibernate recommends mapping the mutable value as a natural id, and use a surrogate id for the PK.
See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid">Natural Ids</a>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically the identifier does not have to map to the column(s) physically defined as the table primary key.
They just need to map to column(s) that uniquely identify each row.
However, this documentation will continue to use the terms identifier and primary key interchangeably.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Every entity must define an identifier. For entity inheritance hierarchies, the identifier must be defined just on the entity that is the root of the hierarchy.</p>
</div>
<div class="paragraph">
<p>An identifier might be simple (single value) or composite (multiple values).</p>
</div>
<div class="sect3">
<h4 id="identifiers-simple"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-simple"></a>2.6.1. Simple identifiers</h4>
<div class="paragraph">
<p>Simple identifiers map to a single basic attribute, and are denoted using the <code>javax.persistence.Id</code> annotation.</p>
</div>
<div class="paragraph">
<p>According to JPA only the following types should be used as identifier attribute types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any Java primitive type</p>
</li>
<li>
<p>any primitive wrapper type</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.util.Date</code> (TemporalType#DATE)</p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any types used for identifier attributes beyond this list will not be portable.</p>
</div>
<div class="sect4">
<h5 id="identifiers-simple-assigned"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-simple-assigned"></a>Assigned identifiers</h5>
<div class="paragraph">
<p>Values for simple identifiers can be assigned, as we have seen in the examples above.
The expectation for assigned identifier values is that the application assigns (sets them on the entity attribute) prior to calling save/persist.</p>
</div>
<div id="identifiers-simple-assigned-mapping-example" class="exampleblock">
<div class="title">Example 157. Simple assigned entity identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="identifiers-simple-generated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-simple-generated"></a>Generated identifiers</h5>
<div class="paragraph">
<p>Values for simple identifiers can be generated. To denote that an identifier attribute is generated, it is annotated with <code>javax.persistence.GeneratedValue</code></p>
</div>
<div id="identifiers-simple-generated-mapping-example" class="exampleblock">
<div class="title">Example 158. Simple generated identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Additionally, to the type restriction list above, JPA says that if using generated identifier values (see below) only integer types (short, int, long) will be portably supported.</p>
</div>
<div class="paragraph">
<p>The expectation for generated identifier values is that Hibernate will generate the value when the save/persist occurs.</p>
</div>
<div class="paragraph">
<p>Identifier value generations strategies are discussed in detail in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators">Generated identifier values</a> section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite"></a>2.6.2. Composite identifiers</h4>
<div class="paragraph">
<p>Composite identifiers correspond to one or more persistent attributes.
Here are the rules governing composite identifiers, as defined by the JPA specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The composite identifier must be represented by a "primary key class".
The primary key class may be defined using the <code>javax.persistence.EmbeddedId</code> annotation (see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-aggregated">Composite identifiers with <code>@EmbeddedId</code></a>),
or defined using the <code>javax.persistence.IdClass</code> annotation (see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-nonaggregated">Composite identifiers with <code>@IdClass</code></a>).</p>
</li>
<li>
<p>The primary key class must be public and must have a public no-arg constructor.</p>
</li>
<li>
<p>The primary key class must be serializable.</p>
</li>
<li>
<p>The primary key class must define equals and hashCode methods, consistent with equality for the underlying database types to which the primary key is mapped.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The restriction that a composite identifier has to be represented by a "primary key class" is only JPA specific.
Hibernate does allow composite identifiers to be defined without a "primary key class", although that modeling technique is deprecated and therefore omitted from this discussion.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The attributes making up the composition can be either basic, composite, ManyToOne.
Note especially that collections and one-to-ones are never appropriate.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-aggregated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-aggregated"></a>2.6.3. Composite identifiers with <code>@EmbeddedId</code></h4>
<div class="paragraph">
<p>Modeling a composite identifier using an EmbeddedId simply means defining an embeddable to be a composition for the one or more attributes making up the identifier,
and then exposing an attribute of that embeddable type on the entity.</p>
</div>
<div id="identifiers-basic-embeddedid-mapping-example" class="exampleblock">
<div class="title">Example 159. Basic <code>@EmbeddedId</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SystemUser"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@EmbeddedId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> PK pk</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> PK </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> PK</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		PK pk </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">PK</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As mentioned before, EmbeddedIds can even contain <code>@ManyToOne</code> attributes:</p>
</div>
<div id="identifiers-basic-embeddedid-manytoone-mapping-example" class="exampleblock">
<div class="title">Example 160. <code>@EmbeddedId</code> with <code>@ManyToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SystemUser"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@EmbeddedId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> PK pk</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Subsystem"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Subsystem</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> PK </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Subsystem</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">Subsystem</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> PK</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		PK pk </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">PK</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate supports directly modeling the ManyToOne in the PK class, whether <code>@EmbeddedId</code> or <code>@IdClass</code>.</p>
</div>
<div class="paragraph">
<p>However, that is not portably supported by the JPA specification.
In JPA terms one would use "derived identifiers"; for details, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-derived">Derived Identifiers</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-nonaggregated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-nonaggregated"></a>2.6.4. Composite identifiers with <code>@IdClass</code></h4>
<div class="paragraph">
<p>Modeling a composite identifier using an IdClass differs from using an EmbeddedId in that the entity defines each individual attribute making up the composition.
The IdClass simply acts as a "shadow".</p>
</div>
<div id="identifiers-basic-idclass-mapping-example" class="exampleblock">
<div class="title">Example 161. Basic <code>@IdClass</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SystemUser"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@IdClass</span><span class="pun">(</span><span class="pln"> PK</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> PK</span><span class="pun">(</span><span class="pln">
			subsystem</span><span class="pun">,</span><span class="pln">
			username
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="pln">PK id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">.</span><span class="pln">getSubsystem</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">.</span><span class="pln">getUsername</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> PK </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> PK</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		PK pk </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">PK</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> username </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Non-aggregated composite identifiers can also contain ManyToOne attributes as we saw with aggregated ones (still non-portably).</p>
</div>
<div id="identifiers-basic-idclass-manytoone-mapping-example" class="exampleblock">
<div class="title">Example 162. IdClass with <code>@ManyToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SystemUser"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@IdClass</span><span class="pun">(</span><span class="pln"> PK</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Subsystem</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Subsystem"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Subsystem</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> PK </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Subsystem</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">Subsystem</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> PK</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With non-aggregated composite identifiers, Hibernate also supports "partial" generation of the composite values.</p>
</div>
<div id="identifiers-basic-idclass-generatedvalue-mapping-example" class="exampleblock">
<div class="title">Example 163. <code>@IdClass</code> with partial identifier generation using <code>@GeneratedValue</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SystemUser"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@IdClass</span><span class="pun">(</span><span class="pln"> PK</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> registrationId</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> PK</span><span class="pun">(</span><span class="pln">
			subsystem</span><span class="pun">,</span><span class="pln">
			username</span><span class="pun">,</span><span class="pln">
			registrationId
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="pln">PK id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">.</span><span class="pln">getSubsystem</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">.</span><span class="pln">getUsername</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">registrationId </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">.</span><span class="pln">getRegistrationId</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> PK </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> registrationId</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> PK</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> registrationId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">=</span><span class="pln"> subsystem</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">registrationId </span><span class="pun">=</span><span class="pln"> registrationId</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> PK</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		PK pk </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">PK</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">subsystem </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">username </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> registrationId</span><span class="pun">,</span><span class="pln"> pk</span><span class="pun">.</span><span class="pln">registrationId </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> subsystem</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> registrationId </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature exists because of a highly questionable interpretation of the JPA specification made by the SpecJ committee.</p>
</div>
<div class="paragraph">
<p>Hibernate does not feel that JPA defines support for this, but added the feature simply to be usable in SpecJ benchmarks.
Use of this feature may or may not be portable from a JPA perspective.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-composite-associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-associations"></a>2.6.5. Composite identifiers with associations</h4>
<div class="paragraph">
<p>Hibernate allows defining a composite identifier out of entity associations.
In the following example, the <code>PersonAddress</code> entity identifier is formed of two <code>@ManyToOne</code> associations.</p>
</div>
<div id="identifiers-composite-id-mapping-example" class="exampleblock">
<div class="title">Example 164. Composite identifiers with associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> publisher</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="typ">Author</span><span class="pln"> author</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> publisher</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">author </span><span class="pun">=</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">publisher </span><span class="pun">=</span><span class="pln"> publisher</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">title </span><span class="pun">=</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">


	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Book</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> author</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">author </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> publisher</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">publisher </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">title </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> author</span><span class="pun">,</span><span class="pln"> publisher</span><span class="pun">,</span><span class="pln"> title </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Author"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Author</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Author</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> author</span><span class="pun">.</span><span class="pln">name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Publisher"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Publisher</span><span class="pln"> publisher </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Publisher</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> publisher</span><span class="pun">.</span><span class="pln">name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although the mapping is much simpler than using an <code>@EmbeddedId</code> or an <code>@IdClass</code>, thereâ€™s no separation between the entity instance and the actual identifier.
To query this entity, an instance of the entity itself must be supplied to the persistence context.</p>
</div>
<div id="identifiers-composite-id-fetching-example" class="exampleblock">
<div class="title">Example 165. Fetching with composite identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">
	author</span><span class="pun">,</span><span class="pln">
	publisher</span><span class="pun">,</span><span class="pln">
	</span><span class="str">"High-Performance Java Persistence"</span><span class="pln">
</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pun">,</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">getAuthor</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators"></a>2.6.6. Generated identifier values</h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For discussion of generated values for non-identifier attributes, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated">Generated properties</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate supports identifier value generation across a number of different types.
Remember that JPA portably defines identifier value generation just for integer types.</p>
</div>
<div class="paragraph">
<p>Identifier value generation is indicated using the <code>javax.persistence.GeneratedValue</code> annotation.
The most important piece of information here is the specified <code>javax.persistence.GenerationType</code> which indicates how values will be generated.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The discussions below assume that the application is using Hibernateâ€™s "new generator mappings" as indicated by the <code>hibernate.id.new_generator_mappings</code> setting or
<code>MetadataBuilder.enableNewIdentifierGeneratorSupport</code> method during bootstrap.
Starting with Hibernate 5, this is set to true by default.
If applications set this to false the resolutions discussed here will be very different.
The rest of the discussion here assumes this setting is enabled (true).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>AUTO</code> (the default)</dt>
<dd>
<p>Indicates that the persistence provider (Hibernate) should choose an appropriate generation strategy. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-auto">Interpreting AUTO</a>.</p>
</dd>
<dt class="hdlist1"><code>IDENTITY</code></dt>
<dd>
<p>Indicates that database IDENTITY columns will be used for primary key value generation. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-identity">Using IDENTITY columns</a>.</p>
</dd>
<dt class="hdlist1"><code>SEQUENCE</code></dt>
<dd>
<p>Indicates that database sequence should be used for obtaining primary key values. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-sequence">Using sequences</a>.</p>
</dd>
<dt class="hdlist1"><code>TABLE</code></dt>
<dd>
<p>Indicates that a database table should be used for obtaining primary key values. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-table">Using the table identifier generator</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-auto"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-auto"></a>2.6.7. Interpreting AUTO</h4>
<div class="paragraph">
<p>How a persistence provider interprets the AUTO generation type is left up to the provider.</p>
</div>
<div class="paragraph">
<p>The default behavior is to look at the Java type of the identifier attribute.</p>
</div>
<div class="paragraph">
<p>If the identifier type is UUID, Hibernate is going to use a <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-uuid">UUID identifier</a>.</p>
</div>
<div class="paragraph">
<p>If the identifier type is numerical (e.g. <code>Long</code>, <code>Integer</code>), then Hibernate is going to use the <code>IdGeneratorStrategyInterpreter</code> to resolve the identifier generator strategy.
The <code>IdGeneratorStrategyInterpreter</code> has two implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>FallbackInterpreter</code></dt>
<dd>
<p>This is the default strategy since Hibernate 5.0. For older versions, this strategy is enabled through the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-mapping"><code>hibernate.id.new_generator_mappings</code></a> configuration property.
When using this strategy, <code>AUTO</code> always resolves to <code>SequenceStyleGenerator</code>.
If the underlying database supports sequences, then a SEQUENCE generator is used. Otherwise, a TABLE generator is going to be used instead.</p>
</dd>
<dt class="hdlist1"><code>LegacyFallbackInterpreter</code></dt>
<dd>
<p>This is a legacy mechanism that was used by Hibernate prior to version 5.0 or when the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-mapping"><code>hibernate.id.new_generator_mappings</code></a> configuration property is false.
The legacy strategy maps <code>AUTO</code> to the <code>native</code> generator strategy which uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html#getNativeIdentifierGeneratorStrategy--">Dialect#getNativeIdentifierGeneratorStrategy</a> to resolve the actual identifier generator (e.g. <code>identity</code> or <code>sequence</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-sequence"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-sequence"></a>2.6.8. Using sequences</h4>
<div class="paragraph">
<p>For implementing database sequence-based identifier value generation Hibernate makes use of its <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code> id generator.
It is important to note that SequenceStyleGenerator is capable of working against databases that do not support sequences by switching to a table as the underlying backing.
This gives Hibernate a huge degree of portability across databases while still maintaining consistent id generation behavior (versus say choosing between SEQUENCE and IDENTITY).
This backing storage is completely transparent to the user.</p>
</div>
<div class="paragraph">
<p>The preferred (and portable) way to configure this generator is using the JPA-defined <code>javax.persistence.SequenceGenerator</code> annotation.</p>
</div>
<div class="paragraph">
<p>The simplest form is to simply request sequence generation; Hibernate will use a single, implicitly-named sequence (<code>hibernate_sequence</code>) for all such unnamed definitions.</p>
</div>
<div id="identifiers-generators-sequence-unnamed" class="exampleblock">
<div class="title">Example 166. Unnamed sequence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">SEQUENCE
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using <code>javax.persistence.SequenceGenerator</code>, you can specify a specific database sequence name.</p>
</div>
<div id="identifiers-generators-sequence-named" class="exampleblock">
<div class="title">Example 167. Named sequence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">SEQUENCE</span><span class="pun">,</span><span class="pln">
		generator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sequence-generator"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@SequenceGenerator</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sequence-generator"</span><span class="pun">,</span><span class="pln">
		sequenceName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_sequence"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>javax.persistence.SequenceGenerator</code> annotation allows you to specify additional configurations as well.</p>
</div>
<div id="identifiers-generators-sequence-configured" class="exampleblock">
<div class="title">Example 168. Configured sequence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">SEQUENCE</span><span class="pun">,</span><span class="pln">
		generator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sequence-generator"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@SequenceGenerator</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sequence-generator"</span><span class="pun">,</span><span class="pln">
		sequenceName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_sequence"</span><span class="pun">,</span><span class="pln">
		allocationSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-identity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-identity"></a>2.6.9. Using IDENTITY columns</h4>
<div class="paragraph">
<p>For implementing identifier value generation based on IDENTITY columns,
Hibernate makes use of its <code>org.hibernate.id.IdentityGenerator</code> id generator which expects the identifier to be generated by INSERT into the table.
IdentityGenerator understands 3 different ways that the INSERT-generated value might be retrieved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Hibernate believes the JDBC environment supports <code>java.sql.Statement#getGeneratedKeys</code>, then that approach will be used for extracting the IDENTITY generated keys.</p>
</li>
<li>
<p>Otherwise, if <code>Dialect#supportsInsertSelectIdentity</code> reports true, Hibernate will use the Dialect specific INSERT+SELECT statement syntax.</p>
</li>
<li>
<p>Otherwise, Hibernate will expect that the database supports some form of asking for the most recently inserted IDENTITY value via a separate SQL command as indicated by <code>Dialect#getIdentitySelectString</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important to realize that this imposes a runtime behavior where the entity row <strong>must</strong> be physically inserted prior to the identifier value being known.
This can mess up extended persistence contexts (conversations).
Because of the runtime imposition/inconsistency, Hibernate suggests other forms of identifier value generation be used.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is yet another important runtime impact of choosing IDENTITY generation: Hibernate will not be able to JDBC batching for inserts of the entities that use IDENTITY generation.
The importance of this depends on the application-specific use cases.
If the application is not usually creating many new instances of a given type of entity that uses IDENTITY generation, then this is not an important impact since batching would not have been helpful anyway.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-table"></a>2.6.10. Using the table identifier generator</h4>
<div class="paragraph">
<p>Hibernate achieves table-based identifier generation based on its <code>org.hibernate.id.enhanced.TableGenerator</code> which defines a table capable of holding multiple named value segments for any number of entities.</p>
</div>
<div class="paragraph">
<p>The basic idea is that a given table-generator table (<code>hibernate_sequences</code> for example) can hold multiple segments of identifier generation values.</p>
</div>
<div id="identifiers-generators-table-unnamed-mapping-example" class="exampleblock">
<div class="title">Example 169. Unnamed table generator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">TABLE
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table hibernate_sequences </span><span class="pun">(</span><span class="pln">
    sequence_name varchar2</span><span class="pun">(</span><span class="lit">255</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    next_val number</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="lit">0</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">sequence_name</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If no table name is given Hibernate assumes an implicit name of <code>hibernate_sequences</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, because no <code>javax.persistence.TableGenerator#pkColumnValue</code> is specified,
Hibernate will use the default segment (<code>sequence_name='default'</code>) from the hibernate_sequences table.</p>
</div>
<div class="paragraph">
<p>However, you can configure the table identifier generator using the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/TableGenerator.html"><code>@TableGenerator</code></a> annotation.</p>
</div>
<div id="identifiers-generators-table-configured-mapping-example" class="exampleblock">
<div class="title">Example 170. Configured table generator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">TABLE</span><span class="pun">,</span><span class="pln">
		generator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"table-generator"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@TableGenerator</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln">  </span><span class="str">"table-generator"</span><span class="pun">,</span><span class="pln">
		table </span><span class="pun">=</span><span class="pln"> </span><span class="str">"table_identifier"</span><span class="pun">,</span><span class="pln">
		pkColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"table_name"</span><span class="pun">,</span><span class="pln">
		valueColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_id"</span><span class="pun">,</span><span class="pln">
		allocationSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table table_identifier </span><span class="pun">(</span><span class="pln">
    table_name varchar2</span><span class="pun">(</span><span class="lit">255</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    product_id number</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="lit">0</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">table_name</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when inserting 3 <code>Product</code> entities, Hibernate generates the following statements:</p>
</div>
<div id="identifiers-generators-table-configured-persist-example" class="exampleblock">
<div class="title">Example 171. Configured table generator persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
	product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Product %d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="kwd">select</span><span class="pln">
    tbl</span><span class="pun">.</span><span class="pln">product_id
</span><span class="kwd">from</span><span class="pln">
    table_identifier tbl
</span><span class="kwd">where</span><span class="pln">
    tbl</span><span class="pun">.</span><span class="pln">table_name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> update

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    table_identifier
    </span><span class="pun">(</span><span class="pln">table_name</span><span class="pun">,</span><span class="pln"> product_id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

update
    table_identifier
</span><span class="kwd">set</span><span class="pln">
    product_id</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    product_id</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> table_name</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">select</span><span class="pln">
    tbl</span><span class="pun">.</span><span class="pln">product_id
</span><span class="kwd">from</span><span class="pln">
    table_identifier tbl
</span><span class="kwd">where</span><span class="pln">
    tbl</span><span class="pun">.</span><span class="pln">table_name</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> update

update
    table_identifier
</span><span class="kwd">set</span><span class="pln">
    product_id</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    product_id</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> table_name</span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">11</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Product</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">product_name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Product</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">product_name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Product</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">product_name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-uuid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-uuid"></a>2.6.11. Using UUID generation</h4>
<div class="paragraph">
<p>As mentioned above, Hibernate supports UUID identifier value generation.
This is supported through its <code>org.hibernate.id.UUIDGenerator</code> id generator.</p>
</div>
<div class="paragraph">
<p><code>UUIDGenerator</code> supports pluggable strategies for exactly how the UUID is generated.
These strategies are defined by the <code>org.hibernate.id.UUIDGenerationStrategy</code> contract.
The default strategy is a version 4 (random) strategy according to IETF RFC 4122.
Hibernate does ship with an alternative strategy which is a RFC 4122 version 1 (time-based) strategy (using IP address rather than mac address).</p>
</div>
<div id="identifiers-generators-uuid-mapping-example" class="exampleblock">
<div class="title">Example 172. Implicitly using the random UUID strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> UUID id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To specify an alternative generation strategy, weâ€™d have to define some configuration via <code>@GenericGenerator</code>.
Here we choose the RFC 4122 version 1 compliant strategy named <code>org.hibernate.id.uuid.CustomVersionOneStrategy</code>.</p>
</div>
<div id="identifiers-generators-custom-uuid-mapping-example" class="exampleblock">
<div class="title">Example 173. Implicitly using the random UUID strategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln"> generator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"custom-uuid"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@GenericGenerator</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"custom-uuid"</span><span class="pun">,</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.id.UUIDGenerator"</span><span class="pun">,</span><span class="pln">
		parameters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="lit">@Parameter</span><span class="pun">(</span><span class="pln">
				name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"uuid_gen_strategy_class"</span><span class="pun">,</span><span class="pln">
				value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.id.uuid.CustomVersionOneStrategy"</span><span class="pln">
			</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> UUID id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-optimizer"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-optimizer"></a>2.6.12. Optimizers</h4>
<div class="paragraph">
<p>Most of the Hibernate generators that separately obtain identifier values from database structures support the use of pluggable optimizers.
Optimizers help manage the number of times Hibernate has to talk to the database in order to generate identifier values.
For example, with no optimizer applied to a sequence-generator, every time the application asked Hibernate to generate an identifier it would need to grab the next sequence value from the database.
But if we can minimize the number of times we need to communicate with the database here, the application will be able to perform better.
Which is, in fact, the role of these optimizers.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">none</dt>
<dd>
<p>No optimization is performed. We communicate with the database each and every time an identifier value is needed from the generator.</p>
</dd>
<dt class="hdlist1">pooled-lo</dt>
<dd>
<p>The pooled-lo optimizer works on the principle that the increment-value is encoded into the database table/sequence structure.
In sequence-terms, this means that the sequence is defined with a greater-than-1 increment size.</p>
<div class="paragraph">
<p>For example, consider a brand new sequence defined as <code>create sequence m_sequence start with 1 increment by 20</code>.
This sequence essentially defines a "pool" of 20 usable id values each and every time we ask it for its next-value.
The pooled-lo optimizer interprets the next-value as the low end of that pool.</p>
</div>
<div class="paragraph">
<p>So when we first ask it for next-value, weâ€™d get 1.
We then assume that the valid pool would be the values from 1-20 inclusive.</p>
</div>
<div class="paragraph">
<p>The next call to the sequence would result in 21, which would define 21-40 as the valid range. And so on.
The "lo" part of the name indicates that the value from the database table/sequence is interpreted as the pool lo(w) end.</p>
</div>
</dd>
<dt class="hdlist1">pooled</dt>
<dd>
<p>Just like pooled-lo, except that here the value from the table/sequence is interpreted as the high end of the value pool.</p>
</dd>
<dt class="hdlist1">hilo; legacy-hilo</dt>
<dd>
<p>Define a custom algorithm for generating pools of values based on a single value from a table or sequence.</p>
<div class="paragraph">
<p>These optimizers are not recommended for use. They are maintained (and mentioned) here simply for use by legacy applications that used these strategies previously.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications can also implement and use their own optimizer strategies, as defined by the <code>org.hibernate.id.enhanced.Optimizer</code> contract.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-generators-GenericGenerator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-GenericGenerator"></a>2.6.13. Using <code>@GenericGenerator</code></h4>
<div class="paragraph">
<p><code>@GenericGenerator</code> allows integration of any Hibernate <code>org.hibernate.id.IdentifierGenerator</code> implementation, including any of the specific ones discussed here and any custom ones.</p>
</div>
<div class="paragraph">
<p>To make use of the pooled or pooled-lo optimizers,
the entity mapping must use the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenericGenerator.html"><code>@GenericGenerator</code></a> annotation:</p>
</div>
<div id="identifiers-generators-pooled-lo-optimizer-mapping-example" class="exampleblock">
<div class="title">Example 174. Pooled-lo optimizer mapping using <code>@GenericGenerator</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">SEQUENCE</span><span class="pun">,</span><span class="pln">
		generator </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_generator"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@GenericGenerator</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_generator"</span><span class="pun">,</span><span class="pln">
		strategy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.id.enhanced.SequenceStyleGenerator"</span><span class="pun">,</span><span class="pln">
		parameters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="lit">@Parameter</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sequence_name"</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"product_sequence"</span><span class="pun">),</span><span class="pln">
			</span><span class="lit">@Parameter</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"initial_value"</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">),</span><span class="pln">
			</span><span class="lit">@Parameter</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"increment_size"</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"3"</span><span class="pun">),</span><span class="pln">
			</span><span class="lit">@Parameter</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"optimizer"</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pooled-lo"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"p_name"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"p_number"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when saving 5 <code>Person</code> entities and flushing the Persistence Context after every 3 entities:</p>
</div>
<div id="identifiers-generators-pooled-lo-optimizer-persist-example" class="exampleblock">
<div class="title">Example 175. Pooled-lo optimizer mapping using <code>@GenericGenerator</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
	product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Product %d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	product</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"P_100_%d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> product </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CALL NEXT VALUE FOR product_sequence

INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_name</span><span class="pun">,</span><span class="pln"> p_number</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">P_100_1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_name</span><span class="pun">,</span><span class="pln"> p_number</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">P_100_2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">

CALL NEXT VALUE FOR product_sequence

INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_name</span><span class="pun">,</span><span class="pln"> p_number</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">P_100_3</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln">

INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_name</span><span class="pun">,</span><span class="pln"> p_number</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">P_100_4</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln">

INSERT INTO </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p_name</span><span class="pun">,</span><span class="pln"> p_number</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Product</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">P_100_5</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see from the list of generated SQL statements, you can insert 3 entities with just one database sequence call.
This way, the pooled and the pooled-lo optimizers allow you to reduce the number of database roundtrips, therefore reducing the overall transaction response time.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-derived"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-derived"></a>2.6.14. Derived Identifiers</h4>
<div class="paragraph">
<p>JPA 2.0 added support for derived identifiers which allow an entity to borrow the identifier from a many-to-one or one-to-one association.</p>
</div>
<div id="identifiers-derived-mapsid" class="exampleblock">
<div class="title">Example 176. Derived identifier with <code>@MapsId</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln">  </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">registrationNumber </span><span class="pun">=</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PersonDetails"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonDetails</span><span class="pln">  </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pln">
	</span><span class="lit">@MapsId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>PersonDetails</code> entity uses the <code>id</code> column for both the entity identifier and for the one-to-one association to the <code>Person</code> entity.
The value of the <code>PersonDetails</code> entity identifier is "derived" from the identifier of its parent <code>Person</code> entity.</p>
</div>
<div id="identifiers-derived-mapsid-persist-example" class="exampleblock">
<div class="title">Example 177. Derived identifier with <code>@MapsId</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"ABC-123"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">PersonDetails</span><span class="pln"> personDetails </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonDetails</span><span class="pun">();</span><span class="pln">
	personDetails</span><span class="pun">.</span><span class="pln">setNickName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	personDetails</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> personDetails </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">PersonDetails</span><span class="pln"> personDetails </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonDetails</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	assertEquals</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">,</span><span class="pln"> personDetails</span><span class="pun">.</span><span class="pln">getNickName</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@MapsId</code> annotation can also reference columns from an <code>@EmbeddedId</code> identifier as well.</p>
</div>
<div class="paragraph">
<p>The previous example can also be mapped using <code>@PrimaryKeyJoinColumn</code>.</p>
</div>
<div id="identifiers-derived-primarykeyjoincolumn" class="exampleblock">
<div class="title">Example 178. Derived identifier <code>@PrimaryKeyJoinColumn</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln">  </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">registrationNumber </span><span class="pun">=</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PersonDetails"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonDetails</span><span class="pln">  </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pln">
	</span><span class="lit">@PrimaryKeyJoinColumn</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setPerson</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">person </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Other getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike <code>@MapsId</code>, the application developer is responsible for ensuring that the identifier and the many-to-one (or one-to-one) association are in sync
as you can see in the <code>PersonDetails#setPerson</code> method.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-rowid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-rowid"></a>2.6.15. @RowId</h4>
<div class="paragraph">
<p>If you annotate a given entity with the <code>@RowId</code> annotation and the underlying database supports fetching a record by ROWID (e.g. Oracle),
then Hibernate can use the <code>ROWID</code> pseudo-column for CRUD operations.</p>
</div>
<div id="identifiers-rowid-mapping" class="exampleblock">
<div class="title">Example 179. <code>@RowId</code> entity maapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@RowId</span><span class="pun">(</span><span class="str">"ROWID"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching an entity and modifying it, Hibernate uses the <code>ROWID</code> pseudo-column for the UPDATE SQL statement.</p>
</div>
<div id="identifiers-rowid-example" class="exampleblock">
<div class="title">Example 180. <code>@RowId</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> product </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

product</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Smart phone"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> name2_0_0_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="str">"number"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> number3_0_0_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">ROWID </span><span class="kwd">as</span><span class="pln"> rowid_0_
FROM
    </span><span class="typ">Product</span><span class="pln"> p
WHERE
    p</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">name2_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Mobile</span><span class="pln"> phone</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">number3_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">123</span><span class="pun">-</span><span class="lit">456</span><span class="pun">-</span><span class="lit">7890</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted ROWID value</span><span class="pun">:</span><span class="pln"> </span><span class="typ">AAAwkBAAEAAACP3AAA</span><span class="pln">

UPDATE
    </span><span class="typ">Product</span><span class="pln">
SET
    </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    </span><span class="str">"number"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
WHERE
    ROWID </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Smart</span><span class="pln"> phone</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">123</span><span class="pun">-</span><span class="lit">456</span><span class="pun">-</span><span class="lit">7890</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> ROWID     </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">AAAwkBAAEAAACP3AAA</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations"></a>2.7. Associations</h3>
<div class="paragraph">
<p>Associations describe how two or more entities form a relationship based on a database joining semantics.</p>
</div>
<div class="sect3">
<h4 id="associations-many-to-one"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-one"></a>2.7.1. <code>@ManyToOne</code></h4>
<div class="paragraph">
<p><code>@ManyToOne</code> is the most common association, having a direct equivalent in the relational database as well (e.g. foreign key),
and so it establishes a relationship between a child entity and a parent.</p>
</div>
<div id="associations-many-to-one-example" class="exampleblock">
<div class="title">Example 181. <code>@ManyToOne</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_id"</span><span class="pun">,</span><span class="pln">
			foreignKey </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ForeignKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PERSON_ID_FK"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    person_id BIGINT </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
 </span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT PERSON_ID_FK
FOREIGN KEY </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each entity has a lifecycle of its own. Once the <code>@ManyToOne</code> association is set, Hibernate will set the associated database foreign key column.</p>
</div>
<div id="associations-many-to-one-lifecycle-example" class="exampleblock">
<div class="title">Example 182. <code>@ManyToOne</code> association lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

UPDATE </span><span class="typ">Phone</span><span class="pln">
SET    number </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln">
       person_id </span><span class="pun">=</span><span class="pln"> NULL
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-one-to-many"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-many"></a>2.7.2. <code>@OneToMany</code></h4>
<div class="paragraph">
<p>The <code>@OneToMany</code> association links a parent entity with one or more child entities.
If the <code>@OneToMany</code> doesnâ€™t have a mirroring <code>@ManyToOne</code> association on the child side, the <code>@OneToMany</code> association is unidirectional.
If there is a <code>@ManyToOne</code> association on the child side, the <code>@OneToMany</code> association is bidirectional and the application developer can navigate this relationship from both ends.</p>
</div>
<div class="sect4">
<h5 id="associations-one-to-many-unidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-many-unidirectional"></a>Unidirectional <code>@OneToMany</code></h5>
<div class="paragraph">
<p>When using a unidirectional <code>@OneToMany</code> association, Hibernate resorts to using a link table between the two joining entities.</p>
</div>
<div id="associations-one-to-many-unidirectional-example" class="exampleblock">
<div class="title">Example 183. Unidirectional <code>@OneToMany</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person_Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="typ">Person_id</span><span class="pln"> BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    phones_id BIGINT NOT NULL
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT UK_9uhc5itwc9h5gcng944pcaslf
UNIQUE </span><span class="pun">(</span><span class="pln">phones_id</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKr38us2n8g5p9rj0b494sd3391</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">phones_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Phone</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT FK2ex4e4p7w1cj310kg2woisjl2
FOREIGN KEY </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@OneToMany</code> association is by definition a parent association, even if itâ€™s a unidirectional or a bidirectional one.
Only the parent side of an association makes sense to cascade its entity state transitions to children.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="associations-one-to-many-unidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 184. Cascading <code>@OneToMany</code> association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"321-654-0987"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone1 </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone2 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> phone1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'321-654-0987'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Person_Phone</span><span class="pln">
WHERE  </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Phone</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting the <code>Person</code> entity, the cascade will propagate the persist operation to the underlying <code>Phone</code> children as well.
Upon removing a <code>Phone</code> from the phones collection, the association row is deleted from the link table, and the <code>orphanRemoval</code> attribute will trigger a <code>Phone</code> removal as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The unidirectional associations are not very efficient when it comes to removing child entities.
In this particular example, upon flushing the persistence context, Hibernate deletes all database child entries and reinserts the ones that are still found in the in-memory persistence context.</p>
</div>
<div class="paragraph">
<p>On the other hand, a bidirectional <code>@OneToMany</code> association is much more efficient because the child entity controls the association.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="associations-one-to-many-bidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-many-bidirectional"></a>Bidirectional <code>@OneToMany</code></h5>
<div class="paragraph">
<p>The bidirectional <code>@OneToMany</code> association also requires a <code>@ManyToOne</code> association on the child side.
Although the Domain Model exposes two sides to navigate this association, behind the scenes, the relational database has only one foreign key for this relationship.</p>
</div>
<div class="paragraph">
<p>Every bidirectional association must have one owning side only (the child side), the other one being referred to as the <em>inverse</em> (or the <code>mappedBy</code>) side.</p>
</div>
<div id="associations-one-to-many-bidirectional-example" class="exampleblock">
<div class="title">Example 185. <code>@OneToMany</code> association mappedBy the <code>@ManyToOne</code> side</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removePhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    person_id BIGINT </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT UK_l329ab0g4c1t78onljnxmbnp6
UNIQUE </span><span class="pun">(</span><span class="pln">number</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKmw13yfsjypiiq0i1osdkaeqpg</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever a bidirectional association is formed, the application developer must make sure both sides are in-sync at all times.
The <code>addPhone()</code> and <code>removePhone()</code> are utility methods that synchronize both ends whenever a child element is added or removed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Because the <code>Phone</code> class has a <code>@NaturalId</code> column (the phone number being unique),
the <code>equals()</code> and the <code>hashCode()</code> can make use of this property, and so the <code>removePhone()</code> logic is reduced to the <code>remove()</code> Java <code>Collection</code> method.</p>
</div>
<div id="associations-one-to-many-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 186. Bidirectional <code>@OneToMany</code> with an owner <code>@ManyToOne</code> side lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"321-654-0987"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> phone1 </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> phone2 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">removePhone</span><span class="pun">(</span><span class="pln"> phone1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln">
       </span><span class="pun">(</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'321-654-0987'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Phone</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Unlike the unidirectional <code>@OneToMany</code>, the bidirectional association is much more efficient when managing the collection persistence state.
Every element removal only requires a single update (in which the foreign key column is set to <code>NULL</code>), and,
if the child entity lifecycle is bound to its owning parent so that the child cannot exist without its parent,
then we can annotate the association with the <code>orphan-removal</code> attribute and dissociate the child will trigger a delete statement on the actual child table row as well.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-one-to-one"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one"></a>2.7.3. <code>@OneToOne</code></h4>
<div class="paragraph">
<p>The <code>@OneToOne</code> association can either be unidirectional or bidirectional.
A unidirectional association follows the relational database foreign key semantics, the client-side owning the relationship.
A bidirectional association features a <code>mappedBy</code> <code>@OneToOne</code> parent side too.</p>
</div>
<div class="sect4">
<h5 id="associations-one-to-one-unidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one-unidirectional"></a>Unidirectional <code>@OneToOne</code></h5>
<div id="associations-one-to-one-unidirectional-example" class="exampleblock">
<div class="title">Example 187. Unidirectional <code>@OneToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"details_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> details</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PhoneDetails"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> provider</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> technology</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    details_id BIGINT </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    provider VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    technology VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKnoj7cj83ppfqbnvqqa5kolub7</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">details_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">PhoneDetails</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>From a relational database point of view, the underlying schema is identical to the unidirectional <code>@ManyToOne</code> association,
as the client-side controls the relationship based on the foreign key column.</p>
</div>
<div class="paragraph">
<p>But then, itâ€™s unusual to consider the <code>Phone</code> as a client-side and the <code>PhoneDetails</code> as the parent-side because the details cannot exist without an actual phone.
A much more natural mapping would be if the <code>Phone</code> were the parent-side, therefore pushing the foreign key into the <code>PhoneDetails</code> table.
This mapping requires a bidirectional <code>@OneToOne</code> association as you can see in the following example:</p>
</div>
</div>
<div class="sect4">
<h5 id="associations-one-to-one-bidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one-bidirectional"></a>Bidirectional <code>@OneToOne</code></h5>
<div id="associations-one-to-one-bidirectional-example" class="exampleblock">
<div class="title">Example 188. Bidirectional <code>@OneToOne</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pun">(</span><span class="pln">
		mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">,</span><span class="pln">
		cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln">
		orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
		fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> details</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addDetails</span><span class="pun">(</span><span class="typ">PhoneDetails</span><span class="pln"> details</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		details</span><span class="pun">.</span><span class="pln">setPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">details </span><span class="pun">=</span><span class="pln"> details</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeDetails</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> details </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			details</span><span class="pun">.</span><span class="pln">setPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">details </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PhoneDetails"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> provider</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> technology</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    provider VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    technology VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    phone_id BIGINT </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">PhoneDetails</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKeotuev8ja8v0sdh29dynqj05p</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">phone_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Phone</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the <code>PhoneDetails</code> owns the association, and, like any bidirectional association, the parent-side can propagate its lifecycle to the child-side through cascading.</p>
</div>
<div id="associations-one-to-one-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 189. Bidirectional <code>@OneToOne</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">PhoneDetails</span><span class="pln"> details </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pun">(</span><span class="pln"> </span><span class="str">"T-Mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"GSM"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

phone</span><span class="pun">.</span><span class="pln">addDetails</span><span class="pun">(</span><span class="pln"> details </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> phone_id</span><span class="pun">,</span><span class="pln"> provider</span><span class="pun">,</span><span class="pln"> technology</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'T-Mobile'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'GSM'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using a bidirectional <code>@OneToOne</code> association, Hibernate enforces the unique constraint upon fetching the child-side.
If there are more than one children associated with the same parent, Hibernate will throw a <code>org.hibernate.exception.ConstraintViolationException</code>.
Continuing the previous example, when adding another <code>PhoneDetails</code>, Hibernate validates the uniqueness constraint when reloading the <code>Phone</code> object.</p>
</div>
<div id="associations-one-to-one-bidirectional-constraint-example" class="exampleblock">
<div class="title">Example 190. Bidirectional <code>@OneToOne</code> unique constraint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">PhoneDetails</span><span class="pln"> otherDetails </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pun">(</span><span class="pln"> </span><span class="str">"T-Mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"CDMA"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
otherDetails</span><span class="pun">.</span><span class="pln">setPhone</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> otherDetails </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">

</span><span class="com">//throws javax.persistence.PersistenceException: org.hibernate.HibernateException: More than one row with the given identifier was found: 1</span><span class="pln">
phone </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="associations-one-to-one-bidirectional-lazy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one-bidirectional-lazy"></a>Bidirectional <code>@OneToOne</code> lazy association</h6>
<div class="paragraph">
<p>Although you might annotate the parent-side association to be fetched lazily,
Hibernate cannot honor this request since it cannot know whether the association is <code>null</code> or not.</p>
</div>
<div class="paragraph">
<p>The only way to figure out whether there is an associated record on the child side is to fetch the child association using a secondary query.
Because this can lead to N+1 query issues, itâ€™s much more efficient to use unidirectional <code>@OneToOne</code> associations with the <code>@MapsId</code> annotation in place.</p>
</div>
<div class="paragraph">
<p>However, if you really need to use a bidirectional association and want to make sure that this is always going to be fetched lazily,
then you need to enable lazy state initialization bytecode enhancement and use the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyToOne.html"><code>@LazyToOne</code></a> annotation as well.</p>
</div>
<div id="associations-one-to-one-bidirectional-lazy-example" class="exampleblock">
<div class="title">Example 191. Bidirectional <code>@OneToOne</code> lazy parent-side association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pun">(</span><span class="pln">
		mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">,</span><span class="pln">
		cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln">
		orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
		fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@LazyToOne</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LazyToOneOption</span><span class="pun">.</span><span class="pln">NO_PROXY </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> details</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addDetails</span><span class="pun">(</span><span class="typ">PhoneDetails</span><span class="pln"> details</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		details</span><span class="pun">.</span><span class="pln">setPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">details </span><span class="pun">=</span><span class="pln"> details</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeDetails</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> details </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			details</span><span class="pun">.</span><span class="pln">setPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">details </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PhoneDetails"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PhoneDetails</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> provider</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> technology</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more about how to enable Bytecode enhancement,
see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement">BytecodeEnhancement chapter</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-many-to-many"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many"></a>2.7.4. <code>@ManyToMany</code></h4>
<div class="paragraph">
<p>The <code>@ManyToMany</code> association requires a link table that joins two entities.
Like the <code>@OneToMany</code> association, <code>@ManyToMany</code> can be either unidirectional or bidirectional.</p>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-unidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many-unidirectional"></a>Unidirectional <code>@ManyToMany</code></h5>
<div id="associations-many-to-many-unidirectional-example" class="exampleblock">
<div class="title">Example 192. Unidirectional <code>@ManyToMany</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">PERSIST</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">MERGE</span><span class="pun">})</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Address</span><span class="pun">&gt;</span><span class="pln"> addresses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Address"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> street</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    street VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="typ">Person_id</span><span class="pln"> BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    addresses_id BIGINT NOT NULL
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Address</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKm7j0bnabh2yr0pe99il1d066u</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">addresses_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Address</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Address</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKba7rc9qe2vh44u93u0p2auwti</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with unidirectional <code>@OneToMany</code> associations, the link table is controlled by the owning side.</p>
</div>
<div class="paragraph">
<p>When an entity is removed from the <code>@ManyToMany</code> collection, Hibernate simply deletes the joining record in the link table.
Unfortunately, this operation requires removing all entries associated with a given parent and recreating the ones that are listed in the current running persistent context.</p>
</div>
<div id="associations-many-to-many-unidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 193. Unidirectional <code>@ManyToMany</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Address</span><span class="pln"> address1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"12th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"12A"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Address</span><span class="pln"> address2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"18th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"18B"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person1</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">
person1</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> address2 </span><span class="pun">);</span><span class="pln">

person2</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person1 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person2 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

person1</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'12A'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'12th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'18B'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'18th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Person_Address</span><span class="pln">
WHERE  </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For <code>@ManyToMany</code> associations, the <code>REMOVE</code> entity state transition doesnâ€™t make sense to be cascaded because it will propagate beyond the link table.
Since the other side might be referenced by other entities on the parent-side, the automatic removal might end up in a <code>ConstraintViolationException</code>.</p>
</div>
<div class="paragraph">
<p>For example, if <code>@ManyToMany(cascade = CascadeType.ALL)</code> was defined and the first person would be deleted,
Hibernate would throw an exception because another person is still associated with the address thatâ€™s being deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">person1</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Caused</span><span class="pln"> by</span><span class="pun">:</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">persistence</span><span class="pun">.</span><span class="typ">PersistenceException</span><span class="pun">:</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">exception</span><span class="pun">.</span><span class="typ">ConstraintViolationException</span><span class="pun">:</span><span class="pln"> could not execute statement
</span><span class="typ">Caused</span><span class="pln"> by</span><span class="pun">:</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">exception</span><span class="pun">.</span><span class="typ">ConstraintViolationException</span><span class="pun">:</span><span class="pln"> could not execute statement
</span><span class="typ">Caused</span><span class="pln"> by</span><span class="pun">:</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">SQLIntegrityConstraintViolationException</span><span class="pun">:</span><span class="pln"> integrity constraint violation</span><span class="pun">:</span><span class="pln"> foreign key no action</span><span class="pun">;</span><span class="pln"> FKM7J0BNABH2YR0PE99IL1D066U table</span><span class="pun">:</span><span class="pln"> PERSON_ADDRESS</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By simply removing the parent-side, Hibernate can safely remove the associated link records as you can see in the following example:</p>
</div>
<div id="associations-many-to-many-unidirectional-remove-example" class="exampleblock">
<div class="title">Example 194. Unidirectional <code>@ManyToMany</code> entity removal</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> person1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">DELETE FROM </span><span class="typ">Person_Address</span><span class="pln">
WHERE  </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

DELETE FROM </span><span class="typ">Person</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-bidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many-bidirectional"></a>Bidirectional <code>@ManyToMany</code></h5>
<div class="paragraph">
<p>A bidirectional <code>@ManyToMany</code> association has an owning and a <code>mappedBy</code> side.
To preserve synchronicity between both sides, itâ€™s good practice to provide helper methods for adding or removing child entities.</p>
</div>
<div id="associations-many-to-many-bidirectional-example" class="exampleblock">
<div class="title">Example 195. Bidirectional <code>@ManyToMany</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">PERSIST</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">MERGE</span><span class="pun">})</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Address</span><span class="pun">&gt;</span><span class="pln"> addresses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addAddress</span><span class="pun">(</span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		addresses</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> address </span><span class="pun">);</span><span class="pln">
		address</span><span class="pun">.</span><span class="pln">getOwners</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeAddress</span><span class="pun">(</span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		addresses</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> address </span><span class="pun">);</span><span class="pln">
		address</span><span class="pun">.</span><span class="pln">getOwners</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">registrationNumber </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> registrationNumber </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Address"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> street</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> postalCode</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"addresses"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> owners </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Address</span><span class="pln"> address </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Address</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">street </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">number </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">postalCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    postalCode VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    street VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    registrationNumber VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    owners_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    addresses_id BIGINT NOT NULL
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person</span><span class="pln">
ADD CONSTRAINT UK_23enodonj49jm8uwec4i7y37f
UNIQUE </span><span class="pun">(</span><span class="pln">registrationNumber</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Address</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKm7j0bnabh2yr0pe99il1d066u</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">addresses_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Address</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Address</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKbn86l24gmxdv2vmekayqcsgup</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">owners_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the helper methods in place, the synchronicity management can be simplified, as you can see in the following example:</p>
</div>
<div id="associations-many-to-many-bidirectional-lifecycle-example" class="exampleblock">
<div class="title">Example 196. Bidirectional <code>@ManyToMany</code> lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"ABC-123"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"DEF-456"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Address</span><span class="pln"> address1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"12th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"12A"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"4005A"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Address</span><span class="pln"> address2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"18th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"18B"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"4007B"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person1</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">
person1</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address2 </span><span class="pun">);</span><span class="pln">

person2</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person1 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person2 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

person1</span><span class="pun">.</span><span class="pln">removeAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'ABC-123'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'12A'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4005A'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'12th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'18B'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4007B'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'18th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'DEF-456'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> owners_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> owners_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> owners_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Person_Address</span><span class="pln">
WHERE  owners_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> owners_id</span><span class="pun">,</span><span class="pln"> addresses_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If a bidirectional <code>@OneToMany</code> association performs better when removing or changing the order of child elements,
the <code>@ManyToMany</code> relationship cannot benefit from such an optimization because the foreign key side is not in control.
To overcome this limitation, the link table must be directly exposed and the <code>@ManyToMany</code> association split into two bidirectional <code>@OneToMany</code> relationships.</p>
</div>
</div>
<div class="sect4">
<h5 id="associations-many-to-many-bidirectional-with-link-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many-bidirectional-with-link-entity"></a>Bidirectional many-to-many with a link entity</h5>
<div class="paragraph">
<p>To most natural <code>@ManyToMany</code> association follows the same logic employed by the database schema,
and the link table has an associated entity which controls the relationship for both sides that need to be joined.</p>
</div>
<div id="associations-many-to-many-bidirectional-with-link-entity-example" class="exampleblock">
<div class="title">Example 197. Bidirectional many-to-many with link entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> registrationNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">
		mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln">
		cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln">
		orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonAddress</span><span class="pun">&gt;</span><span class="pln"> addresses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addAddress</span><span class="pun">(</span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">PersonAddress</span><span class="pln"> personAddress </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonAddress</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">);</span><span class="pln">
		addresses</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> personAddress </span><span class="pun">);</span><span class="pln">
		address</span><span class="pun">.</span><span class="pln">getOwners</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> personAddress </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeAddress</span><span class="pun">(</span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">PersonAddress</span><span class="pln"> personAddress </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonAddress</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">);</span><span class="pln">
		address</span><span class="pun">.</span><span class="pln">getOwners</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> personAddress </span><span class="pun">);</span><span class="pln">
		addresses</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> personAddress </span><span class="pun">);</span><span class="pln">
		personAddress</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		personAddress</span><span class="pun">.</span><span class="pln">setAddress</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">registrationNumber </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> registrationNumber </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"PersonAddress"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonAddress</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">PersonAddress</span><span class="pln"> that </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">PersonAddress</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> that</span><span class="pun">.</span><span class="pln">person </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> address</span><span class="pun">,</span><span class="pln"> that</span><span class="pun">.</span><span class="pln">address </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Address"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> street</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> postalCode</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">
		mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln">
		cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln">
		orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonAddress</span><span class="pun">&gt;</span><span class="pln"> owners </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Address</span><span class="pln"> address </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Address</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">street </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">number </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">.</span><span class="pln">postalCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    postalCode VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    street VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    registrationNumber VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">PersonAddress</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    person_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    address_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> address_id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person</span><span class="pln">
ADD CONSTRAINT UK_23enodonj49jm8uwec4i7y37f
UNIQUE </span><span class="pun">(</span><span class="pln">registrationNumber</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">PersonAddress</span><span class="pln">
ADD CONSTRAINT FK8b3lru5fyej1aarjflamwghqq
FOREIGN KEY </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span><span class="pln">

ALTER TABLE </span><span class="typ">PersonAddress</span><span class="pln">
ADD CONSTRAINT FK7p69mgialumhegyl4byrh65jk
FOREIGN KEY </span><span class="pun">(</span><span class="pln">address_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Address</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>Person</code> and the <code>Address</code> have a <code>mappedBy</code> <code>@OneToMany</code> side, while the <code>PersonAddress</code> owns the <code>person</code> and the <code>address</code> <code>@ManyToOne</code> associations.
Because this mapping is formed out of two bidirectional associations, the helper methods are even more relevant.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The aforementioned example uses a Hibernate specific mapping for the link entity since JPA doesnâ€™t allow building a composite identifier out of multiple <code>@ManyToOne</code> associations.
For more details, see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-associations">Composite identifiers - associations</a> section.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The entity state transitions are better managed than in the previous bidirectional <code>@ManyToMany</code> case.</p>
</div>
<div id="associations-many-to-many-bidirectional-with-link-entity-lifecycle-example" class="exampleblock">
<div class="title">Example 198. Bidirectional many-to-many with link entity lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"ABC-123"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"DEF-456"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Address</span><span class="pln"> address1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"12th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"12A"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"4005A"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Address</span><span class="pln"> address2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">(</span><span class="pln"> </span><span class="str">"18th Avenue"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"18B"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"4007B"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person1 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person2 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> address2 </span><span class="pun">);</span><span class="pln">

person1</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">
person1</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address2 </span><span class="pun">);</span><span class="pln">

person2</span><span class="pun">.</span><span class="pln">addAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">

log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Removing address"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person1</span><span class="pun">.</span><span class="pln">removeAddress</span><span class="pun">(</span><span class="pln"> address1 </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT  INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="str">'ABC-123'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> registrationNumber</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="str">'DEF-456'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="str">'12A'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4005A'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'12th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> postalCode</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="str">'18B'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'4007B'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'18th Avenue'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">PersonAddress</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> address_id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">PersonAddress</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> address_id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT  INTO </span><span class="typ">PersonAddress</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> address_id </span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

DELETE  FROM </span><span class="typ">PersonAddress</span><span class="pln">
WHERE   person_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> AND address_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is only one delete statement executed because, this time, the association is controlled by the <code>@ManyToOne</code> side which only has to monitor the state of the underlying foreign key relationship to trigger the right DML statement.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="associations-not-found"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-not-found"></a>2.7.5. <code>@NotFound</code> association mapping</h4>
<div class="paragraph">
<p>When dealing with associations which are not enforced by a Foreign Key,
itâ€™s possible to bump into inconsistencies if the child record cannot reference a parent entity.</p>
</div>
<div class="paragraph">
<p>By default, Hibernate will complain whenever a child association references a non-existing parent record.
However, you can configure this behavior so that Hibernate can ignore such an Exception and simply assign <code>null</code> as a parent object referenced.</p>
</div>
<div class="paragraph">
<p>To ignore non-existing parent entity references, even though not really recommended, itâ€™s possible to use the annotation <code>org.hibernate.annotation.NotFound</code> annotation with a value of <code>org.hibernate.annotations.NotFoundAction.IGNORE</code>.</p>
</div>
<div class="paragraph">
<p>Considering the following <code>City</code> and <code>Person</code> entity mappings:</p>
</div>
<div id="associations-not-found-domain-model-example" class="exampleblock">
<div class="title">Example 199. <code>@NotFound</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> cityName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@NotFound</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> action </span><span class="pun">=</span><span class="pln"> </span><span class="typ">NotFoundAction</span><span class="pun">.</span><span class="pln">IGNORE </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"cityName"</span><span class="pun">,</span><span class="pln">
		referencedColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln">
		insertable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
		updatable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">City</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"City"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">City</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we have the following entities in our database:</p>
</div>
<div id="associations-not-found-persist-example" class="exampleblock">
<div class="title">Example 200. <code>@NotFound</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">City</span><span class="pln"> </span><span class="typ">_NewYork</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">City</span><span class="pun">();</span><span class="pln">
</span><span class="typ">_NewYork</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"New York"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="typ">_NewYork</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setCityName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"New York"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the <code>Person</code> entity, Hibernate is able to locate the associated <code>City</code> parent entity:</p>
</div>
<div id="associations-not-found-find-example" class="exampleblock">
<div class="title">Example 201. <code>@NotFound</code> find existing entity example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"New York"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getCity</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, if we change the <code>cityName</code> attribute to a non-existing city:</p>
</div>
<div id="associations-not-found-non-existing-persist-example" class="exampleblock">
<div class="title">Example 202. <code>@NotFound</code> change to non-existing City example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">setCityName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Atlantis"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is not going to throw any exception, and it will assign a value of <code>null</code> for the non-existing <code>City</code> entity reference:</p>
</div>
<div id="associations-not-found-non-existing-find-example" class="exampleblock">
<div class="title">Example 203. <code>@NotFound</code> find non-existing City example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Atlantis"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getCityName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getCity</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="collections"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections"></a>2.8. Collections</h3>
<div class="paragraph">
<p>Naturally Hibernate also allows persisting collections.
These persistent collections can contain almost any other Hibernate type, including basic types, custom types, embeddables, and references to other entities.
In this context, the distinction between value and reference semantics is very important.
An object in a collection might be handled with <em>value</em> semantics (its lifecycle being fully dependant on the collection owner),
or it might be a reference to another entity with its own lifecycle.
In the latter case, only the <em>link</em> between the two objects is considered to be a state held by the collection.</p>
</div>
<div class="paragraph">
<p>The owner of the collection is always an entity, even if the collection is defined by an embeddable type.
Collections form one/many-to-many associations between types so there can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>value type collections</p>
</li>
<li>
<p>embeddable type collections</p>
</li>
<li>
<p>entity collections</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hibernate uses its own collection implementations which are enriched with lazy-loading, caching or state change detection semantics.
For this reason, persistent collections must be declared as an interface type.
The actual interface might be <code>java.util.Collection</code>, <code>java.util.List</code>, <code>java.util.Set</code>, <code>java.util.Map</code>, <code>java.util.SortedSet</code>, <code>java.util.SortedMap</code> or even other object types (meaning you will have to write an implementation of <code>org.hibernate.usertype.UserCollectionType</code>).</p>
</div>
<div class="paragraph">
<p>As the following example demonstrates, itâ€™s important to use the interface type and not the collection implementation, as declared in the entity mapping.</p>
</div>
<div id="collections-collection-proxy-example" class="exampleblock">
<div class="title">Example 204. Hibernate uses its own collection implementations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Throws java.lang.ClassCastException: org.hibernate.collection.internal.PersistentBag cannot be cast to java.util.ArrayList</span><span class="pln">
</span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is important that collections be defined using the appropriate Java Collections Framework interface rather than a specific implementation.
From a theoretical perspective, this just follows good design principles.
From a practical perspective, Hibernate (like other persistence providers) will use their own collection implementations which conform to the Java Collections Framework interfaces.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The persistent collections injected by Hibernate behave like <code>ArrayList</code>, <code>HashSet</code>, <code>TreeSet</code>, <code>HashMap</code> or <code>TreeMap</code>, depending on the interface type.</p>
</div>
<div class="sect3">
<h4 id="collections-synopsis"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-synopsis"></a>2.8.1. Collections as a value type</h4>
<div class="paragraph">
<p>Value and embeddable type collections have a similar behavior to basic types since they are automatically persisted when referenced by a persistent object and automatically deleted when unreferenced.
If a collection is passed from one persistent object to another, its elements might be moved from one table to another.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Two entities cannot share a reference to the same collection instance.
Collection-valued properties do not support null value semantics because Hibernate does not distinguish between a null collection reference and an empty collection.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="collections-value"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-value"></a>2.8.2. Collections of value types</h4>
<div class="paragraph">
<p>Collections of value type include basic and embeddable types.
Collections cannot be nested, and, when used in collections, embeddable types are not allowed to define other collections.</p>
</div>
<div class="paragraph">
<p>For collections of value types, JPA 2.0 defines the <code>@ElementCollection</code> annotation.
The lifecycle of the value-type collection is entirely controlled by its owning entity.</p>
</div>
<div class="paragraph">
<p>Considering the previous example mapping, when clearing the phone collection, Hibernate deletes all the associated phones.
When adding a new element to the value type collection, Hibernate issues a new insert statement.</p>
</div>
<div id="collections-value-type-collection-lifecycle-example" class="exampleblock">
<div class="title">Example 205. Value type collection lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"456-000-1234"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">DELETE FROM </span><span class="typ">Person_phones</span><span class="pln"> WHERE   </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

INSERT INTO </span><span class="typ">Person_phones</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_phones</span><span class="pln">  </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones</span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'456-000-1234'</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If removing all elements or adding new ones is rather straightforward, removing a certain entry actually requires reconstructing the whole collection from scratch.</p>
</div>
<div id="collections-value-type-collection-remove-example" class="exampleblock">
<div class="title">Example 206. Removing collection elements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">DELETE FROM </span><span class="typ">Person_phones</span><span class="pln"> WHERE </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

INSERT INTO </span><span class="typ">Person_phones</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'456-000-1234'</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Depending on the number of elements, this behavior might not be efficient, if many elements need to be deleted and reinserted back into the database table.
A workaround is to use an <code>@OrderColumn</code>, which, although not as efficient as when using the actual link table primary key, might improve the efficiency of the remove operations.</p>
</div>
<div id="collections-value-type-collection-order-column-remove-example" class="exampleblock">
<div class="title">Example 207. Removing collection elements using the order column</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@ElementCollection</span><span class="pln">
</span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">DELETE FROM </span><span class="typ">Person_phones</span><span class="pln">
WHERE  </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
       AND order_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

UPDATE </span><span class="typ">Person_phones</span><span class="pln">
SET    phones </span><span class="pun">=</span><span class="pln"> </span><span class="str">'456-000-1234'</span><span class="pln">
WHERE  </span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
       AND order_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@OrderColumn</code> column works best when removing from the tail of the collection, as it only requires a single delete statement.
Removing from the head or the middle of the collection requires deleting the extra elements and updating the remaining ones to preserve element order.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Embeddable type collections behave the same way as value type collections.
Adding embeddables to the collection triggers the associated insert statements and removing elements from the collection will generate delete statements.</p>
</div>
<div id="collections-embeddable-type-collection-lifecycle-example" class="exampleblock">
<div class="title">Example 208. Embeddable type collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"landline"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"072-122-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person_phones</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'landline'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_phones</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'072-122-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-entity"></a>2.8.3. Collections of entities</h4>
<div class="paragraph">
<p>If value type collections can only form a one-to-many association between an owner entity and multiple basic or embeddable types,
entity collections can represent both <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-many">@OneToMany</a> and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many">@ManyToMany</a> associations.</p>
</div>
<div class="paragraph">
<p>From a relational database perspective, associations are defined by the foreign key side (the child-side).
With value type collections, only the entity can control the association (the parent-side), but for a collection of entities, both sides of the association are managed by the persistence context.</p>
</div>
<div class="paragraph">
<p>For this reason, entity collections can be devised into two main categories: unidirectional and bidirectional associations.
Unidirectional associations are very similar to value type collections since only the parent side controls this relationship.
Bidirectional associations are more tricky since, even if sides need to be in-sync at all times, only one side is responsible for managing the association.
A bidirectional association has an <em>owning</em> side and an <em>inverse (mappedBy)</em> side.</p>
</div>
<div class="paragraph">
<p>Another way of categorizing entity collections is by the underlying collection type, and so we can have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bags</p>
</li>
<li>
<p>indexed lists</p>
</li>
<li>
<p>sets</p>
</li>
<li>
<p>sorted sets</p>
</li>
<li>
<p>maps</p>
</li>
<li>
<p>sorted maps</p>
</li>
<li>
<p>arrays</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following sections, we will go through all these collection types and discuss both unidirectional and bidirectional associations.</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-bag"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bag"></a>2.8.4. Bags</h4>
<div class="paragraph">
<p>Bags are unordered lists, and we can have unidirectional bags or bidirectional ones.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-bag"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-bag"></a>Unidirectional bags</h5>
<div class="paragraph">
<p>The unidirectional bag is mapped using a single <code>@OneToMany</code> annotation on the parent side of the association.
Behind the scenes, Hibernate requires an association table to manage the parent-child relationship, as we can see in the following example:</p>
</div>
<div id="collections-unidirectional-bag-example" class="exampleblock">
<div class="title">Example 209. Unidirectional bag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Person_Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="typ">Person_id</span><span class="pln"> BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    phones_id BIGINT NOT NULL
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    type VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT UK_9uhc5itwc9h5gcng944pcaslf
UNIQUE </span><span class="pun">(</span><span class="pln">phones_id</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKr38us2n8g5p9rj0b494sd3391</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">phones_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Phone</span><span class="pln">

ALTER TABLE </span><span class="typ">Person_Phone</span><span class="pln">
ADD CONSTRAINT FK2ex4e4p7w1cj310kg2woisjl2
FOREIGN KEY </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because both the parent and the child sides are entities, the persistence context manages each entity separately.
Cascades can propagate an entity state transition from a parent entity to its children.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By marking the parent side with the <code>CascadeType.ALL</code> attribute, the unidirectional association lifecycle becomes very similar to that of a value type collection.</p>
</div>
<div id="collections-unidirectional-bag-lifecycle-example" class="exampleblock">
<div class="title">Example 210. Unidirectional bag lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"landline"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"072-122-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'landline'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'072-122-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Person_Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> phones_id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, once the parent entity is persisted, the child entities are going to be persisted as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just like value type collections, unidirectional bags are not as efficient when it comes to modifying the collection structure (removing or reshuffling elements).
Because the parent-side cannot uniquely identify each individual child, Hibernate might delete all child table rows associated with the parent entity and re-add them according to the current collection state.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-bag"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-bag"></a>Bidirectional bags</h5>
<div class="paragraph">
<p>The bidirectional bag is the most common type of entity collection.
The <code>@ManyToOne</code> side is the owning side of the bidirectional bag association, while the <code>@OneToMany</code> is the <em>inverse</em> side, being marked with the <code>mappedBy</code> attribute.</p>
</div>
<div id="collections-bidirectional-bag-example" class="exampleblock">
<div class="title">Example 211. Bidirectional bag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removePhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln"> PRIMARY KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    type VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    person_id BIGINT</span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT UK_l329ab0g4c1t78onljnxmbnp6
UNIQUE </span><span class="pun">(</span><span class="pln">number</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKmw13yfsjypiiq0i1osdkaeqpg</span><span class="pln">
FOREIGN </span><span class="typ">KEy</span><span class="pln"> </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div id="collections-bidirectional-bag-lifecycle-example" class="exampleblock">
<div class="title">Example 212. Bidirectional bag lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"landline"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"072-122-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">removePhone</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">number</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'landline'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">number</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'072-122-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

UPDATE </span><span class="typ">Phone</span><span class="pln">
SET person_id </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">,</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">'landline'</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div id="collections-bidirectional-bag-orphan-removal-example" class="exampleblock">
<div class="title">Example 213. Bidirectional bag with orphan removal</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">DELETE FROM </span><span class="typ">Phone</span><span class="pln"> WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When rerunning the previous example, the child will get removed because the parent-side propagates the removal upon dissociating the child entity reference.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-list"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-list"></a>2.8.5. Ordered Lists</h4>
<div class="paragraph">
<p>Although they use the <code>List</code> interface on the Java side, bags donâ€™t retain element order.
To preserve the collection element order, there are two possibilities:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@OrderBy</code></dt>
<dd>
<p>the collection is ordered upon retrieval using a child entity property</p>
</dd>
<dt class="hdlist1"><code>@OrderColumn</code></dt>
<dd>
<p>the collection uses a dedicated order column in the collection link table</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-ordered-list"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-ordered-list"></a>Unidirectional ordered lists</h5>
<div class="paragraph">
<p>When using the <code>@OrderBy</code> annotation, the mapping looks as follows:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-by-example" class="exampleblock">
<div class="title">Example 214. Unidirectional <code>@OrderBy</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@OrderBy</span><span class="pun">(</span><span class="str">"number"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The database mapping is the same as with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-bag">Unidirectional bags</a> example, so it wonâ€™t be repeated.
Upon fetching the collection, Hibernate generates the following select statement:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-by-select-example" class="exampleblock">
<div class="title">Example 215. Unidirectional <code>@OrderBy</code> list select statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">SELECT
   phones0_</span><span class="pun">.</span><span class="typ">Person_id</span><span class="pln"> AS </span><span class="typ">Person_i1_1_0_</span><span class="pun">,</span><span class="pln">
   phones0_</span><span class="pun">.</span><span class="pln">phones_id AS phones_i2_1_0_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="pln">id AS id1_2_1_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="str">"number"</span><span class="pln"> AS number2_2_1_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="pln">type AS type3_2_1_
FROM
   </span><span class="typ">Person_Phone</span><span class="pln"> phones0_
INNER JOIN
   </span><span class="typ">Phone</span><span class="pln"> unidirecti1_ ON phones0_</span><span class="pun">.</span><span class="pln">phones_id</span><span class="pun">=</span><span class="pln">unidirecti1_</span><span class="pun">.</span><span class="pln">id
WHERE
   phones0_</span><span class="pun">.</span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
ORDER BY
   unidirecti1_</span><span class="pun">.</span><span class="str">"number"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The child table column is used to order the list elements.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@OrderBy</code> annotation can take multiple entity properties, and each property can take an ordering direction too (e.g. <code>@OrderBy("name ASC, type DESC")</code>).</p>
</div>
<div class="paragraph">
<p>If no property is specified (e.g. <code>@OrderBy</code>), the primary key of the child entity table is used for ordering.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Another ordering option is to use the <code>@OrderColumn</code> annotation:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-column-example" class="exampleblock">
<div class="title">Example 216. Unidirectional <code>@OrderColumn</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person_Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="typ">Person_id</span><span class="pln"> BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    phones_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    order_id INTEGER NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> order_id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the link table takes the <code>order_id</code> column and uses it to materialize the collection element order.
When fetching the list, the following select query is executed:</p>
</div>
<div id="collections-unidirectional-ordered-list-order-column-select-example" class="exampleblock">
<div class="title">Example 217. Unidirectional <code>@OrderColumn</code> list select statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="kwd">select</span><span class="pln">
   phones0_</span><span class="pun">.</span><span class="typ">Person_id</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Person_i1_1_0_</span><span class="pun">,</span><span class="pln">
   phones0_</span><span class="pun">.</span><span class="pln">phones_id </span><span class="kwd">as</span><span class="pln"> phones_i2_1_0_</span><span class="pun">,</span><span class="pln">
   phones0_</span><span class="pun">.</span><span class="pln">order_id </span><span class="kwd">as</span><span class="pln"> order_id3_0_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_2_1_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="pln">number </span><span class="kwd">as</span><span class="pln"> number2_2_1_</span><span class="pun">,</span><span class="pln">
   unidirecti1_</span><span class="pun">.</span><span class="pln">type </span><span class="kwd">as</span><span class="pln"> type3_2_1_
</span><span class="kwd">from</span><span class="pln">
   </span><span class="typ">Person_Phone</span><span class="pln"> phones0_
inner join
   </span><span class="typ">Phone</span><span class="pln"> unidirecti1_
      on phones0_</span><span class="pun">.</span><span class="pln">phones_id</span><span class="pun">=</span><span class="pln">unidirecti1_</span><span class="pun">.</span><span class="pln">id
</span><span class="kwd">where</span><span class="pln">
   phones0_</span><span class="pun">.</span><span class="typ">Person_id</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>order_id</code> column in place, Hibernate can order the list in-memory after itâ€™s being fetched from the database.</p>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-ordered-list"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-ordered-list"></a>Bidirectional ordered lists</h5>
<div class="paragraph">
<p>The mapping is similar with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-bag">Bidirectional bags</a> example, just that the parent side is going to be annotated with either <code>@OrderBy</code> or <code>@OrderColumn</code>.</p>
</div>
<div id="collections-bidirectional-ordered-list-order-by-example" class="exampleblock">
<div class="title">Example 218. Bidirectional <code>@OrderBy</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OrderBy</span><span class="pun">(</span><span class="str">"number"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just like with the unidirectional <code>@OrderBy</code> list, the <code>number</code> column is used to order the statement on the SQL level.</p>
</div>
<div class="paragraph">
<p>When using the <code>@OrderColumn</code> annotation, the <code>order_id</code> column is going to be embedded in the child table:</p>
</div>
<div id="collections-bidirectional-ordered-list-order-column-example" class="exampleblock">
<div class="title">Example 219. Bidirectional <code>@OrderColumn</code> list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    type VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    person_id BIGINT </span><span class="pun">,</span><span class="pln">
    order_id INTEGER </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the collection, Hibernate will use the fetched ordered columns to sort the elements according to the <code>@OrderColumn</code> mapping.</p>
</div>
</div>
<div class="sect4">
<h5 id="collections-customizing-ordered-list-ordinal"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-customizing-ordered-list-ordinal"></a>Customizing ordered list ordinal</h5>
<div class="paragraph">
<p>You can customize the ordinal of the underlying ordered list by using the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ListIndexBase.html"><code>@ListIndexBase</code></a> annotation.</p>
</div>
<div id="collections-customizing-ordered-list-ordinal-mapping-example" class="exampleblock">
<div class="title">Example 220. <code>@ListIndexBase</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@ListIndexBase</span><span class="pun">(</span><span class="lit">100</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When inserting two <code>Phone</code> records, Hibernate is going to start the List index from 100 this time.</p>
</div>
<div id="collections-customizing-ordered-list-ordinal-persist-example" class="exampleblock">
<div class="title">Example 221. <code>@ListIndexBase</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"landline"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mobile"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"072-122-9876"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Phone</span><span class="pun">(</span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'landline'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pun">(</span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'072-122-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'mobile'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

UPDATE </span><span class="typ">Phone</span><span class="pln">
SET order_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pln">
WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

UPDATE </span><span class="typ">Phone</span><span class="pln">
SET order_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">101</span><span class="pln">
WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-customizing-ordered-by-sql-clause"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-customizing-ordered-by-sql-clause"></a>Customizing ORDER BY SQL clause</h5>
<div class="paragraph">
<p>While the JPA
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderBy.html"><code>@OrderBy</code></a> annotation allows you to specify the entity attributes used for sorting
when fetching the current annotated collection, the Hibernate specific
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OrderBy.html"><code>@OrderBy</code></a> annotation is used to specify a <strong>SQL</strong> clause instead.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>@OrderBy</code> annotation uses the <code>CHAR_LENGTH</code> SQL function to order the <code>Article</code> entities
by the number of characters of the <code>name</code> attribute.</p>
</div>
<div id="collections-customizing-ordered-by-sql-clause-mapping-example" class="exampleblock">
<div class="title">Example 222. <code>@OrderBy</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">
		mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln">
		cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">OrderBy</span><span class="pun">(</span><span class="pln">
		clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CHAR_LENGTH(name) DESC"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Article</span><span class="pun">&gt;</span><span class="pln"> articles </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Article"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Article</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> content</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>articles</code> collection, Hibernate uses the ORDER BY SQL clause provided by the mapping:</p>
</div>
<div id="collections-customizing-ordered-by-sql-clause-fetching-example" class="exampleblock">
<div class="title">Example 223. <code>@OrderBy</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"High-Performance Hibernate"</span><span class="pun">,</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">getArticles</span><span class="pun">().</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getName</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="kwd">select</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">person_id </span><span class="kwd">as</span><span class="pln"> person_i4_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">content </span><span class="kwd">as</span><span class="pln"> content2_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name3_0_1_</span><span class="pun">,</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">person_id </span><span class="kwd">as</span><span class="pln"> person_i4_0_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Article</span><span class="pln"> a
</span><span class="kwd">where</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">person_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
order </span><span class="kwd">by</span><span class="pln">
    CHAR_LENGTH</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> desc</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-set"></a>2.8.6. Sets</h4>
<div class="paragraph">
<p>Sets are collections that donâ€™t allow duplicate entries and Hibernate supports both the unordered <code>Set</code> and the natural-ordering <code>SortedSet</code>.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-set"></a>Unidirectional sets</h5>
<div class="paragraph">
<p>The unidirectional set uses a link table to hold the parent-child associations and the entity mapping looks as follows:</p>
</div>
<div id="collections-unidirectional-set-example" class="exampleblock">
<div class="title">Example 224. Unidirectional set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The unidirectional set lifecycle is similar to that of the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-bag">Unidirectional bags</a>, so it can be omitted.
The only difference is that <code>Set</code> doesnâ€™t allow duplicates, but this constraint is enforced by the Java object contract rather than the database mapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using sets, itâ€™s very important to supply proper equals/hashCode implementations for child entities.
In the absence of a custom equals/hashCode implementation logic, Hibernate will use the default Java reference-based object equality which might render unexpected results when mixing detached and managed object instances.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-set"></a>Bidirectional sets</h5>
<div class="paragraph">
<p>Just like bidirectional bags, the bidirectional set doesnâ€™t use a link table, and the child table has a foreign key referencing the parent table primary key.
The lifecycle is just like with bidirectional bags except for the duplicates which are filtered out.</p>
</div>
<div id="collections-bidirectional-set-example" class="exampleblock">
<div class="title">Example 225. Bidirectional set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removePhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phones</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-sorted-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-sorted-set"></a>2.8.7. Sorted sets</h4>
<div class="paragraph">
<p>For sorted sets, the entity mapping must use the <code>SortedSet</code> interface instead.
According to the <code>SortedSet</code> contract, all elements must implement the <code>Comparable</code> interface and therefore provide the sorting logic.</p>
</div>
<div class="sect4">
<h5 id="collections-unidirectional-sorted-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-sorted-set"></a>Unidirectional sorted sets</h5>
<div class="paragraph">
<p>A <code>SortedSet</code> that relies on the natural sorting order given by the child element <code>Comparable</code> implementation logic must be annotated with the <code>@SortNatural</code> Hibernate annotation.</p>
</div>
<div id="collections-unidirectional-sorted-set-natural-comparator-example" class="exampleblock">
<div class="title">Example 226. Unidirectional natural sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@SortNatural</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SortedSet</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TreeSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compareTo</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> number</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getNumber</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The lifecycle and the database mapping are identical to the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-bag">Unidirectional bags</a>, so they are intentionally omitted.</p>
</div>
<div class="paragraph">
<p>To provide a custom sorting logic, Hibernate also provides a <code>@SortComparator</code> annotation:</p>
</div>
<div id="collections-unidirectional-sorted-set-custom-comparator-example" class="exampleblock">
<div class="title">Example 227. Unidirectional custom comparator sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@SortComparator</span><span class="pun">(</span><span class="typ">ReverseComparator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SortedSet</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TreeSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ReverseComparator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Comparator</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compare</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> o1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> o2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> o2</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln"> o1 </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compareTo</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> number</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getNumber</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-bidirectional-sorted-set"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-sorted-set"></a>Bidirectional sorted sets</h5>
<div class="paragraph">
<p>The <code>@SortNatural</code> and <code>@SortComparator</code> work the same for bidirectional sorted sets too:</p>
</div>
<div id="collections-bidirectional-sorted-set-example" class="exampleblock">
<div class="title">Example 228. Bidirectional natural sorted set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SortNatural</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SortedSet</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TreeSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

</span><span class="lit">@SortComparator</span><span class="pun">(</span><span class="typ">ReverseComparator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SortedSet</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TreeSet</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-map"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map"></a>2.8.8. Maps</h4>
<div class="paragraph">
<p>A <code>java.util.Map</code> is a ternary association because it requires a parent entity, a map key, and a value.
An entity can either be a map key or a map value, depending on the mapping.
Hibernate allows using the following map keys:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MapKeyColumn</code></dt>
<dd>
<p>for value type maps, the map key is a column in the link table that defines the grouping logic</p>
</dd>
<dt class="hdlist1"><code>MapKey</code></dt>
<dd>
<p>the map key is either the primary key or another property of the entity stored as a map entry value</p>
</dd>
<dt class="hdlist1"><code>MapKeyEnumerated</code></dt>
<dd>
<p>the map key is an <code>Enum</code> of the target child entity</p>
</dd>
<dt class="hdlist1"><code>MapKeyTemporal</code></dt>
<dd>
<p>the map key is a <code>Date</code> or a <code>Calendar</code> of the target child entity</p>
</dd>
<dt class="hdlist1"><code>MapKeyJoinColumn</code></dt>
<dd>
<p>the map key is an entity mapped as an association in the child entity thatâ€™s stored as a map entry key</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="collections-map-value-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-value-type"></a>Value type maps</h5>
<div class="paragraph">
<p>A map of value type must use the <code>@ElementCollection</code> annotation, just like value type lists, bags or sets.</p>
</div>
<div id="collections-map-value-type-entity-key-example" class="exampleblock">
<div class="title">Example 229. Value type map with an entity as a map key</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	LAND_LINE</span><span class="pun">,</span><span class="pln">
	MOBILE
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@CollectionTable</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_register"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"since"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">&gt;</span><span class="pln"> phoneRegister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE phone_register </span><span class="pun">(</span><span class="pln">
    </span><span class="typ">Person_id</span><span class="pln"> BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    since TIMESTAMP </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> NOT NULL </span><span class="pun">,</span><span class="pln">
    type INTEGER NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE phone_register
ADD CONSTRAINT </span><span class="typ">FKrmcsa34hr68of2rq8qf526mlk</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Adding entries to the map generates the following SQL statements:</p>
</div>
<div id="collections-map-value-type-entity-key-add-example" class="exampleblock">
<div class="title">Example 230. Adding value type map entries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">getPhoneRegister</span><span class="pun">().</span><span class="pln">put</span><span class="pun">(</span><span class="pln">
	</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhoneRegister</span><span class="pun">().</span><span class="pln">put</span><span class="pun">(</span><span class="pln">
	</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">MOBILE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"072-122-9876"</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO phone_register </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> since</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'072-122-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2015-12-15 17:16:45.311'</span><span class="pun">)</span><span class="pln">

INSERT INTO phone_register </span><span class="pun">(</span><span class="typ">Person_id</span><span class="pun">,</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> since</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2015-12-15 17:16:45.311'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-custom-key-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-custom-key-type"></a>Maps with a custom key type</h5>
<div class="paragraph">
<p>Hibernate defines the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/MapKeyType.html"><code>@MapKeyType</code></a> annotation
which you can use to customize the <code>Map</code> key type.</p>
</div>
<div class="paragraph">
<p>Considering you have the following tables in your database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table person </span><span class="pun">(</span><span class="pln">
    id int8 </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table call_register </span><span class="pun">(</span><span class="pln">
    person_id int8 </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    phone_number int4</span><span class="pun">,</span><span class="pln">
    call_timestamp_epoch int8 </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">,</span><span class="pln"> call_timestamp_epoch</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="kwd">if</span><span class="pln"> exists call_register
    add constraint </span><span class="typ">FKsn58spsregnjyn8xt61qkxsub</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln">
    references person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>call_register</code> records the call history for every <code>person</code>.
The <code>call_timestamp_epoch</code> column stores the phone call timestamp as a Unix timestamp since the Unix epoch.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@MapKeyColumn</code> annotation is used to define the table column holding the key
while the <code>@Column</code> mapping gives the value of the <code>java.util.Map</code> in question.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Since we want to map all the calls by their associated <code>java.util.Date</code>, not by their timestamp since epoch which is a number, the entity mapping looks as follows:</p>
</div>
<div id="collections-map-custom-key-type-mapping-example" class="exampleblock">
<div class="title">Example 231. <code>@MapKeyType</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@CollectionTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_register"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyType</span><span class="pun">(</span><span class="pln">
		</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln">
			type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.userguide.collections.type.TimestampEpochType"</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyColumn</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_timestamp_epoch"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_number"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> callRegister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The associated <code>TimestampEpochType</code> looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public class TimestampEpochType
        extends AbstractSingleColumnStandardBasicType&lt;Date&gt;
        implements VersionType&lt;Date&gt;, LiteralType&lt;Date&gt; {

    public static final TimestampEpochType INSTANCE = new TimestampEpochType();

    public TimestampEpochType() {
        super(
            BigIntTypeDescriptor.INSTANCE,
            JdbcTimestampTypeDescriptor.INSTANCE
        );
    }

    @Override
    public String getName() {
        return "epoch";
    }

    @Override
    public Date next(
        Date current,
        SharedSessionContractImplementor session) {
        return seed( session );
    }

    @Override
    public Date seed(
        SharedSessionContractImplementor session) {
        return new Timestamp( System.currentTimeMillis() );
    }

    @Override
    public Comparator&lt;Date&gt; getComparator() {
        return getJavaTypeDescriptor().getComparator();
    }

    @Override
    public String objectToSQLString(
        Date value,
        Dialect dialect) throws Exception {
        final Timestamp ts = Timestamp.class.isInstance( value )
            ? ( Timestamp ) value
            : new Timestamp( value.getTime() );
        return StringType.INSTANCE.objectToSQLString(
            ts.toString(), dialect
        );
    }

    @Override
    public Date fromStringValue(
        String xml) throws HibernateException {
        return fromString( xml );
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TimestampEpochType</code> allows us to map a Unix timestamp since epoch to a <code>java.util.Date</code>.
But, without the <code>@MapKeyType</code> Hibernate annotation, it would not be possible to customize the <code>Map</code> key type.</p>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-key-class"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-key-class"></a>Maps having an interface type as the key</h5>
<div class="paragraph">
<p>Considering you have the following <code>PhoneNumber</code> interface with an implementation given by the <code>MobilePhone</code> class type:</p>
</div>
<div id="collections-map-key-class-type-mapping-example" class="exampleblock">
<div class="title">Example 232. <code>PhoneNumber</code> interface and the <code>MobilePhone</code> class type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">PhoneNumber</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">String</span><span class="pln"> get</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pln">
		</span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PhoneNumber</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">static</span><span class="pln"> </span><span class="typ">PhoneNumber</span><span class="pln"> fromString</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> phoneNumber</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> tokens </span><span class="pun">=</span><span class="pln"> phoneNumber</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="pln"> </span><span class="str">"-"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> tokens</span><span class="pun">.</span><span class="pln">length </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"invalid phone number: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> phoneNumber </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">(</span><span class="pln">
			tokens</span><span class="pun">[</span><span class="pln">i</span><span class="pun">++],</span><span class="pln">
			tokens</span><span class="pun">[</span><span class="pln">i</span><span class="pun">++],</span><span class="pln">
			tokens</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">String</span><span class="pln"> countryCode</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">String</span><span class="pln"> operatorCode</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">String</span><span class="pln"> subscriberCode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">countryCode </span><span class="pun">=</span><span class="pln"> countryCode</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">operatorCode </span><span class="pun">=</span><span class="pln"> operatorCode</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">subscriberCode </span><span class="pun">=</span><span class="pln"> subscriberCode</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"country_code"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> countryCode</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"operator_code"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> operatorCode</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"subscriber_code"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> subscriberCode</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">
			</span><span class="str">"%s-%s-%s"</span><span class="pun">,</span><span class="pln">
			countryCode</span><span class="pun">,</span><span class="pln">
			operatorCode</span><span class="pun">,</span><span class="pln">
			subscriberCode
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">MobilePhone</span><span class="pln"> that </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MobilePhone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> countryCode</span><span class="pun">,</span><span class="pln"> that</span><span class="pun">.</span><span class="pln">countryCode </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> operatorCode</span><span class="pun">,</span><span class="pln"> that</span><span class="pun">.</span><span class="pln">operatorCode </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> subscriberCode</span><span class="pun">,</span><span class="pln"> that</span><span class="pun">.</span><span class="pln">subscriberCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> countryCode</span><span class="pun">,</span><span class="pln"> operatorCode</span><span class="pun">,</span><span class="pln"> subscriberCode </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to use the <code>PhoneNumber</code> interface as a <code>java.util.Map</code> key, then you need to supply the
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyClass.html"><code>@MapKeyClass</code></a> annotation as well.</p>
</div>
<div id="collections-map-key-class-mapping-example" class="exampleblock">
<div class="title">Example 233. <code>@MapKeyClass</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@CollectionTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_register"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyColumn</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_timestamp_epoch"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_register"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">PhoneNumber</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> callRegister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">create table person </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table call_register </span><span class="pun">(</span><span class="pln">
    person_id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    call_register integer</span><span class="pun">,</span><span class="pln">
    country_code varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    operator_code varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    subscriber_code varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">,</span><span class="pln"> country_code</span><span class="pun">,</span><span class="pln"> operator_code</span><span class="pun">,</span><span class="pln"> subscriber_code</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table call_register
    add constraint </span><span class="typ">FKqyj2at6ik010jqckeaw23jtv2</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln">
    references person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When inserting a <code>Person</code> with a <code>callRegister</code> containing 2 <code>MobilePhone</code> references,
Hibernate generates the following SQL statements:</p>
</div>
<div id="collections-map-key-class-persist-example" class="exampleblock">
<div class="title">Example 234. <code>@MapKeyClass</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getCallRegister</span><span class="pun">().</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"01"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"234"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"567"</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> </span><span class="lit">101</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getCallRegister</span><span class="pun">().</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">(</span><span class="pln"> </span><span class="str">"01"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"234"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"789"</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> </span><span class="lit">102</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">insert </span><span class="kwd">into</span><span class="pln"> person </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> values </span><span class="pun">(?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert </span><span class="kwd">into</span><span class="pln"> call_register</span><span class="pun">(</span><span class="pln">
    person_id</span><span class="pun">,</span><span class="pln">
    country_code</span><span class="pun">,</span><span class="pln">
    operator_code</span><span class="pun">,</span><span class="pln">
    subscriber_code</span><span class="pun">,</span><span class="pln">
    call_register
</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">01</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">234</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">789</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">102</span><span class="pun">]</span><span class="pln">

insert </span><span class="kwd">into</span><span class="pln"> call_register</span><span class="pun">(</span><span class="pln">
    person_id</span><span class="pun">,</span><span class="pln">
    country_code</span><span class="pun">,</span><span class="pln">
    operator_code</span><span class="pun">,</span><span class="pln">
    subscriber_code</span><span class="pun">,</span><span class="pln">
    call_register
</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">01</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">234</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">567</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">101</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching a <code>Person</code> and accessing the <code>callRegister</code> <code>Map</code>,
Hibernate generates the following SQL statements:</p>
</div>
<div id="collections-map-key-class-fetch-example" class="exampleblock">
<div class="title">Example 235. <code>@MapKeyClass</code> fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getCallRegister</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">101</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">getCallRegister</span><span class="pun">().</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">.</span><span class="pln">fromString</span><span class="pun">(</span><span class="pln"> </span><span class="str">"01-234-567"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">102</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">getCallRegister</span><span class="pun">().</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MobilePhone</span><span class="pun">.</span><span class="pln">fromString</span><span class="pun">(</span><span class="pln"> </span><span class="str">"01-234-789"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="kwd">select</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">person_id </span><span class="kwd">as</span><span class="pln"> person_i1_0_0_</span><span class="pun">,</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">call_register </span><span class="kwd">as</span><span class="pln"> call_reg2_0_0_</span><span class="pun">,</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">country_code </span><span class="kwd">as</span><span class="pln"> country_3_0_</span><span class="pun">,</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">operator_code </span><span class="kwd">as</span><span class="pln"> operator4_0_</span><span class="pun">,</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">subscriber_code </span><span class="kwd">as</span><span class="pln"> subscrib5_0_
</span><span class="kwd">from</span><span class="pln">
    call_register cr
</span><span class="kwd">where</span><span class="pln">
    cr</span><span class="pun">.</span><span class="pln">person_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">person_i1_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">])</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">call_reg2_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">101</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">country_3_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">01</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">operator4_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">234</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">subscrib5_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">567</span><span class="pun">]</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">person_i1_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">])</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">call_reg2_0_0_</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">102</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">country_3_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">01</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">operator4_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">234</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> extracted value </span><span class="pun">([</span><span class="pln">subscrib5_0_</span><span class="pun">]</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">])</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">789</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-unidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-unidirectional"></a>Unidirectional maps</h5>
<div class="paragraph">
<p>A unidirectional map exposes a parent-child association from the parent-side only.</p>
</div>
<div class="paragraph">
<p>The following example shows a unidirectional map which also uses a <code>@MapKeyTemporal</code> annotation.
The map key is a timestamp, and itâ€™s taken from the child entity table.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@MapKey</code> annotation is used to define the entity attribute used as a key of the <code>java.util.Map</code> in question.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="collections-map-unidirectional-example" class="exampleblock">
<div class="title">Example 236. Unidirectional Map</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	LAND_LINE</span><span class="pun">,</span><span class="pln">
	MOBILE
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@JoinTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_register"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_id"</span><span class="pun">),</span><span class="pln">
		inverseJoinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_id"</span><span class="pun">))</span><span class="pln">
	</span><span class="lit">@MapKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"since"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyTemporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phoneRegister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phoneRegister</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getSince</span><span class="pun">(),</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> since</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    since TIMESTAMP </span><span class="pun">,</span><span class="pln">
    type INTEGER </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE phone_register </span><span class="pun">(</span><span class="pln">
    phone_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    person_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> phone_id</span><span class="pun">,</span><span class="pln"> person_id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE phone_register
ADD CONSTRAINT </span><span class="typ">FKc3jajlx41lw6clbygbw8wm65w</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Phone</span><span class="pln">

ALTER TABLE phone_register
ADD CONSTRAINT FK6npoomh1rp660o1b55py9ndw4
FOREIGN KEY </span><span class="pun">(</span><span class="pln">phone_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collections-map-bidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-bidirectional"></a>Bidirectional maps</h5>
<div class="paragraph">
<p>Like most bidirectional associations, this relationship is owned by the child-side while the parent is the inverse side and can propagate its own state transitions to the child entities.</p>
</div>
<div class="paragraph">
<p>In the following example, you can see that <code>@MapKeyEnumerated</code> was used so that the <code>Phone</code> enumeration becomes the map key.</p>
</div>
<div id="collections-map-bidirectional-example" class="exampleblock">
<div class="title">Example 237. Bidirectional Map</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"type"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@MapKeyEnumerated</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">PhoneType</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phoneRegister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		phone</span><span class="pun">.</span><span class="pln">setPerson</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		phoneRegister</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getType</span><span class="pun">(),</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> since</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    number VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    since TIMESTAMP </span><span class="pun">,</span><span class="pln">
    type INTEGER </span><span class="pun">,</span><span class="pln">
    person_id BIGINT </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">Phone</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKmw13yfsjypiiq0i1osdkaeqpg</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">person_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="collections-array"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-array"></a>2.8.9. Arrays</h4>
<div class="paragraph">
<p>When discussing arrays, it is important to understand the distinction between SQL array types and Java arrays that are mapped as part of the applicationâ€™s domain model.</p>
</div>
<div class="paragraph">
<p>Not all databases implement the SQL-99 ARRAY type and, for this reason,
Hibernate doesnâ€™t support native database array types.</p>
</div>
<div class="paragraph">
<p>Hibernate does support the mapping of arrays in the Java domain model - conceptually the same as mapping a List.
However, it is important to realize that it is impossible for Hibernate to offer lazy-loading for arrays of entities and, for this reason,
it is strongly recommended to map a "collection" of entities using a List rather than an array.</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-array-binary"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-array-binary"></a>2.8.10. Arrays as binary</h4>
<div class="paragraph">
<p>By default, Hibernate will choose a BINARY type, as supported by the current <code>Dialect</code>.</p>
</div>
<div id="collections-array-binary-example" class="exampleblock">
<div class="title">Example 238. Arrays stored as binary</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> phones</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    phones VARBINARY</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to map arrays such as <code>String[]</code> or <code>int[]</code> to database-specific array types like PostgreSQL <code>integer[]</code> or <code>text[]</code>,
you need to write a custom Hibernate Type.</p>
</div>
<div class="paragraph">
<p>Check out <a href="https://vladmihalcea.com/how-to-map-java-and-sql-arrays-with-jpa-and-hibernate/">this article</a> for an example of how to write
such a custom Hibernate Type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="collections-as-basic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-as-basic"></a>2.8.11. Collections as basic value type</h4>
<div class="paragraph">
<p>Notice how all the previous examples explicitly mark the collection attribute as either <code>ElementCollection</code>, <code>OneToMany</code> or <code>ManyToMany</code>.
Collections not marked as such require a custom Hibernate <code>Type</code> and the collection elements must be stored in a single database column.</p>
</div>
<div class="paragraph">
<p>This is sometimes beneficial. Consider a use-case such as a <code>VARCHAR</code> column that represents a delimited list/set of Strings.</p>
</div>
<div id="collections-comma-delimited-collection-example" class="exampleblock">
<div class="title">Example 239. Comma delimited collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Type</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"comma_delimited_strings"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> getPhones</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> phones</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CommaDelimitedStringsJavaTypeDescriptor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractTypeDescriptor</span><span class="pun">&lt;</span><span class="typ">List</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> DELIMITER </span><span class="pun">=</span><span class="pln"> </span><span class="str">","</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">CommaDelimitedStringsJavaTypeDescriptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MutableMutabilityPlan</span><span class="pun">&lt;</span><span class="typ">List</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="lit">@Override</span><span class="pln">
                </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> deepCopyNotNull</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> value </span><span class="pun">).</span><span class="pln">stream</span><span class="pun">().</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">joining</span><span class="pun">(</span><span class="pln"> DELIMITER </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> fromString</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> string</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> values </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">
        </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">(</span><span class="pln"> values</span><span class="pun">,</span><span class="pln"> string</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="pln"> DELIMITER </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> values</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> X unwrap</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> type</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">X</span><span class="pun">)</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">X</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> wrap</span><span class="pun">(</span><span class="pln">X value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WrapperOptions</span><span class="pln"> options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> fromString</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CommaDelimitedStringsType</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractSingleColumnStandardBasicType</span><span class="pun">&lt;</span><span class="typ">List</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">CommaDelimitedStringsType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">VarcharTypeDescriptor</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CommaDelimitedStringsJavaTypeDescriptor</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"comma_delimited_strings"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The developer can use the comma-delimited collection like any other collection weâ€™ve discussed so far and Hibernate will take care of the type transformation part.
The collection itself behaves like any other basic value type, as its lifecycle is bound to its owner entity.</p>
</div>
<div id="collections-comma-delimited-collection-lifecycle-example" class="exampleblock">
<div class="title">Example 240. Comma delimited collection lifecycle</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">person</span><span class="pun">.</span><span class="pln">phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"027-123-4567"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="str">"028-234-9876"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> phones</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'027-123-4567,028-234-9876'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

UPDATE </span><span class="typ">Person</span><span class="pln">
SET    phones </span><span class="pun">=</span><span class="pln"> </span><span class="str">'028-234-9876'</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the Hibernate Integrations Guide for more details on developing custom value type mappings.</p>
</div>
</div>
<div class="sect3">
<h4 id="collections-custom"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-custom"></a>2.8.12. Custom collection types</h4>
<div class="paragraph">
<p>If you wish to use other collection types than <code>List</code>, <code>Set</code> or <code>Map</code>, like <code>Queue</code> for instance,
you have to use a custom collection type, as illustrated by the following example:</p>
</div>
<div id="collections-custom-collection-mapping-example" class="exampleblock">
<div class="title">Example 241. Custom collection mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CollectionType</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.userguide.collections.type.QueueType"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Collection</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Constructors are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Queue</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> getPhones</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Queue</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;)</span><span class="pln"> phones</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Comparable</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compareTo</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> number</span><span class="pun">.</span><span class="pln">compareTo</span><span class="pun">(</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getNumber</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> number</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> number </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">QueueType</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserCollectionType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersistentCollection</span><span class="pln"> instantiate</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">CollectionPersister</span><span class="pln"> persister</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersistentQueue</span><span class="pun">(</span><span class="pln"> session </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersistentCollection</span><span class="pln"> wrap</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> collection</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersistentQueue</span><span class="pun">(</span><span class="pln"> session</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">)</span><span class="pln"> collection </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Iterator</span><span class="pln"> getElementsIterator</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> collection</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Queue</span><span class="pun">)</span><span class="pln"> collection </span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> contains</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> collection</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Queue</span><span class="pun">)</span><span class="pln"> collection </span><span class="pun">).</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> entity </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> indexOf</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> collection</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">)</span><span class="pln"> collection </span><span class="pun">).</span><span class="pln">indexOf</span><span class="pun">(</span><span class="pln"> entity </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> replaceElements</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> original</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> target</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">CollectionPersister</span><span class="pln"> persister</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Map</span><span class="pln"> copyCache</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">HibernateException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Queue</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Queue</span><span class="pun">)</span><span class="pln"> target</span><span class="pun">;</span><span class="pln">
        result</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
        result</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Queue</span><span class="pun">)</span><span class="pln"> original </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> instantiate</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> anticipatedSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;&gt;();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersistentQueue</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">PersistentBag</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Queue</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersistentQueue</span><span class="pun">(</span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> session </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersistentQueue</span><span class="pun">(</span><span class="typ">SharedSessionContractImplementor</span><span class="pln"> session</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> session</span><span class="pun">,</span><span class="pln"> list </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> offer</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">o</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> remove</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> poll</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> poll</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> size </span><span class="pun">=</span><span class="pln"> size</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">size </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> first </span><span class="pun">=</span><span class="pln"> get</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
            remove</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> first</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NoSuchElementException</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> element</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> peek</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> peek</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reason why the <code>Queue</code> interface is not used for the entity attribute is because Hibernate only allows the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.List</code></p>
</li>
<li>
<p><code>java.util.Set</code></p>
</li>
<li>
<p><code>java.util.Map</code></p>
</li>
<li>
<p><code>java.util.SortedSet</code></p>
</li>
<li>
<p><code>java.util.SortedMap</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, the custom collection type can still be customized as long as the base type is one of the aforementioned persistent types.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This way, the <code>Phone</code> collection can be used as a <code>java.util.Queue</code>:</p>
</div>
<div id="collections-custom-collection-example" class="exampleblock">
<div class="title">Example 242. Custom collection example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Queue</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> head </span><span class="pun">=</span><span class="pln"> phones</span><span class="pun">.</span><span class="pln">peek</span><span class="pun">();</span><span class="pln">
assertSame</span><span class="pun">(</span><span class="pln">head</span><span class="pun">,</span><span class="pln"> phones</span><span class="pun">.</span><span class="pln">poll</span><span class="pun">());</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> phones</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="naturalid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid"></a>2.9. Natural Ids</h3>
<div class="paragraph">
<p>Natural ids represent domain model unique identifiers that have a meaning in the real world too.
Even if a natural id does not make a good primary key (surrogate keys being usually preferred), itâ€™s still useful to tell Hibernate about it.
As we will see later, Hibernate provides a dedicated, efficient API for loading an entity by its natural id much like it offers for loading by its identifier (PK).</p>
</div>
<div class="sect3">
<h4 id="naturalid-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid-mapping"></a>2.9.1. Natural Id Mapping</h4>
<div class="paragraph">
<p>Natural ids are defined in terms of one or more persistent attributes.</p>
</div>
<div id="naturalid-simple-basic-attribute-mapping-example" class="exampleblock">
<div class="title">Example 243. Natural id using single basic attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="naturalid-single-embedded-attribute-mapping-example" class="exampleblock">
<div class="title">Example 244. Natural id using single embedded attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Embedded</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Isbn</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Isbn</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn10</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn13</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Isbn</span><span class="pln"> isbn </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Isbn</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> isbn10</span><span class="pun">,</span><span class="pln"> isbn</span><span class="pun">.</span><span class="pln">isbn10 </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> isbn13</span><span class="pun">,</span><span class="pln"> isbn</span><span class="pun">.</span><span class="pln">isbn13 </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> isbn10</span><span class="pun">,</span><span class="pln"> isbn13 </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="naturalid-multiple-attribute-mapping-example" class="exampleblock">
<div class="title">Example 245. Natural id using multiple persistent attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> productNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> publisher</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Publisher"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="typ">Publisher</span><span class="pln"> publisher </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Publisher</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> publisher</span><span class="pun">.</span><span class="pln">id </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
				</span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> publisher</span><span class="pun">.</span><span class="pln">name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">.</span><span class="pln">hash</span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> name </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="naturalid-api"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid-api"></a>2.9.2. Natural Id API</h4>
<div class="paragraph">
<p>As stated before, Hibernate provides an API for loading entities by their associate natural id.
This is represented by the <code>org.hibernate.NaturalIdLoadAccess</code> contract obtained via Session#byNaturalId.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the entity does not define a natural id, trying to load an entity by its natural id will throw an exception.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="naturalid-load-access-example" class="exampleblock">
<div class="title">Example 246. Using NaturalIdLoadAccess</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">using</span><span class="pun">(</span><span class="pln"> </span><span class="str">"isbn"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"978-9730228236"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">using</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"isbn"</span><span class="pun">,</span><span class="pln">
		</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Isbn</span><span class="pun">(</span><span class="pln">
			</span><span class="str">"973022823X"</span><span class="pun">,</span><span class="pln">
			</span><span class="str">"978-9730228236"</span><span class="pln">
		</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">using</span><span class="pun">(</span><span class="str">"productNumber"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"973022823X"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">using</span><span class="pun">(</span><span class="str">"publisher"</span><span class="pun">,</span><span class="pln"> publisher</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>NaturalIdLoadAccess offers 2 distinct methods for obtaining the entity:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>load()</code></dt>
<dd>
<p>obtains a reference to the entity, making sure that the entity state is initialized</p>
</dd>
<dt class="hdlist1"><code>getReference()</code></dt>
<dd>
<p>obtains a reference to the entity. The state may or may not be initialized.
If the entity is already associated with the current running Session, that reference (loaded or not) is returned.
If the entity is not loaded in the current Session and the entity supports proxy generation, an uninitialized proxy is generated and returned, otherwise the entity is loaded from the database and returned.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>NaturalIdLoadAccess</code> allows loading an entity by natural id and at the same time apply a pessimistic lock.
For additional details on locking, see the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking">Locking</a> chapter.</p>
</div>
<div class="paragraph">
<p>We will discuss the last method available on NaturalIdLoadAccess ( <code>setSynchronizationEnabled()</code> ) in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid-mutability-caching">Natural Id - Mutability and Caching</a>.</p>
</div>
<div class="paragraph">
<p>Because the <code>Company</code> and <code>PostalCarrier</code> entities define "simple" natural ids, we can load them as follows:</p>
</div>
<div id="naturalid-simple-load-access-example" class="exampleblock">
<div class="title">Example 247. Loading by simple natural id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="str">"978-9730228236"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln">
		</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Isbn</span><span class="pun">(</span><span class="pln">
			</span><span class="str">"973022823X"</span><span class="pun">,</span><span class="pln">
			</span><span class="str">"978-9730228236"</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we see the use of the <code>org.hibernate.SimpleNaturalIdLoadAccess</code> contract,
obtained via `Session#bySimpleNaturalId().</p>
</div>
<div class="paragraph">
<p><code>SimpleNaturalIdLoadAccess</code> is similar to <code>NaturalIdLoadAccess</code> except that it does not define the using method.
Instead, because these <em>simple</em> natural ids are defined based on just one attribute we can directly pass
the corresponding natural id attribute value directly to the <code>load()</code> and <code>getReference()</code> methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the entity does not define a natural id, or if the natural id is not of a "simple" type, an exception will be thrown there.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="naturalid-mutability-caching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid-mutability-caching"></a>2.9.3. Natural Id - Mutability and Caching</h4>
<div class="paragraph">
<p>A natural id may be mutable or immutable. By default the <code>@NaturalId</code> annotation marks an immutable natural id attribute.
An immutable natural id is expected to never change its value.</p>
</div>
<div class="paragraph">
<p>If the value(s) of the natural id attribute(s) change, <code>@NaturalId(mutable=true)</code> should be used instead.</p>
</div>
<div id="naturalid-mutable-mapping-example" class="exampleblock">
<div class="title">Example 248. Mutable natural id mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Author"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pun">(</span><span class="pln">mutable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> email</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Within the Session, Hibernate maintains a mapping from natural id values to entity identifiers (PK) values.
If natural ids values changed, it is possible for this mapping to become out of date until a flush occurs.</p>
</div>
<div class="paragraph">
<p>To work around this condition, Hibernate will attempt to discover any such pending changes and adjust them when the <code>load()</code> or <code>getReference()</code> methods are executed.
To be clear: this is only pertinent for mutable natural ids.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <em>discovery and adjustment</em> have a performance impact.
If an application is certain that none of its mutable natural ids already associated with the Session have changed, it can disable that checking by calling <code>setSynchronizationEnabled(false)</code> (the default is true).
This will force Hibernate to circumvent the checking of mutable natural ids.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="naturalid-mutable-synchronized-example" class="exampleblock">
<div class="title">Example 249. Mutable natural id synchronization use-case</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Author</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="str">"john@acme.com"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

author</span><span class="pun">.</span><span class="pln">setEmail</span><span class="pun">(</span><span class="pln"> </span><span class="str">"john.doe@acme.com"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertNull</span><span class="pun">(</span><span class="pln">
	entityManager
		</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setSynchronizationEnabled</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="str">"john.doe@acme.com"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertSame</span><span class="pun">(</span><span class="pln"> author</span><span class="pun">,</span><span class="pln">
	entityManager
		</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setSynchronizationEnabled</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="str">"john.doe@acme.com"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Not only can this NaturalId-to-PK resolution be cached in the Session, but we can also have it cached in the second-level cache if second level caching is enabled.</p>
</div>
<div id="naturalid-caching" class="exampleblock">
<div class="title">Example 250. Natural id caching</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NaturalIdCache</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-model"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#dynamic-model"></a>2.10. Dynamic Model</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPA only acknowledges the entity model mapping so, if you are concerned about JPA provider portability, itâ€™s best to stick to the strict POJO model.
On the other hand, Hibernate can work with both POJO entities as well as with dynamic entity models.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="mapping-model-dynamic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-model-dynamic"></a>2.10.1. Dynamic mapping models</h4>
<div class="paragraph">
<p>Persistent entities do not necessarily have to be represented as POJO/JavaBean classes.
Hibernate also supports dynamic models (using <code>Map</code> of <code>Maps</code> at runtime).
With this approach, you do not write persistent classes, only mapping files.</p>
</div>
<div class="paragraph">
<p>A given entity has just one entity mode within a given SessionFactory.
This is a change from previous versions which allowed to define multiple entity modes for an entity and to select which to load.
Entity modes can now be mixed within a domain model; a dynamic entity might reference a POJO entity and vice versa.</p>
</div>
<div id="mapping-model-dynamic-example" class="exampleblock">
<div class="title">Example 251. Dynamic domain model Hibernate mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="dec">&lt;!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span><span class="pln">

</span><span class="tag">&lt;hibernate-mapping&gt;</span><span class="pln">
    </span><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">entity-name</span><span class="pun">=</span><span class="atv">"Book"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;id</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"isbn"</span><span class="pln"> </span><span class="atn">column</span><span class="pun">=</span><span class="atv">"isbn"</span><span class="pln"> </span><span class="atn">length</span><span class="pun">=</span><span class="atv">"32"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="tag">/&gt;</span><span class="pln">

        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"title"</span><span class="pln"> </span><span class="atn">not-null</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="atn">length</span><span class="pun">=</span><span class="atv">"50"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="tag">/&gt;</span><span class="pln">

        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"author"</span><span class="pln"> </span><span class="atn">not-null</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="atn">length</span><span class="pun">=</span><span class="atv">"50"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="tag">/&gt;</span><span class="pln">

    </span><span class="tag">&lt;/class&gt;</span><span class="pln">
</span><span class="tag">&lt;/hibernate-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After you defined your entity mapping, you need to instruct Hibernate to use the dynamic mapping mode:</p>
</div>
<div id="mapping-model-dynamic-setting-example" class="exampleblock">
<div class="title">Example 252. Dynamic domain model Hibernate mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">settings</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"hibernate.default_entity_mode"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"dynamic-map"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you are going to save the following <code>Book</code> dynamic entity,
Hibernate is going to generate the following SQL statement:</p>
</div>
<div id="mapping-model-dynamic-persist-example" class="exampleblock">
<div class="title">Example 253. Persist dynamic entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"isbn"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"978-9730228236"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"title"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">,</span><span class="pln"> book </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Book</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">title</span><span class="pun">,</span><span class="pln"> author</span><span class="pun">,</span><span class="pln"> isbn</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pln"> </span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">978</span><span class="pun">-</span><span class="lit">9730228236</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of dynamic models is the quick turnaround time for prototyping without the need for entity class implementation.
The main downfall is that you lose compile-time type checking and will likely deal with many exceptions at runtime.
However, as a result of the Hibernate mapping, the database schema can easily be normalized and sound, allowing to add a proper domain model implementation on top later on.</p>
</div>
<div class="paragraph">
<p>It is also interesting to note that dynamic models are great for certain integration use cases as well.
Envers, for example, makes extensive use of dynamic models to represent the historical data.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-inheritance"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance"></a>2.11. Inheritance</h3>
<div class="paragraph">
<p>Although relational database systems donâ€™t provide support for inheritance, Hibernate provides several strategies to leverage this object-oriented trait onto domain model entities:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MappedSuperclass</dt>
<dd>
<p>Inheritance is implemented in the domain model only without reflecting it in the database schema. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-mapped-superclass">MappedSuperclass</a>.</p>
</dd>
<dt class="hdlist1">Single table</dt>
<dd>
<p>The domain model class hierarchy is materialized into a single table which contains entities belonging to different class types. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-single-table">Single table</a>.</p>
</dd>
<dt class="hdlist1">Joined table</dt>
<dd>
<p>The base class and all the subclasses have their own database tables and fetching a subclass entity requires a join with the parent table as well. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-joined-table">Joined table</a>.</p>
</dd>
<dt class="hdlist1">Table per class</dt>
<dd>
<p>Each subclass has its own table containing both the subclass and the base class properties. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-table-per-class">Table per class</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="entity-inheritance-mapped-superclass"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-mapped-superclass"></a>2.11.1. MappedSuperclass</h4>
<div class="paragraph">
<p>In the following domain model class hierarchy, a <code>DebitAccount</code> and a <code>CreditAccount</code> share the same <code>Account</code> base class.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/inheritance_class_diagram.svg" alt="Inheritance class diagram"></span></p>
</div>
<div class="paragraph">
<p>When using <code>MappedSuperclass</code>, the inheritance is visible in the domain model only, and each database table contains both the base class and the subclass properties.</p>
</div>
<div id="entity-inheritance-mapped-superclass-example" class="exampleblock">
<div class="title">Example 254. <code>@MappedSuperclass</code> inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@MappedSuperclass</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the <code>@MappedSuperclass</code> inheritance model is not mirrored at the database level,
itâ€™s not possible to use polymorphic queries (fetching subclasses by their base class).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-single-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-single-table"></a>2.11.2. Single table</h4>
<div class="paragraph">
<p>The single table inheritance strategy maps all subclasses to only one database table.
Each subclass declares its own persistent properties.
Version and id properties are assumed to be inherited from the root class.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When omitting an explicit inheritance strategy (e.g. <code>@Inheritance</code>), JPA will choose the <code>SINGLE_TABLE</code> strategy by default.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="entity-inheritance-single-table-example" class="exampleblock">
<div class="title">Example 255. Single Table inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">SINGLE_TABLE</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    DTYPE VARCHAR</span><span class="pun">(</span><span class="lit">31</span><span class="pun">)</span><span class="pln"> NOT NULL </span><span class="pun">,</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each subclass in a hierarchy must define a unique discriminator value, which is used to differentiate between rows belonging to separate subclass types.
If this is not specified, the <code>DTYPE</code> column is used as a discriminator, storing the associated subclass name.</p>
</div>
<div id="entity-inheritance-single-table-persist-example" class="exampleblock">
<div class="title">Example 256. Single Table inheritance discriminator column</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DebitAccount</span><span class="pln"> debitAccount </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pun">();</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setBalance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setInterestRate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.5d</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setOverdraftFee</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">25</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CreditAccount</span><span class="pln"> creditAccount </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pun">();</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setBalance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setInterestRate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.9d</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setCreditLimit</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> debitAccount </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> creditAccount </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> overdraftFee</span><span class="pun">,</span><span class="pln"> DTYPE</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.5</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">25</span><span class="pun">,</span><span class="pln"> </span><span class="str">'DebitAccount'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> creditLimit</span><span class="pun">,</span><span class="pln"> DTYPE</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1000</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.9</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5000</span><span class="pun">,</span><span class="pln"> </span><span class="str">'CreditAccount'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, only a single table is required to be scanned to fetch all associated subclass instances.</p>
</div>
<div id="entity-inheritance-single-table-query-example" class="exampleblock">
<div class="title">Example 257. Single Table polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select a from Account a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">SELECT  singletabl0_</span><span class="pun">.</span><span class="pln">id AS id2_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">balance AS balance3_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">interestRate AS interest4_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">owner AS owner5_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">overdraftFee AS overdraf6_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">creditLimit AS creditLi7_0_ </span><span class="pun">,</span><span class="pln">
        singletabl0_</span><span class="pun">.</span><span class="pln">DTYPE AS DTYPE1_0_
FROM    </span><span class="typ">Account</span><span class="pln"> singletabl0_</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Among all other inheritance alternatives, the single table strategy performs the best since it requires access to one table only.
Because all subclass columns are stored in a single table, itâ€™s not possible to use NOT NULL constraints anymore, so integrity checks must be moved either into the data access layer or enforced through <code>CHECK</code> or <code>TRIGGER</code> constraints.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="entity-inheritance-discriminator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator"></a>Discriminator</h5>
<div class="paragraph">
<p>The discriminator column contains marker values that tell the persistence layer what subclass to instantiate for a particular row.
Hibernate Core supports the following restricted set of types as discriminator column: <code>String</code>, <code>char</code>, <code>int</code>, <code>byte</code>, <code>short</code>, <code>boolean</code>(including <code>yes_no</code>, <code>true_false</code>).</p>
</div>
<div class="paragraph">
<p>Use the <code>@DiscriminatorColumn</code> to define the discriminator column as well as the discriminator type.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The enum <code>DiscriminatorType</code> used in <code>javax.persistence.DiscriminatorColumn</code> only contains the values <code>STRING</code>, <code>CHAR</code> and <code>INTEGER</code> which means that not all Hibernate supported types are available via the <code>@DiscriminatorColumn</code> annotation.
You can also use <code>@DiscriminatorFormula</code> to express in SQL a virtual discriminator column.
This is particularly useful when the discriminator value can be extracted from one or more columns of the table.
Both <code>@DiscriminatorColumn</code> and <code>@DiscriminatorFormula</code> are to be set on the root entity (once per persisted hierarchy).</p>
</div>
<div class="paragraph">
<p><code>@org.hibernate.annotations.DiscriminatorOptions</code> allows to optionally specify Hibernate specific discriminator options which are not standardized in JPA.
The available options are <code>force</code> and <code>insert</code>.</p>
</div>
<div class="paragraph">
<p>The <code>force</code> attribute is useful if the table contains rows with <em>extra</em> discriminator values that are not mapped to a persistent class.
This could, for example, occur when working with a legacy database.
If <code>force</code> is set to true Hibernate will specify the allowed discriminator values in the SELECT query, even when retrieving all instances of the root class.</p>
</div>
<div class="paragraph">
<p>The second option, <code>insert</code>, tells Hibernate whether or not to include the discriminator column in SQL INSERTs.
Usually, the column should be part of the INSERT statement, but if your discriminator column is also part of a mapped composite identifier you have to set this option to false.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There used to be <code>@org.hibernate.annotations.ForceDiscriminator</code> annotation which was deprecated in version 3.6 and later removed. Use <code>@DiscriminatorOptions</code> instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="entity-inheritance-discriminator-formula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator-formula"></a>Discriminator formula</h6>
<div class="paragraph">
<p>Assuming a legacy database schema where the discriminator is based on inspecting a certain column,
we can take advantage of the Hibernate specific <code>@DiscriminatorFormula</code> annotation and map the inheritance model as follows:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-formula-example" class="exampleblock">
<div class="title">Example 258. Single Table discriminator formula</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">SINGLE_TABLE</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorFormula</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"case when debitKey is not null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"then 'Debit' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"else ( "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   case when creditKey is not null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   then 'Credit' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   else 'Unknown' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   end ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"end "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Debit"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> debitKey</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Credit"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> creditKey</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id int8 NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    debitKey VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    creditKey VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>@DiscriminatorFormula</code> defines a custom SQL clause that can be used to identify a certain subclass type.
The <code>@DiscriminatorValue</code> defines the mapping between the result of the <code>@DiscriminatorFormula</code> and the inheritance subclass type.</p>
</div>
</div>
<div class="sect5">
<h6 id="entity-inheritance-discriminator-implicit"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator-implicit"></a>Implicit discriminator values</h6>
<div class="paragraph">
<p>Aside from the usual discriminator values assigned to each individual subclass type, the <code>@DiscriminatorValue</code> can take two additional values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>null</code></dt>
<dd>
<p>If the underlying discriminator column is null, the <code>null</code> discriminator mapping is going to be used.</p>
</dd>
<dt class="hdlist1"><code>not null</code></dt>
<dd>
<p>If the underlying discriminator column has a not-null value that is not explicitly mapped to any entity, the <code>not-null</code> discriminator mapping used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To understand how these two values work, consider the following entity mapping:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-value-example" class="exampleblock">
<div class="title">Example 259. @DiscriminatorValue <code>null</code> and <code>not-null</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">SINGLE_TABLE</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"null"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Debit"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Credit"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"OtherAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DiscriminatorValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"not null"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">OtherAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> active</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Account</code> class has a <code>@DiscriminatorValue( "null" )</code> mapping, meaning that any <code>account</code> row which does not contain any discriminator value will be mapped to an <code>Account</code> base class entity.
The <code>DebitAccount</code> and <code>CreditAccount</code> entities use explicit discriminator values.
The <code>OtherAccount</code> entity is used as a generic account type because it maps any database row whose discriminator column is not explicitly assigned to any other entity in the current inheritance tree.</p>
</div>
<div class="paragraph">
<p>To visualize how it works, consider the following example:</p>
</div>
<div id="entity-inheritance-single-table-discriminator-value-persist-example" class="exampleblock">
<div class="title">Example 260. @DiscriminatorValue <code>null</code> and <code>not-null</code> entity persistence</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DebitAccount</span><span class="pln"> debitAccount </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pun">();</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setBalance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setInterestRate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.5d</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
debitAccount</span><span class="pun">.</span><span class="pln">setOverdraftFee</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">25</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CreditAccount</span><span class="pln"> creditAccount </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pun">();</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setBalance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setInterestRate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.9d</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
creditAccount</span><span class="pun">.</span><span class="pln">setCreditLimit</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Account</span><span class="pln"> account </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">();</span><span class="pln">
account</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
account</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
account</span><span class="pun">.</span><span class="pln">setBalance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
account</span><span class="pun">.</span><span class="pln">setInterestRate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1.9d</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> debitAccount </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> creditAccount </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> account </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">doWork</span><span class="pun">(</span><span class="pln"> connection </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">try</span><span class="pun">(</span><span class="typ">Statement</span><span class="pln"> statement </span><span class="pun">=</span><span class="pln"> connection</span><span class="pun">.</span><span class="pln">createStatement</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
			</span><span class="str">"insert into Account (DTYPE, active, balance, interestRate, owner, id) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
			</span><span class="str">"values ('Other', true, 25, 0.5, 'Vlad', 4)"</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select a from Account a"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">toMap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">::</span><span class="pln">getId</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Function</span><span class="pun">.</span><span class="pln">identity</span><span class="pun">()));</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Account</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3L</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">OtherAccount</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">4L</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> overdraftFee</span><span class="pun">,</span><span class="pln"> DTYPE</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.5</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">25</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Debit'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> overdraftFee</span><span class="pun">,</span><span class="pln"> DTYPE</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1000</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.9</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5000</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Credit'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="lit">1000</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.9</span><span class="pun">,</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">DTYPE</span><span class="pun">,</span><span class="pln"> active</span><span class="pun">,</span><span class="pln"> balance</span><span class="pun">,</span><span class="pln"> interestRate</span><span class="pun">,</span><span class="pln"> owner</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'Other'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="lit">25</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.5</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Vlad'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln">

SELECT a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id2_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">balance </span><span class="kwd">as</span><span class="pln"> balance3_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">interestRate </span><span class="kwd">as</span><span class="pln"> interest4_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">owner </span><span class="kwd">as</span><span class="pln"> owner5_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">overdraftFee </span><span class="kwd">as</span><span class="pln"> overdraf6_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">creditLimit </span><span class="kwd">as</span><span class="pln"> creditLi7_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">active </span><span class="kwd">as</span><span class="pln"> active8_0_</span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">DTYPE </span><span class="kwd">as</span><span class="pln"> DTYPE1_0_
FROM   </span><span class="typ">Account</span><span class="pln"> a</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>Account</code> entity row has a value of <code>NULL</code> in the <code>DTYPE</code> discriminator column,
while the <code>OtherAccount</code> entity was saved with a <code>DTYPE</code> column value of <code>other</code> which has not explicit mapping.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-joined-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-joined-table"></a>2.11.3. Joined table</h4>
<div class="paragraph">
<p>Each subclass can also be mapped to its own table.
This is also called <em>table-per-subclass</em> mapping strategy.
An inherited state is retrieved by joining with the table of the superclass.</p>
</div>
<div class="paragraph">
<p>A discriminator column is not required for this mapping strategy.
Each subclass must, however, declare a table column holding the object identifier.</p>
</div>
<div id="entity-inheritance-joined-table-example" class="exampleblock">
<div class="title">Example 261. Join Table</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">JOINED</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">CreditAccount</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKihw8h3j1k0w31cnyu7jcl7n7n</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Account</span><span class="pln">

ALTER TABLE </span><span class="typ">DebitAccount</span><span class="pln">
ADD CONSTRAINT </span><span class="typ">FKia914478noepymc468kiaivqm</span><span class="pln">
FOREIGN KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Account</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The primary key of this table is also a foreign key to the superclass table and described by the <code>@PrimaryKeyJoinColumns</code>.</p>
</div>
<div class="paragraph">
<p>The table name still defaults to the non-qualified class name.
Also, if <code>@PrimaryKeyJoinColumn</code> is not set, the primary key / foreign key columns are assumed to have the same names as the primary key columns of the primary table of the superclass.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="entity-inheritance-joined-table-primary-key-join-column-example" class="exampleblock">
<div class="title">Example 262. Join Table with <code>@PrimaryKeyJoinColumn</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">JOINED</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@PrimaryKeyJoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_id"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@PrimaryKeyJoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"account_id"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    account_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> account_id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    account_id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> account_id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

ALTER TABLE </span><span class="typ">CreditAccount</span><span class="pln">
ADD CONSTRAINT FK8ulmk1wgs5x7igo370jt0q005
FOREIGN KEY </span><span class="pun">(</span><span class="pln">account_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Account</span><span class="pln">

ALTER TABLE </span><span class="typ">DebitAccount</span><span class="pln">
ADD CONSTRAINT FK7wjufa570onoidv4omkkru06j
FOREIGN KEY </span><span class="pun">(</span><span class="pln">account_id</span><span class="pun">)</span><span class="pln"> REFERENCES </span><span class="typ">Account</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, the base class table must be joined with all subclass tables to fetch every associated subclass instance.</p>
</div>
<div id="entity-inheritance-joined-table-query-example" class="exampleblock">
<div class="title">Example 263. Join Table polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select a from Account a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">SELECT jointablet0_</span><span class="pun">.</span><span class="pln">id AS id1_0_ </span><span class="pun">,</span><span class="pln">
       jointablet0_</span><span class="pun">.</span><span class="pln">balance AS balance2_0_ </span><span class="pun">,</span><span class="pln">
       jointablet0_</span><span class="pun">.</span><span class="pln">interestRate AS interest3_0_ </span><span class="pun">,</span><span class="pln">
       jointablet0_</span><span class="pun">.</span><span class="pln">owner AS owner4_0_ </span><span class="pun">,</span><span class="pln">
       jointablet0_1_</span><span class="pun">.</span><span class="pln">overdraftFee AS overdraf1_2_ </span><span class="pun">,</span><span class="pln">
       jointablet0_2_</span><span class="pun">.</span><span class="pln">creditLimit AS creditLi1_1_ </span><span class="pun">,</span><span class="pln">
       CASE WHEN jointablet0_1_</span><span class="pun">.</span><span class="pln">id IS NOT NULL THEN </span><span class="lit">1</span><span class="pln">
            WHEN jointablet0_2_</span><span class="pun">.</span><span class="pln">id IS NOT NULL THEN </span><span class="lit">2</span><span class="pln">
            WHEN jointablet0_</span><span class="pun">.</span><span class="pln">id IS NOT NULL THEN </span><span class="lit">0</span><span class="pln">
       </span><span class="kwd">END</span><span class="pln"> AS clazz_
FROM   </span><span class="typ">Account</span><span class="pln"> jointablet0_
       LEFT OUTER JOIN </span><span class="typ">DebitAccount</span><span class="pln"> jointablet0_1_ ON jointablet0_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> jointablet0_1_</span><span class="pun">.</span><span class="pln">id
       LEFT OUTER JOIN </span><span class="typ">CreditAccount</span><span class="pln"> jointablet0_2_ ON jointablet0_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> jointablet0_2_</span><span class="pun">.</span><span class="pln">id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The joined table inheritance polymorphic queries can use several JOINS which might affect performance when fetching a large number of entities.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-table-per-class"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-table-per-class"></a>2.11.4. Table per class</h4>
<div class="paragraph">
<p>A third option is to map only the concrete classes of an inheritance hierarchy to tables.
This is called the table-per-concrete-class strategy.
Each table defines all persistent states of the class, including the inherited state.</p>
</div>
<div class="paragraph">
<p>In Hibernate, it is not necessary to explicitly map such inheritance hierarchies.
You can map each class as a separate entity root.
However, if you wish use polymorphic associations (e.g. an association to the superclass of your hierarchy), you need to use the union subclass mapping.</p>
</div>
<div id="entity-inheritance-table-per-class-example" class="exampleblock">
<div class="title">Example 264. Table per class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Account"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">TABLE_PER_CLASS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> balance</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> interestRate</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"DebitAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> overdraftFee</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CreditAccount"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> creditLimit</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">CREATE TABLE </span><span class="typ">Account</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">CreditAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    creditLimit NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

CREATE TABLE </span><span class="typ">DebitAccount</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id BIGINT NOT NULL </span><span class="pun">,</span><span class="pln">
    balance NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    interestRate NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    owner VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    overdraftFee NUMERIC</span><span class="pun">(</span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">,</span><span class="pln">
    PRIMARY KEY </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using polymorphic queries, a UNION is required to fetch the base class table along with all subclass tables as well.</p>
</div>
<div class="exampleblock">
<div class="title">Example 265. Table per class polymorphic query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Account</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select a from Account a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pln">SELECT tablepercl0_</span><span class="pun">.</span><span class="pln">id AS id1_0_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">balance AS balance2_0_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">interestRate AS interest3_0_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">owner AS owner4_0_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">overdraftFee AS overdraf1_2_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">creditLimit AS creditLi1_1_ </span><span class="pun">,</span><span class="pln">
       tablepercl0_</span><span class="pun">.</span><span class="pln">clazz_ AS clazz_
FROM </span><span class="pun">(</span><span class="pln">
    SELECT    id </span><span class="pun">,</span><span class="pln">
             balance </span><span class="pun">,</span><span class="pln">
             interestRate </span><span class="pun">,</span><span class="pln">
             owner </span><span class="pun">,</span><span class="pln">
             CAST</span><span class="pun">(</span><span class="pln">NULL AS INT</span><span class="pun">)</span><span class="pln"> AS overdraftFee </span><span class="pun">,</span><span class="pln">
             CAST</span><span class="pun">(</span><span class="pln">NULL AS INT</span><span class="pun">)</span><span class="pln"> AS creditLimit </span><span class="pun">,</span><span class="pln">
             </span><span class="lit">0</span><span class="pln"> AS clazz_
    FROM     </span><span class="typ">Account</span><span class="pln">
    UNION ALL
    SELECT   id </span><span class="pun">,</span><span class="pln">
             balance </span><span class="pun">,</span><span class="pln">
             interestRate </span><span class="pun">,</span><span class="pln">
             owner </span><span class="pun">,</span><span class="pln">
             overdraftFee </span><span class="pun">,</span><span class="pln">
             CAST</span><span class="pun">(</span><span class="pln">NULL AS INT</span><span class="pun">)</span><span class="pln"> AS creditLimit </span><span class="pun">,</span><span class="pln">
             </span><span class="lit">1</span><span class="pln"> AS clazz_
    FROM     </span><span class="typ">DebitAccount</span><span class="pln">
    UNION ALL
    SELECT   id </span><span class="pun">,</span><span class="pln">
             balance </span><span class="pun">,</span><span class="pln">
             interestRate </span><span class="pun">,</span><span class="pln">
             owner </span><span class="pun">,</span><span class="pln">
             CAST</span><span class="pun">(</span><span class="pln">NULL AS INT</span><span class="pun">)</span><span class="pln"> AS overdraftFee </span><span class="pun">,</span><span class="pln">
             creditLimit </span><span class="pun">,</span><span class="pln">
             </span><span class="lit">2</span><span class="pln"> AS clazz_
    FROM     </span><span class="typ">CreditAccount</span><span class="pln">
</span><span class="pun">)</span><span class="pln"> tablepercl0_</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Polymorphic queries require multiple UNION queries, so be aware of the performance implications of a large class hierarchy.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-polymorphism"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-polymorphism"></a>2.11.5. Implicit and explicit polymorphism</h4>
<div class="paragraph">
<p>By default, when you query a base class entity,
the polymorphic query will fetch all subclasses belonging to the base type.</p>
</div>
<div class="paragraph">
<p>However, you can even query
<strong>interfaces or base classes that donâ€™t belong to the JPA entity inheritance model</strong>.</p>
</div>
<div class="paragraph">
<p>For instance, considering the following <code>DomainModelEntity</code> interface:</p>
</div>
<div id="entity-inheritance-polymorphism-interface-example" class="exampleblock">
<div class="title">Example 266. Domain Model Entity interface</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">DomainModelEntity</span><span class="pun">&lt;</span><span class="pln">ID</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    ID getId</span><span class="pun">();</span><span class="pln">

    </span><span class="typ">Integer</span><span class="pln"> getVersion</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we have two entity mappings, a <code>Book</code> and a <code>Blog</code>,
and the <code>Book</code> entity is mapped with the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Polymorphism.html"><code>@Polymorphism</code></a> annotation
and taking the <code>PolymorphismType.EXPLICIT</code> setting:</p>
</div>
<div id="entity-inheritance-polymorphism-mapping-example" class="exampleblock">
<div class="title">Example 267. <code>@Polymorphism</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DomainModelEntity</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Blog"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Polymorphism</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PolymorphismType</span><span class="pun">.</span><span class="pln">EXPLICIT</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Blog</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DomainModelEntity</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> site</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we have the following entity objects in our system:</p>
</div>
<div id="entity-inheritance-polymorphism-persist-example" class="exampleblock">
<div class="title">Example 268. Domain Model entity objects</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Blog</span><span class="pln"> blog </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Blog</span><span class="pun">();</span><span class="pln">
blog</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
blog</span><span class="pun">.</span><span class="pln">setSite</span><span class="pun">(</span><span class="pln"> </span><span class="str">"vladmihalcea.com"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> blog </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can now query against the <code>DomainModelEntity</code> interface,
and Hibernate is going to fetch only the entities that are either mapped with
<code>@Polymorphism(type = PolymorphismType.IMPLICIT)</code>
or they are not annotated at all with the <code>@Polymorphism</code> annotation (implying the IMPLICIT behavior):</p>
</div>
<div id="entity-inheritance-polymorphism-fetch-example" class="exampleblock">
<div class="title">Example 269. Fetching Domain Model entities using non-mapped base class polymorphism</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">DomainModelEntity</span><span class="pun">&gt;</span><span class="pln"> accounts </span><span class="pun">=</span><span class="pln"> entityManager
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from org.hibernate.userguide.inheritance.polymorphism.DomainModelEntity e"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> accounts</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Therefore, only the <code>Book</code> was fetched since the <code>Blog</code> entity was marked with the
<code>@Polymorphism(type = PolymorphismType.EXPLICIT)</code> annotation, which instructs Hibernate
to skip it when executing a polymorphic query against a non-mapped base class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-immutability"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-immutability"></a>2.12. Immutability</h3>
<div class="paragraph">
<p>Immutability can be specified for both entities and collections.</p>
</div>
<div class="sect3">
<h4 id="_entity_immutability"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_entity_immutability"></a>2.12.1. Entity immutability</h4>
<div class="paragraph">
<p>If a specific entity is immutable, it is good practice to mark it with the <code>@Immutable</code> annotation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 270. Immutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Internally, Hibernate is going to perform several optimizations, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>reducing memory footprint since there is no need to retain the dehydrated state for the dirty checking mechanism</p>
</li>
<li>
<p>speeding-up the Persistence Context flushing phase since immutable entities can skip the dirty checking process</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering the following entity is persisted in the database:</p>
</div>
<div class="exampleblock">
<div class="title">Example 271. Persisting an immutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setCreatedOn</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setMessage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Hibernate User Guide rocks!"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When loading the entity and trying to change its state,
Hibernate will skip any modification, therefore no SQL <code>UPDATE</code> statement is executed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 272. The immutable entity ignores any update</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Change event message"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setMessage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Hibernate User Guide"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="str">"Hibernate User Guide rocks!"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT e</span><span class="pun">.</span><span class="pln">id AS id1_0_0_</span><span class="pun">,</span><span class="pln">
       e</span><span class="pun">.</span><span class="pln">createdOn AS createdO2_0_0_</span><span class="pun">,</span><span class="pln">
       e</span><span class="pun">.</span><span class="pln">message AS message3_0_0_
FROM   </span><span class="kwd">event</span><span class="pln"> e
WHERE  e</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Change</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> message

SELECT e</span><span class="pun">.</span><span class="pln">id AS id1_0_0_</span><span class="pun">,</span><span class="pln">
       e</span><span class="pun">.</span><span class="pln">createdOn AS createdO2_0_0_</span><span class="pun">,</span><span class="pln">
       e</span><span class="pun">.</span><span class="pln">message AS message3_0_0_
FROM   </span><span class="kwd">event</span><span class="pln"> e
WHERE  e</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_collection_immutability"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_collection_immutability"></a>2.12.2. Collection immutability</h4>
<div class="paragraph">
<p>Just like entities, collections can also be marked with the <code>@Immutable</code> annotation.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mappings:</p>
</div>
<div class="exampleblock">
<div class="title">Example 273. Immutable collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Batch"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Batch</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Immutable</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Event</span><span class="pun">&gt;</span><span class="pln"> events </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, not only the <code>Event</code> entity is immutable, but the <code>Event</code> collection stored by the <code>Batch</code> parent entity.
Once the immutable collection is created, it can never be modified.</p>
</div>
<div class="exampleblock">
<div class="title">Example 274. Persisting an immutable collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Batch</span><span class="pln"> batch </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Batch</span><span class="pun">();</span><span class="pln">
	batch</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	batch</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Change request"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Event</span><span class="pln"> event1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">();</span><span class="pln">
	event1</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	event1</span><span class="pun">.</span><span class="pln">setCreatedOn</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	event1</span><span class="pun">.</span><span class="pln">setMessage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Update Hibernate User Guide"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Event</span><span class="pln"> event2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">();</span><span class="pln">
	event2</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	event2</span><span class="pun">.</span><span class="pln">setCreatedOn</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	event2</span><span class="pun">.</span><span class="pln">setMessage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Update Hibernate Getting Started Guide"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	batch</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> event1 </span><span class="pun">);</span><span class="pln">
	batch</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> event2 </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> batch </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Batch</code> entity is mutable. Only the <code>events</code> collection is immutable.</p>
</div>
<div class="paragraph">
<p>For instance, we can still modify the entity name:</p>
</div>
<div class="exampleblock">
<div class="title">Example 275. Changing the mutable entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Batch</span><span class="pln"> batch </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Batch</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Change batch name"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	batch</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Proposed change request"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT b</span><span class="pun">.</span><span class="pln">id AS id1_0_0_</span><span class="pun">,</span><span class="pln">
       b</span><span class="pun">.</span><span class="pln">name AS name2_0_0_
FROM   </span><span class="typ">Batch</span><span class="pln"> b
WHERE  b</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Change</span><span class="pln"> batch name

UPDATE batch
SET    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Proposed change request'</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, when trying to modify the <code>events</code> collection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 276. Immutable collections cannot be modified</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Batch</span><span class="pln"> batch </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Batch</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		batch</span><span class="pun">.</span><span class="pln">getEvents</span><span class="pun">().</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Immutable collections cannot be modified"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-bash" data-lang="bash"><span class="pln">javax</span><span class="pun">.</span><span class="pln">persistence</span><span class="pun">.</span><span class="typ">RollbackException</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Error</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> committing the transaction

</span><span class="typ">Caused</span><span class="pln"> by</span><span class="pun">:</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">persistence</span><span class="pun">.</span><span class="typ">PersistenceException</span><span class="pun">:</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="typ">HibernateException</span><span class="pun">:</span><span class="pln">

</span><span class="typ">Caused</span><span class="pln"> by</span><span class="pun">:</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="typ">HibernateException</span><span class="pun">:</span><span class="pln"> changed an immutable collection instance</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">userguide</span><span class="pun">.</span><span class="pln">immutability</span><span class="pun">.</span><span class="typ">CollectionImmutabilityTest$Batch</span><span class="pun">.</span><span class="pln">events</span><span class="com">#1</span><span class="pln">
</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While immutable entity changes are simply discarded, modifying an immutable collection end up in a <code>HibernateException</code> being thrown.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrap"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap"></a>3. Bootstrap</h2>
<div class="sectionbody">
<div class="paragraph">
<p>org.hibernate.boot.spi.metadatabuildercontributor;</p>
</div>
<div class="paragraph">
<p>The term bootstrapping refers to initializing and starting a software component.
In Hibernate, we are specifically talking about the process of building a fully functional <code>SessionFactory</code> instance or <code>EntityManagerFactory</code> instance, for JPA.
The process is very different for each.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This chapter will not focus on all the possibilities of bootstrapping.
Those will be covered in each specific more-relevant chapters later on.
Instead, we focus here on the API calls needed to perform the bootstrapping.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>During the bootstrap process, you might want to customize Hibernate behavior so make sure you check the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations">Configurations</a> section as well.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="bootstrap-native"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-native"></a>3.1. Native Bootstrapping</h3>
<div class="paragraph">
<p>This section discusses the process of bootstrapping a Hibernate <code>SessionFactory</code>.
Specifically, it addresses the bootstrapping APIs as redesigned in 5.0.
For a discussion of the legacy bootstrapping API, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-bootstrap">Legacy Bootstrapping</a></p>
</div>
<div class="sect3">
<h4 id="bootstrap-native-registry"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-native-registry"></a>3.1.1. Building the ServiceRegistry</h4>
<div class="paragraph">
<p>The first step in native bootstrapping is the building of a <code>ServiceRegistry</code> holding the services Hibernate will need during bootstrapping and at run time.</p>
</div>
<div class="paragraph">
<p>Actually, we are concerned with building 2 different ServiceRegistries.
First is the <code>org.hibernate.boot.registry.BootstrapServiceRegistry</code>.
The <code>BootstrapServiceRegistry</code> is intended to hold services that Hibernate needs at both bootstrap and run time.
This boils down to 3 services:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.boot.registry.classloading.spi.ClassLoaderService</code></dt>
<dd>
<p>which controls how Hibernate interacts with `ClassLoader`s</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.integrator.spi.IntegratorService</code></dt>
<dd>
<p>which controls the management and discovery of <code>org.hibernate.integrator.spi.Integrator</code> instances.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.boot.registry.selector.spi.StrategySelector</code></dt>
<dd>
<p>which control how Hibernate resolves implementations of various strategy contracts.
This is a very powerful service, but a full discussion of it is beyond the scope of this guide.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are ok with the default behavior of Hibernate in regards to these <code>BootstrapServiceRegistry</code> services
(which is quite often the case, especially in stand-alone environments), then building the <code>BootstrapServiceRegistry</code> can be skipped.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you wish to alter how the <code>BootstrapServiceRegistry</code> is built, that is controlled through the <code>org.hibernate.boot.registry.BootstrapServiceRegistryBuilder:</code></p>
</div>
<div id="bootstrap-bootstrap-native-registry-BootstrapServiceRegistry-example" class="exampleblock">
<div class="title">Example 277. Controlling <code>BootstrapServiceRegistry</code> building</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">BootstrapServiceRegistryBuilder</span><span class="pln"> bootstrapRegistryBuilder </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BootstrapServiceRegistryBuilder</span><span class="pun">();</span><span class="pln">
</span><span class="com">// add a custom ClassLoader</span><span class="pln">
bootstrapRegistryBuilder</span><span class="pun">.</span><span class="pln">applyClassLoader</span><span class="pun">(</span><span class="pln"> customClassLoader </span><span class="pun">);</span><span class="pln">
</span><span class="com">// manually add an Integrator</span><span class="pln">
bootstrapRegistryBuilder</span><span class="pun">.</span><span class="pln">applyIntegrator</span><span class="pun">(</span><span class="pln"> customIntegrator </span><span class="pun">);</span><span class="pln">

</span><span class="typ">BootstrapServiceRegistry</span><span class="pln"> bootstrapRegistry </span><span class="pun">=</span><span class="pln"> bootstrapRegistryBuilder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The services of the <code>BootstrapServiceRegistry</code> cannot be extended (added to) nor overridden (replaced).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The second ServiceRegistry is the <code>org.hibernate.boot.registry.StandardServiceRegistry</code>.
You will almost always need to configure the <code>StandardServiceRegistry</code>, which is done through <code>org.hibernate.boot.registry.StandardServiceRegistryBuilder</code>:</p>
</div>
<div id="bootstrap-bootstrap-native-registry-StandardServiceRegistryBuilder-example" class="exampleblock">
<div class="title">Example 278. Building a <code>BootstrapServiceRegistryBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// An example using an implicitly built BootstrapServiceRegistry</span><span class="pln">
</span><span class="typ">StandardServiceRegistryBuilder</span><span class="pln"> standardRegistryBuilder </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="com">// An example using an explicitly built BootstrapServiceRegistry</span><span class="pln">
</span><span class="typ">BootstrapServiceRegistry</span><span class="pln"> bootstrapRegistry </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BootstrapServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">StandardServiceRegistryBuilder</span><span class="pln"> standardRegistryBuilder </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">(</span><span class="pln"> bootstrapRegistry </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>StandardServiceRegistry</code> is also highly configurable via the StandardServiceRegistryBuilder API.
See the <code>StandardServiceRegistryBuilder</code> <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/registry/StandardServiceRegistryBuilder.html">Javadocs</a> for more details.</p>
</div>
<div class="paragraph">
<p>Some specific methods of interest:</p>
</div>
<div id="bootstrap-bootstrap-native-registry-MetadataSources-example" class="exampleblock">
<div class="title">Example 279. Configuring a <code>MetadataSources</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MetadataSources</span><span class="pln"> sources </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">);</span><span class="pln">

</span><span class="com">// alternatively, we can build the MetadataSources without passing</span><span class="pln">
</span><span class="com">// a service registry, in which case it will build a default</span><span class="pln">
</span><span class="com">// BootstrapServiceRegistry to use.  But the approach shown</span><span class="pln">
</span><span class="com">// above is preferred</span><span class="pln">
</span><span class="com">// MetadataSources sources = new MetadataSources();</span><span class="pln">

</span><span class="com">// add a class using JPA/Hibernate annotations for mapping</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// add the name of a class using JPA/Hibernate annotations for mapping.</span><span class="pln">
</span><span class="com">// differs from above in that accessing the Class is deferred which is</span><span class="pln">
</span><span class="com">// important if using runtime bytecode-enhancement</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addAnnotatedClassName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.example.Customer"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read package-level metadata.</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addPackage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"hibernate.example"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read package-level metadata.</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addPackage</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getPackage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Adds the named hbm.xml resource as a source: which performs the</span><span class="pln">
</span><span class="com">// classpath lookup and parses the XML</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Order.hbm.xml"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Adds the named JPA orm.xml resource as a source: which performs the</span><span class="pln">
</span><span class="com">// classpath lookup and parses the XML</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Product.orm.xml"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read all mapping documents from a directory tree.</span><span class="pln">
</span><span class="com">// Assumes that any file named *.hbm.xml is a mapping document.</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addDirectory</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln"> </span><span class="str">"."</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read mappings from a particular XML file</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addFile</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln"> </span><span class="str">"./mapping.xml"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read all mappings from a jar file.</span><span class="pln">
</span><span class="com">// Assumes that any file named *.hbm.xml is a mapping document.</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addJar</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln"> </span><span class="str">"./entities.jar"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Read a mapping as an application resource using the convention that a class named foo.bar.MyEntity is</span><span class="pln">
</span><span class="com">// mapped by a file named foo/bar/MyEntity.hbm.xml which can be resolved as a classpath resource.</span><span class="pln">
sources</span><span class="pun">.</span><span class="pln">addClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-event-listener-registration"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-event-listener-registration"></a>3.1.2. Event Listener registration</h4>
<div class="paragraph">
<p>The main use cases for an <code>org.hibernate.integrator.spi.Integrator</code> right now are registering event listeners and providing services (see <code>org.hibernate.integrator.spi.ServiceContributingIntegrator</code>).
With 5.0 we plan on expanding that to allow altering the metamodel describing the mapping between object and relational models.</p>
</div>
<div id="bootstrap-event-listener-registration-example" class="exampleblock">
<div class="title">Example 280. Configuring an event listener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyIntegrator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">integrator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="typ">Integrator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> integrate</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">Metadata</span><span class="pln"> metadata</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">SessionFactoryImplementor</span><span class="pln"> sessionFactory</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">SessionFactoryServiceRegistry</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="com">// As you might expect, an EventListenerRegistry is the thing with which event</span><span class="pln">
        </span><span class="com">// listeners are registered</span><span class="pln">
        </span><span class="com">// It is a service so we look it up using the service registry</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">EventListenerRegistry</span><span class="pln"> eventListenerRegistry </span><span class="pun">=</span><span class="pln">
            serviceRegistry</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventListenerRegistry</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="com">// If you wish to have custom determination and handling of "duplicate" listeners,</span><span class="pln">
        </span><span class="com">// you would have to add an implementation of the</span><span class="pln">
        </span><span class="com">// org.hibernate.event.service.spi.DuplicationStrategy contract like this</span><span class="pln">
        eventListenerRegistry</span><span class="pun">.</span><span class="pln">addDuplicationStrategy</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomDuplicationStrategy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="com">// EventListenerRegistry defines 3 ways to register listeners:</span><span class="pln">

        </span><span class="com">// 1) This form overrides any existing registrations with</span><span class="pln">
        eventListenerRegistry</span><span class="pun">.</span><span class="pln">setListeners</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">AUTO_FLUSH</span><span class="pun">,</span><span class="pln">
                                            </span><span class="typ">DefaultAutoFlushEventListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="com">// 2) This form adds the specified listener(s) to the beginning of the listener chain</span><span class="pln">
        eventListenerRegistry</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">PERSIST</span><span class="pun">,</span><span class="pln">
                                                </span><span class="typ">DefaultPersistEventListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="com">// 3) This form adds the specified listener(s) to the end of the listener chain</span><span class="pln">
        eventListenerRegistry</span><span class="pun">.</span><span class="pln">appendListeners</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">MERGE</span><span class="pun">,</span><span class="pln">
                                               </span><span class="typ">DefaultMergeEventListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> disintegrate</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">SessionFactoryImplementor</span><span class="pln"> sessionFactory</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">SessionFactoryServiceRegistry</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-native-metadata"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-native-metadata"></a>3.1.3. Building the Metadata</h4>
<div class="paragraph">
<p>The second step in native bootstrapping is the building of an <code>org.hibernate.boot.Metadata</code> object containing the parsed representations of an application domain model and its mapping to a database.
The first thing we obviously need to build a parsed representation is the source information to be parsed (annotated classes, <code>hbm.xml</code> files, <code>orm.xml</code> files).
This is the purpose of <code>org.hibernate.boot.MetadataSources</code>:</p>
</div>
<div class="paragraph">
<p><code>MetadataSources</code> has many other methods as well, explore its API and <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/MetadataSources.html">Javadocs</a> for more information.
Also, all methods on <code>MetadataSources</code> offer fluent-style call chaining::</p>
</div>
<div id="bootstrap-native-metadata-source-example" class="exampleblock">
<div class="title">Example 281. Configuring a <code>MetadataSources</code> with method chaining</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MetadataSources</span><span class="pln"> sources </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClassName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.example.Customer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Order.hbm.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Product.orm.xml"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once we have the sources of mapping information defined, we need to build the <code>Metadata</code> object.
If you are ok with the default behavior in building the Metadata then you can simply call the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/MetadataSources.html#buildMetadata--"><code>buildMetadata</code></a> method of the <code>MetadataSources</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice that a <code>ServiceRegistry</code> can be passed at a number of points in this bootstrapping process.
The suggested approach is to build a <code>StandardServiceRegistry</code> yourself and pass that along to the <code>MetadataSources</code> constructor.
From there, <code>MetadataBuilder</code>, <code>Metadata</code>, <code>SessionFactoryBuilder</code>, and <code>SessionFactory</code> will all pick up that same <code>StandardServiceRegistry</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>However, if you wish to adjust the process of building <code>Metadata</code> from <code>MetadataSources</code>,
you will need to use the <code>MetadataBuilder</code> as obtained via <code>MetadataSources#getMetadataBuilder</code>.
<code>MetadataBuilder</code> allows a lot of control over the <code>Metadata</code> building process.
See its <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/MetadataBuilder.html">Javadocs</a> for full details.</p>
</div>
<div id="bootstrap-native-metadata-builder-example" class="exampleblock">
<div class="title">Example 282. Building Metadata via <code>MetadataBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MetadataSources</span><span class="pln"> sources </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">);</span><span class="pln">

</span><span class="typ">MetadataBuilder</span><span class="pln"> metadataBuilder </span><span class="pun">=</span><span class="pln"> sources</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Use the JPA-compliant implicit naming strategy</span><span class="pln">
metadataBuilder</span><span class="pun">.</span><span class="pln">applyImplicitNamingStrategy</span><span class="pun">(</span><span class="pln">
    </span><span class="typ">ImplicitNamingStrategyJpaCompliantImpl</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">);</span><span class="pln">

</span><span class="com">// specify the schema name to use for tables, etc when none is explicitly specified</span><span class="pln">
metadataBuilder</span><span class="pun">.</span><span class="pln">applyImplicitSchemaName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"my_default_schema"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// specify a custom Attribute Converter</span><span class="pln">
metadataBuilder</span><span class="pun">.</span><span class="pln">applyAttributeConverter</span><span class="pun">(</span><span class="pln"> myAttributeConverter </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> metadataBuilder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-native-SessionFactory"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-native-SessionFactory"></a>3.1.4. Building the SessionFactory</h4>
<div class="paragraph">
<p>The final step in native bootstrapping is to build the <code>SessionFactory</code> itself.
Much like discussed above, if you are ok with the default behavior of building a <code>SessionFactory</code> from a <code>Metadata</code> reference, you can simply call the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/Metadata.html#buildSessionFactory--"><code>buildSessionFactory</code></a> method on the <code>Metadata</code> object.</p>
</div>
<div class="paragraph">
<p>However, if you would like to adjust that building process, you will need to use <code>SessionFactoryBuilder</code> as obtained via [<code>Metadata#getSessionFactoryBuilder</code>. Again, see its <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/Metadata.html#getSessionFactoryBuilder--">Javadocs</a> for more details.</p>
</div>
<div id="bootstrap-native-SessionFactory-example" class="exampleblock">
<div class="title">Example 283. Native Bootstrapping - Putting it all together</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StandardServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/hibernate.cfg.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClassName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.example.Customer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Order.hbm.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Product.orm.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">applyImplicitNamingStrategy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ImplicitNamingStrategyJpaCompliantImpl</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> metadata</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">applyBeanManager</span><span class="pun">(</span><span class="pln"> getBeanManager</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The bootstrapping API is quite flexible, but in most cases it makes the most sense to think of it as a 3 step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build the <code>StandardServiceRegistry</code></p>
</li>
<li>
<p>Build the <code>Metadata</code></p>
</li>
<li>
<p>Use those 2 to build the <code>SessionFactory</code></p>
</li>
</ol>
</div>
<div id="bootstrap-native-SessionFactoryBuilder-example" class="exampleblock">
<div class="title">Example 284. Building <code>SessionFactory</code> via <code>SessionFactoryBuilder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StandardServiceRegistry</span><span class="pln"> standardRegistry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/hibernate.cfg.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> standardRegistry </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MyEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClassName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.example.Customer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Order.hbm.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org/hibernate/example/Product.orm.xml"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">applyImplicitNamingStrategy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ImplicitNamingStrategyJpaCompliantImpl</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">SessionFactoryBuilder</span><span class="pln"> sessionFactoryBuilder </span><span class="pun">=</span><span class="pln"> metadata</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Supply a SessionFactory-level Interceptor</span><span class="pln">
sessionFactoryBuilder</span><span class="pun">.</span><span class="pln">applyInterceptor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomSessionFactoryInterceptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Add a custom observer</span><span class="pln">
sessionFactoryBuilder</span><span class="pun">.</span><span class="pln">addSessionFactoryObservers</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomSessionFactoryObserver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Apply a CDI BeanManager ( for JPA event listeners )</span><span class="pln">
sessionFactoryBuilder</span><span class="pun">.</span><span class="pln">applyBeanManager</span><span class="pun">(</span><span class="pln"> getBeanManager</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> sessionFactoryBuilder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrap-jpa"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa"></a>3.2. JPA Bootstrapping</h3>
<div class="paragraph">
<p>Bootstrapping Hibernate as a JPA provider can be done in a JPA-spec compliant manner or using a proprietary bootstrapping approach.
The standardized approach has some limitations in certain environments, but aside from those, it is <strong>highly</strong> recommended that you use JPA-standardized bootstrapping.</p>
</div>
<div class="sect3">
<h4 id="bootstrap-jpa-compliant"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant"></a>3.2.1. JPA-compliant bootstrapping</h4>
<div class="paragraph">
<p>In JPA, we are ultimately interested in bootstrapping a <code>javax.persistence.EntityManagerFactory</code> instance.
The JPA specification defines two primary standardized bootstrap approaches depending on how the application intends to access the <code>javax.persistence.EntityManager</code> instances from an <code>EntityManagerFactory</code>.</p>
</div>
<div class="paragraph">
<p>It uses the terms <em>EE</em> and <em>SE</em> for these two approaches, but those terms are very misleading in this context.
What the JPA spec calls EE bootstrapping implies the existence of a container (EE, OSGi, etc), whoâ€™ll manage and inject the persistence context on behalf of the application.
What it calls SE bootstrapping is everything else. We will use the terms container-bootstrapping and application-bootstrapping in this guide.</p>
</div>
<div class="paragraph">
<p>For compliant container-bootstrapping, the container will build an <code>EntityManagerFactory</code> for each persistent-unit defined in the <code>META-INF/persistence.xml</code> configuration file
and make that available to the application for injection via the <code>javax.persistence.PersistenceUnit</code> annotation or via JNDI lookup.</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceUnit-example" class="exampleblock">
<div class="title">Example 285. Injecting the default <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@PersistenceUnit</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span class="pln"> emf</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or, in case you have multiple Persistence Units (e.g. multiple <code>persistence.xml</code> configuration files),
you can inject a specific <code>EntityManagerFactory</code> by Unit name:</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceUnit-configurable-example" class="exampleblock">
<div class="title">Example 286. Injecting a specific <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@PersistenceUnit</span><span class="pun">(</span><span class="pln">
    unitName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CRM"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span class="pln"> entityManagerFactory</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>META-INF/persistence.xml</code> file looks as follows:</p>
</div>
<div id="bootstrap-jpa-compliant-persistence-xml-example" class="exampleblock">
<div class="title">Example 287. META-INF/persistence.xml configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="tag">&lt;persistence</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence"</span><span class="pln">
             </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
             </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"</span><span class="pln">
             </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.1"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;persistence-unit</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CRM"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;description&gt;</span><span class="pln">
            Persistence unit for Hibernate User Guide
        </span><span class="tag">&lt;/description&gt;</span><span class="pln">

        </span><span class="tag">&lt;provider&gt;</span><span class="pln">org.hibernate.jpa.HibernatePersistenceProvider</span><span class="tag">&lt;/provider&gt;</span><span class="pln">

        </span><span class="tag">&lt;class&gt;</span><span class="pln">org.hibernate.documentation.userguide.Document</span><span class="tag">&lt;/class&gt;</span><span class="pln">

        </span><span class="tag">&lt;properties&gt;</span><span class="pln">
            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.driver"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.h2.Driver"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.url"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1;MVCC=TRUE"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.user"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"sa"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.password"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.show_sql"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hbm2ddl.auto"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"update"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/properties&gt;</span><span class="pln">

    </span><span class="tag">&lt;/persistence-unit&gt;</span><span class="pln">

</span><span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For compliant application-bootstrapping, rather than the container building the <code>EntityManagerFactory</code> for the application, the application builds the <code>EntityManagerFactory</code> itself using the <code>javax.persistence.Persistence</code> bootstrap class.
The application creates an <code>EntityManagerFactory</code> by calling the <code>createEntityManagerFactory</code> method:</p>
</div>
<div id="bootstrap-jpa-compliant-EntityManagerFactory-example" class="exampleblock">
<div class="title">Example 288. Application bootstrapped <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// Create an EMF for our CRM persistence-unit.</span><span class="pln">
</span><span class="typ">EntityManagerFactory</span><span class="pln"> emf </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">.</span><span class="pln">createEntityManagerFactory</span><span class="pun">(</span><span class="pln"> </span><span class="str">"CRM"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you donâ€™t want to provide a <code>persistence.xml</code> configuration file, JPA allows you to provide all the configuration options in a
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/spi/PersistenceUnitInfo.html"><code>PersistenceUnitInfo</code></a> implementation and call
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/HibernatePersistenceProvider.html#createContainerEntityManagerFactory-javax.persistence.spi.PersistenceUnitInfo-java.util.Map-"><code>HibernatePersistenceProvider.html#createContainerEntityManagerFactory</code></a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To inject the default Persistence Context, you can use the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceContext.html"><code>@PersistenceContext</code></a> annotation.</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceContext-example" class="exampleblock">
<div class="title">Example 289. Inject the default <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@PersistenceContext</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> em</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To inject a specific Persistence Context,
you can use the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceContext.html"><code>@PersistenceContext</code></a> annotation,
and you can even pass <code>EntityManager</code>-specific properties using the
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceProperty.html"><code>@PersistenceProperty</code></a> annotation.</p>
</div>
<div id="bootstrap-jpa-compliant-PersistenceContext-configurable-example" class="exampleblock">
<div class="title">Example 290. Inject a configurable <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@PersistenceContext</span><span class="pun">(</span><span class="pln">
    unitName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CRM"</span><span class="pun">,</span><span class="pln">
    properties </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">@PersistenceProperty</span><span class="pun">(</span><span class="pln">
            name</span><span class="pun">=</span><span class="str">"org.hibernate.flushMode"</span><span class="pun">,</span><span class="pln">
            value</span><span class="pun">=</span><span class="pln"> </span><span class="str">"MANUAL"</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> entityManager</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you would like additional details on accessing and using <code>EntityManager</code> instances, sections 7.6 and 7.7 of the JPA 2.1 specification cover container-managed and application-managed <code>EntityManagers</code>, respectively.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-jpa-xml-files"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-xml-files"></a>3.2.2. Externalizing XML mapping files</h4>
<div class="paragraph">
<p>JPA offers two mapping options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotations</p>
</li>
<li>
<p>XML mappings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although annotations are much more common, there are projects where XML mappings are preferred.
You can even mix annotations and XML mappings so that you can override annotation mappings with XML configurations that can be easily changed without recompiling the project source code.
This is possible because if there are two conflicting mappings, the XML mappings take precedence over its annotation counterpart.</p>
</div>
<div class="paragraph">
<p>The JPA specification requires the XML mappings to be located on the classpath:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An object/relational mapping XML file named <code>orm.xml</code> may be specified in the <code>META-INF</code> directory in the root of the persistence unit or in the <code>META-INF</code> directory of any jar file referenced by the <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, or in addition, one or more mapping files may be referenced by the mapping-file elements of the persistence-unit element. These mapping files may be present anywhere on the classpath.</p>
</div>
</blockquote>
<div class="attribution">
â€” Section 8.2.1.6.2 of the JPA 2.1 Specification
</div>
</div>
<div class="paragraph">
<p>Therefore, the mapping files can reside in the application jar artifacts, or they can be stored in an external folder location with the cogitation that that location be included in the classpath.</p>
</div>
<div class="paragraph">
<p>Hibernate is more lenient in this regard so you can use any external location even outside of the application configured classpath.</p>
</div>
<div id="bootstrap-jpa-compliant-persistence-xml-external-mappings-example" class="exampleblock">
<div class="title">Example 291. META-INF/persistence.xml configuration file for external XML mappings</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="tag">&lt;persistence</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence"</span><span class="pln">
             </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
             </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"</span><span class="pln">
             </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.1"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;persistence-unit</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CRM"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;description&gt;</span><span class="pln">
            Persistence unit for Hibernate User Guide
        </span><span class="tag">&lt;/description&gt;</span><span class="pln">

        </span><span class="tag">&lt;provider&gt;</span><span class="pln">org.hibernate.jpa.HibernatePersistenceProvider</span><span class="tag">&lt;/provider&gt;</span><span class="pln">

        </span><span class="tag">&lt;mapping-file&gt;</span><span class="pln">file:///etc/opt/app/mappings/orm.xml</span><span class="tag">&lt;/mapping-file&gt;</span><span class="pln">

        </span><span class="tag">&lt;properties&gt;</span><span class="pln">
            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.driver"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.h2.Driver"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.url"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1;MVCC=TRUE"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.user"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"sa"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.jdbc.password"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.show_sql"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

            </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hbm2ddl.auto"</span><span class="pln">
                      </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"update"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/properties&gt;</span><span class="pln">

    </span><span class="tag">&lt;/persistence-unit&gt;</span><span class="pln">

</span><span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the <code>persistence.xml</code> configuration file above, the <code>orm.xml</code> XML file containing all JPA entity mappings is located in the <code>/etc/opt/app/mappings/</code> folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="bootstrap-jpa-metadata"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-metadata"></a>3.2.3. Configuring the <code>SessionFactory</code> <code>Metadata</code> via the JPA bootstrap</h4>
<div class="paragraph">
<p>As previously seen, the Hibernate native bootstrap mechanism allows you to customize a great variety of configurations which are passed via the <code>Metadata</code> object.</p>
</div>
<div class="paragraph">
<p>When using Hibernate as a JPA provider, the <code>EntityManagerFactory</code> is backed by a <code>SessionFactory</code>. For this reason, you might still want to use the <code>Metadata</code> object to pass various settings which cannot be supplied via the standard Hibernate <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendices/Configurations.adoc">configuration settings</a>.</p>
</div>
<div class="paragraph">
<p>For this reason, you can use the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/spi/MetadataBuilderContributor.html"><code>MetadataBuilderContributor</code></a> class as you can see in the following examples.</p>
</div>
<div id="bootstrap-jpa-compliant-MetadataBuilderContributor-example" class="exampleblock">
<div class="title">Example 292. Implementing a <code>MetadataBuilderContributor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SqlFunctionMetadataBuilderContributor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MetadataBuilderContributor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> contribute</span><span class="pun">(</span><span class="typ">MetadataBuilder</span><span class="pln"> metadataBuilder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        metadataBuilder</span><span class="pun">.</span><span class="pln">applySqlFunction</span><span class="pun">(</span><span class="pln">
            </span><span class="str">"instr"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardSQLFunction</span><span class="pun">(</span><span class="pln"> </span><span class="str">"instr"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StandardBasicTypes</span><span class="pun">.</span><span class="pln">STRING </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above <code>MetadataBuilderContributor</code> is used to register a <code>SqlFuction</code> which is not defined by the currently running Hibernate <code>Dialect</code>, but which we need to reference in our JPQL queries.</p>
</div>
<div class="paragraph">
<p>By having access to the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/MetadataBuilder.html"><code>MetadataBuilder</code></a> class thatâ€™s used by the underlying <code>SessionFactory</code>, the JPA bootstrap becomes just as flexible as the Hibernate native bootstrap mechanism.</p>
</div>
<div class="paragraph">
<p>You can then pass the custom <code>MetadataBuilderContributor</code> via the <code>hibernate.metadata_builder_contributor</code> configuration property as explained in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-bootstrap">configuration chapter</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="schema-generation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation"></a>4. Schema generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate allows you to generate the database from the entity mappings.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the automatic schema generation is very useful for testing and prototyping purposes, in a production environment,
itâ€™s much more flexible to manage the schema using incremental migration scripts.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Traditionally, the process of generating  schema from entity mapping has been called <code>HBM2DDL</code>.
To get a list of Hibernate-native and JPA-specific configuration properties consider reading the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-hbmddl">Configurations</a> section.</p>
</div>
<div class="paragraph">
<p>Considering the following Domain Model:</p>
</div>
<div id="schema-generation-domain-model-example" class="exampleblock">
<div class="title">Example 293. Schema generation Domain Model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Basic</span><span class="pun">(</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> UUID accountsPayableXrefId</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Lob</span><span class="pln">
	</span><span class="lit">@Basic</span><span class="pun">(</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@LazyGroup</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lobs"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Blob</span><span class="pln"> image</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>hibernate.hbm2ddl.auto</code> configuration is set to <code>create</code>, Hibernate is going to generate the following database schema:</p>
</div>
<div id="sql-schema-generation-domain-model-example" class="exampleblock">
<div class="title">Example 294. Auto-generated database schema</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    accountsPayableXrefId binary</span><span class="pun">,</span><span class="pln">
    image blob</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    isbn varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    author_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Book</span><span class="pln">
    add constraint UK_u31e1frmjp9mxf8k8tmp990i unique </span><span class="pun">(</span><span class="pln">isbn</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Book</span><span class="pln">
    add constraint </span><span class="typ">FKrxrgiajod1le3gii8whx2doie</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">author_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-script-files"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-script-files"></a>4.1. Importing script files</h3>
<div class="paragraph">
<p>To customize the schema generation process, the <code>hibernate.hbm2ddl.import_files</code> configuration property must be used to provide other scripts files that Hibernate can use when the <code>SessionFactory</code> is started.</p>
</div>
<div class="paragraph">
<p>For instance, considering the following <code>schema-generation.sql</code> import file:</p>
</div>
<div id="schema-generation-import-file-example" class="exampleblock">
<div class="title">Example 295. Schema generation import file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">create sequence book_sequence start </span><span class="kwd">with</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> increment </span><span class="kwd">by</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If we configure Hibernate to import the script above:</p>
</div>
<div id="schema-generation-import-file-configuration-example" class="exampleblock">
<div class="title">Example 296. Enabling query cache</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hbm2ddl.import_files"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"schema-generation.sql"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is going to execute the script file after the schema is automatically generated.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-database-objects"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-database-objects"></a>4.2. Database objects</h3>
<div class="paragraph">
<p>Hibernate allows you to customize the schema generation process via the HBM <code>database-object</code> element.</p>
</div>
<div class="paragraph">
<p>Considering the following HBM mapping:</p>
</div>
<div id="schema-generation-database-object-example" class="exampleblock">
<div class="title">Example 297. Schema generation HBM database-object</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="dec">&lt;!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" &gt;</span><span class="pln">

</span><span class="tag">&lt;hibernate-mapping&gt;</span><span class="pln">
    </span><span class="tag">&lt;database-object&gt;</span><span class="pln">
        </span><span class="tag">&lt;create&gt;</span><span class="pln">
            CREATE OR REPLACE FUNCTION sp_count_books(
                IN authorId bigint,
                OUT bookCount bigint)
                RETURNS bigint AS
            $BODY$
                BEGIN
                    SELECT COUNT(*) INTO bookCount
                    FROM book
                    WHERE author_id = authorId;
                END;
            $BODY$
            LANGUAGE plpgsql;
        </span><span class="tag">&lt;/create&gt;</span><span class="pln">
        </span><span class="tag">&lt;drop&gt;&lt;/drop&gt;</span><span class="pln">
        </span><span class="tag">&lt;dialect-scope</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"org.hibernate.dialect.PostgreSQL95Dialect"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/database-object&gt;</span><span class="pln">
</span><span class="tag">&lt;/hibernate-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When the <code>SessionFactory</code> is bootstrapped, Hibernate is going to execute the <code>database-object</code>, therefore creating the <code>sp_count_books</code> function.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-database-checks"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-database-checks"></a>4.3. Database-level checks</h3>
<div class="paragraph">
<p>Hibernate offers the <code>@Check</code> annotation so that you can specify an arbitrary SQL CHECK constraint which can be defined as follows:</p>
</div>
<div id="schema-generation-database-checks-example" class="exampleblock">
<div class="title">Example 298. Database check entity mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Check</span><span class="pun">(</span><span class="pln"> constraints </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CASE WHEN isbn IS NOT NULL THEN LENGTH(isbn) = 13 ELSE true END"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Double</span><span class="pln"> price</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, if you try to add a <code>Book</code> entity with an <code>isbn</code> attribute whose length is not 13 characters,
a <code>ConstraintViolationException</code> is going to be thrown.</p>
</div>
<div id="stag::schema-generation-database-checks-persist-example" class="exampleblock">
<div class="title">Example 299. Database check failure example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setPrice</span><span class="pun">(</span><span class="pln"> </span><span class="lit">49.99d</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setIsbn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"11-11-2016"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT  INTO </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isbn</span><span class="pun">,</span><span class="pln"> price</span><span class="pun">,</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES  </span><span class="pun">(</span><span class="str">'11-11-2016'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">49.99</span><span class="pun">,</span><span class="pln"> </span><span class="str">'High-Performance Java Persistence'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> WARN </span><span class="typ">SqlExceptionHelper</span><span class="pun">:</span><span class="lit">129</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> SQL </span><span class="typ">Error</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SQLState</span><span class="pun">:</span><span class="pln"> </span><span class="lit">23514</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> ERROR </span><span class="typ">SqlExceptionHelper</span><span class="pun">:</span><span class="lit">131</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> ERROR</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> row </span><span class="kwd">for</span><span class="pln"> relation </span><span class="str">"book"</span><span class="pln"> violates check constraint </span><span class="str">"book_isbn_check"</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-column-default-value"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-column-default-value"></a>4.4. Default value for a database column</h3>
<div class="paragraph">
<p>With Hibernate, you can specify a default value for a given database column using the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ColumnDefault.html"><code>@ColumnDefault</code></a> annotation.</p>
</div>
<div id="schema-generation-column-default-value-mapping-example" class="exampleblock">
<div class="title">Example 300. <code>@ColumnDefault</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DynamicInsert</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ColumnDefault</span><span class="pun">(</span><span class="str">"'N/A'"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ColumnDefault</span><span class="pun">(</span><span class="str">"-1"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> clientId</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CREATE TABLE </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
  id BIGINT NOT NULL</span><span class="pun">,</span><span class="pln">
  clientId BIGINT DEFAULT </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln">
  name VARCHAR</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT </span><span class="str">'N/A'</span><span class="pun">,</span><span class="pln">
  PRIMARY KEY </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the mapping above, both the <code>name</code> and <code>clientId</code> table columns are going to use a <code>DEFAULT</code> value.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The entity is annotated with the <code>@DynamicInsert</code> annotation so that the <code>INSERT</code> statement does not include the entity attribute that have not been set.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This way, when omitting the <code>name</code> and the <code>clientId</code> attribute, the database is going to set them according to their default values.</p>
</div>
<div id="schema-generation-column-default-value-persist-example" class="exampleblock">
<div class="title">Example 301. <code>@ColumnDefault</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"N/A"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1L</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getClientId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(?)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-columns-unique-constraint"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-columns-unique-constraint"></a>4.5. Columns unique constraint</h3>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/UniqueConstraint.html"><code>@UniqueConstraint</code></a> annotation is used to specify a unique constraint to be included by the automated schema generator for the primary or secondary table associated with the current annotated entity.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mapping, Hibernate generates the unique constraint DDL when creating the database schema:</p>
</div>
<div id="schema-generation-columns-unique-constraint-mapping-example" class="exampleblock">
<div class="title">Example 302. <code>@UniqueConstraint</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"book"</span><span class="pun">,</span><span class="pln">
    uniqueConstraints </span><span class="pun">=</span><span class="pln">  </span><span class="lit">@UniqueConstraint</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"uk_book_title_author"</span><span class="pun">,</span><span class="pln">
        columnNames </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="str">"title"</span><span class="pun">,</span><span class="pln">
            </span><span class="str">"author_id"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author_id"</span><span class="pun">,</span><span class="pln">
        foreignKey </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ForeignKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"fk_book_author_id"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"first_name"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"last_name"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table author </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    first_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    last_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table book </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    title varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    author_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table book
   add constraint uk_book_title_author
   unique </span><span class="pun">(</span><span class="pln">title</span><span class="pun">,</span><span class="pln"> author_id</span><span class="pun">)</span><span class="pln">

alter table book
   add constraint fk_book_author_id
   foreign key </span><span class="pun">(</span><span class="pln">author_id</span><span class="pun">)</span><span class="pln">
   references author</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>uk_book_title_author</code> unique constraint in place,
itâ€™s no longer possible to add two books with the same title and for the same author.</p>
</div>
<div id="schema-generation-columns-unique-constraint-persist-example" class="exampleblock">
<div class="title">Example 303. <code>@UniqueConstraintTest</code> persist example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">     </span><span class="typ">Author</span><span class="pln"> _author </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         </span><span class="typ">Author</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Author</span><span class="pun">();</span><span class="pln">
         author</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
         author</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
         entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> author </span><span class="pun">);</span><span class="pln">

         </span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
         book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
         book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> author </span><span class="pun">);</span><span class="pln">
         entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">

         </span><span class="kwd">return</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">
     </span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

     </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> _author </span><span class="pun">);</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">
     </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> expected</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         assertNotNull</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ExceptionUtil</span><span class="pun">.</span><span class="pln">findCause</span><span class="pun">(</span><span class="pln"> expected</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintViolationException</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
     </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    author
    </span><span class="pun">(</span><span class="pln">first_name</span><span class="pun">,</span><span class="pln"> last_name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    book
    </span><span class="pun">(</span><span class="pln">author_id</span><span class="pun">,</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    book
    </span><span class="pun">(</span><span class="pln">author_id</span><span class="pun">,</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> SQL </span><span class="typ">Error</span><span class="pun">:</span><span class="pln"> </span><span class="lit">23505</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SQLState</span><span class="pun">:</span><span class="pln"> </span><span class="lit">23505</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Unique</span><span class="pln"> index </span><span class="kwd">or</span><span class="pln"> primary key violation</span><span class="pun">:</span><span class="pln"> </span><span class="str">"UK_BOOK_TITLE_AUTHOR_INDEX_1 ON PUBLIC.BOOK(TITLE, AUTHOR_ID) VALUES ( /* key:1 */ 3, 'High-Performance Java Persistence', 1)"</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The second INSERT statement fails because of the unique constraint violation.</p>
</div>
</div>
<div class="sect2">
<h3 id="schema-generation-columns-index"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-columns-index"></a>4.6. Columns index</h3>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Index.html"><code>@Index</code></a> annotation is used by the automated schema generation tool to create a database index.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mapping, Hibernate generates the index when creating the database schema:</p>
</div>
<div id="schema-generation-columns-index-mapping-example" class="exampleblock">
<div class="title">Example 304. <code>@Index</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">,</span><span class="pln">
    indexes </span><span class="pun">=</span><span class="pln">  </span><span class="lit">@Index</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"idx_author_first_last_name"</span><span class="pun">,</span><span class="pln">
        columnList </span><span class="pun">=</span><span class="pln"> </span><span class="str">"first_name, last_name"</span><span class="pun">,</span><span class="pln">
        unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Author</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"first_name"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"last_name"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getter and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table author </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    first_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    last_name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create index idx_author_first_last_name
    on author </span><span class="pun">(</span><span class="pln">first_name</span><span class="pun">,</span><span class="pln"> last_name</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pc"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc"></a>5. Persistence Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both the <code>org.hibernate.Session</code> API and <code>javax.persistence.EntityManager</code> API represent a context for dealing with persistent data.
This concept is called a <code>persistence context</code>.
Persistent data has a state in relation to both a persistence context and the underlying database.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>transient</code></dt>
<dd>
<p>the entity has just been instantiated and is not associated with a persistence context.
It has no persistent representation in the database and typically no identifier value has been assigned (unless the <em>assigned</em> generator was used).</p>
</dd>
<dt class="hdlist1"><code>managed</code>, or <code>persistent</code></dt>
<dd>
<p>the entity has an associated identifier and is associated with a persistence context.
It may or may not physically exist in the database yet.</p>
</dd>
<dt class="hdlist1"><code>detached</code></dt>
<dd>
<p>the entity has an associated identifier but is no longer associated with a persistence context (usually because the persistence context was closed or the instance was evicted from the context)</p>
</dd>
<dt class="hdlist1"><code>removed</code></dt>
<dd>
<p>the entity has an associated identifier and is associated with a persistence context, however, it is scheduled for removal from the database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Much of the <code>org.hibernate.Session</code> and <code>javax.persistence.EntityManager</code> methods deal with moving entities between these states.</p>
</div>
<div class="sect2">
<h3 id="pc-unwrap"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-unwrap"></a>5.1. Accessing Hibernate APIs from JPA</h3>
<div class="paragraph">
<p>JPA defines an incredibly useful method to allow applications access to the APIs of the underlying provider.</p>
</div>
<div id="pc-unwrap-example" class="exampleblock">
<div class="title">Example 305. Accessing Hibernate APIs from JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">SessionImplementor</span><span class="pln"> sessionImplementor </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionImplementor</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getEntityManagerFactory</span><span class="pun">().</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BytecodeEnhancement"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement"></a>5.2. Bytecode Enhancement</h3>
<div class="paragraph">
<p>Hibernate "grew up" not supporting bytecode enhancement at all.
At that time, Hibernate only supported proxy-based for lazy loading and always used diff-based dirty calculation.
Hibernate 3.x saw the first attempts at bytecode enhancement support in Hibernate.
We consider those initial attempts (up until 5.0) completely as an incubation.
The support for bytecode enhancement in 5.0 onward is what we are discussing here.</p>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-capabilities"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-capabilities"></a>5.2.1. Capabilities</h4>
<div class="paragraph">
<p>Hibernate supports the enhancement of an application Java domain model for the purpose of adding various persistence-related capabilities directly into the class.</p>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-lazy-loading"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-lazy-loading"></a>Lazy attribute loading</h5>
<div class="paragraph">
<p>Think of this as partial loading support.
Essentially, you can tell Hibernate that only part(s) of an entity should be loaded upon fetching from the database and when the other part(s) should be loaded as well.
Note that this is very much different from the proxy-based idea of lazy loading which is entity-centric where the entityâ€™s state is loaded at once as needed.
With bytecode enhancement, individual attributes or groups of attributes are loaded as needed.</p>
</div>
<div class="paragraph">
<p>Lazy attributes can be designated to be loaded together, and this is called a "lazy group".
By default, all singular attributes are part of a single group, meaning that when one lazy singular attribute is accessed all lazy singular attributes are loaded.
Lazy plural attributes, by default, are each a lazy group by themselves.
This behavior is explicitly controllable through the <code>@org.hibernate.annotations.LazyGroup</code> annotation.</p>
</div>
<div id="BytecodeEnhancement-lazy-loading-example" class="exampleblock">
<div class="title">Example 306. <code>@LazyGroup</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Basic</span><span class="pun">(</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> UUID accountsPayableXrefId</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Lob</span><span class="pln">
	</span><span class="lit">@Basic</span><span class="pun">(</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@LazyGroup</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lobs"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Blob</span><span class="pln"> image</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example, we have 2 lazy attributes: <code>accountsPayableXrefId</code> and <code>image</code>.
Each is part of a different fetch group (accountsPayableXrefId is part of the default fetch group),
which means that accessing <code>accountsPayableXrefId</code> will not force the loading of the <code>image</code> attribute, and vice-versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a hopefully temporary legacy hold-over, it is currently required that all lazy singular associations (many-to-one and one-to-one) also include <code>@LazyToOne(LazyToOneOption.NO_PROXY)</code>.
The plan is to relax that requirement later.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-dirty-tracking"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-dirty-tracking"></a>In-line dirty tracking</h5>
<div class="paragraph">
<p>Historically Hibernate only supported diff-based dirty calculation for determining which entities in a persistence context have changed.
This essentially means that Hibernate would keep track of the last known state of an entity in regards to the database (typically the last read or write).
Then, as part of flushing the persistence context, Hibernate would walk every entity associated with the persistence context and check its current state against that "last known database state".
This is by far the most thorough approach to dirty checking because it accounts for data-types that can change their internal state (<code>java.util.Date</code> is the prime example of this).
However, in a persistence context with a large number of associated entities, it can also be a performance-inhibiting approach.</p>
</div>
<div class="paragraph">
<p>If your application does not need to care about "internal state changing data-type" use cases, bytecode-enhanced dirty tracking might be a worthwhile alternative to consider, especially in terms of performance.
In this approach Hibernate will manipulate the bytecode of your classes to add "dirty tracking" directly to the entity, allowing the entity itself to keep track of which of its attributes have changed.
During the flush time, Hibernate asks your entity what has changed rather than having to perform the state-diff calculations.</p>
</div>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-dirty-tracking-bidirectional"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-dirty-tracking-bidirectional"></a>Bidirectional association management</h5>
<div class="paragraph">
<p>Hibernate strives to keep your application as close to "normal Java usage" (idiomatic Java) as possible.
Consider a domain model with a normal <code>Person</code>/<code>Book</code> bidirectional association:</p>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-example" class="exampleblock">
<div class="title">Example 307. Bidirectional association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-incorrect-usage-example" class="exampleblock">
<div class="title">Example 308. Incorrect normal Java usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">getAuthor</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">NullPointerException</span><span class="pln"> expected</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// This blows up ( NPE ) in normal Java usage</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This blows up in normal Java usage. The correct normal Java usage is:</p>
</div>
<div id="BytecodeEnhancement-dirty-tracking-bidirectional-correct-usage-example" class="exampleblock">
<div class="title">Example 309. Correct normal Java usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

book</span><span class="pun">.</span><span class="pln">getAuthor</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bytecode-enhanced bi-directional association management makes that first example work by managing the "other side" of a bi-directional association whenever one side is manipulated.</p>
</div>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-dirty-tracking-optimizations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-dirty-tracking-optimizations"></a>Internal performance optimizations</h5>
<div class="paragraph">
<p>Additionally, we use the enhancement process to add some additional code that allows us to optimized certain performance characteristics of the persistence context.
These are hard to discuss without diving into a discussion of Hibernate internals.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BytecodeEnhancement-enhancement"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-enhancement"></a>5.2.2. Performing enhancement</h4>
<div class="sect4">
<h5 id="BytecodeEnhancement-enhancement-runtime"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-enhancement-runtime"></a>Runtime enhancement</h5>
<div class="paragraph">
<p>Currently, runtime enhancement of the domain model is only supported in managed JPA environments following the JPA-defined SPI for performing class transformations.</p>
</div>
<div class="paragraph">
<p>Even then, this support is disabled by default. To enable runtime enhancement, specify one of the following configuration properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableDirtyTracking</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable dirty tracking feature in runtime bytecode enhancement.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableLazyInitialization</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable lazy loading feature in runtime bytecode enhancement. This way, even basic types (e.g. <code>@Basic(fetch = FetchType.LAZY</code>)) can be fetched lazily.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableAssociationManagement</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable association management feature in runtime bytecode enhancement which automatically synchronizes a bidirectional association when only one side is changed.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Also, at the moment, only annotated classes are supported for runtime enhancement.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-enhancement-gradle"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-enhancement-gradle"></a>Gradle plugin</h5>
<div class="paragraph">
<p>Hibernate provides a Gradle plugin that is capable of providing build-time enhancement of the domain model as they are compiled as part of a Gradle build.
To use the plugin, a project would first need to apply it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 310. Apply the Gradle plugin</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-gradle" data-lang="gradle"><span class="pln">ext </span><span class="pun">{</span><span class="pln">
    hibernateVersion </span><span class="pun">=</span><span class="pln"> </span><span class="str">'hibernate-version-you-want'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

buildscript </span><span class="pun">{</span><span class="pln">
    dependencies </span><span class="pun">{</span><span class="pln">
        classpath </span><span class="str">"org.hibernate:hibernate-gradle-plugin:$hibernateVersion"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

hibernate </span><span class="pun">{</span><span class="pln">
    enhance </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// any configuration goes here</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The configuration that is available is exposed through a registered Gradle DSL extension:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enableLazyInitialization</dt>
<dd>
<p>Whether enhancement for lazy attribute loading should be done.</p>
</dd>
<dt class="hdlist1">enableDirtyTracking</dt>
<dd>
<p>Whether enhancement for self-dirty tracking should be done.</p>
</dd>
<dt class="hdlist1">enableAssociationManagement</dt>
<dd>
<p>Whether enhancement for bi-directional association management should be done.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The default value for all 3 configuration settings is <code>false</code></p>
</div>
<div class="paragraph">
<p>The <code>enhance { }</code> block is required in order for enhancement to occur.
Enhancement is disabled by default in preparation for additions capabilities (hbm2ddl, etc) in the plugin.</p>
</div>
</div>
<div class="sect4">
<h5 id="BytecodeEnhancement-enhancement-maven"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-enhancement-maven"></a>Maven plugin</h5>
<div class="paragraph">
<p>Hibernate provides a Maven plugin capable of providing build-time enhancement of the domain model as they are compiled as part of a Maven build.
See the section on the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-enhancement-gradle">Gradle plugin</a> for details on the configuration settings. Again, the default for those 3 is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The Maven plugin supports one additional configuration settings: failOnError, which controls what happens in case of error.
The default behavior is to fail the build, but it can be set so that only a warning is issued.</p>
</div>
<div class="exampleblock">
<div class="title">Example 311. Apply the Maven plugin</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;build&gt;</span><span class="pln">
    </span><span class="tag">&lt;plugins&gt;</span><span class="pln">
        [...]
        </span><span class="tag">&lt;plugin&gt;</span><span class="pln">
            </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.orm.tooling</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
            </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-enhance-maven-plugin</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
            </span><span class="tag">&lt;version&gt;</span><span class="pln">$currentHibernateVersion</span><span class="tag">&lt;/version&gt;</span><span class="pln">
            </span><span class="tag">&lt;executions&gt;</span><span class="pln">
                </span><span class="tag">&lt;execution&gt;</span><span class="pln">
                    </span><span class="tag">&lt;configuration&gt;</span><span class="pln">
                        </span><span class="tag">&lt;failOnError&gt;</span><span class="pln">true</span><span class="tag">&lt;/failOnError&gt;</span><span class="pln">
                        </span><span class="tag">&lt;enableLazyInitialization&gt;</span><span class="pln">true</span><span class="tag">&lt;/enableLazyInitialization&gt;</span><span class="pln">
                        </span><span class="tag">&lt;enableDirtyTracking&gt;</span><span class="pln">true</span><span class="tag">&lt;/enableDirtyTracking&gt;</span><span class="pln">
                        </span><span class="tag">&lt;enableAssociationManagement&gt;</span><span class="pln">true</span><span class="tag">&lt;/enableAssociationManagement&gt;</span><span class="pln">
                    </span><span class="tag">&lt;/configuration&gt;</span><span class="pln">
                    </span><span class="tag">&lt;goals&gt;</span><span class="pln">
                        </span><span class="tag">&lt;goal&gt;</span><span class="pln">enhance</span><span class="tag">&lt;/goal&gt;</span><span class="pln">
                    </span><span class="tag">&lt;/goals&gt;</span><span class="pln">
                </span><span class="tag">&lt;/execution&gt;</span><span class="pln">
            </span><span class="tag">&lt;/executions&gt;</span><span class="pln">
        </span><span class="tag">&lt;/plugin&gt;</span><span class="pln">
        [...]
    </span><span class="tag">&lt;/plugins&gt;</span><span class="pln">
</span><span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-persist"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-persist"></a>5.3. Making entities persistent</h3>
<div class="paragraph">
<p>Once youâ€™ve created a new entity instance (using the standard <code>new</code> operator) it is in <code>new</code> state.
You can make it persistent by associating it to either a <code>org.hibernate.Session</code> or <code>javax.persistence.EntityManager</code>.</p>
</div>
<div id="pc-persist-jpa-example" class="exampleblock">
<div class="title">Example 312. Making an entity persistent with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-persist-native-example" class="exampleblock">
<div class="title">Example 313. Making an entity persistent with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>org.hibernate.Session</code> also has a method named persist which follows the exact semantic defined in the JPA specification for the persist method.
It is this <code>org.hibernate.Session</code> method to which the Hibernate <code>javax.persistence.EntityManager</code> implementation delegates.</p>
</div>
<div class="paragraph">
<p>If the <code>DomesticCat</code> entity type has a generated identifier, the value is associated with the instance when the save or persist is called.
If the identifier is not automatically generated, the manually assigned (usually natural) key value has to be set on the instance before the save or persist methods are called.</p>
</div>
</div>
<div class="sect2">
<h3 id="pc-remove"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-remove"></a>5.4. Deleting (removing) entities</h3>
<div class="paragraph">
<p>Entities can also be deleted.</p>
</div>
<div id="pc-remove-jpa-example" class="exampleblock">
<div class="title">Example 314. Deleting an entity with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-remove-native-example" class="exampleblock">
<div class="title">Example 315. Deleting an entity with the Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">session</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate itself can handle deleting detached state.
JPA, however, disallows it.
The implication here is that the entity instance passed to the <code>org.hibernate.Session</code> delete method can be either in managed or detached state,
while the entity instance passed to remove on <code>javax.persistence.EntityManager</code> must be in the managed state.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="pc-get-reference"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-get-reference"></a>5.5. Obtain an entity reference without initializing its data</h3>
<div class="paragraph">
<p>Sometimes referred to as lazy loading, the ability to obtain a reference to an entity without having to load its data is hugely important.
The most common case being the need to create an association between an entity and another existing entity.</p>
</div>
<div id="pc-get-reference-jpa-example" class="exampleblock">
<div class="title">Example 316. Obtaining an entity reference without initializing its data with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-get-reference-native-example" class="exampleblock">
<div class="title">Example 317. Obtaining an entity reference without initializing its data with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setIsbn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above works on the assumption that the entity is defined to allow lazy loading, generally through use of runtime proxies.
In both cases an exception will be thrown later if the given entity does not refer to actual database state when the application attempts to use the returned proxy in any way that requires access to its data.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless the entity class is declared <code>final</code>, the proxy extends the entity class. If the entity class is <code>final</code>, the proxy will implement an interface instead. See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-proxy"><code>@Proxy</code> mapping</a> section for more info.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="pc-find"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-find"></a>5.6. Obtain an entity with its data initialized</h3>
<div class="paragraph">
<p>It is also quite common to want to obtain an entity along with its data (e.g. like when we need to display it in the UI).</p>
</div>
<div id="pc-find-jpa-example" class="exampleblock">
<div class="title">Example 318. Obtaining an entity reference with its data initialized with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-native-example" class="exampleblock">
<div class="title">Example 319. Obtaining an entity reference with its data initialized with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-by-id-native-example" class="exampleblock">
<div class="title">Example 320. Obtaining an entity reference with its data initialized using the <code>byId()</code> Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In both cases null is returned if no matching database row was found.</p>
</div>
<div class="paragraph">
<p>Itâ€™s possible to return a Java 8 <code>Optional</code> as well:</p>
</div>
<div id="tag::pc-find-optional-by-id-native-example" class="exampleblock">
<div class="title">Example 321. Obtaining an Optional entity reference with its data initialized using the <code>byId()</code> Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Optional</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> optionalPerson </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">loadOptional</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-find-natural-id"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-find-natural-id"></a>5.7. Obtain an entity by natural-id</h3>
<div class="paragraph">
<p>In addition to allowing to load the entity by its identifier, Hibernate allows applications to load entities by the declared natural identifier.</p>
</div>
<div id="pc-find-by-natural-id-entity-example" class="exampleblock">
<div class="title">Example 322. Natural-id mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> isbn</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can also opt to fetch the entity or just retrieve a reference to it when using the natural identifier loading methods.</p>
</div>
<div id="pc-find-by-simple-natural-id-example" class="exampleblock">
<div class="title">Example 323. Get entity reference by simple natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> isbn </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-find-by-natural-id-example" class="exampleblock">
<div class="title">Example 324. Load entity by natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> session
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">using</span><span class="pun">(</span><span class="pln"> </span><span class="str">"isbn"</span><span class="pun">,</span><span class="pln"> isbn </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can also use a Java 8 <code>Optional</code> to load an entity by its natural id:</p>
</div>
<div id="pc-find-optional-by-simple-natural-id-example" class="exampleblock">
<div class="title">Example 325. Load an Optional entity by natural-id</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Optional</span><span class="pun">&lt;</span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> optionalBook </span><span class="pun">=</span><span class="pln"> session
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">using</span><span class="pun">(</span><span class="pln"> </span><span class="str">"isbn"</span><span class="pun">,</span><span class="pln"> isbn </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">loadOptional</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers a consistent API for accessing persistent data by identifier or by the natural-id. Each of these defines the same two data access methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">getReference</dt>
<dd>
<p>Should be used in cases where the identifier is assumed to exist, where non-existence would be an actual error.
Should never be used to test existence.
That is because this method will prefer to create and return a proxy if the data is not already associated with the Session rather than hit the database.
The quintessential use-case for using this method is to create foreign key based associations.</p>
</dd>
<dt class="hdlist1">load</dt>
<dd>
<p>Will return the persistent data associated with the given identifier value or null if that identifier does not exist.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each of these two methods defines an overloading variant accepting a <code>org.hibernate.LockOptions</code> argument.
Locking is discussed in a separate <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking">chapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="pc-managed-state"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-managed-state"></a>5.8. Modifying managed/persistent state</h3>
<div class="paragraph">
<p>Entities in managed/persistent state may be manipulated by the application, and any changes will be automatically detected and persisted when the persistence context is flushed.
There is no need to call a particular method to make your modifications persistent.</p>
</div>
<div id="pc-managed-state-jpa-example" class="exampleblock">
<div class="title">Example 326. Modifying managed state with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-managed-state-native-example" class="exampleblock">
<div class="title">Example 327. Modifying managed state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default, when you modify an entity, all columns but the identifier are being set during update.</p>
</div>
<div class="paragraph">
<p>Therefore, considering you have the following <code>Product</code> entity mapping:</p>
</div>
<div id="pc-managed-state-update-mapping-example" class="exampleblock">
<div class="title">Example 328. <code>Product</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"price_cents"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> priceCents</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> quantity</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you persist the following <code>Product</code> entity:</p>
</div>
<div id="pc-managed-state-update-persist-example" class="exampleblock">
<div class="title">Example 329. Persisting a <code>Product</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Product</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setDescription</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Get the most out of your persistence layer"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setPriceCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">29</span><span class="pln">_99 </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setQuantity</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pln">_000 </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you modify the <code>Product</code> entity, Hibernate generates the following SQL UPDATE statement:</p>
</div>
<div id="pc-managed-state-update-example" class="exampleblock">
<div class="title">Example 330. Modifying the <code>Product</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Product</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setPriceCents</span><span class="pun">(</span><span class="pln"> </span><span class="lit">24</span><span class="pln">_99 </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE
    </span><span class="typ">Product</span><span class="pln">
SET
    description </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    price_cents </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    quantity </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Get</span><span class="pln"> the most </span><span class="kwd">out</span><span class="pln"> of your persistence layer</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2499</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">10000</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The default UPDATE statement containing all columns has two advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it allows you to better benefit from JDBC Statement caching.</p>
</li>
<li>
<p>it allows you to enable batch updates even if multiple entities modify different properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, there is also one downside to including all columns in the SQL UPDATE statement.
If you have multiple indexes, the database might update those redundantly even if you donâ€™t actually modify all column values.</p>
</div>
<div class="paragraph">
<p>To fix this issue, you can use dynamic updates.</p>
</div>
<div class="sect3">
<h4 id="pc-managed-state-dynamic-update"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-managed-state-dynamic-update"></a>5.8.1. Dynamic updates</h4>
<div class="paragraph">
<p>To enable dynamic updates, you need to annotate the entity with the <code>@DynamicUpdate</code> annotation:</p>
</div>
<div id="pc-managed-state-dynamic-update-mapping-example" class="exampleblock">
<div class="title">Example 331. <code>Product</code> entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Product"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DynamicUpdate</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"price_cents"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> priceCents</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> quantity</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, when rerunning the previous test case, Hibernate generates the following SQL UPDATE statement:</p>
</div>
<div id="pc-managed-state-dynamic-update-example" class="exampleblock">
<div class="title">Example 332. Modifying the <code>Product</code> entity with a dynamic update</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE
    </span><span class="typ">Product</span><span class="pln">
SET
    price_cents </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2499</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The dynamic update allows you to set just the columns that were modified in the associated entity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-refresh"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-refresh"></a>5.9. Refresh entity state</h3>
<div class="paragraph">
<p>You can reload an entity instance and its collections at any time.</p>
</div>
<div id="pc-refresh-jpa-example" class="exampleblock">
<div class="title">Example 333. Refreshing entity state with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"update Person set name = UPPER(name)"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">executeUpdate</span><span class="pun">();</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">refresh</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"JOHN DOE"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-refresh-native-example" class="exampleblock">
<div class="title">Example 334. Refreshing entity state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">doWork</span><span class="pun">(</span><span class="pln"> connection </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">try</span><span class="pun">(</span><span class="typ">Statement</span><span class="pln"> statement </span><span class="pun">=</span><span class="pln"> connection</span><span class="pun">.</span><span class="pln">createStatement</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UPDATE Person SET name = UPPER(name)"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">refresh</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"JOHN DOE"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>One case where this is useful is when it is known that the database state has changed since the data was read.
Refreshing allows the current database state to be pulled into the entity instance and the persistence context.</p>
</div>
<div class="paragraph">
<p>Another case where this might be useful is when database triggers are used to initialize some of the properties of the entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only the entity instance and its value type collections are refreshed unless you specify <code>REFRESH</code> as a cascade style of any associations.
However, please note that Hibernate has the capability to handle this automatically through its notion of generated properties.
See the discussion of non-identifier <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated">generated attributes</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Traditionally, Hibernate has been allowing detached entities to be refreshed.
Unfortunately, JPA prohibits this practice and specifies that an <code>IllegalArgumentException</code> should be thrown instead.</p>
</div>
<div class="paragraph">
<p>For this reason, when bootstrapping the Hibernate <code>SessionFactory</code> using the native API, the legacy detached entity refresh behavior is going to be preserved.
On the other hand, when bootstrapping Hibernate through JPA <code>EntityManagerFactory</code> building process, detached entities are not allowed to be refreshed by default.</p>
</div>
<div class="paragraph">
<p>However, this default behavior can be overwritten through the <code>hibernate.allow_refresh_detached_entity</code> configuration property.
If this property is explicitly set to <code>true</code>, then you can refresh detached entities even when using the JPA bootstraps mechanism, therefore bypassing the JPA specification restriction.</p>
</div>
<div class="paragraph">
<p>For more about the <code>hibernate.allow_refresh_detached_entity</code> configuration property,
check out the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#misc">Configurations</a> section as well.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="pc-refresh-gotchas"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-refresh-gotchas"></a>5.9.1. Refresh gotchas</h4>
<div class="paragraph">
<p>The <code>refresh</code> entity state transition is meant to overwrite the entity attributes according to the info currently contained in the associated database record.</p>
</div>
<div class="paragraph">
<p>However, you have to be very careful when cascading the refresh action to any transient entity.</p>
</div>
<div class="paragraph">
<p>For instance, consider the following example:</p>
</div>
<div id="pc-refresh-child-entity-jpa-example" class="exampleblock">
<div class="title">Example 335. Refreshing entity state gotcha</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">

	</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Hibernate User Guide"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">refresh</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">EntityNotFoundException</span><span class="pln"> expected </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Beware when cascading the refresh associations to transient entities!"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the aforementioned example, an <code>EntityNotFoundException</code> is thrown because the <code>Book</code> entity is still in a transient state.
When the refresh action is cascaded from the <code>Person</code> entity, Hibernate will not be able to locate the <code>Book</code> entity in the database.</p>
</div>
<div class="paragraph">
<p>For this reason, you should be very careful when mixing the refresh action with transient child entity objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-detach"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-detach"></a>5.10. Working with detached data</h3>
<div class="paragraph">
<p>Detachment is the process of working with data outside the scope of any persistence context.
Data becomes detached in a number of ways.
Once the persistence context is closed, all data that was associated with it becomes detached.
Clearing the persistence context has the same effect.
Evicting a particular entity from the persistence context makes it detached.
And finally, serialization will make the deserialized form be detached (the original instance is still managed).</p>
</div>
<div class="paragraph">
<p>Detached data can still be manipulated, however, the persistence context will no longer automatically know about these modifications, and the application will need to intervene to make the changes persistent again.</p>
</div>
<div class="sect3">
<h4 id="pc-detach-reattach"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-detach-reattach"></a>5.10.1. Reattaching detached data</h4>
<div class="paragraph">
<p>Reattachment is the process of taking an incoming entity instance that is in the detached state and re-associating it with the current persistence context.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JPA does not provide for this model. This is only available through Hibernate <code>org.hibernate.Session</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="pc-detach-reattach-lock-example" class="exampleblock">
<div class="title">Example 336. Reattaching a detached entity using <code>lock</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Clear the Session so the person entity becomes detached</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="kwd">lock</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LockMode</span><span class="pun">.</span><span class="pln">NONE </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-detach-reattach-saveOrUpdate-example" class="exampleblock">
<div class="title">Example 337. Reattaching a detached entity using <code>saveOrUpdate</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Clear the Session so the person entity becomes detached</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">saveOrUpdate</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The method name <code>update</code> is a bit misleading here.
It does not mean that an <code>SQL</code> <code>UPDATE</code> is immediately performed.
It does, however, mean that an <code>SQL</code> <code>UPDATE</code> will be performed when the persistence context is flushed since Hibernate does not know its previous state against which to compare for changes.
If the entity is mapped with <code>select-before-update</code>, Hibernate will pull the current state from the database and see if an update is needed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Provided the entity is detached, <code>update</code> and <code>saveOrUpdate</code> operate exactly the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-merge"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-merge"></a>5.10.2. Merging detached data</h4>
<div class="paragraph">
<p>Merging is the process of taking an incoming entity instance that is in the detached state and copying its data over onto a new managed instance.</p>
</div>
<div class="paragraph">
<p>Although not exactly per se, the following example is a good visualization of the <code>merge</code> operation internals.</p>
</div>
<div id="pc-merge-visualize-example" class="exampleblock">
<div class="title">Example 338. Visualizing merge</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> merge</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> detached</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> newReference </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> detached</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	newReference</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> detached</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> newReference</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-merge-jpa-example" class="exampleblock">
<div class="title">Example 339. Merging a detached entity with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Clear the EntityManager so the person entity becomes detached</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">merge</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-merge-native-example" class="exampleblock">
<div class="title">Example 340. Merging a detached entity with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">byId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> personId </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Clear the Session so the person entity becomes detached</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">merge</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pc-merge-gotchas"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-merge-gotchas"></a>Merging gotchas</h5>
<div class="paragraph">
<p>For example, Hibernate throws <code>IllegalStateException</code> when merging a parent entity which has references to 2 detached child entities <code>child1</code> and <code>child2</code> (obtained from different sessions), and <code>child1</code> and <code>child2</code> represent the same persistent entity, <code>Child</code>.</p>
</div>
<div class="paragraph">
<p>A new configuration property, <code>hibernate.event.merge.entity_copy_observer</code>, controls how Hibernate will respond when multiple representations of the same persistent entity ("entity copy") is detected while merging.</p>
</div>
<div class="paragraph">
<p>The possible values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">disallow (the default)</dt>
<dd>
<p>throws <code>IllegalStateException</code> if an entity copy is detected</p>
</dd>
<dt class="hdlist1">allow</dt>
<dd>
<p>performs the merge operation on each entity copy that is detected</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>(provided for testing only) performs the merge operation on each entity copy that is detected and logs information about the entity copies.
This setting requires DEBUG logging be enabled for <code>org.hibernate.event.internal.EntityCopyAllowedLoggedObserver</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition, the application may customize the behavior by providing an implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> and setting <code>hibernate.event.merge.entity_copy_observer</code> to the class name.
When this property is set to <code>allow</code> or <code>log</code>, Hibernate will merge each entity copy detected while cascading the merge operation.
In the process of merging each entity copy, Hibernate will cascade the merge operation from each entity copy to its associations with <code>cascade=CascadeType.MERGE</code> or <code>CascadeType.ALL</code>.
The entity state resulting from merging an entity copy will be overwritten when another entity copy is merged.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because cascade order is undefined, the order in which the entity copies are merged is undefined.
As a result, if property values in the entity copies are not consistent, the resulting entity state will be indeterminate, and data will be lost from all entity copies except for the last one merged.
Therefore, the <strong>last writer wins</strong>.</p>
</div>
<div class="paragraph">
<p>If an entity copy cascades the merge operation to an association that is (or contains) a new entity, that new entity will be merged (i.e., persisted and the merge operation will be cascaded to its associations according to its mapping),
even if that same association is ultimately overwritten when Hibernate merges a different representation having a different value for its association.</p>
</div>
<div class="paragraph">
<p>If the association is mapped with <code>orphanRemoval = true</code>, the new entity will not be deleted because the semantics of orphanRemoval do not apply if the entity being orphaned is a new entity.</p>
</div>
<div class="paragraph">
<p>There are known issues when representations of the same persistent entity have different values for a collection.
See <a href="https://hibernate.atlassian.net/browse/HHH-9239">HHH-9239</a> and <a href="https://hibernate.atlassian.net/browse/HHH-9240">HHH-9240</a> for more details.
These issues can cause data loss or corruption.</p>
</div>
<div class="paragraph">
<p>By setting <code>hibernate.event.merge.entity_copy_observer</code> configuration property to <code>allow</code> or <code>log</code>,
Hibernate will allow entity copies of any type of entity to be merged.</p>
</div>
<div class="paragraph">
<p>The only way to exclude particular entity classes or associations that contain critical data is to provide a custom implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> with the desired behavior,
and setting <code>hibernate.event.merge.entity_copy_observer</code> to the class name.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate provides limited DEBUG logging capabilities that can help determine the entity classes for which entity copies were found.
By setting <code>hibernate.event.merge.entity_copy_observer</code> to <code>log</code> and enabling DEBUG logging for <code>org.hibernate.event.internal.EntityCopyAllowedLoggedObserver</code>,
the following will be logged each time an application calls <code>EntityManager.merge( entity )</code> or<br>
<code>Session.merge( entity )</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>number of times multiple representations of the same persistent entity was detected summarized by entity name;</p>
</li>
<li>
<p>details by entity name and ID, including output from calling toString() on each representation being merged as well as the merge result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log should be reviewed to determine if multiple representations of entities containing critical data are detected.
If so, the application should be modified so there is only one representation, and a custom implementation of <code>org.hibernate.event.spi.EntityCopyObserver</code> should be provided to disallow entity copies for entities with critical data.</p>
</div>
<div class="paragraph">
<p>Using optimistic locking is recommended to detect if different representations are from different versions of the same persistent entity.
If they are not from the same version, Hibernate will throw either the JPA <code>OptimisticLockException</code> or the native <code>StaleObjectStateException</code> depending on your bootstrapping strategy.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-contains"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-contains"></a>5.11. Checking persistent state</h3>
<div class="paragraph">
<p>An application can verify the state of entities and collections in relation to the persistence context.</p>
</div>
<div id="pc-contains-jpa-example" class="exampleblock">
<div class="title">Example 341. Verifying managed state with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">boolean</span><span class="pln"> contained </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-contains-native-example" class="exampleblock">
<div class="title">Example 342. Verifying managed state with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">boolean</span><span class="pln"> contained </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-verify-lazy-jpa-example" class="exampleblock">
<div class="title">Example 343. Verifying laziness with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PersistenceUnitUtil</span><span class="pln"> persistenceUnitUtil </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getEntityManagerFactory</span><span class="pun">().</span><span class="pln">getPersistenceUnitUtil</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personBooksInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personNameInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="pc-verify-lazy-native-example" class="exampleblock">
<div class="title">Example 344. Verifying laziness with Hibernate API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">boolean</span><span class="pln"> personInitialized </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Hibernate</span><span class="pun">.</span><span class="pln">isInitialized</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personBooksInitialized </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Hibernate</span><span class="pun">.</span><span class="pln">isInitialized</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personNameInitialized </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Hibernate</span><span class="pun">.</span><span class="pln">isPropertyInitialized</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In JPA there is an alternative means to check laziness using the following <code>javax.persistence.PersistenceUtil</code> pattern (which is recommended wherever possible).</p>
</div>
<div id="pc-verify-lazy-jpa-alternative-example" class="exampleblock">
<div class="title">Example 345. Alternative JPA means to verify laziness</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PersistenceUtil</span><span class="pln"> persistenceUnitUtil </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">.</span><span class="pln">getPersistenceUtil</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personBooksInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getBooks</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">boolean</span><span class="pln"> personNameInitialized </span><span class="pun">=</span><span class="pln"> persistenceUnitUtil</span><span class="pun">.</span><span class="pln">isLoaded</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_evicting_entities"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_evicting_entities"></a>5.12. Evicting entities</h3>
<div class="paragraph">
<p>When the <code>flush()</code> method is called, the state of the entity is synchronized with the database.
If you do not want this synchronization to occur, or if you are processing a huge number of objects and need to manage memory efficiently,
the <code>evict()</code> method can be used to remove the object and its collections from the first-level cache.</p>
</div>
<div id="caching-management-jpa-detach-example" class="exampleblock">
<div class="title">Example 346. Detaching an entity from the <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">for</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="str">"select p from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	dtos</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">toDTO</span><span class="pun">(</span><span class="pln">person</span><span class="pun">));</span><span class="pln">
	entityManager</span><span class="pun">.</span><span class="pln">detach</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-native-evict-example" class="exampleblock">
<div class="title">Example 347. Evicting an entity from the Hibernate <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;)</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="str">"select p from Person p"</span><span class="pun">).</span><span class="pln">list</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	dtos</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">toDTO</span><span class="pun">(</span><span class="pln">person</span><span class="pun">));</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">evict</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To detach all entities from the current persistence context, both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>clear()</code> method.</p>
</div>
<div id="caching-management-clear-example" class="exampleblock">
<div class="title">Example 348. Clearing the persistence context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To verify if an entity instance is currently attached to the running persistence context, both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>contains(Object entity)</code> method.</p>
</div>
<div id="caching-management-contains-example" class="exampleblock">
<div class="title">Example 349. Verify if an entity is contained in a persistence context</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-cascade"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade"></a>5.13. Cascading entity state transitions</h3>
<div class="paragraph">
<p>JPA allows you to propagate the state transition from a parent entity to a child.
For this purpose, the JPA <code>javax.persistence.CascadeType</code> defines various cascade types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>cascades all entity state transitions</p>
</dd>
<dt class="hdlist1"><code>PERSIST</code></dt>
<dd>
<p>cascades the entity persist operation.</p>
</dd>
<dt class="hdlist1"><code>MERGE</code></dt>
<dd>
<p>cascades the entity merge operation.</p>
</dd>
<dt class="hdlist1"><code>REMOVE</code></dt>
<dd>
<p>cascades the entity remove operation.</p>
</dd>
<dt class="hdlist1"><code>REFRESH</code></dt>
<dd>
<p>cascades the entity refresh operation.</p>
</dd>
<dt class="hdlist1"><code>DETACH</code></dt>
<dd>
<p>cascades the entity detach operation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, the <code>CascadeType.ALL</code> will propagate any Hibernate-specific operation, which is defined by the <code>org.hibernate.annotations.CascadeType</code> enum:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>SAVE_UPDATE</code></dt>
<dd>
<p>cascades the entity saveOrUpdate operation.</p>
</dd>
<dt class="hdlist1"><code>REPLICATE</code></dt>
<dd>
<p>cascades the entity replicate operation.</p>
</dd>
<dt class="hdlist1"><code>LOCK</code></dt>
<dd>
<p>cascades the entity lock operation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following examples will explain some of the aforementioned cascade operations using the following entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"owner"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPhone</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">phones</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">
        phone</span><span class="pun">.</span><span class="pln">setOwner</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-persist"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-persist"></a>5.13.1. <code>CascadeType.PERSIST</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.PERSIST</code> allows us to persist a child entity along with the parent one.</p>
</div>
<div id="pc-cascade-persist-example" class="exampleblock">
<div class="title">Example 350. <code>CascadeType.PERSIST</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">();</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

INSERT INTO </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">`number`</span><span class="pun">,</span><span class="pln"> person_id</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
VALUE </span><span class="pun">(</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Even if just the <code>Person</code> parent entity was persisted, Hibernate has managed to cascade the persist operation to the associated <code>Phone</code> child entity as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-merge"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-merge"></a>5.13.2. <code>CascadeType.MERGE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.MERGE</code> allows us to merge a child entity along with the parent one.</p>
</div>
<div id="pc-cascade-merge-example" class="exampleblock">
<div class="title">Example 351. <code>CascadeType.MERGE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getOwner</span><span class="pun">();</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe Jr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"987-654-3210"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">merge</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_0_1_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">owner_id </span><span class="kwd">as</span><span class="pln"> owner_id3_1_3_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_3_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="str">"number"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> number2_1_0_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">owner_id </span><span class="kwd">as</span><span class="pln"> owner_id3_1_0_
FROM
    </span><span class="typ">Person</span><span class="pln"> p
LEFT OUTER JOIN
    </span><span class="typ">Phone</span><span class="pln"> ph
        on p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">ph</span><span class="pun">.</span><span class="pln">owner_id
WHERE
    p</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>During merge, the current state of the entity is copied onto the entity version that was just fetched from the database.
Thatâ€™s the reason why Hibernate executed the SELECT statement which fetched both the <code>Person</code> entity along with its children.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-remove"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-remove"></a>5.13.3. <code>CascadeType.REMOVE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REMOVE</code> allows us to remove a child entity along with the parent one.
Traditionally, Hibernate called this operation delete, thatâ€™s why the <code>org.hibernate.annotations.CascadeType</code> provides a <code>DELETE</code> cascade option.
However, <code>CascadeType.REMOVE</code> and <code>org.hibernate.annotations.CascadeType.DELETE</code> are identical.</p>
</div>
<div id="pc-cascade-remove-example" class="exampleblock">
<div class="title">Example 352. <code>CascadeType.REMOVE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">DELETE FROM </span><span class="typ">Phone</span><span class="pln"> WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

DELETE FROM </span><span class="typ">Person</span><span class="pln"> WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-detach"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-detach"></a>5.13.4. <code>CascadeType.DETACH</code></h4>
<div class="paragraph">
<p><code>CascadeType.DETACH</code> is used to propagate the detach operation from a parent entity to a child.</p>
</div>
<div id="pc-cascade-detach-example" class="exampleblock">
<div class="title">Example 353. <code>CascadeType.DETACH</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">));</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">));</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">detach</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertFalse</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">));</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">));</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-lock"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-lock"></a>5.13.5. <code>CascadeType.LOCK</code></h4>
<div class="paragraph">
<p>Although unintuitively, <code>CascadeType.LOCK</code> does not propagate a lock request from a parent entity to its children.
Such a use case requires the use of the <code>PessimisticLockScope.EXTENDED</code> value of the <code>javax.persistence.lock.scope</code> property.</p>
</div>
<div class="paragraph">
<p>However, <code>CascadeType.LOCK</code> allows us to reattach a parent entity along with its children to the currently running Persistence Context.</p>
</div>
<div id="pc-cascade-lock-example" class="exampleblock">
<div class="title">Example 354. <code>CascadeType.LOCK</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">detach</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertFalse</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">buildLockRequest</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LockOptions</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockMode</span><span class="pun">.</span><span class="pln">NONE </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="kwd">lock</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-refresh"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-refresh"></a>5.13.6. <code>CascadeType.REFRESH</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REFRESH</code> is used to propagate the refresh operation from a parent entity to a child.
The refresh operation will discard the current entity state, and it will override it using the one loaded from the database.</p>
</div>
<div id="pc-cascade-refresh-example" class="exampleblock">
<div class="title">Example 355. <code>CascadeType.REFRESH</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe Jr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"987-654-3210"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">refresh</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pun">,</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pun">,</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getNumber</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_0_1_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">owner_id </span><span class="kwd">as</span><span class="pln"> owner_id3_1_3_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_3_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="str">"number"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> number2_1_0_</span><span class="pun">,</span><span class="pln">
    ph</span><span class="pun">.</span><span class="pln">owner_id </span><span class="kwd">as</span><span class="pln"> owner_id3_1_0_
FROM
    </span><span class="typ">Person</span><span class="pln"> p
LEFT OUTER JOIN
    </span><span class="typ">Phone</span><span class="pln"> ph
        ON p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">ph</span><span class="pun">.</span><span class="pln">owner_id
WHERE
    p</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the aforementioned example, you can see that both the <code>Person</code> and <code>Phone</code> entities are refreshed even if we only called this operation on the parent entity only.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-replicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-replicate"></a>5.13.7. <code>CascadeType.REPLICATE</code></h4>
<div class="paragraph">
<p>The <code>CascadeType.REPLICATE</code> is to replicate both the parent and the child entities.
The replicate operation allows you to synchronize entities coming from different sources of data.</p>
</div>
<div id="pc-cascade-replicate-example" class="exampleblock">
<div class="title">Example 356. <code>CascadeType.REPLICATE</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe Sr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">();</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"(01) 123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">addPhone</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">replicate</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ReplicationMode</span><span class="pun">.</span><span class="pln">OVERWRITE </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    id
FROM
    </span><span class="typ">Person</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT
    id
FROM
    </span><span class="typ">Phone</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

UPDATE
    </span><span class="typ">Person</span><span class="pln">
SET
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'John Doe Sr.'</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

UPDATE
    </span><span class="typ">Phone</span><span class="pln">
SET
    </span><span class="str">"number"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'(01) 123-456-7890'</span><span class="pun">,</span><span class="pln">
    owner_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
WHERE
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As illustrated by the SQL statements being generated, both the <code>Person</code> and <code>Phone</code> entities are replicated to the underlying database rows.</p>
</div>
</div>
<div class="sect3">
<h4 id="pc-cascade-on-delete"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-on-delete"></a>5.13.8. <code>@OnDelete</code> cascade</h4>
<div class="paragraph">
<p>While the previous cascade types propagate entity state transitions, the <code>@OnDelete</code> cascade is a DDL-level FK feature which allows you
to remove a child record whenever the parent row is deleted.</p>
</div>
<div class="paragraph">
<p>So, when annotating the <code>@ManyToOne</code> association with <code>@OnDelete( action = OnDeleteAction.CASCADE )</code>,
the automatic schema generator will apply the ON DELETE CASCADE SQL directive to the Foreign Key declaration,
as illustrated by the following example.</p>
</div>
<div id="pc-cascade-on-delete-mapping-example" class="exampleblock">
<div class="title">Example 357. <code>@OnDelete</code> mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@OnDelete</span><span class="pun">(</span><span class="pln"> action </span><span class="pun">=</span><span class="pln"> </span><span class="typ">OnDeleteAction</span><span class="pun">.</span><span class="pln">CASCADE </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> owner</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"number"</span><span class="pln"> varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    owner_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Phone</span><span class="pln">
    add constraint FK82m836qc1ss2niru7eogfndhl
    foreign key </span><span class="pun">(</span><span class="pln">owner_id</span><span class="pun">)</span><span class="pln">
    references </span><span class="typ">Person</span><span class="pln">
    on </span><span class="kwd">delete</span><span class="pln"> cascade</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, you can just remove the <code>Person</code> entity, and the associated <code>Phone</code> is going to be removed automatically.</p>
</div>
<div id="pc-cascade-on-delete-example" class="exampleblock">
<div class="title">Example 358. <code>@OnDelete</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">delete</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pc-exception-handling"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-exception-handling"></a>5.14. Exception handling</h3>
<div class="paragraph">
<p>If the JPA <code>EntityManager</code> or the Hibernate-specific <code>Session</code> throws an exception, including any JDBC <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html"><code>SQLException</code></a>, you have to immediately rollback the database transaction and close the current <code>EntityManager</code> or <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>Certain methods of the JPA <code>EntityManager</code> or the Hibernate <code>Session</code> will not leave the Persistence Context in a consistent state. As a rule of thumb, no exception thrown by Hibernate can be treated as recoverable. Ensure that the Session will be closed by calling the <code>close()</code> method in a finally block.</p>
</div>
<div class="paragraph">
<p>Rolling back the database transaction does not put your business objects back into the state they were at the start of the transaction. This means that the database state and the business objects will be out of sync. Usually, this is not a problem because exceptions are not recoverable and you will have to start over after rollback anyway.</p>
</div>
<div class="paragraph">
<p>The JPA <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceException.html"><code>PersistenceException</code></a> or the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/HibernateException.html"><code>HibernateException</code></a> wraps most of the errors that can occur in a Hibernate persistence layer.</p>
</div>
<div class="paragraph">
<p>Both the <code>PersistenceException</code> and the <code>HibernateException</code> are runtime exceptions because, in our opinion, we should not force the application developer to catch an unrecoverable exception at a low layer. In most systems, unchecked and fatal exceptions are handled in one of the first frames of the method call stack (i.e., in higher layers) and either an error message is presented to the application user or some other appropriate action is taken. Note that Hibernate might also throw other unchecked exceptions that are not a <code>HibernateException</code>. These are not recoverable either, and appropriate action should be taken.</p>
</div>
<div class="paragraph">
<p>Hibernate wraps the JDBC <code>SQLException</code>, thrown while interacting with the database, in a
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/JDBCException.html"><code>JDBCException</code></a>.
In fact, Hibernate will attempt to convert the exception into a more meaningful subclass of <code>JDBCException</code>. The underlying <code>SQLException</code> is always available via <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/JDBCException.html#getSQLException--"><code>JDBCException.getSQLException()</code></a>. Hibernate converts the <code>SQLException</code> into an appropriate JDBCException subclass using the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/exception/spi/SQLExceptionConverter.html"><code>SQLExceptionConverter</code></a>
attached to the current <code>SessionFactory</code>.</p>
</div>
<div class="paragraph">
<p>By default, the <code>SQLExceptionConverter</code> is defined by the configured Hibernate <code>Dialect</code> via the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html#buildSQLExceptionConversionDelegate--"><code>buildSQLExceptionConversionDelegate</code></a> method
which is overridden by several database-specific <code>Dialects</code>.</p>
</div>
<div class="paragraph">
<p>However, it is also possible to plug in a custom implementation. See the
<a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-exception-handling"><code>hibernate.jdbc.sql_exception_converter</code></a> configuration property for more details.</p>
</div>
<div class="paragraph">
<p>The standard <code>JDBCException</code> subtypes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ConstraintViolationException</dt>
<dd>
<p>indicates some form of integrity constraint violation.</p>
</dd>
<dt class="hdlist1">DataException</dt>
<dd>
<p>indicates that evaluation of the valid SQL statement against the given data
resulted in some illegal operation, mismatched types, truncation or incorrect cardinality.</p>
</dd>
<dt class="hdlist1">GenericJDBCException</dt>
<dd>
<p>a generic exception which did not fall into any of the other categories.</p>
</dd>
<dt class="hdlist1">JDBCConnectionException</dt>
<dd>
<p>indicates an error with the underlying JDBC communication.</p>
</dd>
<dt class="hdlist1">LockAcquisitionException</dt>
<dd>
<p>indicates an error acquiring a lock level necessary to perform the requested operation.</p>
</dd>
<dt class="hdlist1">LockTimeoutException</dt>
<dd>
<p>indicates that the lock acquisition request has timed out.</p>
</dd>
<dt class="hdlist1">PessimisticLockException</dt>
<dd>
<p>indicates that a lock acquisition request has failed.</p>
</dd>
<dt class="hdlist1">QueryTimeoutException</dt>
<dd>
<p>indicates that the current executing query has timed out.</p>
</dd>
<dt class="hdlist1">SQLGrammarException</dt>
<dd>
<p>indicates a grammar or syntax problem with the issued SQL.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Hibernate 5.2, the Hibernate <code>Session</code> extends the JPA <code>EntityManager</code>. For this reason, when a <code>SessionFactory</code> is built via Hibernateâ€™s native bootstrapping,
the <code>HibernateException</code> or <code>SQLException</code> can be wrapped in a JPA <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceException.html"><code>PersistenceException</code></a> when thrown
by <code>Session</code> methods that implement <code>EntityManager</code> methods (e.g., <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Session.html#merge-java.lang.Object-">Session.merge(Object object)</a>,
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Session.html#flush--">Session.flush()</a>).</p>
</div>
<div class="paragraph">
<p>If your <code>SessionFactory</code> is built via Hibernateâ€™s native bootstrapping, and you donâ€™t want the Hibernate exceptions to be wrapped in the JPA <code>PersistenceException</code>, you need to set the
<code>hibernate.native_exception_handling_51_compliance</code> configuration property to <code>true</code>. See the
<a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-exception-handling"><code>hibernate.native_exception_handling_51_compliance</code></a> configuration property for more details.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flushing"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing"></a>6. Flushing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flushing is the process of synchronizing the state of the persistence context with the underlying database.
The <code>EntityManager</code> and the Hibernate <code>Session</code> expose a set of methods, through which the application developer can change the persistent state of an entity.</p>
</div>
<div class="paragraph">
<p>The persistence context acts as a transactional write-behind cache, queuing any entity state change.
Like any write-behind cache, changes are first applied in-memory and synchronized with the database during the flush time.
The flush operation takes every entity state change and translates it to an <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code> statement.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because DML statements are grouped together, Hibernate can apply batching transparently.
See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch">Batching chapter</a> for more information.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The flushing strategy is given by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Session.html#getFlushMode--"><code>flushMode</code></a> of the current running Hibernate <code>Session</code>.
Although JPA defines only two flushing strategies (<a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/FlushModeType.html#AUTO"><code>AUTO</code></a> and <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/FlushModeType.html#COMMIT"><code>COMMIT</code></a>),
Hibernate has a much broader spectrum of flush types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ALWAYS</dt>
<dd>
<p>Flushes the <code>Session</code> before every query.</p>
</dd>
<dt class="hdlist1">AUTO</dt>
<dd>
<p>This is the default mode, and it flushes the <code>Session</code> only if necessary.</p>
</dd>
<dt class="hdlist1">COMMIT</dt>
<dd>
<p>The <code>Session</code> tries to delay the flush until the current <code>Transaction</code> is committed, although it might flush prematurely too.</p>
</dd>
<dt class="hdlist1">MANUAL</dt>
<dd>
<p>The <code>Session</code> flushing is delegated to the application, which must call <code>Session.flush()</code> explicitly in order to apply the persistence context changes.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="flushing-auto"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing-auto"></a>6.1. <code>AUTO</code> flush</h3>
<div class="paragraph">
<p>By default, Hibernate uses the <code>AUTO</code> flush mode which triggers a flush in the following circumstances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prior to committing a <code>Transaction</code></p>
</li>
<li>
<p>prior to executing a JPQL/HQL query that overlaps with the queued entity actions</p>
</li>
<li>
<p>before executing any native SQL query that has no registered synchronization</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_code_auto_code_flush_on_commit"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_code_auto_code_flush_on_commit"></a>6.1.1. <code>AUTO</code> flush on commit</h4>
<div class="paragraph">
<p>In the following example, an entity is persisted, and then the transaction is committed.</p>
</div>
<div id="flushing-auto-flush-commit-example" class="exampleblock">
<div class="title">Example 359. Automatic flushing on commit</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">().</span><span class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">
txn </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Entity is in persisted state"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pun">--</span><span class="pln">INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Entity</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> persisted state
INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate logs the message prior to inserting the entity because the flush only occurred during transaction commit.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is valid for the <code>SEQUENCE</code> and <code>TABLE</code> identifier generators.
The <code>IDENTITY</code> generator must execute the insert right after calling <code>persist()</code>.
For details, see the discussion of generators in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers"><em>Identifier generators</em></a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_code_auto_code_flush_on_jpql_hql_query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_code_auto_code_flush_on_jpql_hql_query"></a>6.1.2. <code>AUTO</code> flush on JPQL/HQL query</h4>
<div class="paragraph">
<p>A flush may also be triggered when executing an entity query.</p>
</div>
<div id="flushing-auto-flush-jpql-example" class="exampleblock">
<div class="title">Example 360. Automatic flushing on JPQL/HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select p from Advertisement p"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select p from Person p"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT a</span><span class="pun">.</span><span class="pln">id AS id1_0_ </span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">title AS title2_0_
FROM   </span><span class="typ">Advertisement</span><span class="pln"> a

INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT p</span><span class="pun">.</span><span class="pln">id AS id1_1_ </span><span class="pun">,</span><span class="pln">
       p</span><span class="pun">.</span><span class="pln">name AS name2_1_
FROM   </span><span class="typ">Person</span><span class="pln"> p</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The reason why the <code>Advertisement</code> entity query didnâ€™t trigger a flush is that thereâ€™s no overlapping between the <code>Advertisement</code> and the <code>Person</code> tables:</p>
</div>
<div id="flushing-auto-flush-jpql-entity-example" class="exampleblock">
<div class="title">Example 361. Automatic flushing on JPQL/HQL entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Advertisement"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Advertisement</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When querying for a <code>Person</code> entity, the flush is triggered prior to executing the entity query.</p>
</div>
<div id="flushing-auto-flush-jpql-overlap-example" class="exampleblock">
<div class="title">Example 362. Automatic flushing on JPQL/HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select p from Person p"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT p</span><span class="pun">.</span><span class="pln">id AS id1_1_ </span><span class="pun">,</span><span class="pln">
       p</span><span class="pun">.</span><span class="pln">name AS name2_1_
FROM   </span><span class="typ">Person</span><span class="pln"> p</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, the flush was triggered by a JPQL query because the pending entity persists action overlaps with the query being executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_auto_code_flush_on_native_sql_query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_code_auto_code_flush_on_native_sql_query"></a>6.1.3. <code>AUTO</code> flush on native SQL query</h4>
<div class="paragraph">
<p>When executing a native SQL query, a flush is always triggered when using the <code>EntityManager</code> API.</p>
</div>
<div id="flushing-auto-flush-sql-example" class="exampleblock">
<div class="title">Example 363. Automatic flushing on native SQL using <code>EntityManager</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> entityManager
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> entityManager
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you bootstrap Hibernate natively, and not through JPA, by default,
the <code>Session</code> API will trigger a flush automatically when executing a native query.</p>
</div>
<div id="flushing-auto-flush-sql-native-example" class="exampleblock">
<div class="title">Example 364. Automatic flushing on native SQL using <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To flush the <code>Session</code>, the query must use a synchronization:</p>
</div>
<div id="flushing-auto-flush-sql-synchronization-example" class="exampleblock">
<div class="title">Example 365. Automatic flushing on native SQL with <code>Session</code> synchronization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> entityManager
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session
		</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">addSynchronizedEntityClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-commit"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing-commit"></a>6.2. <code>COMMIT</code> flush</h3>
<div class="paragraph">
<p>JPA also defines a COMMIT flush mode, which is described as follows:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If <code>FlushModeType.COMMIT</code> is set, the effect of updates made to entities in the persistence context upon queries is unspecified.</p>
</div>
</blockquote>
<div class="attribution">
â€” Section 3.10.8 of the JPA 2.1 Specification
</div>
</div>
<div class="paragraph">
<p>When executing a JPQL query, the persistence context is only flushed when the current running transaction is committed.</p>
</div>
<div id="flushing-commit-flush-jpql-example" class="exampleblock">
<div class="title">Example 366. <code>COMMIT</code> flushing on JPQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="str">"select p from Advertisement p"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setFlushMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FlushModeType</span><span class="pun">.</span><span class="pln">COMMIT</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="str">"select p from Person p"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setFlushMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FlushModeType</span><span class="pun">.</span><span class="pln">COMMIT</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT a</span><span class="pun">.</span><span class="pln">id AS id1_0_ </span><span class="pun">,</span><span class="pln">
       a</span><span class="pun">.</span><span class="pln">title AS title2_0_
FROM   </span><span class="typ">Advertisement</span><span class="pln"> a

SELECT p</span><span class="pun">.</span><span class="pln">id AS id1_1_ </span><span class="pun">,</span><span class="pln">
       p</span><span class="pun">.</span><span class="pln">name AS name2_1_
FROM   </span><span class="typ">Person</span><span class="pln"> p

INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because the JPA doesnâ€™t impose a strict rule on delaying flushing, when executing a native SQL query, the persistence context is going to be flushed.</p>
</div>
<div id="flushing-commit-flush-sql-example" class="exampleblock">
<div class="title">Example 367. <code>COMMIT</code> flushing on SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> entityManager
    </span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT COUNT</span><span class="pun">(*)</span><span class="pln"> FROM </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-always"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing-always"></a>6.3. <code>ALWAYS</code> flush</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ALWAYS</code> is only available with the native <code>Session</code> API.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>ALWAYS</code> flush mode triggers a persistence context flush even when executing a native SQL query against the <code>Session</code> API.</p>
</div>
<div id="flushing-always-flush-sql-example" class="exampleblock">
<div class="title">Example 368. <code>COMMIT</code> flushing on SQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session
        </span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">setFlushMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FlushMode</span><span class="pun">.</span><span class="pln">ALWAYS</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">

SELECT COUNT</span><span class="pun">(*)</span><span class="pln"> FROM </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flushing-manual"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing-manual"></a>6.4. <code>MANUAL</code> flush</h3>
<div class="paragraph">
<p>Both the <code>EntityManager</code> and the Hibernate <code>Session</code> define a <code>flush()</code> method that, when called, triggers a manual flush.
Hibernate also provides a <code>MANUAL</code> flush mode so the persistence context can only be flushed manually.</p>
</div>
<div id="flushing-manual-flush-example" class="exampleblock">
<div class="title">Example 369. <code>MANUAL</code> flushing</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">"John Doe"</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">setHibernateFlushMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FlushMode</span><span class="pun">.</span><span class="pln">MANUAL </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> entityManager
    </span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="str">"select count(id) from Person"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(((</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session
    </span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="str">"select count(*) from Person"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">()).</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT COUNT</span><span class="pun">(</span><span class="pln">p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> AS col_0_0_
FROM   </span><span class="typ">Person</span><span class="pln"> p

SELECT COUNT</span><span class="pun">(*)</span><span class="pln">
FROM   </span><span class="typ">Person</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>INSERT</code> statement was not executed because the persistence context because there was no manual <code>flush()</code> call.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This mode is useful when using multi-request logical transactions, and only the last request should flush the persistence context.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="flushing-order"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing-order"></a>6.5. Flush operation order</h3>
<div class="paragraph">
<p>From a database perspective, a row state can be altered using either an <code>INSERT</code>, an <code>UPDATE</code> or a <code>DELETE</code> statement.
Because entity state changes are automatically converted to SQL statements, itâ€™s important to know which entity actions are associated with a given SQL statement.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>INSERT</code></dt>
<dd>
<p>The <code>INSERT</code> statement is generated either by the <code>EntityInsertAction</code> or <code>EntityIdentityInsertAction</code>. These actions are scheduled by the <code>persist</code> operation, either explicitly or through cascading the <code>PersistEvent</code> from a parent to a child entity.</p>
</dd>
<dt class="hdlist1"><code>DELETE</code></dt>
<dd>
<p>The <code>DELETE</code> statement is generated by the <code>EntityDeleteAction</code> or <code>OrphanRemovalAction</code>.</p>
</dd>
<dt class="hdlist1"><code>UPDATE</code></dt>
<dd>
<p>The <code>UPDATE</code> statement is generated by <code>EntityUpdateAction</code> during flushing if the managed entity has been marked modified. The dirty checking mechanism is responsible for determining if a managed entity has been modified since it was first loaded.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hibernate does not execute the SQL statements in the order of their associated entity state operations.</p>
</div>
<div class="paragraph">
<p>To visualize how this works, consider the following example:</p>
</div>
<div id="flushing-order-example" class="exampleblock">
<div class="title">Example 370. Flush operation order</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Person</span><span class="pln"> newPerson </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
newPerson</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
newPerson</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> newPerson </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">INSERT INTO </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES </span><span class="pun">(</span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pun">)</span><span class="pln">

DELETE FROM </span><span class="typ">Person</span><span class="pln"> WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Even if we removed the first entity and then persist a new one, Hibernate is going to execute the <code>DELETE</code> statement after the <code>INSERT</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order in which SQL statements are executed is given by the <code>ActionQueue</code> and not by the order in which entity state operations have been previously defined.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>ActionQueue</code> executes all operations in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>OrphanRemovalAction</code></p>
</li>
<li>
<p><code>EntityInsertAction</code> or <code>EntityIdentityInsertAction</code></p>
</li>
<li>
<p><code>EntityUpdateAction</code></p>
</li>
<li>
<p><code>CollectionRemoveAction</code></p>
</li>
<li>
<p><code>CollectionUpdateAction</code></p>
</li>
<li>
<p><code>CollectionRecreateAction</code></p>
</li>
<li>
<p><code>EntityDeleteAction</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database"></a>7. Database access</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="database-connectionprovider"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider"></a>7.1. ConnectionProvider</h3>
<div class="paragraph">
<p>As an ORM tool, probably the single most important thing you need to tell Hibernate is how to connect to your database so that it may connect on behalf of your application.
This is ultimately the function of the <code>org.hibernate.engine.jdbc.connections.spi.ConnectionProvider</code> interface.
Hibernate provides some out of the box implementations of this interface.
<code>ConnectionProvider</code> is also an extension point so you can also use custom implementations from third parties or written yourself.
The <code>ConnectionProvider</code> to use is defined by the <code>hibernate.connection.provider_class</code> setting. See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/cfg/AvailableSettings.html#CONNECTION_PROVIDER"><code>org.hibernate.cfg.AvailableSettings#CONNECTION_PROVIDER</code></a></p>
</div>
<div class="paragraph">
<p>Generally speaking, applications should not have to configure a <code>ConnectionProvider</code> explicitly if using one of the Hibernate-provided implementations.
Hibernate will internally determine which <code>ConnectionProvider</code> to use based on the following algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <code>hibernate.connection.provider_class</code> is set, it takes precedence</p>
</li>
<li>
<p>else if <code>hibernate.connection.datasource</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-datasource">Using DataSources</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.c3p0.</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-c3p0">Using c3p0</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.proxool.</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-proxool">Using Proxool</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.hikari.</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-hikari">Using HikariCP</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.vibur.</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-vibur">Using Vibur DBCP</a></p>
</li>
<li>
<p>else if any setting prefixed by <code>hibernate.agroal.</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-agroal">Using Agroal</a></p>
</li>
<li>
<p>else if <code>hibernate.connection.url</code> is set â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-drivermanager">Using Hibernateâ€™s built-in (and unsupported) pooling</a></p>
</li>
<li>
<p>else â†’ <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-provided">User-provided Connections</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-datasource"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-datasource"></a>7.2. Using DataSources</h3>
<div class="paragraph">
<p>Hibernate can integrate with a <code>javax.sql.DataSource</code> for obtaining JDBC Connections.
Applications would tell Hibernate about the <code>DataSource</code> via the (required) <code>hibernate.connection.datasource</code> setting which can either specify a JNDI name or would reference the actual <code>DataSource</code> instance.
For cases where a JNDI name is given, be sure to read <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jndi">JNDI</a></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For JPA applications, note that <code>hibernate.connection.datasource</code> corresponds to either <code>javax.persistence.jtaDataSource</code> or <code>javax.persistence.nonJtaDataSource</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>DataSource</code> <code>ConnectionProvider</code> also (optionally) accepts the <code>hibernate.connection.username</code> and <code>hibernate.connection.password</code>.
If specified, the <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html#getConnection-java.lang.String-java.lang.String-"><code>DataSource#getConnection(String username, String password)</code></a> will be used.
Otherwise, the no-arg form is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-c3p0"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-c3p0"></a>7.3. Using c3p0</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this integration, the application must include the hibernate-c3p0 module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="http://www.mchange.com/projects/c3p0/">c3p0</a> connection pooling.
When using this c3p0 support, a number of additional configuration settings are recognized.</p>
</div>
<div class="paragraph">
<p>Transaction isolation of the Connections is managed by the <code>ConnectionProvider</code> itself. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>The name of the JDBC Driver class to use</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>The JDBC connection url.</p>
</dd>
<dt class="hdlist1">Any settings prefixed with <code>hibernate.connection.</code> (other than the "special ones")</dt>
<dd>
<p>These all have the <code>hibernate.connection.</code> prefix stripped and the rest will be passed as JDBC connection properties</p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.min_size</code> or <code>c3p0.minPoolSize</code></dt>
<dd>
<p>The minimum size of the c3p0 pool. See <a href="http://www.mchange.com/projects/c3p0/#minPoolSize">c3p0 minPoolSize</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.max_size</code> or <code>c3p0.maxPoolSize</code></dt>
<dd>
<p>The maximum size of the c3p0 pool. See <a href="http://www.mchange.com/projects/c3p0/#maxPoolSize">c3p0 maxPoolSize</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.timeout</code> or <code>c3p0.maxIdleTime</code></dt>
<dd>
<p>The Connection idle time. See <a href="http://www.mchange.com/projects/c3p0/#maxIdleTime">c3p0 maxIdleTime</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.max_statements</code> or <code>c3p0.maxStatements</code></dt>
<dd>
<p>Controls the c3p0 PreparedStatement cache size (if using). See <a href="http://www.mchange.com/projects/c3p0/#maxStatements">c3p0 maxStatements</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.acquire_increment</code> or <code>c3p0.acquireIncrement</code></dt>
<dd>
<p>Number of connections c3p0 should acquire at a time when the pool is exhausted. See <a href="http://www.mchange.com/projects/c3p0/#acquireIncrement">c3p0 acquireIncrement</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.idle_test_period</code> or <code>c3p0.idleConnectionTestPeriod</code></dt>
<dd>
<p>Idle time before a c3p0 pooled connection is validated. See <a href="http://www.mchange.com/projects/c3p0/#idleConnectionTestPeriod">c3p0 idleConnectionTestPeriod</a></p>
</dd>
<dt class="hdlist1"><code>hibernate.c3p0.initialPoolSize</code></dt>
<dd>
<p>The initial c3p0 pool size. If not specified, default is to use the min pool size. See <a href="http://www.mchange.com/projects/c3p0/#initialPoolSize">c3p0 initialPoolSize</a></p>
</dd>
<dt class="hdlist1">Any other settings prefixed with <code>hibernate.c3p0.</code></dt>
<dd>
<p>Will have the <code>hibernate.</code> portion stripped and be passed to c3p0.</p>
</dd>
<dt class="hdlist1">Any other settings prefixed with <code>c3p0.</code></dt>
<dd>
<p>Get passed to c3p0 as is. See <a href="http://www.mchange.com/projects/c3p0/#configuration">c3p0 configuration</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-proxool"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-proxool"></a>7.4. Using Proxool</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this integration, the application must include the hibernate-proxool module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="http://proxool.sourceforge.net/">Proxool</a> connection pooling.</p>
</div>
<div class="paragraph">
<p>Transaction isolation of the Connections is managed by the <code>ConnectionProvider</code> itself. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</div>
<div class="sect3">
<h4 id="database-connectionprovider-proxool-existing"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-proxool-existing"></a>7.4.1. Using existing Proxool pools</h4>
<div class="paragraph">
<p>Controlled by the <code>hibernate.proxool.existing_pool</code> setting.
If set to true, this ConnectionProvider will use an already existing Proxool pool by alias as indicated by the <code>hibernate.proxool.pool_alias</code> setting.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-connectionprovider-proxool-jaxp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-proxool-jaxp"></a>7.4.2. Configuring Proxool via XML</h4>
<div class="paragraph">
<p>The <code>hibernate.proxool.xml</code> setting names a Proxool configuration XML file to be loaded as a classpath resource and loaded by Proxoolâ€™s JAXPConfigurator.
See <a href="http://proxool.sourceforge.net/configure.html">proxool  configuration</a>.
<code>hibernate.proxool.pool_alias</code> must be set to indicate which pool to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-connectionprovider-proxool-properties"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-proxool-properties"></a>7.4.3. Configuring Proxool via Properties</h4>
<div class="paragraph">
<p>The <code>hibernate.proxool.properties</code> setting names a Proxool configuration properties file to be loaded as a classpath resource and loaded by Proxoolâ€™s <code>PropertyConfigurator</code>.
See <a href="http://proxool.sourceforge.net/configure.html">proxool  configuration</a>.
<code>hibernate.proxool.pool_alias</code> must be set to indicate which pool to use.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-hikari"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-hikari"></a>7.5. Using HikariCP</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this integration, the application must include the hibernate-hikari module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="http://brettwooldridge.github.io/HikariCP/">Hikari</a> connection pool.</p>
</div>
<div class="paragraph">
<p>Set all of your Hikari settings in Hibernate prefixed by <code>hibernate.hikari.</code> and this <code>ConnectionProvider</code> will pick them up and pass them along to Hikari.
Additionally, this <code>ConnectionProvider</code> will pick up the following Hibernate-specific properties and map them to the corresponding Hikari ones (any <code>hibernate.hikari.</code> prefixed ones have precedence):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>driverClassName</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>jdbcUrl</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.username</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>username</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.password</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>password</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.isolation</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>transactionIsolation</code> setting. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.
Note that Hikari only supports JDBC standard isolation levels (apparently).</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.autocommit</code></dt>
<dd>
<p>Mapped to Hikariâ€™s <code>autoCommit</code> setting</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-vibur"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-vibur"></a>7.6. Using Vibur DBCP</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this integration, the application must include the hibernate-vibur module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="http://www.vibur.org/">Vibur DBCP</a> connection pool.</p>
</div>
<div class="paragraph">
<p>Set all of your Vibur settings in Hibernate prefixed by <code>hibernate.vibur.</code> and this <code>ConnectionProvider</code> will pick them up and pass them along to Vibur DBCP.
Additionally, this <code>ConnectionProvider</code> will pick up the following Hibernate-specific properties and map them to the corresponding Vibur ones (any <code>hibernate.vibur.</code> prefixed ones have precedence):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>driverClassName</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>jdbcUrl</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.username</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>username</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.password</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>password</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.isolation</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>defaultTransactionIsolationValue</code> setting. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.autocommit</code></dt>
<dd>
<p>Mapped to Viburâ€™s <code>defaultAutoCommit</code> setting</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-agroal"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-agroal"></a>7.7. Using Agroal</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this integration, the application must include the hibernate-agroal module jar (as well as its dependencies) on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also provides support for applications to use <a href="http://agroal.github.io/">Agroal</a> connection pool.</p>
</div>
<div class="paragraph">
<p>Set all of your Agroal settings in Hibernate prefixed by <code>hibernate.agroal.</code> and this <code>ConnectionProvider</code> will pick them up and pass them along to Agroal connection pool.
Additionally, this <code>ConnectionProvider</code> will pick up the following Hibernate-specific properties and map them to the corresponding Agroal ones (any <code>hibernate.agroal.</code> prefixed ones have precedence):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.connection.driver_class</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>driverClassName</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.url</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>jdbcUrl</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.username</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>principal</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.password</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>credential</code> setting</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.isolation</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>jdbcTransactionIsolation</code> setting. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation">ConnectionProvider support for transaction isolation setting</a>.</p>
</dd>
<dt class="hdlist1"><code>hibernate.connection.autocommit</code></dt>
<dd>
<p>Mapped to Agroalâ€™s <code>autoCommit</code> setting</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-drivermanager"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-drivermanager"></a>7.8. Using Hibernateâ€™s built-in (and unsupported) pooling</h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The built-in connection pool is not supported for use in a production system.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This section is here just for completeness.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-provided"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-provided"></a>7.9. User-provided Connections</h3>
<div class="paragraph">
<p>It is possible to use Hibernate by simply passing a Connection to use to the Session when the Session is opened.
This usage is discouraged and not discussed here.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-connectionprovider-isolation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-connectionprovider-isolation"></a>7.10. ConnectionProvider support for transaction isolation setting</h3>
<div class="paragraph">
<p>All of the provided ConnectionProvider implementations, other than <code>DataSourceConnectionProvider</code>, support consistent setting of transaction isolation for all <code>Connections</code> obtained from the underlying pool.
The value for <code>hibernate.connection.isolation</code> can be specified in one of 3 formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the integer value accepted at the JDBC level</p>
</li>
<li>
<p>the name of the <code>java.sql.Connection</code> constant field representing the isolation you would like to use.
For example, <code>TRANSACTION_REPEATABLE_READ</code> for <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html#TRANSACTION_REPEATABLE_READ"><code>java.sql.Connection#TRANSACTION_REPEATABLE_READ</code></a>.
Not that this is only supported for JDBC standard isolation levels, not for isolation levels specific to a particular JDBC driver.</p>
</li>
<li>
<p>a short-name version of the java.sql.Connection constant field without the <code>TRANSACTION_</code> prefix. For example, <code>REPEATABLE_READ</code> for <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html#TRANSACTION_REPEATABLE_READ"><code>java.sql.Connection#TRANSACTION_REPEATABLE_READ</code></a>.
Again, this is only supported for JDBC standard isolation levels, not for isolation levels specific to a particular JDBC driver.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="database-dialect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#database-dialect"></a>7.11. Database Dialect</h3>
<div class="paragraph">
<p>Although SQL is relatively standardized, each database vendor uses a subset and superset of ANSI SQL defined syntax.
This is referred to as the databaseâ€™s dialect.
Hibernate handles variations across these dialects through its <code>org.hibernate.dialect.Dialect</code> class and the various subclasses for each database vendor.</p>
</div>
<div class="paragraph">
<p>In most cases, Hibernate will be able to determine the proper Dialect to use by asking some questions of the JDBC Connection during bootstrap.
For information on Hibernateâ€™s ability to determine the proper Dialect to use (and your ability to influence that resolution), see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-dialectresolver">Dialect resolution</a>.</p>
</div>
<div class="paragraph">
<p>If for some reason it is not able to determine the proper one or you want to use a custom Dialect, you will need to set the <code>hibernate.dialect</code> setting.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Provided Dialects</caption>
<colgroup>
<col style="width: 28%;">
<col style="width: 72%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dialect (short name)</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the CachÃ© database, version 2007.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CUBRID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the CUBRID database, version 8.3. May work with later versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the DB2 database, version 8.2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB297</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the DB2 database, version 9.7.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2390</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for DB2 Universal Database for OS/390, also known as DB2/390.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for DB2 Universal Database for iSeries, also known as DB2/400.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DerbyTenFive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Derby database, version 10.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DerbyTenSix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Derby database, version 10.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DerbyTenSeven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Derby database, version 10.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firebird</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Firebird database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FrontBase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Frontbase database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the H2 database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HANAColumnStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SAP HANA database column store. This is the recommended dialect for the SAP HANA database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HANARowStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SAP HANA database row store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the HSQL (HyperSQL) database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Informix database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Ingres database, version 9.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingres9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Ingres database, version 9.3. May work with newer versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingres10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Ingres database, version 10. May work with newer versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Interbase database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDataStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the JDataStore database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">McKoi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the McKoi database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mimer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Mimer database, version 9.2.1. May work with newer versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the MySQL database, version 5.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL5InnoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the MySQL database, version 5.x preferring the InnoDB storage engine when exporting tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL57InnoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the MySQL database, version 5.7 preferring the InnoDB storage engine when exporting tables. May work with newer versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the MariaDB database. May work with newer versions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the MariaDB database, version 5.3 and newer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle8i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Oracle database, version 8i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle9i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Oracle database, version 9i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle10g</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Oracle database, version 10g</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Pointbase database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgresPlus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Postgres Plus database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the PostgrSQL database, version 8.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the PostgreSQL database, version 8.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the PostgreSQL database, version 9. May work with later versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Progress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Progress database, version 9.1C. May work with newer versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAPDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SAPDB/MAXDB database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SQL Server 2000 database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLServer2005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SQL Server 2005 database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLServer2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the SQL Server 2008 database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sybase11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Sybase database, up to version 11.9.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SybaseAnywhere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Sybase Anywhere database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SybaseASE15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Sybase Adaptive Server Enterprise database, version 15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SybaseASE157</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Sybase Adaptive Server Enterprise database, version 15.7. May work with newer versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Teradata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the Teradata database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimesTen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for the TimesTen database, version 5.1. May work with newer versions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions"></a>8. Transactions and concurrency control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is important to understand that the term transaction has many different yet related meanings in regards to persistence and Object/Relational Mapping.
In most use-cases these definitions align, but that is not always the case.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Might refer to the physical transaction with the database.</p>
</li>
<li>
<p>Might refer to the logical notion of a transaction as related to a persistence context.</p>
</li>
<li>
<p>Might refer to the application notion of a Unit-of-Work, as defined by the archetypal pattern.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This documentation largely treats the physical and logic notions of a transaction as one-in-the-same.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="transactions-physical"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions-physical"></a>8.1. Physical Transactions</h3>
<div class="paragraph">
<p>Hibernate uses the JDBC API for persistence. In the world of Java, there are two well-defined mechanisms for dealing with transactions in JDBC: JDBC itself and JTA.
Hibernate supports both mechanisms for integrating with transactions and allowing applications to manage physical transactions.</p>
</div>
<div class="paragraph">
<p>The transaction handling per <code>Session</code> is handled by the <code>org.hibernate.resource.transaction.spi.TransactionCoordinator</code> contract,
which are built by the <code>org.hibernate.resource.transaction.spi.TransactionCoordinatorBuilder</code> service.
<code>TransactionCoordinatorBuilder</code> represents a strategy for dealing with transactions whereas TransactionCoordinator represents one instance of that strategy related to a Session.
Which <code>TransactionCoordinatorBuilder</code> implementation to use is defined by the <code>hibernate.transaction.coordinator_class</code> setting.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>jdbc</code> (the default for non-JPA applications)</dt>
<dd>
<p>Manages transactions via calls to <code>java.sql.Connection</code></p>
</dd>
<dt class="hdlist1"><code>jta</code></dt>
<dd>
<p>Manages transactions via JTA. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant">Java EE bootstrapping</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a JPA application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate will
automatically build the proper transaction coordinator based on the transaction type for the persistence unit.</p>
</div>
<div class="paragraph">
<p>If a non-JPA application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate
will use <code>jdbc</code> as the default. This default will cause problems if the application actually uses JTA-based transactions.
A non-JPA application that uses JTA-based transactions should explicitly set <code>hibernate.transaction.coordinator_class=jta</code>
or provide a custom <code>org.hibernate.resource.transaction.TransactionCoordinatorBuilder</code> that builds a
<code>org.hibernate.resource.transaction.TransactionCoordinator</code> that properly coordinates with JTA-based transactions.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For details on implementing a custom <code>TransactionCoordinatorBuilder</code>, or simply better understanding how it works, see the Integrations Guide.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate uses JDBC connections and JTA resources directly, without adding any additional locking behavior.
Hibernate does not lock objects in memory.
The behavior defined by the isolation level of your database transactions does not change when you use Hibernate.
The Hibernate <code>Session</code> acts as a transaction-scoped cache providing repeatable reads for lookup by identifier and queries that result in loading entities.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To reduce lock contention in the database, the physical database transaction needs to be as short as possible.
Long-running database transactions prevent your application from scaling to a highly-concurrent load.
Do not hold a database transaction open during end-user-level work, but open it after the end-user-level work is finished.
This concept is referred to as <code>transactional write-behind</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="transactions-physical-jtaplatform"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions-physical-jtaplatform"></a>8.2. JTA configuration</h3>
<div class="paragraph">
<p>Interaction with a JTA system is consolidated behind a single contract named <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> which exposes access to the <code>javax.transaction.TransactionManager</code>
and <code>javax.transaction.UserTransaction</code> for that system as well as exposing the ability to register <code>javax.transaction.Synchronization</code> instances, check transaction status, etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Generally, <code>JtaPlatform</code> will need access to JNDI to resolve the JTA <code>TransactionManager</code>, <code>UserTransaction</code>, etc.
See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jndi">JNDI chapter</a> for details on configuring access to JNDI.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate tries to discover the <code>JtaPlatform</code> it should use through the use of another service named <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatformResolver</code>.
If that resolution does not work, or if you wish to provide a custom implementation you will need to specify the <code>hibernate.transaction.jta.platform</code> setting.
Hibernate provides many implementations of the <code>JtaPlatform</code> contract, all with short names:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Borland</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Borland Enterprise Server.</p>
</dd>
<dt class="hdlist1"><code>Bitronix</code></dt>
<dd>
<p><code>JtaPlatform</code> for Bitronix.</p>
</dd>
<dt class="hdlist1"><code>JBossAS</code></dt>
<dd>
<p><code>JtaPlatform</code> for Arjuna/JBossTransactions/Narayana when used within the JBoss/WildFly Application Server.</p>
</dd>
<dt class="hdlist1"><code>JBossTS</code></dt>
<dd>
<p><code>JtaPlatform</code> for Arjuna/JBossTransactions/Narayana when used standalone.</p>
</dd>
<dt class="hdlist1"><code>JOnAS</code></dt>
<dd>
<p><code>JtaPlatform</code> for JOTM when used within JOnAS.</p>
</dd>
<dt class="hdlist1"><code>JOTM</code></dt>
<dd>
<p><code>JtaPlatform</code> for JOTM when used standalone.</p>
</dd>
<dt class="hdlist1"><code>JRun4</code></dt>
<dd>
<p><code>JtaPlatform</code> for the JRun 4 Application Server.</p>
</dd>
<dt class="hdlist1"><code>OC4J</code></dt>
<dd>
<p><code>JtaPlatform</code> for Oracleâ€™s OC4J container.</p>
</dd>
<dt class="hdlist1"><code>Orion</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Orion Application Server.</p>
</dd>
<dt class="hdlist1"><code>Resin</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Resin Application Server.</p>
</dd>
<dt class="hdlist1"><code>SapNetWeaver</code></dt>
<dd>
<p><code>JtaPlatform</code> for the SAP NetWeaver Application Server.</p>
</dd>
<dt class="hdlist1"><code>SunOne</code></dt>
<dd>
<p><code>JtaPlatform</code> for the SunOne Application Server.</p>
</dd>
<dt class="hdlist1"><code>Weblogic</code></dt>
<dd>
<p><code>JtaPlatform</code> for the Weblogic Application Server.</p>
</dd>
<dt class="hdlist1"><code>WebSphere</code></dt>
<dd>
<p><code>JtaPlatform</code> for older versions of the WebSphere Application Server.</p>
</dd>
<dt class="hdlist1"><code>WebSphereExtended</code></dt>
<dd>
<p><code>JtaPlatform</code> for newer versions of the WebSphere Application Server.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="transactions-api"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions-api"></a>8.3. Hibernate Transaction API</h3>
<div class="paragraph">
<p>Hibernate provides an API for helping to isolate applications from the differences in the underlying physical transaction system in use.
Based on the configured <code>TransactionCoordinatorBuilder</code>, Hibernate will simply do the right thing when this transaction API is used by the application.
This allows your applications and components to be more portable move around into different environments.</p>
</div>
<div class="paragraph">
<p>To use this API, you would obtain the <code>org.hibernate.Transaction</code> from the Session. <code>Transaction</code> allows for all the normal operations youâ€™d expect: <code>begin</code>, <code>commit</code> and <code>rollback</code>, and it even exposes some cool methods like:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>markRollbackOnly</code></dt>
<dd>
<p>that works in both JTA and JDBC</p>
</dd>
<dt class="hdlist1"><code>getTimeout</code> and <code>setTimeout</code></dt>
<dd>
<p>that again work in both JTA and JDBC</p>
</dd>
<dt class="hdlist1"><code>registerSynchronization</code></dt>
<dd>
<p>that allows you to register JTA Synchronizations even in non-JTA environments.
In fact, in both JTA and JDBC environments, these <code>Synchronizations</code> are kept locally by Hibernate.
In JTA environments, Hibernate will only ever register one single <code>Synchronization</code> with the <code>TransactionManager</code> to avoid ordering problems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, it exposes a getStatus method that returns an <code>org.hibernate.resource.transaction.spi.TransactionStatus</code> enum.
This method checks with the underlying transaction system if needed, so care should be taken to minimize its use; it can have a big performance impact in certain JTA setups.</p>
</div>
<div class="paragraph">
<p>Letâ€™s take a look at using the Transaction API in the various environments.</p>
</div>
<div id="transactions-api-jdbc-example" class="exampleblock">
<div class="title">Example 371. Using Transaction API in JDBC</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StandardServiceRegistry</span><span class="pln"> serviceRegistry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="com">// "jdbc" is the default, but for explicitness</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">applySetting</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">TRANSACTION_COORDINATOR_STRATEGY</span><span class="pun">,</span><span class="pln"> </span><span class="str">"jdbc"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> serviceRegistry </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> metadata</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// calls Connection#setAutoCommit( false ) to</span><span class="pln">
	</span><span class="com">// signal start of transaction</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"UPDATE customer set NAME = 'Sir. '||NAME"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
			</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span><span class="pln">

	</span><span class="com">// calls Connection#commit(), if an error</span><span class="pln">
	</span><span class="com">// happens we attempt a rollback</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// we may need to rollback depending on</span><span class="pln">
	</span><span class="com">// where the exception happened</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">ACTIVE
			</span><span class="pun">||</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">MARKED_ROLLBACK </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="com">// handle the underlying error</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	sessionFactory</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="transactions-api-cmt-example" class="exampleblock">
<div class="title">Example 372. Using Transaction API in JTA (CMT)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StandardServiceRegistry</span><span class="pln"> serviceRegistry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="com">// "jdbc" is the default, but for explicitness</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">applySetting</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">TRANSACTION_COORDINATOR_STRATEGY</span><span class="pun">,</span><span class="pln"> </span><span class="str">"jta"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> serviceRegistry </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> metadata</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Note: depending on the JtaPlatform used and some optional settings,</span><span class="pln">
</span><span class="com">// the underlying transactions here will be controlled through either</span><span class="pln">
</span><span class="com">// the JTA TransactionManager or UserTransaction</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// Since we are in CMT, a JTA transaction would</span><span class="pln">
	</span><span class="com">// already have been started.  This call essentially</span><span class="pln">
	</span><span class="com">// no-ops</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	</span><span class="typ">Number</span><span class="pln"> customerCount </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select count(c) from Customer c"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">uniqueResult</span><span class="pun">();</span><span class="pln">

	</span><span class="com">// Since we did not start the transaction ( CMT ),</span><span class="pln">
	</span><span class="com">// we also will not end it.  This call essentially</span><span class="pln">
	</span><span class="com">// no-ops in terms of transaction handling.</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// again, the rollback call here would no-op (aside from</span><span class="pln">
	</span><span class="com">// marking the underlying CMT transaction for rollback only).</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">ACTIVE
			</span><span class="pun">||</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">MARKED_ROLLBACK </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="com">// handle the underlying error</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	sessionFactory</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="transactions-api-bmt-example" class="exampleblock">
<div class="title">Example 373. Using Transaction API in JTA (BMT)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StandardServiceRegistry</span><span class="pln"> serviceRegistry </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="com">// "jdbc" is the default, but for explicitness</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">applySetting</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">TRANSACTION_COORDINATOR_STRATEGY</span><span class="pun">,</span><span class="pln"> </span><span class="str">"jta"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Metadata</span><span class="pln"> metadata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> serviceRegistry </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> metadata</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Note: depending on the JtaPlatform used and some optional settings,</span><span class="pln">
</span><span class="com">// the underlying transactions here will be controlled through either</span><span class="pln">
</span><span class="com">// the JTA TransactionManager or UserTransaction</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// Assuming a JTA transaction is not already active,</span><span class="pln">
	</span><span class="com">// this call the TM/UT begin method.  If a JTA</span><span class="pln">
	</span><span class="com">// transaction is already active, we remember that</span><span class="pln">
	</span><span class="com">// the Transaction associated with the Session did</span><span class="pln">
	</span><span class="com">// not "initiate" the JTA transaction and will later</span><span class="pln">
	</span><span class="com">// nop-op the commit and rollback calls...</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">(</span><span class="pln">  </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select c from Customer c"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">uniqueResult</span><span class="pun">();</span><span class="pln">

	</span><span class="com">// calls TM/UT commit method, assuming we are initiator.</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// we may need to rollback depending on</span><span class="pln">
	</span><span class="com">// where the exception happened</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">ACTIVE
			</span><span class="pun">||</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">MARKED_ROLLBACK </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="com">// calls TM/UT commit method, assuming we are initiator;</span><span class="pln">
		</span><span class="com">// otherwise marks the JTA transaction for rollback only</span><span class="pln">
		session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="com">// handle the underlying error</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	session</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	sessionFactory</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the CMT case, we really could have omitted all of the Transaction calls.
But the point of the examples was to show that the Transaction API really does insulate your code from the underlying transaction mechanism.
In fact, if you strip away the comments and the single configuration setting supplied at bootstrap, the code is exactly the same in all 3 examples.
In other words, we could develop that code and drop it, as-is, in any of the 3 transaction environments.</p>
</div>
<div class="paragraph">
<p>The Transaction API tries hard to make the experience consistent across all environments.
To that end, it generally defers to the JTA specification when there are differences (for example automatically trying rollback on a failed commit).</p>
</div>
</div>
<div class="sect2">
<h3 id="architecture-current-session"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#architecture-current-session"></a>8.4. Contextual sessions</h3>
<div class="paragraph">
<p>Most applications using Hibernate need some form of <em>contextual</em> session, where a given session is in effect throughout the scope of a given context.
However, across applications the definition of what constitutes a context is typically different; different contexts define different scopes to the notion of current.
Applications using Hibernate prior to version 3.0 tended to utilize either home-grown <code>ThreadLocal</code>-based contextual sessions, helper classes such as <code>HibernateUtil</code>, or utilized third-party frameworks, such as Spring or Pico, which provided proxy/interception-based contextual sessions.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.0.1, Hibernate added the <code>SessionFactory.getCurrentSession()</code> method.
Initially, this assumed usage of <code>JTA</code> transactions, where the <code>JTA</code> transaction defined both the scope and context of a current session.
Given the maturity of the numerous stand-alone <code>JTA TransactionManager</code> implementations, most, if not all, applications should be using <code>JTA</code> transaction management, whether or not they are deployed into a <code>J2EE</code> container.
Based on that, the <code>JTA</code>-based contextual sessions are all you need to use.</p>
</div>
<div class="paragraph">
<p>However, as of version 3.1, the processing behind <code>SessionFactory.getCurrentSession()</code> is now pluggable.
To that end, a new extension interface, <code>org.hibernate.context.spi.CurrentSessionContext</code>,
and a new configuration parameter, <code>hibernate.current_session_context_class</code>, have been added to allow pluggability of the scope and context of defining current sessions.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/spi/CurrentSessionContext.html">Javadocs</a> for the <code>org.hibernate.context.spi.CurrentSessionContext</code> interface for a detailed discussion of its contract.
It defines a single method, <code>currentSession()</code>, by which the implementation is responsible for tracking the current contextual session.
Out-of-the-box, Hibernate comes with three implementations of this interface:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.context.internal.JTASessionContext</code></dt>
<dd>
<p>current sessions are tracked and scoped by a <code>JTA</code> transaction.
The processing here is exactly the same as in the older JTA-only approach.
See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/internal/JTASessionContext.html">Javadocs</a> for more details.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.context.internal.ThreadLocalSessionContext</code></dt>
<dd>
<p>current sessions are tracked by thread of execution. See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/internal/ThreadLocalSessionContext.html">Javadocs</a> for more details.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.context.internal.ManagedSessionContext</code></dt>
<dd>
<p>current sessions are tracked by thread of execution.
However, you are responsible to bind and unbind a <code>Session</code> instance with static methods on this class; it does not open, flush, or close a <code>Session</code>.
See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/internal/ManagedSessionContext.html">Javadocs</a> for details.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Typically, the value of this parameter would just name the implementation class to use.
For the three out-of-the-box implementations, however, there are three corresponding short names: <em>jta</em>, <em>thread</em>, and <em>managed</em>.</p>
</div>
<div class="paragraph">
<p>The first two implementations provide a <em>one session - one database transaction</em> programming model.
This is also known and used as <em>session-per-request</em>.
The beginning and end of a Hibernate session is defined by the duration of a database transaction.
If you use programmatic transaction demarcation in plain Java SE without JTA, you are advised to use the Hibernate <code>Transaction</code> API to hide the underlying transaction system from your code.
If you use JTA, you can utilize the JTA interfaces to demarcate transactions.
If you execute in an EJB container that supports CMT, transaction boundaries are defined declaratively and you do not need any transaction or session demarcation operations in your code. Refer to <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#transactions">Transactions and concurrency control</a> for more information and code examples.</p>
</div>
<div class="paragraph">
<p>The <code>hibernate.current_session_context_class</code> configuration parameter defines which <code>org.hibernate.context.spi.CurrentSessionContext</code> implementation should be used.
For backward compatibility, if this configuration parameter is not set but a <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform</code> is configured, Hibernate will use the <code>org.hibernate.context.internal.JTASessionContext</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transactional_patterns_and_anti_patterns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_transactional_patterns_and_anti_patterns"></a>8.5. Transactional patterns (and anti-patterns)</h3>
<div class="sect3">
<h4 id="session-per-operation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#session-per-operation"></a>8.5.1. Session-per-operation anti-pattern</h4>
<div class="paragraph">
<p>This is an anti-pattern of opening and closing a <code>Session</code> for each database call in a single thread.
It is also an anti-pattern in terms of database transactions.
Group your database calls into a planned sequence.
In the same way, do not auto-commit after every SQL statement in your application.
Hibernate disables or expects the application server to disable, auto-commit mode immediately.
Database transactions are never optional.
All communication with a database must be encapsulated by a transaction.
Avoid auto-commit behavior for reading data because many small transactions are unlikely to perform better than one clearly-defined unit of work, and are more difficult to maintain and extend.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using auto-commit does not circumvent database transactions.
Instead, when in auto-commit mode, JDBC drivers simply perform each call in an implicit transaction call.
It is as if your application called commit after each and every JDBC call.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="session-per-request"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#session-per-request"></a>8.5.2. Session-per-request pattern</h4>
<div class="paragraph">
<p>This is the most common transaction pattern.
The term request here relates to the concept of a system that reacts to a series of requests from a client/user.
Web applications are a prime example of this type of system, though certainly not the only one.
At the beginning of handling such a request, the application opens a Hibernate Session, starts a transaction, performs all data related work, ends the transaction and closes the Session.
The crux of the pattern is the one-to-one relationship between the transaction and the Session.</p>
</div>
<div class="paragraph">
<p>Within this pattern, there is a common technique of defining a current session to simplify the need of passing this <code>Session</code> around to all the application components that may need access to it.
Hibernate provides support for this technique through the <code>getCurrentSession</code> method of the <code>SessionFactory</code>.
The concept of a <em>current</em> session has to have a scope that defines the bounds in which the notion of <em>current</em> is valid.
This is the purpose of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.</p>
</div>
<div class="paragraph">
<p>There are 2 reliable defining scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First is a JTA transaction because it allows a callback hook to know when it is ending, which gives Hibernate a chance to close the <code>Session</code> and clean up.
This is represented by the <code>org.hibernate.context.internal.JTASessionContext</code> implementation of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.
Using this implementation, a <code>Session</code> will be opened the first time <code>getCurrentSession</code> is called within that transaction.</p>
</li>
<li>
<p>Secondly is this application request cycle itself.
This is best represented with the <code>org.hibernate.context.internal.ManagedSessionContext</code> implementation of the <code>org.hibernate.context.spi.CurrentSessionContext</code> contract.
Here an external component is responsible for managing the lifecycle and scoping of a <em>current</em> session.
At the start of such a scope, <code>ManagedSessionContext#bind()</code> method is called passing in the <code>Session</code>.
In the end, its <code>unbind()</code> method is called.
Some common examples of such <em>external components</em> include:</p>
<div class="ulist">
<ul>
<li>
<p><code>javax.servlet.Filter</code> implementation</p>
</li>
<li>
<p>AOP interceptor with a pointcut on the service methods</p>
</li>
<li>
<p>A proxy/interception container</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>getCurrentSession()</code> method has one downside in a JTA environment.
If you use it, <code>after_statement</code> connection release mode is also used by default.
Due to a limitation of the JTA specification, Hibernate cannot automatically clean up any unclosed <code>ScrollableResults</code> or <code>Iterator</code> instances returned by <code>scroll()</code> or <code>iterate()</code>.
Release the underlying database cursor by calling <code>ScrollableResults#close()</code> or <code>Hibernate.close(Iterator)</code> explicitly from a finally block.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="long-conversations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#long-conversations"></a>8.5.3. Conversations (application-level transactions)</h4>
<div class="paragraph">
<p>The session-per-request pattern is not the only valid way of designing units of work.
Many business processes require a whole series of interactions with the user that are interleaved with database accesses.
In web and enterprise applications, it is not acceptable for a database transaction to span a user interaction. Consider the following example:</p>
</div>
<div class="paragraph">
<p>The first screen of a dialog opens.
The data seen by the user is loaded in a particular <code>Session</code> and database transaction.
The user is free to modify the objects.</p>
</div>
<div class="paragraph">
<p>The user uses a UI element to save their work after five minutes of editing.
The modifications are made persistent.
The user also expects to have exclusive access to the data during the edit session.</p>
</div>
<div class="paragraph">
<p>Even though we have multiple databases access here, from the point of view of the user, this series of steps represents a single unit of work.
There are many ways to implement this in your application.</p>
</div>
<div class="paragraph">
<p>A first naive implementation might keep the <code>Session</code> and database transaction open while the user is editing, using database-level locks to prevent other users from modifying the same data and to guarantee isolation and atomicity.
This is an anti-pattern because lock contention is a bottleneck which will prevent scalability in the future.</p>
</div>
<div class="paragraph">
<p>Several database transactions are used to implement the conversation.
In this case, maintaining isolation of business processes becomes the partial responsibility of the application tier.
A single conversation usually spans several database transactions.
These multiple database accesses can only be atomic as a whole if only one of these database transactions (typically the last one) stores the updated data.
All others only read data.
A common way to receive this data is through a wizard-style dialog spanning several request/response cycles.
Hibernate includes some features which make this easy to implement.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatic Versioning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hibernate can perform automatic optimistic concurrency control for you.
It can automatically detect (at the end of the conversation) if a concurrent modification occurred during user think time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detached Objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you decide to use the session-per-request pattern, all loaded instances will be in the detached state during user think time.
Hibernate allows you to reattach the objects and persist the modifications.
The pattern is called session-per-request-with-detached-objects.
Automatic versioning is used to isolate concurrent modifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended <code>Session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Hibernate <code>Session</code> can be disconnected from the underlying JDBC connection after the database transaction has been committed and reconnected when a new client request occurs.
This pattern is known as session-per-conversation and makes even reattachment unnecessary.
Automatic versioning is used to isolate concurrent modifications, and the <code>Session</code> will not be allowed to flush automatically, only explicitly.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Session-per-request-with-detached-objects and session-per-conversation each have advantages and disadvantages.</p>
</div>
</div>
<div class="sect3">
<h4 id="session-per-application"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#session-per-application"></a>8.5.4. Session-per-application anti-pattern</h4>
<div class="paragraph">
<p>The <em>session-per-application</em> is also considered an anti-pattern.
The Hibernate <code>Session</code>, like the JPA <code>EntityManager</code>, is not a thread-safe object and it is intended to be confined to a single thread at once.
If the <code>Session</code> is shared among multiple threads, there will be race conditions as well as visibility issues, so beware of this.</p>
</div>
<div class="paragraph">
<p>An exception thrown by Hibernate means you have to rollback your database transaction and close the <code>Session</code> immediately.
If your <code>Session</code> is bound to the application, you have to stop the application.
Rolling back the database transaction does not put your business objects back into the state they were at the start of the transaction.
This means that the database state and the business objects will be out of sync.
Usually, this is not a problem because exceptions are not recoverable and you will have to start over after rollback anyway.</p>
</div>
<div class="paragraph">
<p>For more details, check out the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-exception-handling"><em>exception handling</em></a> chapter.</p>
</div>
<div class="paragraph">
<p>The <code>Session</code> caches every object that is in a persistent state (watched and checked for dirty state by Hibernate).
If you keep it open for a long time or simply load too much data, it will grow endlessly until you get an <code>OutOfMemoryException</code>.
One solution is to call <code>clear()</code> and <code>evict()</code> to manage the <code>Session</code> cache, but you should consider a Stored Procedure if you need mass data operations.
Some solutions are shown in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch">Batching chapter</a>.
Keeping a <code>Session</code> open for the duration of a user session also means a higher probability of stale data.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jndi"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jndi"></a>9. JNDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate does optionally interact with JNDI on the applicationâ€™s behalf.
Generally, it does this when the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>has asked the SessionFactory be bound to JNDI</p>
</li>
<li>
<p>has specified a DataSource to use by JNDI name</p>
</li>
<li>
<p>is using JTA transactions and the <code>JtaPlatform</code> needs to do JNDI lookups for <code>TransactionManager</code>, <code>UserTransaction</code>, etc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these JNDI calls route through a single service whose role is <code>org.hibernate.engine.jndi.spi.JndiService</code>.
The standard <code>JndiService</code> accepts a number of configuration settings</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.jndi.class</code></dt>
<dd>
<p>names the javax.naming.InitialContext implementation class to use. See <a href="https://docs.oracle.com/javase/8/docs/api/javax/naming/Context.html#INITIAL_CONTEXT_FACTORY"><code>javax.naming.Context#INITIAL_CONTEXT_FACTORY</code></a></p>
</dd>
<dt class="hdlist1"><code>hibernate.jndi.url</code></dt>
<dd>
<p>names the JNDI InitialContext connection url. See <a href="https://docs.oracle.com/javase/8/docs/api/javax/naming/Context.html#PROVIDER_URL"><code>javax.naming.Context.PROVIDER_URL</code></a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Any other settings prefixed with <code>hibernate.jndi.</code> will be collected and passed along to the JNDI provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The standard <code>JndiService</code> assumes that all JNDI calls are relative to the same <code>InitialContext</code>.
If your application uses multiple naming servers for whatever reason, you will need a custom <code>JndiService</code> implementation to handle those details.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="locking"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking"></a>10. Locking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a relational database, locking refers to actions taken to prevent data from changing between the time it is read and the time is used.</p>
</div>
<div class="paragraph">
<p>Your locking strategy can be either optimistic or pessimistic.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Optimistic</dt>
<dd>
<p><a href="http://en.wikipedia.org/wiki/Optimistic_locking">Optimistic locking</a> assumes that multiple transactions can complete without affecting each other,
and that therefore transactions can proceed without locking the data resources that they affect.
Before committing, each transaction verifies that no other transaction has modified its data.
If the check reveals conflicting modifications, the committing transaction rolls back.</p>
</dd>
<dt class="hdlist1">Pessimistic</dt>
<dd>
<p>Pessimistic locking assumes that concurrent transactions will conflict with each other,
and requires resources to be locked after they are read and only unlocked after the application has finished using the data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hibernate provides mechanisms for implementing both types of locking in your applications.</p>
</div>
<div class="sect2">
<h3 id="locking-optimistic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic"></a>10.1. Optimistic</h3>
<div class="paragraph">
<p>When your application uses long transactions or conversations that span several database transactions,
you can store versioning data so that if the same entity is updated by two conversations, the last to commit changes is informed of the conflict,
and does not override the other conversationâ€™s work.
This approach guarantees some isolation, but scales well and works particularly well in <em>read-often-write-sometimes</em> situations.</p>
</div>
<div class="paragraph">
<p>Hibernate provides two different mechanisms for storing versioning information, a dedicated version number or a timestamp.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A version or timestamp property can never be null for a detached instance.
Hibernate detects any instance with a null version or timestamp as transient, regardless of other unsaved-value strategies that you specify.
Declaring a nullable version or timestamp property is an easy way to avoid problems with transitive reattachment in Hibernate,
especially useful if you use assigned identifiers or composite keys.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="locking-optimistic-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-mapping"></a>10.1.1. Mapping optimistic locking</h4>
<div class="paragraph">
<p>JPA defines support for optimistic locking based on either a version (sequential numeric) or timestamp strategy.
To enable this style of optimistic locking simply add the <code>javax.persistence.Version</code> to the persistent attribute that defines the optimistic locking value.
According to JPA, the valid types for these attributes are limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int</code> or <code>Integer</code></p>
</li>
<li>
<p><code>short</code> or <code>Short</code></p>
</li>
<li>
<p><code>long</code> or <code>Long</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, Hibernate allows you to use even Java 8 Date/Time types, such as <code>Instant</code>.</p>
</div>
<div id="locking-optimistic-version-example" class="exampleblock">
<div class="title">Example 374. <code>@Version</code> annotation mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Instant</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-version-number"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-version-number"></a>Dedicated version number</h5>
<div class="paragraph">
<p>The version number mechanism for optimistic locking is provided through a <code>@Version</code> annotation.</p>
</div>
<div id="locking-optimistic-version-number-example" class="exampleblock">
<div class="title">Example 375. @Version annotation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Version</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> version</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, the version property is mapped to the <code>version</code> column, and the entity manager uses it to detect conflicting updates,
and prevent the loss of updates that would otherwise be overwritten by a last-commit-wins strategy.</p>
</div>
<div class="paragraph">
<p>The version column can be any kind of type, as long as you define and implement the appropriate <code>UserVersionType</code>.</p>
</div>
<div class="paragraph">
<p>Your application is forbidden from altering the version number set by Hibernate.
To artificially increase the version number, see the documentation for properties <code>LockModeType.OPTIMISTIC_FORCE_INCREMENT</code> or
<code>LockModeType.PESSIMISTIC_FORCE_INCREMENT</code> check in the Hibernate Entity Manager reference documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the version number is generated by the database, such as a trigger, use the annotation <code>@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code> on the version attribute.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-timestamp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-timestamp"></a>Timestamp</h5>
<div class="paragraph">
<p>Timestamps are a less reliable way of optimistic locking than version numbers but can be used by applications for other purposes as well.
Timestamping is automatically used if you the <code>@Version</code> annotation on a <code>Date</code> or <code>Calendar</code> property type.</p>
</div>
<div id="locking-optimistic-version-timestamp-example" class="exampleblock">
<div class="title">Example 376. Using timestamps for optimistic locking</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Version</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> version</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate can retrieve the timestamp value from the database or the JVM, by reading the value you specify for the <code>@org.hibernate.annotations.Source</code> annotation.
The value can be either <code>org.hibernate.annotations.SourceType.DB</code> or <code>org.hibernate.annotations.SourceType.VM</code>.
The default behavior is to use the database and is also used if you donâ€™t specify the annotation at all.</p>
</div>
<div class="paragraph">
<p>The timestamp can also be generated by the database instead of Hibernate
if you use the <code>@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code> or the <code>@Source</code> annotation.</p>
</div>
<div id="locking-optimistic-version-timestamp-source-mapping-example" class="exampleblock">
<div class="title">Example 377. Database-generated version timestamp mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="lit">@Source</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SourceType</span><span class="pun">.</span><span class="pln">DB</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when persisting a <code>Person</code> entity, Hibernate calls the database-specific current timestamp retrieval function:</p>
</div>
<div id="locking-optimistic-version-timestamp-source-persist-example" class="exampleblock">
<div class="title">Example 378. Database-generated version timestamp example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getVersion</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getVersion</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">CALL current_timestamp</span><span class="pun">()</span><span class="pln">

INSERT INTO
    </span><span class="typ">Person</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
VALUES
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">05</span><span class="pun">-</span><span class="lit">18</span><span class="pln"> </span><span class="lit">12</span><span class="pun">:</span><span class="lit">03</span><span class="pun">:</span><span class="lit">03.808</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-exclude-attribute"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-exclude-attribute"></a>Excluding attributes</h5>
<div class="paragraph">
<p>By default, every entity attribute modification is going to trigger a version incrementation.
If there is an entity property which should not bump up the entity version,
then you need to annotate it with the Hibernate <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLock.html"><code>@OptimisticLock</code></a> annotation,
as illustrated in the following example.</p>
</div>
<div id="locking-optimistic-exclude-attribute-mapping-example" class="exampleblock">
<div class="title">Example 379. @OptimisticLock mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`number`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OptimisticLock</span><span class="pun">(</span><span class="pln"> excluded </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> callCount</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> incrementCallCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">callCount</span><span class="pun">++;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, if one thread modifies the <code>Phone</code> number while a second thread increments the <code>callCount</code> attribute,
the two concurrent transactions are not going to conflict as illustrated by the following example.</p>
</div>
<div id="locking-optimistic-exclude-attribute-example" class="exampleblock">
<div class="title">Example 380. @OptimisticLock exlude attribute example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	phone</span><span class="pun">.</span><span class="pln">setNumber</span><span class="pun">(</span><span class="pln"> </span><span class="str">"+123-456-7890"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> _entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Phone</span><span class="pln"> _phone </span><span class="pun">=</span><span class="pln"> _entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		_phone</span><span class="pun">.</span><span class="pln">incrementCallCount</span><span class="pun">();</span><span class="pln">

		log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Bob changes the Phone call count"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	log</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Alice changes the Phone number"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pun">--</span><span class="pln"> </span><span class="typ">Bob</span><span class="pln"> changes the </span><span class="typ">Phone</span><span class="pln"> call count

update
    </span><span class="typ">Phone</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    callCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"number"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123-456-7890'</span><span class="pun">,</span><span class="pln">
    version </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> version </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Alice</span><span class="pln"> changes the </span><span class="typ">Phone</span><span class="pln"> number

update
    </span><span class="typ">Phone</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    callCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"number"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'+123-456-7890'</span><span class="pun">,</span><span class="pln">
    version </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> version </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When Bob changes the <code>Phone</code> entity <code>callCount</code>, the entity version is not bumped up.
Thatâ€™s why Aliceâ€™s UPDATE succeeds since the entity version is still 0, even if Bob has changed the record
since Alice loaded it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although there is no conflict between Bob and Alice, Aliceâ€™s UPDATE overrides Bobâ€™s change to the <code>callCount</code> attribute.</p>
</div>
<div class="paragraph">
<p>For this reason, you should only use this feature if you can accommodate lost updates on the excluded entity properties.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="locking-optimistic-versionless"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-versionless"></a>Versionless optimistic locking</h5>
<div class="paragraph">
<p>Although the default <code>@Version</code> property optimistic locking mechanism is sufficient in many situations,
sometimes, you need rely on the actual database row column values to prevent <strong>lost updates</strong>.</p>
</div>
<div class="paragraph">
<p>Hibernate supports a form of optimistic locking that does not require a dedicated "version attribute".
This is also useful for use with modeling legacy schemas.</p>
</div>
<div class="paragraph">
<p>The idea is that you can get Hibernate to perform "version checks" using either all of the entityâ€™s attributes or just the attributes that have changed.
This is achieved through the use of the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLocking.html"><code>@OptimisticLocking</code></a>
annotation which defines a single attribute of type
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLockType.html"><code>org.hibernate.annotations.OptimisticLockType</code></a>.</p>
</div>
<div class="paragraph">
<p>There are 4 available OptimisticLockTypes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>optimistic locking is disabled even if there is a <code>@Version</code> annotation present</p>
</dd>
<dt class="hdlist1"><code>VERSION</code> (the default)</dt>
<dd>
<p>performs optimistic locking based on a <code>@Version</code> as described above</p>
</dd>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>performs optimistic locking based on <em>all</em> fields as part of an expanded WHERE clause restriction for the UPDATE/DELETE SQL statements</p>
</dd>
<dt class="hdlist1"><code>DIRTY</code></dt>
<dd>
<p>performs optimistic locking based on <em>dirty</em> fields as part of an expanded WHERE clause restriction for the UPDATE/DELETE SQL statements</p>
</dd>
</dl>
</div>
<div class="sect5">
<h6 id="locking-optimistic-versionless-all"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-versionless-all"></a>Versionless optimistic locking using <code>OptimisticLockType.ALL</code></h6>
<div id="locking-optimistic-lock-type-all-example" class="exampleblock">
<div class="title">Example 381. <code>OptimisticLockType.ALL</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OptimisticLocking</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">OptimisticLockType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DynamicUpdate</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you need to modify the <code>Person</code> entity above:</p>
</div>
<div id="locking-optimistic-lock-type-all-update-example" class="exampleblock">
<div class="title">Example 382. <code>OptimisticLockType.ALL</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setCity</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Washington D.C."</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE
    </span><span class="typ">Person</span><span class="pln">
SET
    city</span><span class="pun">=?</span><span class="pln">
WHERE
    id</span><span class="pun">=?</span><span class="pln">
    AND city</span><span class="pun">=?</span><span class="pln">
    AND country</span><span class="pun">=?</span><span class="pln">
    AND created_on</span><span class="pun">=?</span><span class="pln">
    AND </span><span class="str">"name"</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Washington</span><span class="pln"> D</span><span class="pun">.</span><span class="pln">C</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">New</span><span class="pln"> </span><span class="typ">York</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">US</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">11</span><span class="pun">-</span><span class="lit">16</span><span class="pln"> </span><span class="lit">16</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">12.876</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Doe</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, all the columns of the associated database row are used in the <code>WHERE</code> clause.
If any column has changed after the row was loaded, there wonâ€™t be any match, and a <code>StaleStateException</code> or an <code>OptimisticLockException</code>
is going to be thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <code>OptimisticLockType.ALL</code>, you should also use <code>@DynamicUpdate</code> because the <code>UPDATE</code> statement must take into consideration all the entity property values.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="locking-optimistic-versionless-dirty"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-versionless-dirty"></a>Versionless optimistic locking using <code>OptimisticLockType.DIRTY</code></h6>
<div class="paragraph">
<p>The <code>OptimisticLockType.DIRTY</code> differs from <code>OptimisticLockType.ALL</code>
in that it only takes into consideration the entity properties that have changed
since the entity was loaded in the currently running Persistence Context.</p>
</div>
<div id="locking-optimistic-lock-type-dirty-example" class="exampleblock">
<div class="title">Example 383. <code>OptimisticLockType.DIRTY</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@OptimisticLocking</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">OptimisticLockType</span><span class="pun">.</span><span class="pln">DIRTY</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@DynamicUpdate</span><span class="pln">
</span><span class="lit">@SelectBeforeUpdate</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"`name`"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you need to modify the <code>Person</code> entity above:</p>
</div>
<div id="locking-optimistic-lock-type-dirty-update-example" class="exampleblock">
<div class="title">Example 384. <code>OptimisticLockType.DIRTY</code> update example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">setCity</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Washington D.C."</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">UPDATE
    </span><span class="typ">Person</span><span class="pln">
SET
    city</span><span class="pun">=?</span><span class="pln">
WHERE
    id</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> city</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Washington</span><span class="pln"> D</span><span class="pun">.</span><span class="pln">C</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">New</span><span class="pln"> </span><span class="typ">York</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, only the database column that has changed was used in the <code>WHERE</code> clause.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The main advantage of <code>OptimisticLockType.DIRTY</code> over <code>OptimisticLockType.ALL</code>
and the default <code>OptimisticLockType.VERSION</code> used implicitly along with the <code>@Version</code> mapping,
is that it allows you to minimize the risk of <code>OptimisticLockException</code> across non-overlapping entity property changes.</p>
</div>
<div class="paragraph">
<p>When using <code>OptimisticLockType.DIRTY</code>, you should also use <code>@DynamicUpdate</code> because the <code>UPDATE</code> statement must take into consideration all the dirty entity property values,
and also the <code>@SelectBeforeUpdate</code> annotation so that detached entities are properly handled by the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Session.html#update-java.lang.Object-"><code>Session#update(entity)</code></a> operation.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking-pessimistic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-pessimistic"></a>10.2. Pessimistic</h3>
<div class="paragraph">
<p>Typically, you only need to specify an isolation level for the JDBC connections and let the database handle locking issues.
If you do need to obtain exclusive pessimistic locks or re-obtain locks at the start of a new transaction, Hibernate gives you the tools you need.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate always uses the locking mechanism of the database, and never lock objects in memory.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="locking-LockMode"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-LockMode"></a>10.3. <code>LockMode</code> and <code>LockModeType</code></h3>
<div class="paragraph">
<p>Long before JPA 1.0, Hibernate already defined various explicit locking strategies through its <code>LockMode</code> enumeration.
JPA comes with its own <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html"><code>LockModeType</code></a> enumeration which defines similar strategies as the Hibernate-native <code>LockMode</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>LockModeType</code></th>
<th class="tableblock halign-left valign-top"><code>LockMode</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The absence of a lock. All objects switch to this lock mode at the end of a Transaction. Objects associated with the session via a call to <code>update()</code> or <code>saveOrUpdate()</code> also start out in this lock mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ</code> and <code>OPTIMISTIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity version is checked towards the end of the currently running transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WRITE</code> and <code>OPTIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity version is incremented automatically even if the entity has not changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked pessimistically and its version is incremented automatically even if the entity has not changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked pessimistically using a shared lock if the database supports such a feature. Otherwise, an explicit lock is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code>, <code>UPGRADE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is locked using an explicit lock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code> with a <code>javax.persistence.lock.timeout</code> setting of 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPGRADE_NOWAIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lock acquisition request fails fast if the row s already locked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code> with a <code>javax.persistence.lock.timeout</code> setting of -2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPGRADE_SKIPLOCKED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lock acquisition request skips the already locked rows. It uses a <code>SELECT â€¦â€‹ FOR UPDATE SKIP LOCKED</code> in Oracle and PostgreSQL 9.5, or <code>SELECT â€¦â€‹ with (rowlock, updlock, readpast) in SQL Server</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The explicit user request mentioned above occurs as a consequence of any of the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a call to <code>Session.load()</code>, specifying a <code>LockMode</code>.</p>
</li>
<li>
<p>a call to <code>Session.lock()</code>.</p>
</li>
<li>
<p>a call to <code>Query.setLockMode()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you call <code>Session.load()</code> with option <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>,
and the requested object is not already loaded by the session, the object is loaded using <code>SELECT â€¦â€‹ FOR UPDATE</code>.</p>
</div>
<div class="paragraph">
<p>If you call <code>load()</code> for an object that is already loaded with a less restrictive lock than the one you request, Hibernate calls <code>lock()</code> for that object.</p>
</div>
<div class="paragraph">
<p><code>Session.lock(</code>) performs a version number check if the specified lock mode is <code>READ</code>, <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>.
In the case of <code>UPGRADE</code>, <code>UPGRADE_NOWAIT</code> or <code>UPGRADE_SKIPLOCKED</code>, the <code>SELECT â€¦â€‹ FOR UPDATE</code> syntax is used.</p>
</div>
<div class="paragraph">
<p>If the requested lock mode is not supported by the database, Hibernate uses an appropriate alternate mode instead of throwing an exception.
This ensures that applications are portable.</p>
</div>
</div>
<div class="sect2">
<h3 id="locking-jpa-query-hints"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-jpa-query-hints"></a>10.4. JPA locking query hints</h3>
<div class="paragraph">
<p>JPA 2.0 introduced two query hints:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">javax.persistence.lock.timeout</dt>
<dd>
<p>it gives the number of milliseconds a lock acquisition request will wait before throwing an exception</p>
</dd>
<dt class="hdlist1">javax.persistence.lock.scope</dt>
<dd>
<p>defines the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PessimisticLockScope.html"><em>scope</em></a> of the lock acquisition request.
The scope can either be <code>NORMAL</code> (default value) or <code>EXTENDED</code>. The <code>EXTENDED</code> scope will cause a lock acquisition request to be passed to other owned table structured (e.g. <code>@Inheritance(strategy=InheritanceType.JOINED)</code>, <code>@ElementCollection</code>)</p>
</dd>
</dl>
</div>
<div id="locking-jpa-query-hints-timeout-example" class="exampleblock">
<div class="title">Example 385. <code>javax.persistence.lock.timeout</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LockModeType</span><span class="pun">.</span><span class="pln">PESSIMISTIC_WRITE</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">singletonMap</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.lock.timeout"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT explicitlo0_</span><span class="pun">.</span><span class="pln">id     AS id1_0_0_</span><span class="pun">,</span><span class="pln">
       explicitlo0_</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> AS name2_0_0_
FROM   person explicitlo0_
WHERE  explicitlo0_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
FOR UPDATE wait </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all JDBC database drivers support setting a timeout value for a locking request.
If not supported, the Hibernate dialect ignores this query hint.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>javax.persistence.lock.scope</code> is <a href="https://hibernate.atlassian.net/browse/HHH-9636">not yet supported</a> as specified by the JPA standard.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="locking-buildLockRequest"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-buildLockRequest"></a>10.5. The <code>buildLockRequest</code> API</h3>
<div class="paragraph">
<p>Traditionally, Hibernate offered the <code>Session#lock()</code> method for acquiring an optimistic or a pessimistic lock on a given entity.
Because varying the locking options was difficult when using a single <code>LockMode</code> parameter, Hibernate has added the <code>Session#buildLockRequest()</code> method API.</p>
</div>
<div class="paragraph">
<p>The following example shows how to obtain a shared database lock without waiting for the lock acquisition request.</p>
</div>
<div id="locking-buildLockRequest-example" class="exampleblock">
<div class="title">Example 386. <code>buildLockRequest</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session
	</span><span class="pun">.</span><span class="pln">buildLockRequest</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockOptions</span><span class="pun">.</span><span class="pln">NONE </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setLockMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockMode</span><span class="pun">.</span><span class="pln">PESSIMISTIC_READ </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setTimeOut</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockOptions</span><span class="pun">.</span><span class="pln">NO_WAIT </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">lock</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT p</span><span class="pun">.</span><span class="pln">id AS id1_0_0_ </span><span class="pun">,</span><span class="pln">
       p</span><span class="pun">.</span><span class="pln">name AS name2_0_0_
FROM   </span><span class="typ">Person</span><span class="pln"> p
WHERE  p</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT id
FROM   </span><span class="typ">Person</span><span class="pln">
WHERE  id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
FOR    SHARE NOWAIT</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="locking-follow-on"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-follow-on"></a>10.6. Follow-on-locking</h3>
<div class="paragraph">
<p>When using Oracle, the <a href="https://docs.oracle.com/database/121/SQLRF/statements_10002.htm#SQLRF55371"><code>FOR UPDATE</code> exclusive locking clause</a> cannot be used with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISTINCT</code></p>
</li>
<li>
<p><code>GROUP BY</code></p>
</li>
<li>
<p><code>UNION</code></p>
</li>
<li>
<p>inlined views (derived tables), therefore, affecting the legacy Oracle pagination mechanism as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this reason, Hibernate uses secondary selects to lock the previously fetched entities.</p>
</div>
<div id="locking-follow-on-example" class="exampleblock">
<div class="title">Example 387. Follow-on-locking example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select DISTINCT p from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setLockMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockModeType</span><span class="pun">.</span><span class="pln">PESSIMISTIC_WRITE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT DISTINCT p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> name2_0_
FROM </span><span class="typ">Person</span><span class="pln"> p

SELECT id
FROM </span><span class="typ">Person</span><span class="pln">
WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> FOR UPDATE

SELECT id
FROM </span><span class="typ">Person</span><span class="pln">
WHERE id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> FOR UPDATE</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid the N+1 query problem, a separate query can be used to apply the lock using the associated entity identifiers.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="locking-follow-on-secondary-query-example" class="exampleblock">
<div class="title">Example 388. Secondary query entity locking</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select DISTINCT p from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.id from Person p where p in :persons"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setLockMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockModeType</span><span class="pun">.</span><span class="pln">PESSIMISTIC_WRITE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"persons"</span><span class="pun">,</span><span class="pln"> persons </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT DISTINCT p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> name2_0_
FROM </span><span class="typ">Person</span><span class="pln"> p

SELECT p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> col_0_0_
FROM </span><span class="typ">Person</span><span class="pln"> p
WHERE p</span><span class="pun">.</span><span class="pln">id IN </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
FOR UPDATE</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The lock request was moved from the original query to a secondary one which takes the previously fetched entities to lock their associated database records.</p>
</div>
<div class="paragraph">
<p>Prior to Hibernate 5.2.1, the follow-on-locking mechanism was applied uniformly to any locking query executing on Oracle.
Since 5.2.1, the Oracle Dialect tries to figure out if the current query demands the follow-on-locking mechanism.</p>
</div>
<div class="paragraph">
<p>Even more important is that you can overrule the default follow-on-locking detection logic and explicitly enable or disable it on a per query basis.</p>
</div>
<div id="locking-follow-on-explicit-example" class="exampleblock">
<div class="title">Example 389. Disabling the follow-on-locking mechanism explicitly</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Query</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setLockOptions</span><span class="pun">(</span><span class="pln">
	</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LockOptions</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LockMode</span><span class="pun">.</span><span class="pln">PESSIMISTIC_WRITE </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setFollowOnLocking</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT </span><span class="pun">*</span><span class="pln">
FROM </span><span class="pun">(</span><span class="pln">
    SELECT p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="str">"name"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> name2_0_
    FROM </span><span class="typ">Person</span><span class="pln"> p
</span><span class="pun">)</span><span class="pln">
WHERE rownum </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
FOR UPDATE</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The follow-on-locking mechanism should be explicitly enabled only if the currently executing query fails because the <code>FOR UPDATE</code> clause cannot be applied, meaning that the Dialect resolving mechanism needs to be further improved.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fetching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching"></a>11. Fetching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fetching, essentially, is the process of grabbing data from the database and making it available to the application.
Tuning how an application does fetching is one of the biggest factors in determining how an application will perform.
Fetching too much data, in terms of width (values/columns) and/or depth (results/rows),
adds unnecessary overhead in terms of both JDBC communication and ResultSet processing.
Fetching too little data might cause additional fetching to be needed.
Tuning how an application fetches data presents a great opportunity to influence the overall application performance.</p>
</div>
<div class="sect2">
<h3 id="fetching-basics"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-basics"></a>11.1. The basics</h3>
<div class="paragraph">
<p>The concept of fetching breaks down into two different questions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When should the data be fetched? Now? Later?</p>
</li>
<li>
<p>How should the data be fetched?</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"now" is generally termed eager or immediate. "later" is generally termed lazy or delayed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are a number of scopes for defining fetching:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>static</em></dt>
<dd>
<p>Static definition of fetching strategies is done in the mappings.
The statically-defined fetch strategies are used in the absence of any dynamically defined strategies</p>
<div class="dlist">
<dl>
<dt class="hdlist1">SELECT</dt>
<dd>
<p>Performs a separate SQL select to load the data. This can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).
This is the strategy generally termed N+1.</p>
</dd>
<dt class="hdlist1">JOIN</dt>
<dd>
<p>Inherently an EAGER style of fetching. The data to be fetched is obtained through the use of an SQL outer join.</p>
</dd>
<dt class="hdlist1">BATCH</dt>
<dd>
<p>Performs a separate SQL select to load a number of related data items using an IN-restriction as part of the SQL WHERE-clause based on a batch size.
Again, this can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).</p>
</dd>
<dt class="hdlist1">SUBSELECT</dt>
<dd>
<p>Performs a separate SQL select to load associated data based on the SQL restriction used to load the owner.
Again, this can either be EAGER (the second select is issued immediately) or LAZY (the second select is delayed until the data is needed).</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><em>dynamic</em> (sometimes referred to as runtime)</dt>
<dd>
<p>The dynamic definition is really use-case centric. There are multiple ways to define dynamic fetching:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>fetch profiles</em></dt>
<dd>
<p>defined in mappings, but can be enabled/disabled on the <code>Session</code>.</p>
</dd>
<dt class="hdlist1">HQL/JPQL</dt>
<dd>
<p>and both Hibernate and JPA Criteria queries have the ability to specify fetching, specific to said query.</p>
</dd>
<dt class="hdlist1">entity graphs</dt>
<dd>
<p>Starting in Hibernate 4.2 (JPA 2.1) this is also an option.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="fetching-direct-vs-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-direct-vs-query"></a>11.2. Direct fetching vs. entity queries</h3>
<div class="paragraph">
<p>To see the difference between direct fetching and entity queries in regard to eagerly fetched associations, consider the following entities:</p>
</div>
<div id="fetching-direct-vs-query-domain-model-example" class="exampleblock">
<div class="title">Example 390. Domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Department"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">EAGER</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Employee</code> entity has a <code>@ManyToOne</code> association to a <code>Department</code> which is fetched eagerly.</p>
</div>
<div class="paragraph">
<p>When issuing a direct entity fetch, Hibernate executed the following SQL query:</p>
</div>
<div id="fetching-direct-vs-query-direct-fetching-example" class="exampleblock">
<div class="title">Example 391. Direct fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_0_</span><span class="pun">,</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Employee</span><span class="pln"> e
left outer join
    </span><span class="typ">Department</span><span class="pln"> d
        on e</span><span class="pun">.</span><span class="pln">department_id</span><span class="pun">=</span><span class="pln">d</span><span class="pun">.</span><span class="pln">id
</span><span class="kwd">where</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>LEFT JOIN</code> clause is added to the generated SQL query because this association is required to be fetched eagerly.</p>
</div>
<div class="paragraph">
<p>On the other hand, if you are using an entity query that does not contain a <code>JOIN FETCH</code> directive to the <code>Department</code> association:</p>
</div>
<div id="fetching-direct-vs-query-entity-query-example" class="exampleblock">
<div class="title">Example 392. Entity query fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"select e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"from Employee e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"where e.id = :id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Employee</span><span class="pln"> e
</span><span class="kwd">where</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="kwd">select</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Department</span><span class="pln"> d
</span><span class="kwd">where</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate uses a secondary select instead. This is because the entity query fetch policy cannot be overridden,
so Hibernate requires a secondary select to ensure that the EAGER association is fetched prior to returning the result to the user.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you forget to JOIN FETCH all EAGER associations, Hibernate is going to issue a secondary select for each and every one of those
which, in turn, can lean to N+1 query issues.</p>
</div>
<div class="paragraph">
<p>For this reason, you should prefer LAZY associations.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies"></a>11.3. Applying fetch strategies</h3>
<div class="paragraph">
<p>Letâ€™s consider these topics as it relates to a simple domain model and a few use cases.</p>
</div>
<div id="fetching-strategies-domain-model-example" class="exampleblock">
<div class="title">Example 393. Sample domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Department"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pswd"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@ColumnTransformer</span><span class="pun">(</span><span class="pln">
		read </span><span class="pun">=</span><span class="pln"> </span><span class="str">"decrypt( 'AES', '00', pswd  )"</span><span class="pun">,</span><span class="pln">
		write </span><span class="pun">=</span><span class="pln"> </span><span class="str">"encrypt('AES', '00', ?)"</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> accessLevel</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"employees"</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Project</span><span class="pun">&gt;</span><span class="pln"> projects </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Project"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Project</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Hibernate recommendation is to statically mark all associations lazy and to use dynamic fetching strategies for eagerness.
This is unfortunately at odds with the JPA specification which defines that all one-to-one and many-to-one associations should be eagerly fetched by default.
Hibernate, as a JPA provider, honors that default.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-no-fetching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-no-fetching"></a>11.4. No fetching</h3>
<div class="paragraph">
<p>For the first use case, consider the application login process for an <code>Employee</code>.
Letâ€™s assume that login only requires access to the <code>Employee</code> information, not <code>Project</code> nor <code>Department</code> information.</p>
</div>
<div id="fetching-strategies-no-fetching-example" class="exampleblock">
<div class="title">Example 394. No fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Employee e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.username = :username and "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.password = :password"</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"username"</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"password"</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the application gets the <code>Employee</code> data.
However, because all associations from <code>Employee</code> are declared as LAZY (JPA defines the default for collections as LAZY) no other data is fetched.</p>
</div>
<div class="paragraph">
<p>If the login process does not need access to the <code>Employee</code> information specifically, another fetching optimization here would be to limit the width of the query results.</p>
</div>
<div id="fetching-strategies-no-fetching-scalar-example" class="exampleblock">
<div class="title">Example 395. No fetching (scalar) example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Integer</span><span class="pln"> accessLevel </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select e.accessLevel "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Employee e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.username = :username and "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.password = :password"</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"username"</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"password"</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching"></a>11.5. Dynamic fetching via queries</h3>
<div class="paragraph">
<p>For the second use case, consider a screen displaying the <code>Projects</code> for an <code>Employee</code>.
Certainly access to the <code>Employee</code> is needed, as is the collection of <code>Projects</code> for that Employee. Information about <code>Departments</code>, other <code>Employees</code> or other <code>Projects</code> is not needed.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-jpql-example" class="exampleblock">
<div class="title">Example 396. Dynamic JPQL fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Employee e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join fetch e.projects "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.username = :username and "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	e.password = :password"</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"username"</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"password"</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="fetching-strategies-dynamic-fetching-criteria-example" class="exampleblock">
<div class="title">Example 397. Dynamic query fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">
</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">fetch</span><span class="pun">(</span><span class="pln"> </span><span class="str">"projects"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">LEFT</span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln">root</span><span class="pun">).</span><span class="kwd">where</span><span class="pun">(</span><span class="pln">
	builder</span><span class="pun">.</span><span class="kwd">and</span><span class="pun">(</span><span class="pln">
		builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"username"</span><span class="pun">),</span><span class="pln"> username</span><span class="pun">),</span><span class="pln">
		builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"password"</span><span class="pun">),</span><span class="pln"> password</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> query </span><span class="pun">).</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example we have an <code>Employee</code> and their <code>Projects</code> loaded in a single query shown both as an HQL query and a JPA Criteria query.
In both cases, this resolves to exactly one database query to get all that information.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching-entity-graph"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-entity-graph"></a>11.6. Dynamic fetching via JPA entity graph</h3>
<div class="paragraph">
<p>JPA 2.1 introduced entity graphs so the application developer has more control over fetch plans.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-graph-example" class="exampleblock">
<div class="title">Example 398. Fetch graph example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NamedEntityGraph</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"employee.projects"</span><span class="pun">,</span><span class="pln">
	attributeNodes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@NamedAttributeNode</span><span class="pun">(</span><span class="str">"projects"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	userId</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">singletonMap</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"javax.persistence.fetchgraph"</span><span class="pun">,</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">getEntityGraph</span><span class="pun">(</span><span class="pln"> </span><span class="str">"employee.projects"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the JPA standard specifies that you can override an EAGER fetching association at runtime using the <code>javax.persistence.fetchgraph</code> hint,
currently, Hibernate does not implement this feature, so EAGER associations cannot be fetched lazily.
For more info, check out the <a href="https://hibernate.atlassian.net/browse/HHH-8776">HHH-8776</a> Jira issue.</p>
</div>
<div class="paragraph">
<p>When executing a JPQL query, if an EAGER association is omitted, Hibernate will issue a secondary select for every association needed to be fetched eagerly,
which can lead dto N+1 query issues.</p>
</div>
<div class="paragraph">
<p>For this reason, itâ€™s better to use LAZY associations, and only fetch them eagerly on a per-query basis.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="fetching-strategies-dynamic-fetching-entity-subgraph"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-entity-subgraph"></a>11.6.1. JPA entity subgraphs</h4>
<div class="paragraph">
<p>An entity graph specifies which attributes to be fetched, but it limited to a single entity only.
To fetch associations from a child entity, you need to use the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedSubgraph.html"><code>@NamedSubgraph</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>If we have a <code>Project</code> parent entity which has an <code>employees</code> child associations,
and weâ€™d like to fetch the <code>department</code> for the <code>Employee</code> child association.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-subgraph-mapping-example" class="exampleblock">
<div class="title">Example 399. Fetch graph with a subgraph mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Project"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NamedEntityGraph</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"project.employees"</span><span class="pun">,</span><span class="pln">
	attributeNodes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@NamedAttributeNode</span><span class="pun">(</span><span class="pln">
		value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"employees"</span><span class="pun">,</span><span class="pln">
		subgraph </span><span class="pun">=</span><span class="pln"> </span><span class="str">"project.employees.department"</span><span class="pln">
	</span><span class="pun">),</span><span class="pln">
	subgraphs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@NamedSubgraph</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"project.employees.department"</span><span class="pun">,</span><span class="pln">
		attributeNodes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@NamedAttributeNode</span><span class="pun">(</span><span class="pln"> </span><span class="str">"department"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Project</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToMany</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching this entity graph, Hibernate generates the following SQL query:</p>
</div>
<div id="fetching-strategies-dynamic-fetching-entity-subgraph-example" class="exampleblock">
<div class="title">Example 400. Fetch graph with a subgraph mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Project</span><span class="pln"> project </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">
		</span><span class="typ">Project</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
		</span><span class="lit">1L</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">singletonMap</span><span class="pun">(</span><span class="pln">
			</span><span class="str">"javax.persistence.fetchgraph"</span><span class="pun">,</span><span class="pln">
			entityManager</span><span class="pun">.</span><span class="pln">getEntityGraph</span><span class="pun">(</span><span class="pln"> </span><span class="str">"project.employees"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_2_0_</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_2_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">accessLevel </span><span class="kwd">as</span><span class="pln"> accessLe2_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme5_1_1_</span><span class="pun">,</span><span class="pln">
    decrypt</span><span class="pun">(</span><span class="pln"> </span><span class="str">'AES'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'00'</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">pswd  </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> pswd3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username4_1_1_</span><span class="pun">,</span><span class="pln">
    p_e</span><span class="pun">.</span><span class="pln">projects_id </span><span class="kwd">as</span><span class="pln"> projects1_3_0__</span><span class="pun">,</span><span class="pln">
    p_e</span><span class="pun">.</span><span class="pln">employees_id </span><span class="kwd">as</span><span class="pln"> employee2_3_0__
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Project</span><span class="pln"> p
inner join
    </span><span class="typ">Project_Employee</span><span class="pln"> p_e
        on p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">p_e</span><span class="pun">.</span><span class="pln">projects_id
inner join
    </span><span class="typ">Employee</span><span class="pln"> e
        on p_e</span><span class="pun">.</span><span class="pln">employees_id</span><span class="pun">=</span><span class="pln">e</span><span class="pun">.</span><span class="pln">id
inner join
    </span><span class="typ">Department</span><span class="pln"> d
        on e</span><span class="pun">.</span><span class="pln">department_id</span><span class="pun">=</span><span class="pln">d</span><span class="pun">.</span><span class="pln">id
</span><span class="kwd">where</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-strategies-dynamic-fetching-profile"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-profile"></a>11.7. Dynamic fetching via Hibernate profiles</h3>
<div class="paragraph">
<p>Suppose we wanted to leverage loading by natural-id to obtain the <code>Employee</code> information in the "projects for and employee" use-case.
Loading by natural-id uses the statically defined fetching strategies, but does not expose a means to define load-specific fetching.
So we would leverage a fetch profile.</p>
</div>
<div id="fetching-strategies-dynamic-fetching-profile-example" class="exampleblock">
<div class="title">Example 401. Fetch profile example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@FetchProfile</span><span class="pun">(</span><span class="pln">
	name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"employee.projects"</span><span class="pun">,</span><span class="pln">
	fetchOverrides </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="lit">@FetchProfile</span><span class="pun">.</span><span class="typ">FetchOverride</span><span class="pun">(</span><span class="pln">
			entity </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
			association </span><span class="pun">=</span><span class="pln"> </span><span class="str">"projects"</span><span class="pun">,</span><span class="pln">
			mode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">JOIN
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">session</span><span class="pun">.</span><span class="pln">enableFetchProfile</span><span class="pun">(</span><span class="pln"> </span><span class="str">"employee.projects"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">bySimpleNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">load</span><span class="pun">(</span><span class="pln"> username </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the <code>Employee</code> is obtained by natural-id lookup and the Employeeâ€™s <code>Project</code> data is fetched eagerly.
If the <code>Employee</code> data is resolved from cache, the <code>Project</code> data is resolved on its own.
However, if the <code>Employee</code> data is not resolved in cache, the <code>Employee</code> and <code>Project</code> data is resolved in one SQL query via join as we saw above.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-batch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-batch"></a>11.8. Batch fetching</h3>
<div class="paragraph">
<p>Hibernate offers the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/BatchSize.html"><code>@BatchSize</code></a> annotation,
which can be used when fetching uninitialized entity proxies.</p>
</div>
<div class="paragraph">
<p>Considering the following entity mapping:</p>
</div>
<div id="fetching-batch-mapping-example" class="exampleblock">
<div class="title">Example 402. <code>@BatchSize</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Department"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">)</span><span class="pln">
	</span><span class="com">//@BatchSize(size = 5)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering that we have previously fetched several <code>Department</code> entities,
and now we need to initialize the <code>employees</code> entity collection for each particular <code>Department</code>,
the <code>@BatchSize</code> annotations allows us to load multiple <code>Employee</code> entities in a single database roundtrip.</p>
</div>
<div id="fetching-batch-fetching-example" class="exampleblock">
<div class="title">Example 403. <code>@BatchSize</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Department</span><span class="pun">&gt;</span><span class="pln"> departments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select d "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Department d "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"inner join d.employees e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where e.name like 'John%'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Department</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department </span><span class="pun">:</span><span class="pln"> departments </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">infof</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"Department %d has {} employees"</span><span class="pun">,</span><span class="pln">
		department</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">(),</span><span class="pln">
		department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_
FROM
    </span><span class="typ">Department</span><span class="pln"> d
INNER JOIN
    </span><span class="typ">Employee</span><span class="pln"> employees1_
    ON d</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">employees1_</span><span class="pun">.</span><span class="pln">department_id

SELECT
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id IN </span><span class="pun">(</span><span class="pln">
        </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">as</span><span class="pln"> name2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id IN </span><span class="pun">(</span><span class="pln">
        </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see in the example above, there are only two SQL statements used to fetch the <code>Employee</code> entities associated with multiple <code>Department</code> entities.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Without <code>@BatchSize</code>, youâ€™d run into a N+1 query issue, so,
instead of 2 SQL statements, there would be 10 queries needed for fetching the <code>Employee</code> child entities.</p>
</div>
<div class="paragraph">
<p>However, although <code>@BatchSize</code> is better than running into an N+1 query issue,
most of the time, a DTO projection or a <code>JOIN FETCH</code> is a much better alternative since
it allows you to fetch all the required data with a single query.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetch-annotation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-fetch-annotation"></a>11.9. The <code>@Fetch</code> annotation mapping</h3>
<div class="paragraph">
<p>Besides the <code>FetchType.LAZY</code> or <code>FetchType.EAGER</code> JPA annotations,
you can also use the Hibernate-specific <code>@Fetch</code> annotation that accepts one of the following <code>FetchMode(s)</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SELECT</dt>
<dd>
<p>The association is going to be fetched lazily using a secondary select for each individual entity,
collection, or join load.
Itâ€™s equivalent to JPA <code>FetchType.LAZY</code> fetching strategy.</p>
</dd>
<dt class="hdlist1">JOIN</dt>
<dd>
<p>Use an outer join to load the related entities, collections or joins when using direct fetching.
Itâ€™s equivalent to JPA <code>FetchType.EAGER</code> fetching strategy.</p>
</dd>
<dt class="hdlist1">SUBSELECT</dt>
<dd>
<p>Available for collections only.â€‚When accessing a non-initialized collection,
this fetch mode will trigger loading all elements of all collections of the same role for all owners associated
with the persistence context using a single secondary select.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-select"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-fetchmode-select"></a>11.10. <code>FetchMode.SELECT</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.SELECT</code> works, consider the following entity mapping:</p>
</div>
<div id="fetching-strategies-fetch-mode-select-mapping-example" class="exampleblock">
<div class="title">Example 404. <code>FetchMode.SELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Department"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">,</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Fetch</span><span class="pun">(</span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">SELECT</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering there are multiple <code>Department</code> entities, each one having multiple <code>Employee</code> entities,
when executing the following test case, Hibernate fetches every uninitialized <code>Employee</code>
collection using a secondary <code>SELECT</code> statement upon accessing the child collection for the first time:</p>
</div>
<div id="fetching-strategies-fetch-mode-select-example" class="exampleblock">
<div class="title">Example 405. <code>FetchMode.SELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Department</span><span class="pun">&gt;</span><span class="pln"> departments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select d from Department d"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Department</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

log</span><span class="pun">.</span><span class="pln">infof</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetched %d Departments"</span><span class="pun">,</span><span class="pln"> departments</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Department</span><span class="pln"> department </span><span class="pun">:</span><span class="pln"> departments </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_
FROM
    </span><span class="typ">Department</span><span class="pln"> d

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Fetched</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="typ">Departments</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_1_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_1_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The more <code>Department</code> entities are fetched by the first query, the more secondary <code>SELECT</code> statements are executed to initialize the <code>employees</code> collections.
Therefore, <code>FetchMode.SELECT</code> can lead to N+1 query issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-subselect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-fetchmode-subselect"></a>11.11. <code>FetchMode.SUBSELECT</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.SUBSELECT</code> works, we are going to modify the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-fetch-mode-select-mapping-example"><code>FetchMode.SELECT</code> mapping example</a> to use
<code>FetchMode.SUBSELECT</code>:</p>
</div>
<div id="fetching-strategies-fetch-mode-subselect-mapping-example" class="exampleblock">
<div class="title">Example 406. <code>FetchMode.SUBSELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">,</span><span class="pln"> fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Fetch</span><span class="pun">(</span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">SUBSELECT</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to fetch all <code>Department</code> entities that match a given filtering predicate
and then navigate their <code>employees</code> collections.</p>
</div>
<div class="paragraph">
<p>Hibernate is going to avoid the N+1 query issue by generating a single SQL statement to initialize all <code>employees</code> collections
for all <code>Department</code> entities that were previously fetched.
Instead of using passing all entity identifiers, Hibernate simply reruns the previous query that fetched the <code>Department</code> entities.</p>
</div>
<div id="fetching-strategies-fetch-mode-subselect-example" class="exampleblock">
<div class="title">Example 407. <code>FetchMode.SUBSELECT</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Department</span><span class="pun">&gt;</span><span class="pln"> departments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select d "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Department d "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where d.name like :token"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Department</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"token"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Department%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

log</span><span class="pun">.</span><span class="pln">infof</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetched %d Departments"</span><span class="pun">,</span><span class="pln"> departments</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Department</span><span class="pln"> department </span><span class="pun">:</span><span class="pln"> departments </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_
FROM
    </span><span class="typ">Department</span><span class="pln"> d
</span><span class="kwd">where</span><span class="pln">
    d</span><span class="pun">.</span><span class="pln">name like </span><span class="str">'Department%'</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Fetched</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="typ">Departments</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        SELECT
            fetchmodes0_</span><span class="pun">.</span><span class="pln">id
        FROM
            </span><span class="typ">Department</span><span class="pln"> fetchmodes0_
        WHERE
            d</span><span class="pun">.</span><span class="pln">name like </span><span class="str">'Department%'</span><span class="pln">
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fetching-fetchmode-join"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-fetchmode-join"></a>11.12. <code>FetchMode.JOIN</code></h3>
<div class="paragraph">
<p>To demonstrate how <code>FetchMode.JOIN</code> works, we are going to modify the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-fetch-mode-select-mapping-example"><code>FetchMode.SELECT</code> mapping example</a> to use
<code>FetchMode.JOIN</code> instead:</p>
</div>
<div id="fetching-strategies-fetch-mode-join-mapping-example" class="exampleblock">
<div class="title">Example 408. <code>FetchMode.JOIN</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Fetch</span><span class="pun">(</span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">JOIN</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we are going to fetch one <code>Department</code> and navigate its <code>employees</code> collections.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reason why we are not using a JPQL query to fetch multiple <code>Department</code> entities is because
the <code>FetchMode.JOIN</code> strategy would be overridden by the query fetching directive.</p>
</div>
<div class="paragraph">
<p>To fetch multiple relationships with a JPQL query, the <code>JOIN FETCH</code> directive must be used instead.</p>
</div>
<div class="paragraph">
<p>Therefore, <code>FetchMode.JOIN</code> is useful for when entities are fetched directly, via their identifier or natural-id.</p>
</div>
<div class="paragraph">
<p>Also, the <code>FetchMode.JOIN</code> acts as a <code>FetchType.EAGER</code> strategy.
Even if we mark the association as <code>FetchType.LAZY</code>, the <code>FetchMode.JOIN</code> will load the association eagerly.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate is going to avoid the secondary query by issuing an OUTER JOIN for the <code>employees</code> collection.</p>
</div>
<div id="fetching-strategies-fetch-mode-join-example" class="exampleblock">
<div class="title">Example 409. <code>FetchMode.JOIN</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Department</span><span class="pln"> department </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Department</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

log</span><span class="pun">.</span><span class="pln">infof</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetched department: %s"</span><span class="pun">,</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">());</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    d</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_1_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_2_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_2_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_2_
FROM
    </span><span class="typ">Department</span><span class="pln"> d
LEFT OUTER JOIN
    </span><span class="typ">Employee</span><span class="pln"> e
        on d</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">department_id
WHERE
    d</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Fetched</span><span class="pln"> department</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This time, there was no secondary query because the child collection was loaded along with the parent entity.</p>
</div>
</div>
<div class="sect2">
<h3 id="fetching-LazyCollection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-LazyCollection"></a>11.13. <code>@LazyCollection</code></h3>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyCollection.html"><code>@LazyCollection</code></a> annotation is used to specify the lazy fetching behavior of a given collection.
The possible values are given by the <code><a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyCollectionOption.html">LazyCollectionOption</a></code> enumeration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>TRUE</code></dt>
<dd>
<p>Load it when the state is requested.</p>
</dd>
<dt class="hdlist1"><code>FALSE</code></dt>
<dd>
<p>Eagerly load it.</p>
</dd>
<dt class="hdlist1"><code>EXTRA</code></dt>
<dd>
<p>Prefer extra queries over full collection loading.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>TRUE</code> and <code>FALSE</code> values are deprecated since you should be using the JPA <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/FetchType.html"><code>FetchType</code></a> attribute of the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-elementcollection"><code>@ElementCollection</code></a>, <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-onetomany"><code>@OneToMany</code></a>, or <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-manytomany"><code>@ManyToMany</code></a> collection.</p>
</div>
<div class="paragraph">
<p>The <code>EXTRA</code> value has no equivalent in the JPA specification, and itâ€™s used to avoid loading the entire collection even when the collection is accessed for the first time.
Each element is fetched individually using a secondary query.</p>
</div>
<div id="fetching-LazyCollection-domain-model-example" class="exampleblock">
<div class="title">Example 410. <code>LazyCollectionOption.EXTRA</code> mapping example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Department"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"department"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@LazyCollection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LazyCollectionOption</span><span class="pun">.</span><span class="pln">EXTRA </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Employee</span><span class="pun">&gt;</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Employee"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Department</span><span class="pln"> department</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>LazyCollectionOption.EXTRA</code> only works for ordered collections,
either List(s) that are annotated with @OrderColumn or Map(s).</p>
</div>
<div class="paragraph">
<p>For bags (e.g. regular List(s) of entities that do not preserve any certain ordering),
the @LazyCollection(LazyCollectionOption.EXTRA)` behaves like any other <code>FetchType.LAZY</code> collection
(the collection is fetched entirely upon being accessed for the first time).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now, considering we have the following entities:</p>
</div>
<div id="fetching-LazyCollection-persist-example" class="exampleblock">
<div class="title">Example 411. <code>LazyCollectionOption.EXTRA</code> Domain Model example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Department</span><span class="pln"> department </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Department</span><span class="pun">();</span><span class="pln">
department</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> department </span><span class="pun">);</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Employee</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Employee</span><span class="pun">();</span><span class="pln">
	employee</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> i </span><span class="pun">);</span><span class="pln">
	employee</span><span class="pun">.</span><span class="pln">setUsername</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"user_%d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	department</span><span class="pun">.</span><span class="pln">addEmployee</span><span class="pun">(</span><span class="pln">employee</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching the <code>employee</code> collection entries by their position in the <code>List</code>,
Hibernate generates the following SQL statements:</p>
</div>
<div id="fetching-LazyCollection-select-example" class="exampleblock">
<div class="title">Example 412. <code>LazyCollectionOption.EXTRA</code> fetching example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Department</span><span class="pln"> department </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="typ">Department</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">);</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> employeeCount </span><span class="pun">=</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="pln">size</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> employeeCount</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	log</span><span class="pun">.</span><span class="pln">infof</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Fetched employee: %s"</span><span class="pun">,</span><span class="pln"> department</span><span class="pun">.</span><span class="pln">getEmployees</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> i </span><span class="pun">).</span><span class="pln">getUsername</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    max</span><span class="pun">(</span><span class="pln">order_id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
FROM
    </span><span class="typ">Employee</span><span class="pln">
WHERE
    department_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id</span><span class="pun">=?</span><span class="pln">
    AND e</span><span class="pun">.</span><span class="pln">order_id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id</span><span class="pun">=?</span><span class="pln">
    AND e</span><span class="pun">.</span><span class="pln">order_id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

SELECT
    e</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">department_id </span><span class="kwd">as</span><span class="pln"> departme3_1_0_</span><span class="pun">,</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">username </span><span class="kwd">as</span><span class="pln"> username2_1_0_
FROM
    </span><span class="typ">Employee</span><span class="pln"> e
WHERE
    e</span><span class="pun">.</span><span class="pln">department_id</span><span class="pun">=?</span><span class="pln">
    AND e</span><span class="pun">.</span><span class="pln">order_id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Therefore, the child entities were fetched one after the other without triggering a full collection initialization.</p>
</div>
<div class="paragraph">
<p>For this reason, caution is advised because <code>LazyCollectionOption.EXTRA</code> lazy collections are prone to N+1 query issues.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch"></a>12. Batching</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="batch-jdbcbatch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-jdbcbatch"></a>12.1. JDBC batching</h3>
<div class="paragraph">
<p>JDBC offers support for batching together SQL statements that can be represented as a single PreparedStatement.
Implementation wise this generally means that drivers will send the batched operation to the server in one call,
which can save on network calls to the database. Hibernate can leverage JDBC batching.
The following settings control this behavior.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.jdbc.batch_size</code></dt>
<dd>
<p>Controls the maximum number of statements Hibernate will batch together before asking the driver to execute the batch.
Zero or a negative number disables this feature.</p>
</dd>
<dt class="hdlist1"><code>hibernate.jdbc.batch_versioned_data</code></dt>
<dd>
<p>Some JDBC drivers return incorrect row counts when a batch is executed.
If your JDBC driver falls into this category this setting should be set to <code>false</code>.
Otherwise, it is safe to enable this which will allow Hibernate to still batch the DML for versioned entities and still use the returned row counts for optimistic lock checks.
Since 5.0, it defaults to true. Previously (versions 3.x and 4.x), it used to be false.</p>
</dd>
<dt class="hdlist1"><code>hibernate.jdbc.batch.builder</code></dt>
<dd>
<p>Names the implementation class used to manage batching capabilities.
It is almost never a good idea to switch from Hibernateâ€™s default implementation.
But if you wish to, this setting would name the <code>org.hibernate.engine.jdbc.batch.spi.BatchBuilder</code> implementation to use.</p>
</dd>
<dt class="hdlist1"><code>hibernate.order_updates</code></dt>
<dd>
<p>Forces Hibernate to order SQL updates by the entity type and the primary key value of the items being updated.
This allows for more batching to be used. It will also result in fewer transaction deadlocks in highly concurrent systems.
Comes with a performance hit, so benchmark before and after to see if this actually helps or hurts your application.</p>
</dd>
<dt class="hdlist1"><code>hibernate.order_inserts</code></dt>
<dd>
<p>Forces Hibernate to order inserts to allow for more batching to be used.
Comes with a performance hit, so benchmark before and after to see if this actually helps or hurts your application.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since version 5.2, Hibernate allows overriding the global JDBC batch size given by the <code>hibernate.jdbc.batch_size</code> configuration property for a given <code>Session</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="batch-session-jdbc-batch-size-example" class="exampleblock">
<div class="title">Example 413. Hibernate specific JDBC batch size configuration on a per <code>Session</code> basis</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager
	</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setJdbcBatchSize</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-session-batch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-session-batch"></a>12.2. Session batching</h3>
<div class="paragraph">
<p>The following example shows an anti-pattern for batch inserts.</p>
</div>
<div id="batch-session-batch-example" class="exampleblock">
<div class="title">Example 414. Naive way to insert 100 000 entities with Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">EntityManager</span><span class="pln"> entityManager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">EntityTransaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	entityManager </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">().</span><span class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">

	txn </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
	txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">100</span><span class="pln">_000</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Person %d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">RuntimeException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> txn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">isActive</span><span class="pun">())</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">throw</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">entityManager </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several problems associated with this example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hibernate caches all the newly inserted <code>Customer</code> instances in the session-level c1ache, so, when the transaction ends, 100 000 entities are managed by the persistence context.
If the maximum memory allocated to the JVM is rather low, this example could fail with an <code>OutOfMemoryException</code>.
The Java 1.8 JVM allocated either 1/4 of available RAM or 1Gb, which can easily accommodate 100 000 objects on the heap.</p>
</li>
<li>
<p>long-running transactions can deplete a connection pool so other transactions donâ€™t get a chance to proceed.</p>
</li>
<li>
<p>JDBC batching is not enabled by default, so every insert statement requires a database roundtrip.
To enable JDBC batching, set the <code>hibernate.jdbc.batch_size</code> property to an integer between 10 and 50.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate disables insert batching at the JDBC level transparently if you use an identity identifier generator.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="batch-session-batch-insert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-session-batch-insert"></a>12.2.1. Batch inserts</h4>
<div class="paragraph">
<p>When you make new objects persistent, employ methods <code>flush()</code> and <code>clear()</code> to the session regularly, to control the size of the first-level cache.</p>
</div>
<div id="batch-session-batch-insert-example" class="exampleblock">
<div class="title">Example 415. Flushing and clearing the <code>Session</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">EntityManager</span><span class="pln"> entityManager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">EntityTransaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	entityManager </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">().</span><span class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">

	txn </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
	txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">int</span><span class="pln"> batchSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">25</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> entityCount</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> i </span><span class="pun">%</span><span class="pln"> batchSize </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="com">//flush a batch of inserts and release memory</span><span class="pln">
			entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
			entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="typ">Person</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Person %d"</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">RuntimeException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> txn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">isActive</span><span class="pun">())</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">throw</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">entityManager </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="batch-session-scroll"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-session-scroll"></a>12.2.2. Session scroll</h4>
<div class="paragraph">
<p>When you retrieve and update data, <code>flush()</code> and <code>clear()</code> the session regularly.
In addition, use method <code>scroll()</code> to take advantage of server-side cursors for queries that return many rows of data.</p>
</div>
<div id="batch-session-scroll-example" class="exampleblock">
<div class="title">Example 416. Using <code>scroll()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">EntityManager</span><span class="pln"> entityManager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">EntityTransaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">ScrollableResults</span><span class="pln"> scrollableResults </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	entityManager </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">().</span><span class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">

	txn </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
	txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">int</span><span class="pln"> batchSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">25</span><span class="pun">;</span><span class="pln">

	</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	scrollableResults </span><span class="pun">=</span><span class="pln"> session
		</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select p from Person p"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setCacheMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CacheMode</span><span class="pun">.</span><span class="pln">IGNORE </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">scroll</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ScrollMode</span><span class="pun">.</span><span class="pln">FORWARD_ONLY </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> scrollableResults</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> scrollableResults</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		processPerson</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">++</span><span class="pln">count </span><span class="pun">%</span><span class="pln"> batchSize </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="com">//flush a batch of updates and release memory:</span><span class="pln">
			entityManager</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">
			entityManager</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">RuntimeException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> txn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">isActive</span><span class="pun">())</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">throw</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">scrollableResults </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		scrollableResults</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">entityManager </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		entityManager</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If left unclosed by the application, Hibernate will automatically close the underlying resources (e.g. <code>ResultSet</code> and <code>PreparedStatement</code>) used internally by the <code>ScrollableResults</code> when the current transaction is ended (either commit or rollback).</p>
</div>
<div class="paragraph">
<p>However, it is good practice to close the <code>ScrollableResults</code> explicitly.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_statelesssession"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_statelesssession"></a>12.2.3. StatelessSession</h4>
<div class="paragraph">
<p><code>StatelessSession</code> is a command-oriented API provided by Hibernate.
Use it to stream data to and from the database in the form of detached objects.
A <code>StatelessSession</code> has no persistence context associated with it and does not provide many of the higher-level lifecycle semantics.</p>
</div>
<div class="paragraph">
<p>Some of the things not provided by a <code>StatelessSession</code> include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a first-level cache</p>
</li>
<li>
<p>interaction with any second-level or query cache</p>
</li>
<li>
<p>transactional write-behind or automatic dirty checking</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Limitations of <code>StatelessSession</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operations performed using a stateless session never cascade to associated instances.</p>
</li>
<li>
<p>Collections are ignored by a stateless session.</p>
</li>
<li>
<p>Lazy loading of associations is not supported.</p>
</li>
<li>
<p>Operations performed via a stateless session bypass Hibernateâ€™s event model and interceptors.</p>
</li>
<li>
<p>Due to the lack of a first-level cache, Stateless sessions are vulnerable to data aliasing effects.</p>
</li>
<li>
<p>A stateless session is a lower-level abstraction that is much closer to the underlying JDBC.</p>
</li>
</ul>
</div>
<div id="batch-stateless-session-example" class="exampleblock">
<div class="title">Example 417. Using a  <code>StatelessSession</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StatelessSession</span><span class="pln"> statelessSession </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Transaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">ScrollableResults</span><span class="pln"> scrollableResults </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">().</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	statelessSession </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">.</span><span class="pln">openStatelessSession</span><span class="pun">();</span><span class="pln">

	txn </span><span class="pun">=</span><span class="pln"> statelessSession</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
	txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

	scrollableResults </span><span class="pun">=</span><span class="pln"> statelessSession
		</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select p from Person p"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">scroll</span><span class="pun">(</span><span class="typ">ScrollMode</span><span class="pun">.</span><span class="pln">FORWARD_ONLY</span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> scrollableResults</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> scrollableResults</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		processPerson</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">);</span><span class="pln">
		statelessSession</span><span class="pun">.</span><span class="pln">update</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">RuntimeException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> txn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">getStatus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">TransactionStatus</span><span class="pun">.</span><span class="pln">ACTIVE</span><span class="pun">)</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
		</span><span class="kwd">throw</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">scrollableResults </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		scrollableResults</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">statelessSession </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		statelessSession</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Customer</code> instances returned by the query are immediately detached.
They are never associated with any persistence context.</p>
</div>
<div class="paragraph">
<p>The <code>insert()</code>, <code>update()</code>, and <code>delete()</code> operations defined by the <code>StatelessSession</code> interface operate directly on database rows.
They cause the corresponding SQL operations to be executed immediately.
They have different semantics from the <code>save()</code>, <code>saveOrUpdate()</code>, and <code>delete()</code> operations defined by the <code>Session</code> interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-bulk-hql"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql"></a>12.3. Hibernate Query Language for DML</h3>
<div class="paragraph">
<p>DML, or Data Manipulation Language, refers to SQL statements such as <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code>.
Hibernate provides methods for bulk SQL-style DML statement execution, in the form of Hibernate Query Language (HQL).</p>
</div>
<div class="sect3">
<h4 id="batch-bulk-hql-update-delete"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-update-delete"></a>12.3.1. HQL/JPQL for UPDATE and DELETE</h4>
<div class="paragraph">
<p>Both the Hibernate native Query Language and JPQL (Java Persistence Query Language) provide support for bulk UPDATE and DELETE.</p>
</div>
<div id="batch-bulk-hql-update-delete-example" class="exampleblock">
<div class="title">Example 418. Psuedo-syntax for UPDATE and DELETE statements using HQL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">UPDATE FROM </span><span class="typ">EntityName</span><span class="pln"> e WHERE e</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

DELETE FROM </span><span class="typ">EntityName</span><span class="pln"> e WHERE e</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>FROM</code> and <code>WHERE</code> clauses are each optional, but itâ€™s good practice to use them.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>FROM</code> clause can only refer to a single entity, which can be aliased.
If the entity name is aliased, any property references must be qualified using that alias.
If the entity name is not aliased, then it is illegal for any property references to be qualified.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Joins, either implicit or explicit, are prohibited in a bulk HQL query.
You can use sub-queries in the <code>WHERE</code> clause, and the sub-queries themselves can contain joins.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="batch-bulk-jpql-update-example" class="exampleblock">
<div class="title">Example 419. Executing a JPQL <code>UPDATE</code>, using the <code>Query.executeUpdate()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set p.name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="batch-bulk-hql-update-example" class="exampleblock">
<div class="title">Example 420. Executing an HQL <code>UPDATE</code>, using the <code>Query.executeUpdate()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In keeping with the EJB3 specification, HQL <code>UPDATE</code> statements, by default, do not effect the version or the timestamp property values for the affected entities.
You can use a versioned update to force Hibernate to reset the version or timestamp property values, by adding the <code>VERSIONED</code> keyword after the <code>UPDATE</code> keyword.</p>
</div>
<div id="batch-bulk-hql-update-version-example" class="exampleblock">
<div class="title">Example 421. Updating the version of timestamp</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update versioned Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the <code>VERSIONED</code> statement, you cannot use custom version types, which use class <code>org.hibernate.usertype.UserVersionType</code>.</p>
</div>
<div class="paragraph">
<p>This feature is only available in HQL since itâ€™s not standardized by JPA.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="batch-bulk-jpql-delete-example" class="exampleblock">
<div class="title">Example 422. A JPQL <code>DELETE</code> statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> deletedEntities </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"delete Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name = :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> name </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="batch-bulk-hql-delete-example" class="exampleblock">
<div class="title">Example 423. An HQL <code>DELETE</code> statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> deletedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"delete Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where name = :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> name </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Method <code>Query.executeUpdate()</code> returns an <code>int</code> value, which indicates the number of entities affected by the operation.
This may or may not correlate to the number of rows affected in the database.
A JPQL/HQL bulk operation might result in multiple SQL statements being executed, such as for joined-subclass.
In the example of joined-subclass, a <code>DELETE</code> against one of the subclasses may actually result in deletes in the tables underlying the join, or further down the inheritance hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hql_syntax_for_insert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_hql_syntax_for_insert"></a>12.3.2. HQL syntax for INSERT</h4>
<div class="exampleblock">
<div class="title">Example 424. Pseudo-syntax for INSERT statements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">INSERT INTO </span><span class="typ">EntityName</span><span class="pln">
	properties_list
SELECT properties_list
FROM </span><span class="pun">...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only the <code>INSERT INTO â€¦â€‹ SELECT â€¦â€‹</code> form is supported.
You cannot specify explicit values to insert.</p>
</div>
<div class="paragraph">
<p>The <code>properties_list</code> is analogous to the column specification in the <code>SQL</code> <code>INSERT</code> statement.
For entities involved in mapped inheritance, you can only use properties directly defined on that given class-level in the <code>properties_list</code>.
Superclass properties are not allowed and subclass properties are irrelevant.
In other words, <code>INSERT</code> statements are inherently non-polymorphic.</p>
</div>
<div class="paragraph">
<p>The SELECT statement can be any valid HQL select query, but the return types must match the types expected by the INSERT.
Hibernate verifies the return types during query compilation, instead of expecting the database to check it.
Problems might result from Hibernate types which are equivalent, rather than equal.
One such example is a mismatch between a property defined as an <code>org.hibernate.type.DateType</code> and a property defined as an <code>org.hibernate.type.TimestampType</code>,
even though the database may not make a distinction, or may be capable of handling the conversion.</p>
</div>
<div class="paragraph">
<p>If id property is not specified in the <code>properties_list</code>,
Hibernate generates a value automatically.
Automatic generation is only available if you use ID generators which operate on the database.
Otherwise, Hibernate throws an exception during parsing.
Available in-database generators are <code>org.hibernate.id.SequenceGenerator</code> and its subclasses, and objects which implement <code>org.hibernate.id.PostInsertIdentifierGenerator</code>.</p>
</div>
<div class="paragraph">
<p>For properties mapped as either version or timestamp, the insert statement gives you two options.
You can either specify the property in the properties_list, in which case its value is taken from the corresponding select expressions or omit it from the properties_list,
in which case the seed value defined by the org.hibernate.type.VersionType is used.</p>
</div>
<div id="batch-bulk-hql-insert-example" class="exampleblock">
<div class="title">Example 425. HQL INSERT statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> insertedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"insert into Partner (id, name) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"select p.id, p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This section is only a brief overview of HQL. For more information, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql">HQL</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="batch-bulk-hql-strategies"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies"></a>12.3.3. Bulk-id strategies</h4>
<div class="paragraph">
<p>This article is about the <a href="https://hibernate.atlassian.net/browse/HHH-11262">HHH-11262</a> JIRA issue which now allows the bulk-id
strategies to work even when you cannot create temporary tables.</p>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-class-diagram"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-class-diagram"></a>Class diagram</h5>
<div class="paragraph">
<p>Considering we have the following entities:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/temp_table_class_diagram.png" alt="Entity class diagram"></span></p>
</div>
<div class="paragraph">
<p>The <code>Person</code> entity is the base class of this entity inheritance model, and is mapped as follows:</p>
</div>
<div id="batch-bulk-hql-temp-table-base-class-example" class="exampleblock">
<div class="title">Example 426. Bulk-id base class entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">JOINED</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> companyName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> employed</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Both the <code>Doctor</code> and <code>Engineer</code> entity classes extend the <code>Person</code> base class:</p>
</div>
<div id="batch-bulk-hql-temp-table-sub-classes-example" class="exampleblock">
<div class="title">Example 427. Bulk-id subclass entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Doctor"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Doctor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Engineer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Engineer</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> fellow</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-inheritance-tree"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-inheritance-tree"></a>Inheritance tree bulk processing</h5>
<div class="paragraph">
<p>Now, when you try to execute a bulk entity delete query:</p>
</div>
<div id="batch-bulk-hql-temp-table-delete-query-example" class="exampleblock">
<div class="title">Example 428. Bulk-id delete query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">int</span><span class="pln"> updateCount </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"delete from Person where employed = :employed"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"employed"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create temporary table
    HT_Person
</span><span class="pun">(</span><span class="pln">
    id int4 </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    companyName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    HT_Person
    </span><span class="kwd">select</span><span class="pln">
        p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
        p</span><span class="pun">.</span><span class="pln">companyName </span><span class="kwd">as</span><span class="pln"> companyName
    </span><span class="kwd">from</span><span class="pln">
        </span><span class="typ">Person</span><span class="pln"> p
    </span><span class="kwd">where</span><span class="pln">
        p</span><span class="pun">.</span><span class="pln">employed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Engineer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">
        id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="pun">)</span><span class="pln"> IN </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Doctor</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">
        id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="pun">)</span><span class="pln"> IN </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">
        id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="pun">)</span><span class="pln"> IN </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>HT_Person</code> is a temporary table that Hibernate creates to hold all the entity identifiers that are to be updated or deleted by the bulk id operation.
The temporary table can be either global or local, depending on the underlying database capabilities.</p>
</div>
</div>
<div class="sect4">
<h5 id="batch-bulk-hql-strategies-non-temporary-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-non-temporary-table"></a>Non-temporary table bulk-id strategies</h5>
<div class="paragraph">
<p>As the <a href="https://hibernate.atlassian.net/browse/HHH-11262">HHH-11262</a> issue describes, there are use cases when the application developer cannot use temporary tables because
the database user lacks this privilege.</p>
</div>
<div class="paragraph">
<p>In this case, we defined several options which you can choose depending on your database capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>InlineIdsInClauseBulkIdStrategy</code></p>
</li>
<li>
<p><code>InlineIdsSubSelectValueListBulkIdStrategy</code></p>
</li>
<li>
<p><code>InlineIdsOrClauseBulkIdStrategy</code></p>
</li>
<li>
<p><code>CteValuesListBulkIdStrategy</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="batch-bulk-hql-strategies-InlineIdsInClauseBulkIdStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-InlineIdsInClauseBulkIdStrategy"></a><code>InlineIdsInClauseBulkIdStrategy</code></h6>
<div class="paragraph">
<p>To use this strategy, you need to configure the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hql.bulk_id_strategy"</span><span class="pln">
          </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.hql.spi.id.inline.InlineIdsInClauseBulkIdStrategy"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when running the previous test case, Hibernate generates the following SQL statements:</p>
</div>
<div id="batch-bulk-hql-InlineIdsInClauseBulkIdStrategy-delete-query-example" class="exampleblock">
<div class="title">Example 429. <code>InlineIdsInClauseBulkIdStrategy</code> delete entity query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">companyName </span><span class="kwd">as</span><span class="pln"> companyName
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p
</span><span class="kwd">where</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">employed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Engineer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Doctor</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>So, the entity identifiers are selected first and used for each particular update or delete statement.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The IN clause row value expression has long been supported by Oracle, PostgreSQL, and nowadays by MySQL 5.7.
However, SQL Server 2014 does not support this syntax, so youâ€™ll have to use a different strategy.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="batch-bulk-hql-strategies-InlineIdsSubSelectValueListBulkIdStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-InlineIdsSubSelectValueListBulkIdStrategy"></a><code>InlineIdsSubSelectValueListBulkIdStrategy</code></h6>
<div class="paragraph">
<p>To use this strategy, you need to configure the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hql.bulk_id_strategy"</span><span class="pln">
          </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.hql.spi.id.inline.InlineIdsSubSelectValueListBulkIdStrategy"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when running the previous test case, Hibernate generates the following SQL statements:</p>
</div>
<div id="batch-bulk-hql-InlineIdsSubSelectValueListBulkIdStrategy-delete-query-example" class="exampleblock">
<div class="title">Example 430. <code>InlineIdsSubSelectValueListBulkIdStrategy</code> delete entity query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">companyName </span><span class="kwd">as</span><span class="pln"> companyName
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p
</span><span class="kwd">where</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">employed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Engineer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        values
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT
            </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Doctor</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
         </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        values
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT
            </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln">
            companyName
        </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        values
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
            </span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT
            </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The underlying database must support the VALUES list clause, like PostgreSQL or SQL Server 2008.
However, this strategy requires the IN-clause row value expression for composite identifiers so you can use this strategy only with PostgreSQL.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="batch-bulk-hql-strategies-InlineIdsOrClauseBulkIdStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-InlineIdsOrClauseBulkIdStrategy"></a><code>InlineIdsOrClauseBulkIdStrategy</code></h6>
<div class="paragraph">
<p>To use this strategy, you need to configure the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hql.bulk_id_strategy"</span><span class="pln">
          </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.hql.spi.id.inline.InlineIdsOrClauseBulkIdStrategy"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when running the previous test case, Hibernate generates the following SQL statements:</p>
</div>
<div id="batch-bulk-hql-InlineIdsOrClauseBulkIdStrategy-delete-query-example" class="exampleblock">
<div class="title">Example 431. <code>InlineIdsOrClauseBulkIdStrategy</code> delete entity query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">companyName </span><span class="kwd">as</span><span class="pln"> companyName
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p
</span><span class="kwd">where</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">employed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Engineer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Doctor</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat USA'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">or</span><span class="pln">  </span><span class="pun">(</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> companyName </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Red Hat Europe'</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This strategy has the advantage of being supported by all the major relational database systems (e.g. Oracle, SQL Server, MySQL, and PostgreSQL).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="batch-bulk-hql-strategies-CteValuesListBulkIdStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch-bulk-hql-strategies-CteValuesListBulkIdStrategy"></a><code>CteValuesListBulkIdStrategy</code></h6>
<div class="paragraph">
<p>To use this strategy, you need to configure the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.hql.bulk_id_strategy"</span><span class="pln">
          </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.hql.spi.id.inline.CteValuesListBulkIdStrategy"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when running the previous test case, Hibernate generates the following SQL statements:</p>
</div>
<div id="batch-bulk-hql-CteValuesListBulkIdStrategy-delete-query-example" class="exampleblock">
<div class="title">Example 432. <code>CteValuesListBulkIdStrategy</code> delete entity query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">companyName </span><span class="kwd">as</span><span class="pln"> companyName
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p
</span><span class="kwd">where</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">employed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="kwd">with</span><span class="pln"> HT_Person </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln">companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">select</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    values
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Engineer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln"> companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span><span class="pln">

</span><span class="kwd">with</span><span class="pln"> HT_Person </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln">companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">select</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    values
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Doctor</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln"> companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span><span class="pln">


</span><span class="kwd">with</span><span class="pln"> HT_Person </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln">companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">select</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName
    </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    values
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?),</span><span class="pln">
        </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> HT </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> companyName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    </span><span class="pun">(</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> companyName </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            id</span><span class="pun">,</span><span class="pln"> companyName
        </span><span class="kwd">from</span><span class="pln">
            HT_Person
    </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The underlying database must support the CTE (Common Table Expressions) that can be referenced from non-query statements as well, like PostgreSQL since 9.1 or SQL Server since 2005.
The underlying database must also support the VALUES list clause, like PostgreSQL or SQL Server 2008.</p>
</div>
<div class="paragraph">
<p>However, this strategy requires the IN-clause row value expression for composite identifiers, so you can only use this strategy only with PostgreSQL.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you can use temporary tables, thatâ€™s probably the best choice.
However, if you are not allowed to create temporary tables, you must pick one of these four strategies that works with your underlying database.
Before making your mind, you should benchmark which one works best for your current workload.
For instance, <a href="http://blog.2ndquadrant.com/postgresql-ctes-are-optimization-fences/">CTE are optimization fences in PostgreSQL</a>, so make sure you measure before taking a decision.</p>
</div>
<div class="paragraph">
<p>If youâ€™re using Oracle or MySQL 5.7, you can choose either <code>InlineIdsOrClauseBulkIdStrategy</code> or <code>InlineIdsInClauseBulkIdStrategy</code>.
For older version of MySQL, then you can only use <code>InlineIdsOrClauseBulkIdStrategy</code>.</p>
</div>
<div class="paragraph">
<p>If youâ€™re using SQL Server, <code>InlineIdsOrClauseBulkIdStrategy</code> is the only option for you.</p>
</div>
<div class="paragraph">
<p>If youâ€™re using PostgreSQL, then you  have the luxury of choosing any of these four strategies.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching"></a>13. Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At runtime, Hibernate handles moving data into and out of the second-level cache in response to the operations performed by the <code>Session</code>, which acts as a transaction-level cache of persistent data.
Once an entity becomes managed, that object is added to the internal cache of the current persistence context (<code>EntityManager</code> or <code>Session</code>).
The persistence context is also called the first-level cache, and itâ€™s enabled by default.</p>
</div>
<div class="paragraph">
<p>It is possible to configure a JVM-level (<code>SessionFactory</code>-level) or even a cluster cache on a class-by-class and collection-by-collection basis.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware that caches are not aware of changes made to the persistent store by other applications.
They can, however, be configured to regularly expire cached data.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="caching-config"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-config"></a>13.1. Configuring second-level caching</h3>
<div class="paragraph">
<p>Hibernate can integrate with various caching providers for the purpose of caching data outside the context of a particular <code>Session</code>.
This section defines the settings which control this behavior.</p>
</div>
<div class="sect3">
<h4 id="caching-config-provider"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-config-provider"></a>13.1.1. RegionFactory</h4>
<div class="paragraph">
<p><code>org.hibernate.cache.spi.RegionFactory</code> defines the integration between Hibernate and a pluggable caching provider.
<code>hibernate.cache.region.factory_class</code> is used to declare the provider to use.
Hibernate comes with built-in support for the Java caching standard <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache">JCache</a>
and also two popular caching libraries: <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache">Ehcache</a> and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-infinispan">Infinispan</a>.
Detailed information is provided later in this chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching-config-properties"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-config-properties"></a>13.1.2. Caching configuration properties</h4>
<div class="paragraph">
<p>Besides specific provider configuration, there are a number of configurations options on the Hibernate side of the integration that control various caching behaviors:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.cache.use_second_level_cache</code></dt>
<dd>
<p>Enable or disable second level caching overall. The default is true, although the default region factory is <code>NoCachingRegionFactory</code>.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_query_cache</code></dt>
<dd>
<p>Enable or disable second level caching of query results. The default is false.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.query_cache_factory</code></dt>
<dd>
<p>Query result caching is handled by a special contract that deals with staleness-based invalidation of the results.
The default implementation does not allow stale results at all. Use this for applications that would like to relax that.
Names an implementation of <code>org.hibernate.cache.spi.QueryCacheFactory</code></p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_minimal_puts</code></dt>
<dd>
<p>Optimizes second-level cache operations to minimize writes, at the cost of more frequent reads. Providers typically set this appropriately.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.region_prefix</code></dt>
<dd>
<p>Defines a name to be used as a prefix to all second-level cache region names.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.default_cache_concurrency_strategy</code></dt>
<dd>
<p>In Hibernate second-level caching, all regions can be configured differently including the concurrency strategy to use when accessing that particular region.
This setting allows defining a default strategy to be used.
This setting is very rarely required as the pluggable providers do specify the default strategy to use.
Valid values include:</p>
<div class="ulist">
<ul>
<li>
<p>read-only,</p>
</li>
<li>
<p>read-write,</p>
</li>
<li>
<p>nonstrict-read-write,</p>
</li>
<li>
<p>transactional</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_structured_entries</code></dt>
<dd>
<p>If <code>true</code>, forces Hibernate to store data in the second-level cache in a more human-friendly format.
Can be useful if youâ€™d like to be able to "browse" the data directly in your cache, but does have a performance impact.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.auto_evict_collection_cache</code></dt>
<dd>
<p>Enables or disables the automatic eviction of a bidirectional associationâ€™s collection cache entry when the association is changed just from the owning side.
This is disabled by default, as it has a performance impact to track this state.
However, if your application does not manage both sides of bidirectional association where the collection side is cached,
the alternative is to have stale data in that collection cache.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.use_reference_entries</code></dt>
<dd>
<p>Enable direct storage of entity references into the second level cache for read-only or immutable entities.</p>
</dd>
<dt class="hdlist1"><code>hibernate.cache.keys_factory</code></dt>
<dd>
<p>When storing entries into the second-level cache as a key-value pair, the identifiers can be wrapped into tuples
&lt;entity type, tenant, identifier&gt; to guarantee uniqueness in case that second-level cache stores all entities
in single space. These tuples are then used as keys in the cache. When the second-level cache implementation
(incl. its configuration) guarantees that different entity types are stored separately and multi-tenancy is not
used, you can omit this wrapping to achieve better performance. Currently, this property is only supported when
Infinispan is configured as the second-level cache implementation. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>default</code> (wraps identitifers in the tuple)</p>
</li>
<li>
<p><code>simple</code> (uses identifiers as keys without any wrapping)</p>
</li>
<li>
<p>fully qualified class name that implements <code>org.hibernate.cache.spi.CacheKeysFactory</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-mappings"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-mappings"></a>13.2. Configuring second-level cache mappings</h3>
<div class="paragraph">
<p>The cache mappings can be configured via JPA annotations or XML descriptors or using the Hibernate-specific mapping files.</p>
</div>
<div class="paragraph">
<p>By default, entities are not part of the second level cache and we recommend you to stick to this setting.
However, you can override this by setting the <code>shared-cache-mode</code> element in your <code>persistence.xml</code> file
or by using the <code>javax.persistence.sharedCache.mode</code> property in your configuration file.
The following values are possible:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ENABLE_SELECTIVE</code> (Default and recommended value)</dt>
<dd>
<p>Entities are not cached unless explicitly marked as cacheable (with the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Cacheable.html"><code>@Cacheable</code></a> annotation).</p>
</dd>
<dt class="hdlist1"><code>DISABLE_SELECTIVE</code></dt>
<dd>
<p>Entities are cached unless explicitly marked as non-cacheable.</p>
</dd>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>Entities are always cached even if marked as non-cacheable.</p>
</dd>
<dt class="hdlist1"><code>NONE</code></dt>
<dd>
<p>No entity is cached even if marked as cacheable.
This option can make sense to disable second-level cache altogether.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The cache concurrency strategy used by default can be set globally via the <code>hibernate.cache.default_cache_concurrency_strategy</code> configuration property.
The values for this property are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">read-only</dt>
<dd>
<p>If your application needs to read, but not modify, instances of a persistent class, a read-only cache is the best choice.
Application can still delete entities and these changes should be reflected in second-level cache so that the cache
does not provide stale entities.
Implementations may use performance optimizations based on the immutability of entities.</p>
</dd>
<dt class="hdlist1">read-write</dt>
<dd>
<p>If the application needs to update data, a read-write cache might be appropriate.
This strategy provides consistent access to single entity, but not a serializable transaction isolation level; e.g. when TX1 reads looks up an entity and does not find it, TX2 inserts the entity into cache and TX1 looks it up again, the new entity can be read in TX1.</p>
</dd>
<dt class="hdlist1">nonstrict-read-write</dt>
<dd>
<p>Similar to read-write strategy but there might be occasional stale reads upon concurrent access to an entity. The choice of this strategy might be appropriate if the application rarely updates the same data simultaneously and strict transaction isolation is not required. Implementations may use performance optimizations that make use of the relaxed consistency guarantee.</p>
</dd>
<dt class="hdlist1">transactional</dt>
<dd>
<p>Provides serializable transaction isolation level.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rather than using a global cache concurrency strategy, it is recommended to define this setting on a per entity basis.
Use the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Cache.html"><code>@org.hibernate.annotations.Cache</code></a> annotation for that.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>@Cache</code> annotation define three attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">usage</dt>
<dd>
<p>Defines the <code>CacheConcurrencyStrategy</code></p>
</dd>
<dt class="hdlist1">region</dt>
<dd>
<p>Defines a cache region where entries will be stored</p>
</dd>
<dt class="hdlist1">include</dt>
<dd>
<p>If lazy properties should be included in the second level cache.
The default value is <code>all</code> so lazy properties are cacheable.
The other possible value is <code>non-lazy</code> so lazy properties are not cacheable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="caching-mappings-inheritance"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-mappings-inheritance"></a>13.3. Entity inheritance and second-level cache mapping</h3>
<div class="paragraph">
<p>Traditionally, when using entity inheritance, Hibernate required an entity hierarchy to be either cached entirely or not cached at all.
Therefore, if you wanted to cache a subclass belonging to a given entity hierarchy,
the JPA <code>@Cacheable</code> and the Hibernate-specific <code>@Cache</code> annotations would have to be declared at the root-entity level only.</p>
</div>
<div class="paragraph">
<p>Although we still believe that all entities belonging to a given entity hierarchy should share the same caching semantics,
the JPA specification says that the <code>@Cacheable</code> annotation could be overwritten by a subclass:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The value of the <code>Cacheable</code> annotation is inherited by subclasses; it can be overridden by specifying <code>Cacheable</code> on a subclass.</p>
</div>
</blockquote>
<div class="attribution">
â€” Section 11.1.7 of the JPA 2.1 Specification
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Hibernate ORM 5.3, itâ€™s now possible to possible to override a base class <code>@Cacheable</code> or <code>@Cache</code> definition in subclasses.</p>
</div>
<div class="paragraph">
<p>However, the Hibernate cache concurrency strategy (e.g. read-only, nonstrict-read-write, read-write, transactional) is still defined at the root entity level
and cannot be overridden.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Nevertheless, the reasons why we advise you to have all entities belonging to an inheritance tree share the same caching definition can be summed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from a performance perspective, adding an additional check on a per entity type level slows the bootstrap process.</p>
</li>
<li>
<p>providing different caching semantics for subclasses would violate the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="caching-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-entity"></a>13.4. Entity cache</h3>
<div id="caching-entity-mapping-example" class="exampleblock">
<div class="title">Example 433. Entity cache mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Cacheable</span><span class="pln">
</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Cache</span><span class="pun">(</span><span class="pln">usage </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CacheConcurrencyStrategy</span><span class="pun">.</span><span class="pln">NONSTRICT_READ_WRITE</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> mobile</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate stores cached entities in a dehydrated form, which is similar to the database representation.
Aside from the foreign key column values of the <code>@ManyToOne</code> or <code>@OneToOne</code> child-side associations,
entity relationships are not stored in the cache,</p>
</div>
<div class="paragraph">
<p>Once an entity is stored in the second-level cache, you can avoid a database hit and load the entity from the cache alone:</p>
</div>
<div id="caching-entity-jpa-example" class="exampleblock">
<div class="title">Example 434. Loading entity using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-entity-native-example" class="exampleblock">
<div class="title">Example 435. Loading entity using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Hibernate second-level cache can also load entities by their <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid">natural id</a>:</p>
</div>
<div id="caching-entity-natural-id-mapping-example" class="exampleblock">
<div class="title">Example 436. Hibernate natural id entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Cacheable</span><span class="pln">
</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Cache</span><span class="pun">(</span><span class="pln">usage </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CacheConcurrencyStrategy</span><span class="pun">.</span><span class="pln">READ_WRITE</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

       </span><span class="lit">@Id</span><span class="pln">
       </span><span class="lit">@GeneratedValue</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GenerationType</span><span class="pun">.</span><span class="pln">AUTO</span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

       </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@NaturalId</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"code"</span><span class="pun">,</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> code</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-entity-natural-id-example" class="exampleblock">
<div class="title">Example 437. Loading entity using Hibernate native natural id API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session
	</span><span class="pun">.</span><span class="pln">byNaturalId</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">using</span><span class="pun">(</span><span class="pln"> </span><span class="str">"code"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"unique-code"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">load</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-collection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-collection"></a>13.5. Collection cache</h3>
<div class="paragraph">
<p>Hibernate can also cache collections, and the <code>@Cache</code> annotation must be on added to the collection property.</p>
</div>
<div class="paragraph">
<p>If the collection is made of value types (basic or embeddables mapped with <code>@ElementCollection</code>),
the collection is stored as such.
If the collection contains other entities (<code>@OneToMany</code> or <code>@ManyToMany</code>),
the collection cache entry will store the entity identifiers only.</p>
</div>
<div id="caching-collection-mapping-example" class="exampleblock">
<div class="title">Example 438. Collection cache mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Cache</span><span class="pun">(</span><span class="pln">usage </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CacheConcurrencyStrategy</span><span class="pun">.</span><span class="pln">NONSTRICT_READ_WRITE</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Collections are read-through, meaning they are cached upon being accessed for the first time:</p>
</div>
<div id="caching-collection-example" class="exampleblock">
<div class="title">Example 439. Collection cache usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">size</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Subsequent collection retrievals will use the cache instead of going to the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The collection cache is not write-through so any modification will trigger a collection cache entry invalidation.
On a subsequent access, the collection will be loaded from the database and re-cached.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="caching-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-query"></a>13.6. Query cache</h3>
<div class="paragraph">
<p>Aside from caching entities and collections, Hibernate offers a query cache too.
This is useful for frequently executed queries with fixed parameter values.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Caching of query results introduces some overhead in terms of your applications normal transactional processing.
For example, if you cache results of a query against <code>Person</code>,
Hibernate will need to keep track of when those results should be invalidated because changes have been committed against any <code>Person</code> entity.</p>
</div>
<div class="paragraph">
<p>That, coupled with the fact that most applications simply gain no benefit from caching query results,
leads Hibernate to disable caching of query results by default.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To use query caching, you will first need to enable it with the following configuration property:</p>
</div>
<div id="caching-query-configuration" class="exampleblock">
<div class="title">Example 440. Enabling query cache</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.cache.use_query_cache"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, most queries do not benefit from caching or their results.
So by default, individual queries are not cached even after enabling query caching.
Each particular query that needs to be cached must be manually set as cacheable.
This way, the query looks for existing cache results or adds the query results to the cache when being executed.</p>
</div>
<div id="caching-query-jpa-example" class="exampleblock">
<div class="title">Example 441. Caching query using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name = :name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.cacheable"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-native-example" class="exampleblock">
<div class="title">Example 442. Caching query using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name = :name"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The query cache does not cache the state of the actual entities in the cache;
it caches only identifier values and results of value type.</p>
</div>
<div class="paragraph">
<p>Just as with collection caching, the query cache should always be used in conjunction with the second-level cache for those entities expected to be cached as part of a query result cache.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="caching-query-region"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-query-region"></a>13.6.1. Query cache regions</h4>
<div class="paragraph">
<p>This setting creates two new cache regions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default-query-results-region</code></dt>
<dd>
<p>Holding the cached query results</p>
</dd>
<dt class="hdlist1"><code>default-update-timestamps-region</code></dt>
<dd>
<p>Holding timestamps of the most recent updates to queryable tables.
These are used to validate the results as they are served from the query cache.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you configure your underlying cache implementation to use expiration, itâ€™s very important
that the timeout of the underlying cache region for the <code>default-update-timestamps-region</code>
is set to a higher value than the timeouts of any of the query caches.</p>
</div>
<div class="paragraph">
<p>In fact, we recommend that the <code>default-update-timestamps-region</code> region is not configured for expiration (time-based) or eviction (size/memory-based) at all.
Note that an LRU (Least Recently Used) cache eviction policy is never appropriate for this particular cache region.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you require fine-grained control over query cache expiration policies,
you can specify a named cache region for a particular query.</p>
</div>
<div id="caching-query-region-jpa-example" class="exampleblock">
<div class="title">Example 443. Caching query in custom region using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"where p.id &gt; :id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0L</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_CACHEABLE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_CACHE_REGION</span><span class="pun">,</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-region-native-example" class="exampleblock">
<div class="title">Example 444. Caching query in custom region using Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id &gt; :id"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0L</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheRegion</span><span class="pun">(</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to force the query cache to refresh one of its regions (disregarding any cached results it finds there),
you can use custom cache modes.</p>
</div>
<div id="caching-query-region-store-mode-jpa-example" class="exampleblock">
<div class="title">Example 445. Using custom query cache mode with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id &gt; :id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0L</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_CACHEABLE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_CACHE_REGION</span><span class="pun">,</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.cache.storeMode"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CacheStoreMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-query-region-store-mode-native-example" class="exampleblock">
<div class="title">Example 446. Using custom query cache mode with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id &gt; :id"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0L</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheRegion</span><span class="pun">(</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CacheMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/CacheStoreMode.html#REFRESH"><code>CacheStoreMode.REFRESH</code></a> or <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/CacheMode.html#REFRESH"><code>CacheMode.REFRESH</code></a> in conjunction with the region you have defined for the given query,
Hibernate will selectively force the results cached in that particular region to be refreshed.</p>
</div>
<div class="paragraph">
<p>This is particularly useful in cases where underlying data may have been updated via a separate process
and is a far more efficient alternative to the bulk eviction of the region via <code>SessionFactory</code> eviction which looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">session</span><span class="pun">.</span><span class="pln">getSessionFactory</span><span class="pun">().</span><span class="pln">getCache</span><span class="pun">().</span><span class="pln">evictQueryRegion</span><span class="pun">(</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-management"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-management"></a>13.7. Managing the cached data</h3>
<div class="paragraph">
<p>Traditionally, Hibernate defined the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/CacheMode.html"><code>CacheMode</code></a> enumeration to describe
the ways of interactions with the cached data.
JPA split cache modes by storage (<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/CacheStoreMode.html"><code>CacheStoreMode</code></a>)
and retrieval (<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/CacheRetrieveMode.html"><code>CacheRetrieveMode</code></a>).</p>
</div>
<div class="paragraph">
<p>The relationship between Hibernate and JPA cache modes can be seen in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Cache modes relationships</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hibernate</th>
<th class="tableblock halign-left valign-top">JPA</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.NORMAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.USE</code> and <code>CacheRetrieveMode.USE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default. Reads/writes data from/into the cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.REFRESH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.REFRESH</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesnâ€™t read from cache, but writes to the cache upon loading from the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.USE</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesnâ€™t read from cache, but writes to the cache as it reads from the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.BYPASS</code> and <code>CacheRetrieveMode.USE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read from the cache, but doesnâ€™t write to cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheMode.IGNORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheStoreMode.BYPASS</code> and <code>CacheRetrieveMode.BYPASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesnâ€™t read/write data from/into the cache</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting the cache mode can be done either when loading entities directly or when executing a query.</p>
</div>
<div id="caching-management-cache-mode-entity-jpa-example" class="exampleblock">
<div class="title">Example 447. Using custom cache modes with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> hints </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">
hints</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.cache.retrieveMode "</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="typ">CacheRetrieveMode</span><span class="pun">.</span><span class="pln">USE </span><span class="pun">);</span><span class="pln">
hints</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.cache.storeMode"</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="typ">CacheStoreMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> hints</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-cache-mode-entity-native-example" class="exampleblock">
<div class="title">Example 448. Using custom cache modes with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">session</span><span class="pun">.</span><span class="pln">setCacheMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CacheMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The custom cache modes can be set for queries as well:</p>
</div>
<div id="caching-management-cache-mode-query-jpa-example" class="exampleblock">
<div class="title">Example 449. Using custom cache modes for queries with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_CACHEABLE</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.cache.retrieveMode "</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="typ">CacheRetrieveMode</span><span class="pun">.</span><span class="pln">USE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.cache.storeMode"</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="typ">CacheStoreMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="caching-management-cache-mode-query-native-example" class="exampleblock">
<div class="title">Example 450. Using custom cache modes for queries with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p from Person p"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CacheMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="caching-management-evict"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-management-evict"></a>13.7.1. Evicting cache entries</h4>
<div class="paragraph">
<p>Because the second level cache is bound to the <code>EntityManagerFactory</code> or the <code>SessionFactory</code>,
cache eviction must be done through these two interfaces.</p>
</div>
<div class="paragraph">
<p>JPA only supports entity eviction through the <a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Cache.html"><code>javax.persistence.Cache</code></a> interface:</p>
</div>
<div id="caching-management-evict-jpa-example" class="exampleblock">
<div class="title">Example 451. Evicting entities with JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">entityManager</span><span class="pun">.</span><span class="pln">getEntityManagerFactory</span><span class="pun">().</span><span class="pln">getCache</span><span class="pun">().</span><span class="pln">evict</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate is much more flexible in this regard as it offers fine-grained control over what needs to be evicted.
The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Cache.html"><code>org.hibernate.Cache</code></a> interface defines various evicting strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>entities (by their class or region)</p>
</li>
<li>
<p>entities stored using the natural-id (by their class or region)</p>
</li>
<li>
<p>collections (by the region, and it might take the collection owner identifier as well)</p>
</li>
<li>
<p>queries (by region)</p>
</li>
</ul>
</div>
<div id="caching-management-evict-native-example" class="exampleblock">
<div class="title">Example 452. Evicting entities with Hibernate native API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">session</span><span class="pun">.</span><span class="pln">getSessionFactory</span><span class="pun">().</span><span class="pln">getCache</span><span class="pun">().</span><span class="pln">evictQueryRegion</span><span class="pun">(</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-statistics"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-statistics"></a>13.8. Caching statistics</h3>
<div class="paragraph">
<p>If you enable the <code>hibernate.generate_statistics</code> configuration property,
Hibernate will expose a number of metrics via <code>SessionFactory.getStatistics()</code>.
Hibernate can even be configured to expose these statistics via JMX.</p>
</div>
<div class="paragraph">
<p>This way, you can get access to the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/stat/Statistics.html"><code>Statistics</code></a> class which comprises all sort of
second-level cache metrics.</p>
</div>
<div id="caching-statistics-example" class="exampleblock">
<div class="title">Example 453. Caching statistics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Statistics</span><span class="pln"> statistics </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getSessionFactory</span><span class="pun">().</span><span class="pln">getStatistics</span><span class="pun">();</span><span class="pln">
</span><span class="typ">CacheRegionStatistics</span><span class="pln"> secondLevelCacheStatistics </span><span class="pun">=</span><span class="pln">
		statistics</span><span class="pun">.</span><span class="pln">getDomainDataRegionStatistics</span><span class="pun">(</span><span class="pln"> </span><span class="str">"query.cache.person"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> hitCount </span><span class="pun">=</span><span class="pln"> secondLevelCacheStatistics</span><span class="pun">.</span><span class="pln">getHitCount</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> missCount </span><span class="pun">=</span><span class="pln"> secondLevelCacheStatistics</span><span class="pun">.</span><span class="pln">getMissCount</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">double</span><span class="pln"> hitRatio </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">double</span><span class="pun">)</span><span class="pln"> hitCount </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> hitCount </span><span class="pun">+</span><span class="pln"> missCount </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-provider-jcache"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache"></a>13.9. JCache</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use of the built-in integration for <a href="https://jcp.org/en/jsr/detail?id=107">JCache</a> requires that the <code>hibernate-jcache</code> module jar (and all of its dependencies) are on the classpath.
In addition a JCache implementation needs to be added as well.
A list of compatible implementations can be found <a href="https://jcp.org/aboutJava/communityprocess/implementations/jsr107/index.html">on the JCP website</a>.
An alternative source of compatible implementations can be found through <a href="https://github.com/cruftex/jsr107-test-zoo">the JSR-107 test zoo</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-region-factory"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache-region-factory"></a>13.9.1. RegionFactory</h4>
<div class="paragraph">
<p>The <code>hibernate-jcache</code> module defines the following region factory: <code>JCacheRegionFactory</code>.</p>
</div>
<div class="paragraph">
<p>To use the <code>JCacheRegionFactory</code>, you need to specify the following configuration property:</p>
</div>
<div id="caching-provider-jcache-region-factory-example" class="exampleblock">
<div class="title">Example 454. <code>JCacheRegionFactory</code> configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.cache.region.factory_class"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"jcache"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>JCacheRegionFactory</code> configures a <code>javax.cache.CacheManager</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-cache-manager"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache-cache-manager"></a>13.9.2. JCache <code>CacheManager</code></h4>
<div class="paragraph">
<p>JCache mandates that <code>CacheManager</code>s sharing the same URI and class loader be unique in JVM.</p>
</div>
<div class="paragraph">
<p>If you do not specify additional properties, the <code>JCacheRegionFactory</code> will load the default JCache provider and create the default <code>CacheManager</code>.
Also, <code>Cache</code>s will be created using the default <code>javax.cache.configuration.MutableConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>In order to control which provider to use and specify configuration for the <code>CacheManager</code> and <code>Cache</code>s you can use the following two properties:</p>
</div>
<div id="caching-provider-jcache-region-factory-config-example" class="exampleblock">
<div class="title">Example 455. JCache configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.javax.cache.provider"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.ehcache.jsr107.EhcacheCachingProvider"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.javax.cache.uri"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"file:/path/to/ehcache.xml"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only by specifying the second property <code>hibernate.javax.cache.uri</code> will you be able to have a <code>CacheManager</code> per <code>SessionFactory</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching-provider-jcache-missing-cache-strategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache-missing-cache-strategy"></a>13.9.3. JCache missing cache strategy</h4>
<div class="paragraph">
<p>By default, the JCache region factory
will log a warning when asked to create a cache that is not explicitly configured and pre-started in the underlying cache manager.
Thus if you configure an entity type or a collection as cached, but do not configure the corresponding cache explicitly,
one warning will be logged for each cache that was not configured explicitly.</p>
</div>
<div class="paragraph">
<p>You may change this behavior by setting the <code>hibernate.javax.cache.missing_cache_strategy</code> property
to one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Missing cache strategies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail with an exception on missing caches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default value</strong>. Create a new cache when a cache is not found (see <code>create</code> below),
and also log a warning about the missing cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new cache when a cache is not found, without logging any warning about the missing cache.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that caches created this way may be very badly configured (unlimited size and no eviction in particular)
unless the cache provider was explicitly configured to use a specific configuration for default caches.</p>
</div>
<div class="paragraph">
<p>Ehcache, in particular, allows to set such default configuration using cache templates,
see <a href="http://www.ehcache.org/documentation/3.0/107.html#supplement-jsr-107-configurations" class="bare">http://www.ehcache.org/documentation/3.0/107.html#supplement-jsr-107-configurations</a></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-provider-ehcache"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache"></a>13.10. Ehcache</h3>
<div class="paragraph">
<p>This integration covers Ehcache 2.x, in order to use Ehcache 3.x as second level cache, refer to the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache">JCache integration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use of the built-in integration for <a href="http://www.ehcache.org/">Ehcache</a> requires that the <code>hibernate-ehcache</code> module jar (and all of its dependencies) are on the classpath.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="caching-provider-ehcache-region-factory"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache-region-factory"></a>13.10.1. RegionFactory</h4>
<div class="paragraph">
<p>The hibernate-ehcache module defines two specific region factories: <code>EhCacheRegionFactory</code> and <code>SingletonEhCacheRegionFactory</code>.</p>
</div>
<div class="sect4">
<h5 id="caching-provider-ehcache-region-factory-shared"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache-region-factory-shared"></a><code>EhCacheRegionFactory</code></h5>
<div class="paragraph">
<p>To use the <code>EhCacheRegionFactory</code>, you need to specify the following configuration property:</p>
</div>
<div id="caching-provider-ehcache-region-factory-shared-example" class="exampleblock">
<div class="title">Example 456. <code>EhCacheRegionFactory</code> configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.cache.region.factory_class"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"ehcache"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>EhCacheRegionFactory</code> configures a <code>net.sf.ehcache.CacheManager</code> for each <code>SessionFactory</code>,
so the <code>CacheManager</code> is not shared among multiple <code>SessionFactory</code> instances in the same JVM.</p>
</div>
</div>
<div class="sect4">
<h5 id="caching-provider-ehcache-region-factory-singleton"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache-region-factory-singleton"></a><code>SingletonEhCacheRegionFactory</code></h5>
<div class="paragraph">
<p>To use the <code>SingletonEhCacheRegionFactory</code>, you need to specify the following configuration property:</p>
</div>
<div id="caching-provider-ehcache-region-factory-singleton-example" class="exampleblock">
<div class="title">Example 457. <code>SingletonEhCacheRegionFactory</code> configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.cache.region.factory_class"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"ehcache-singleton"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>SingletonEhCacheRegionFactory</code> configures a singleton <code>net.sf.ehcache.CacheManager</code> (see <a href="http://www.ehcache.org/apidocs/2.8.4/net/sf/ehcache/CacheManager.html#create%28%29">CacheManager#create()</a>),
shared among multiple <code>SessionFactory</code> instances in the same JVM.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="http://www.ehcache.org/documentation/2.8/integrations/hibernate#optional">Ehcache documentation</a> recommends using multiple non-singleton <code>CacheManager(s)</code> when there are multiple Hibernate <code>SessionFactory</code> instances running in the same JVM.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="caching-provider-ehcache-missing-cache-strategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-ehcache-missing-cache-strategy"></a>13.10.2. Ehcache missing cache strategy</h4>
<div class="paragraph">
<p>By default, the Ehcache region factory
will log a warning when asked to create a cache that is not explicitly configured and pre-started in the underlying cache manager.
Thus if you configure an entity type or a collection as cached, but do not configure the corresponding cache explicitly,
one warning will be logged for each cache that was not configured explicitly.</p>
</div>
<div class="paragraph">
<p>You may change this behavior by setting the <code>hibernate.cache.ehcache.missing_cache_strategy</code> property
to one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Missing cache strategies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail with an exception on missing caches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-warn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default value</strong>. Create a new cache when a cache is not found (see <code>create</code> below),
and also log a warning about the missing cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new cache when a cache is not found, without logging any warning about the missing cache.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that caches created this way may be very badly configured (large size in particular)
unless an appropriate <code>&lt;defaultCache&gt;</code> entry is added to the Ehcache configuration.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-provider-infinispan"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching-provider-infinispan"></a>13.11. Infinispan</h3>
<div class="paragraph">
<p>Infinispan is a distributed in-memory key/value data store, available as a cache or data grid, which can be used as a Hibernate 2nd-level cache provider as well.</p>
</div>
<div class="paragraph">
<p>It supports advanced functionality such as transactions, events, querying, distributed processing, off-heap and geographical failover.</p>
</div>
<div class="paragraph">
<p>For more details, check out the
<a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#integrations_jpa_hibernate">Infinispan User Guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="events"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events"></a>14. Interceptors and events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is useful for the application to react to certain events that occur inside Hibernate.
This allows for the implementation of generic functionality and the extension of Hibernate functionality.</p>
</div>
<div class="sect2">
<h3 id="events-interceptors"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-interceptors"></a>14.1. Interceptors</h3>
<div class="paragraph">
<p>The <code>org.hibernate.Interceptor</code> interface provides callbacks from the session to the application,
allowing the application to inspect and/or manipulate properties of a persistent object before it is saved, updated, deleted or loaded.</p>
</div>
<div class="paragraph">
<p>One possible use for this is to track auditing information.
The following example shows an <code>Interceptor</code> implementation that automatically logs when an entity is updated.</p>
</div>
<div id="events-interceptors-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">LoggingInterceptor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">EmptyInterceptor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> onFlushDirty</span><span class="pun">(</span><span class="pln">
		</span><span class="typ">Object</span><span class="pln"> entity</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">Serializable</span><span class="pln"> id</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> currentState</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> previousState</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> propertyNames</span><span class="pun">,</span><span class="pln">
		</span><span class="typ">Type</span><span class="pun">[]</span><span class="pln"> types</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			LOGGER</span><span class="pun">.</span><span class="pln">debugv</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Entity {0}#{1} changed from {2} to {3}"</span><span class="pun">,</span><span class="pln">
				entity</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">().</span><span class="pln">getSimpleName</span><span class="pun">(),</span><span class="pln">
				id</span><span class="pun">,</span><span class="pln">
				</span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln"> previousState </span><span class="pun">),</span><span class="pln">
				</span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln"> currentState </span><span class="pun">)</span><span class="pln">
			</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onFlushDirty</span><span class="pun">(</span><span class="pln"> entity</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> currentState</span><span class="pun">,</span><span class="pln">
				previousState</span><span class="pun">,</span><span class="pln"> propertyNames</span><span class="pun">,</span><span class="pln"> types
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can either implement <code>Interceptor</code> directly or extend <code>org.hibernate.EmptyInterceptor</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>An Interceptor can be either <code>Session</code>-scoped or <code>SessionFactory</code>-scoped.</p>
</div>
<div class="paragraph">
<p>A Session-scoped interceptor is specified when a session is opened.</p>
</div>
<div id="events-interceptors-session-scope-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> sessionFactory
	</span><span class="pun">.</span><span class="pln">withOptions</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">interceptor</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LoggingInterceptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> customerId </span><span class="pun">);</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Mr. John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="com">//Entity Customer#1 changed from [John Doe, 0] to [Mr. John Doe, 0]</span><span class="pln">

session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">().</span><span class="pln">commit</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>SessionFactory</code>-scoped interceptor is registered with the <code>Configuration</code> object prior to building the <code>SessionFactory</code>.
Unless a session is opened explicitly specifying the interceptor to use, the <code>SessionFactory</code>-scoped interceptor will be applied to all sessions opened from that <code>SessionFactory</code>.
<code>SessionFactory</code>-scoped interceptors must be thread-safe.
Ensure that you do not store session-specific states since multiple sessions will use this interceptor potentially concurrently.</p>
</div>
<div id="events-interceptors-session-factory-scope-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">SessionFactory</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MetadataSources</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardServiceRegistryBuilder</span><span class="pun">().</span><span class="pln">build</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getMetadataBuilder</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">build</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getSessionFactoryBuilder</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">applyInterceptor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LoggingInterceptor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events-events"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-events"></a>14.2. Native Event system</h3>
<div class="paragraph">
<p>If you have to react to particular events in the persistence layer, you can also use the Hibernate <em>event</em> architecture.
The event system can be used in place of or in addition to interceptors.</p>
</div>
<div class="paragraph">
<p>Many methods of the <code>Session</code> interface correlate to an event type.
The full range of defined event types is declared as enum values on <code>org.hibernate.event.spi.EventType</code>.
When a request is made of one of these methods, the Session generates an appropriate event and passes it to the configured event listener(s) for that type.</p>
</div>
<div class="paragraph">
<p>Applications can customize the listener interfaces (i.e., the <code>LoadEvent</code> is processed by the registered implementation of the <code>LoadEventListener</code> interface), in which case their implementations would
be responsible for processing the <code>load()</code> requests made of the <code>Session</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The listeners should be considered stateless; they are shared between requests, and should not save any state as instance variables.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A custom listener implements the appropriate interface for the event it wants to process and/or extend one of the convenience base classes
(or even the default event listeners used by Hibernate out-of-the-box as these are declared non-final for this purpose).</p>
</div>
<div class="paragraph">
<p>Here is an example of a custom load event listener:</p>
</div>
<div id="events-interceptors-load-listener-example" class="exampleblock">
<div class="title">Example 458. Custom <code>LoadListener</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">EntityManagerFactory</span><span class="pln"> entityManagerFactory </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">SessionFactoryImplementor</span><span class="pln"> sessionFactory </span><span class="pun">=</span><span class="pln"> entityManagerFactory</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactoryImplementor</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
sessionFactory
	</span><span class="pun">.</span><span class="pln">getServiceRegistry</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventListenerRegistry</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">LOAD</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SecuredLoadEntityListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> customerId </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events-mixing-events-and-interceptors"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-mixing-events-and-interceptors"></a>14.3. Mixing Events and Interceptors</h3>
<div class="paragraph">
<p>When you want to customize the entity state transition behavior, you have to options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>you provide a custom <code>Interceptor</code>, which is taken into consideration by the default Hibernate event listeners.
For example, the <code>Interceptor#onSave()</code> method is invoked by Hibernate <code>AbstractSaveEventListener</code>.
Or, the <code>Interceptor#onLoad()</code> is called by the <code>DefaultPreLoadEventListener</code>.</p>
</li>
<li>
<p>you can replace any given default event listener with your own implementation.
When doing this, you should probably extend the default listeners because otherwise, youâ€™d have to take care of all the low-level entity state transition logic.
For example, if you replace the <code>DefaultPreLoadEventListener</code> with your own implementation, then, only if you call the <code>Interceptor#onLoad()</code> method explicitly, you can mix the custom load event listener with a custom Hibernate interceptor.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="events-declarative-security"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-declarative-security"></a>14.4. Hibernate declarative security</h3>
<div class="paragraph">
<p>Usually, declarative security in Hibernate applications is managed in a session facade layer.
Hibernate allows certain actions to be authorized via JACC and JAAS.
This is an optional functionality that is built on top of the event architecture.</p>
</div>
<div class="paragraph">
<p>First, you must configure the appropriate event listeners, to enable the use of JACC authorization.
Again, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-event-listener-registration">Event Listener Registration</a> for the details.</p>
</div>
<div class="paragraph">
<p>Below is an example of an appropriate <code>org.hibernate.integrator.spi.Integrator</code> implementation for this purpose.</p>
</div>
<div id="events-declarative-security-jacc-example" class="exampleblock">
<div class="title">Example 459. JACC listener registration example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">JaccIntegrator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceContributingIntegrator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="pln"> </span><span class="typ">JaccIntegrator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">DuplicationStrategy</span><span class="pln"> DUPLICATION_STRATEGY </span><span class="pun">=</span><span class="pln">
			</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DuplicationStrategy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="lit">@Override</span><span class="pln">
		</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> areMatch</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> listener</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> original</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> listener</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> original</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln">
					</span><span class="typ">JaccSecurityListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">isInstance</span><span class="pun">(</span><span class="pln"> original </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="lit">@Override</span><span class="pln">
		</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Action</span><span class="pln"> getAction</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Action</span><span class="pun">.</span><span class="pln">KEEP_ORIGINAL</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">};</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> prepareServices</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">StandardServiceRegistryBuilder</span><span class="pln"> serviceRegistryBuilder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">boolean</span><span class="pln"> isSecurityEnabled </span><span class="pun">=</span><span class="pln"> serviceRegistryBuilder
				</span><span class="pun">.</span><span class="pln">getSettings</span><span class="pun">().</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">JACC_ENABLED </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JaccService</span><span class="pln"> jaccService </span><span class="pun">=</span><span class="pln"> isSecurityEnabled </span><span class="pun">?</span><span class="pln">
				</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardJaccServiceImpl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DisabledJaccServiceImpl</span><span class="pun">();</span><span class="pln">
		serviceRegistryBuilder</span><span class="pun">.</span><span class="pln">addService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">JaccService</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> jaccService </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> integrate</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">Metadata</span><span class="pln"> metadata</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">SessionFactoryImplementor</span><span class="pln"> sessionFactory</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">SessionFactoryServiceRegistry</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		doIntegration</span><span class="pun">(</span><span class="pln">
				serviceRegistry
						</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ConfigurationService</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getSettings</span><span class="pun">(),</span><span class="pln">
				</span><span class="com">// pass no permissions here, because atm actually injecting the</span><span class="pln">
				</span><span class="com">// permissions into the JaccService is handled on SessionFactoryImpl via</span><span class="pln">
				</span><span class="com">// the org.hibernate.boot.cfgxml.spi.CfgXmlAccessService</span><span class="pln">
				</span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
				serviceRegistry
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doIntegration</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">Map</span><span class="pln"> properties</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">JaccPermissionDeclarations</span><span class="pln"> permissionDeclarations</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">SessionFactoryServiceRegistry</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">boolean</span><span class="pln"> isSecurityEnabled </span><span class="pun">=</span><span class="pln"> properties
				</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">JACC_ENABLED </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> isSecurityEnabled </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Skipping JACC integration as it was not enabled"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> contextId </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> properties
				</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">JACC_CONTEXT_ID </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> contextId </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IntegrationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"JACC context id must be specified"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JaccService</span><span class="pln"> jaccService </span><span class="pun">=</span><span class="pln"> serviceRegistry
				</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">JaccService</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> jaccService </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IntegrationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"JaccService was not set up"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> permissionDeclarations </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">GrantedPermission</span><span class="pln"> declaration </span><span class="pun">:</span><span class="pln"> permissionDeclarations
					</span><span class="pun">.</span><span class="pln">getPermissionDeclarations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				jaccService</span><span class="pun">.</span><span class="pln">addPermission</span><span class="pun">(</span><span class="pln"> declaration </span><span class="pun">);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">

		</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">EventListenerRegistry</span><span class="pln"> eventListenerRegistry </span><span class="pun">=</span><span class="pln">
				serviceRegistry</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> </span><span class="typ">EventListenerRegistry</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		eventListenerRegistry</span><span class="pun">.</span><span class="pln">addDuplicationStrategy</span><span class="pun">(</span><span class="pln"> DUPLICATION_STRATEGY </span><span class="pun">);</span><span class="pln">

		eventListenerRegistry</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">PRE_DELETE</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JaccPreDeleteEventListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		eventListenerRegistry</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">PRE_INSERT</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JaccPreInsertEventListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		eventListenerRegistry</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">PRE_UPDATE</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JaccPreUpdateEventListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
		eventListenerRegistry</span><span class="pun">.</span><span class="pln">prependListeners</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">EventType</span><span class="pun">.</span><span class="pln">PRE_LOAD</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JaccPreLoadEventListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> disintegrate</span><span class="pun">(</span><span class="typ">SessionFactoryImplementor</span><span class="pln"> sessionFactory</span><span class="pun">,</span><span class="pln">
							 </span><span class="typ">SessionFactoryServiceRegistry</span><span class="pln"> serviceRegistry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="com">// nothing to do</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You must also decide how to configure your JACC provider. Consult your JACC provider documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="events-jpa-callbacks"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks"></a>14.5. JPA Callbacks</h3>
<div class="paragraph">
<p>JPA also defines a more limited set of callbacks through annotations.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Callback annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PrePersist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the entity manager persist operation is actually executed or cascaded. This call is synchronous with the persist operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PreRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the entity manager remove operation is actually executed or cascaded. This call is synchronous with the remove operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostPersist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the entity manager persist operation is actually executed or cascaded. This call is invoked after the database INSERT is executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the entity manager remove operation is actually executed or cascaded. This call is synchronous with the remove operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PreUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed before the database UPDATE operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after the database UPDATE operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@PostLoad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executed after an entity has been loaded into the current persistence context or an entity has been refreshed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are two available approaches defined for specifying callback handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first approach is to annotate methods on the entity itself to receive notifications of a particular entity lifecycle event(s).</p>
</li>
<li>
<p>The second is to use a separate entity listener class.
An entity listener is a stateless class with a no-arg constructor.
The callback annotations are placed on a method of this class instead of the entity class.
The entity listener class is then associated with the entity using the <code>javax.persistence.EntityListeners</code> annotation</p>
</li>
</ul>
</div>
<div id="events-jpa-callbacks-example" class="exampleblock">
<div class="title">Example 460. Example of specifying JPA callbacks</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@EntityListeners</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LastUpdateListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> dateOfBirth</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Transient</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> lastUpdate</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setLastUpdate</span><span class="pun">(</span><span class="typ">Date</span><span class="pln"> lastUpdate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">lastUpdate </span><span class="pun">=</span><span class="pln"> lastUpdate</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">/**
	 * Set the transient property at load time based on a calculation.
	 * Note that a native Hibernate formula mapping is better for this purpose.
	 */</span><span class="pln">
	</span><span class="lit">@PostLoad</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> calculateAge</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		age </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ChronoUnit</span><span class="pun">.</span><span class="pln">YEARS</span><span class="pun">.</span><span class="pln">between</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LocalDateTime</span><span class="pun">.</span><span class="pln">ofInstant</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">Instant</span><span class="pun">.</span><span class="pln">ofEpochMilli</span><span class="pun">(</span><span class="pln"> dateOfBirth</span><span class="pun">.</span><span class="pln">getTime</span><span class="pun">()),</span><span class="pln"> </span><span class="typ">ZoneOffset</span><span class="pun">.</span><span class="pln">UTC</span><span class="pun">),</span><span class="pln">
			</span><span class="typ">LocalDateTime</span><span class="pun">.</span><span class="pln">now</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">LastUpdateListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@PreUpdate</span><span class="pln">
	</span><span class="lit">@PrePersist</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setLastUpdate</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> p </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		p</span><span class="pun">.</span><span class="pln">setLastUpdate</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These approaches can be mixed, meaning you can use both together.</p>
</div>
<div class="paragraph">
<p>Regardless of whether the callback method is defined on the entity or on an entity listener, it must have a void-return signature.
The name of the method is irrelevant as it is the placement of the callback annotations that makes the method a callback.
In the case of callback methods defined on the entity class, the method must additionally have a no-argument signature.
For callback methods defined on an entity listener class, the method must have a single argument signature; the type of that argument can be either <code>java.lang.Object</code> (to facilitate attachment to multiple entities) or the specific entity type.</p>
</div>
<div class="paragraph">
<p>A callback method can throw a <code>RuntimeException</code>.
If the callback method does throw a <code>RuntimeException</code>, then the current transaction, if any, must be rolled back.</p>
</div>
<div class="paragraph">
<p>A callback method must not invoke <code>EntityManager</code> or <code>Query</code> methods!</p>
</div>
<div class="paragraph">
<p>It is possible that multiple callback methods are defined for a particular lifecycle event.
When that is the case, the defined order of execution is well defined by the JPA spec (specifically section 3.5.4):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any default listeners associated with the entity are invoked first, in the order they were specified in the XML. See the <code>javax.persistence.ExcludeDefaultListeners</code> annotation.</p>
</li>
<li>
<p>Next, entity listener class callbacks associated with the entity hierarchy are invoked, in the order they are defined in the <code>EntityListeners</code>.
If multiple classes in the entity hierarchy define entity listeners, the listeners defined for a superclass are invoked before the listeners defined for its subclasses.
See the `javax.persistence.ExcludeSuperclassListener`s annotation.</p>
</li>
<li>
<p>Lastly, callback methods defined on the entity hierarchy are invoked.
If a callback type is annotated on both an entity and one or more of its superclasses without method overriding, both would be called, the most general superclass first.
An entity class is also allowed to override a callback method defined in a superclass in which case the super callback would not get invoked; the overriding method would get invoked provided it is annotated.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="events-default-listener"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-default-listener"></a>14.6. Default entity listeners</h3>
<div class="paragraph">
<p>The JPA specification allows you to define a default entity listener which is going to be applied for every entity in that particular system.
Default entity listeners can only be defined in XML mapping files.</p>
</div>
<div id="events-default-listener-mapping-example" class="exampleblock">
<div class="title">Example 461. Default event listner mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultEntityListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPersist</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> entity </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">BaseEntity</span><span class="pln"> baseEntity </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BaseEntity</span><span class="pun">)</span><span class="pln"> entity</span><span class="pun">;</span><span class="pln">
            baseEntity</span><span class="pun">.</span><span class="pln">setCreatedOn</span><span class="pun">(</span><span class="pln"> now</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onUpdate</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> entity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> entity </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">BaseEntity</span><span class="pln"> baseEntity </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BaseEntity</span><span class="pun">)</span><span class="pln"> entity</span><span class="pun">;</span><span class="pln">
            baseEntity</span><span class="pun">.</span><span class="pln">setUpdatedOn</span><span class="pun">(</span><span class="pln"> now</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> now</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">LocalDateTime</span><span class="pun">.</span><span class="pln">now</span><span class="pun">().</span><span class="pln">toInstant</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ZoneOffset</span><span class="pun">.</span><span class="pln">UTC </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;entity-mappings</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence/orm"</span><span class="pln">
                 </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
                 </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/persistence/orm
                 http://xmlns.jcp.org/xml/ns/persistence/orm_2_1.xsd"</span><span class="pln">
                 </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.1"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;persistence-unit-metadata&gt;</span><span class="pln">
        </span><span class="tag">&lt;persistence-unit-defaults&gt;</span><span class="pln">
            </span><span class="tag">&lt;entity-listeners&gt;</span><span class="pln">
                </span><span class="tag">&lt;entity-listener</span><span class="pln">
                    </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.userguide.events.DefaultEntityListener"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;pre-persist</span><span class="pln"> </span><span class="atn">method-name</span><span class="pun">=</span><span class="atv">"onPersist"</span><span class="tag">/&gt;</span><span class="pln">
                    </span><span class="tag">&lt;pre-update</span><span class="pln"> </span><span class="atn">method-name</span><span class="pun">=</span><span class="atv">"onUpdate"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;/entity-listener&gt;</span><span class="pln">
            </span><span class="tag">&lt;/entity-listeners&gt;</span><span class="pln">
        </span><span class="tag">&lt;/persistence-unit-defaults&gt;</span><span class="pln">
    </span><span class="tag">&lt;/persistence-unit-metadata&gt;</span><span class="pln">
</span><span class="tag">&lt;/entity-mappings&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Considering that all entities extend the <code>BaseEntity</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@MappedSuperclass</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Timestamp</span><span class="pln"> updatedOn</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Book"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Person</code> or <code>Book</code> entity, the <code>createdOn</code> is going to be set by the <code>onPersist</code> method of the <code>DefaultEntityListener</code>.</p>
</div>
<div id="events-default-listener-persist-example" class="exampleblock">
<div class="title">Example 462. Default event listner persist event</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">();</span><span class="pln">
author</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
author</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> author </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">();</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setAuthor</span><span class="pun">(</span><span class="pln"> author </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> book </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">createdOn</span><span class="pun">,</span><span class="pln"> updatedOn</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.224</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pln"> </span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Book</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">createdOn</span><span class="pun">,</span><span class="pln"> updatedOn</span><span class="pun">,</span><span class="pln"> author_id</span><span class="pun">,</span><span class="pln"> title</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.246</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When updating a <code>Person</code> or <code>Book</code> entity, the <code>updatedOn</code> is going to be set by the <code>onUpdate</code> method of the <code>DefaultEntityListener</code>.</p>
</div>
<div id="events-default-listener-update-example" class="exampleblock">
<div class="title">Example 463. Default event listner update event</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> author </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
author</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad-Alexandru Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Book</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
book</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln"> </span><span class="str">"High-Performance Java Persistence 2nd Edition"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">update
    </span><span class="typ">Person</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    createdOn</span><span class="pun">=?,</span><span class="pln">
    updatedOn</span><span class="pun">=?,</span><span class="pln">
    name</span><span class="pun">=?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.224</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.316</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pun">-</span><span class="typ">Alexandru</span><span class="pln"> </span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

update
    </span><span class="typ">Book</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    createdOn</span><span class="pun">=?,</span><span class="pln">
    updatedOn</span><span class="pun">=?,</span><span class="pln">
    author_id</span><span class="pun">=?,</span><span class="pln">
    title</span><span class="pun">=?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.246</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">08</span><span class="pln"> </span><span class="lit">19</span><span class="pun">:</span><span class="lit">23</span><span class="pun">:</span><span class="lit">48.317</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">High</span><span class="pun">-</span><span class="typ">Performance</span><span class="pln"> </span><span class="typ">Java</span><span class="pln"> </span><span class="typ">Persistence</span><span class="pln"> </span><span class="lit">2nd</span><span class="pln"> </span><span class="typ">Edition</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="events-exclude-default-listener"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-exclude-default-listener"></a>14.6.1. Exclude default entity listeners</h4>
<div class="paragraph">
<p>If you already registered a default entity listener, but you donâ€™t want to apply it to a particular entity,
you can use the
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ExcludeDefaultListeners.html"><code>@ExcludeDefaultListeners</code></a> and
<a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ExcludeSuperclassListeners.html"><code>@ExcludeSuperclassListeners</code></a> JPA annotations.</p>
</div>
<div class="paragraph">
<p><code>@ExcludeDefaultListeners</code> instructs the current class to ignore the default entity listeners for the current entity
while <code>@ExcludeSuperclassListeners</code> is used to ignore the default entity listeners propagated to the <code>BaseEntity</code> super-class.</p>
</div>
<div id="events-exclude-default-listener-mapping-example" class="exampleblock">
<div class="title">Example 464. Exclude default event listner mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Publisher"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@ExcludeDefaultListeners</span><span class="pln">
</span><span class="lit">@ExcludeSuperclassListeners</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">BaseEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When persisting a <code>Publisher</code> entity,
the <code>createdOn</code> is not going to be set by the <code>onPersist</code> method of the <code>DefaultEntityListener</code>
because the <code>Publisher</code> entity was marked with the <code>@ExcludeDefaultListeners</code> and <code>@ExcludeSuperclassListeners</code> annotations.</p>
</div>
<div id="events-exclude-default-listener-persist-example" class="exampleblock">
<div class="title">Example 465. Excluding default event listner events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Publisher</span><span class="pln"> publisher </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pun">();</span><span class="pln">
publisher</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
publisher</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Amazon"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> publisher </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Publisher</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">createdOn</span><span class="pun">,</span><span class="pln"> updatedOn</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Amazon</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hql"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql"></a>15. HQL and JPQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Hibernate Query Language (HQL) and Java Persistence Query Language (JPQL) are both object model focused query languages similar in nature to SQL.
JPQL is a heavily-inspired-by subset of HQL.
A JPQL query is always a valid HQL query, the reverse is not true, however.</p>
</div>
<div class="paragraph">
<p>Both HQL and JPQL are non-type-safe ways to perform query operations.
Criteria queries offer a type-safe approach to querying.  See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria">Criteria</a> for more information.</p>
</div>
<div class="sect2">
<h3 id="query-api"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#query-api"></a>15.1. Query API</h3>

</div>
<div class="sect2">
<h3 id="hql-examples-domain-model"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-examples-domain-model"></a>15.2. Example domain model</h3>
<div class="paragraph">
<p>To better understand the further HQL and JPQL examples, itâ€™s time to familiarize the domain model entities that are used in all the examples features in this chapter.</p>
</div>
<div id="hql-examples-domain-model-example" class="exampleblock">
<div class="title">Example 466. Examples domain model</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedQueries</span><span class="pun">({</span><span class="pln">
    </span><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_person_by_name"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select p from Person p where name = :name"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_read_only_person_by_name"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select p from Person p where name = :name"</span><span class="pun">,</span><span class="pln">
        hints </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@QueryHint</span><span class="pun">(</span><span class="pln">
                name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.readOnly"</span><span class="pun">,</span><span class="pln">
                value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"true"</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@NamedStoredProcedureQueries</span><span class="pun">(</span><span class="pln">
    </span><span class="lit">@NamedStoredProcedureQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pun">,</span><span class="pln">
        procedureName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pun">,</span><span class="pln">
        parameters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">
                name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"personId"</span><span class="pun">,</span><span class="pln">
                type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                mode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN
            </span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">
                name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"personPhones"</span><span class="pun">,</span><span class="pln">
                type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                mode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">REF_CURSOR
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> address</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Temporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@OrderColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"order_id"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="lit">@ElementCollection</span><span class="pln">
    </span><span class="lit">@MapKeyEnumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">AddressType</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> addresses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="lit">@Version</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">AddressType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    HOME</span><span class="pun">,</span><span class="pln">
    OFFICE
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Partner</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Version</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> version</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_number"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> number</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Enumerated</span><span class="pun">(</span><span class="typ">EnumType</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_type"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> type</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> cascade </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">,</span><span class="pln"> orphanRemoval </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">

    </span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@MapKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@MapKeyTemporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> callHistory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="lit">@ElementCollection</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">&gt;</span><span class="pln"> repairTimestamps </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    LAND_LINE</span><span class="pun">,</span><span class="pln">
    MOBILE</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone_call"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Call</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Phone</span><span class="pln"> phone</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"call_timestamp"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> timestamp</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> duration</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Inheritance</span><span class="pun">(</span><span class="pln">strategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">InheritanceType</span><span class="pun">.</span><span class="pln">JOINED</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Payment</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> amount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> completed</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> person</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CreditCardPayment</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payment</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WireTransferPayment</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payment</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpql-api"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jpql-api"></a>15.3. JPA Query API</h3>
<div class="paragraph">
<p>In JPA the query is represented by <code>javax.persistence.Query</code> or <code>javax.persistence.TypedQuery</code> as obtained from the <code>EntityManager</code>.
The create an inline <code>Query</code> or <code>TypedQuery</code>, you need to use the <code>EntityManager#createQuery</code> method.
For named queries, the <code>EntityManager#createNamedQuery</code> method is needed.</p>
</div>
<div id="jpql-api-example" class="exampleblock">
<div class="title">Example 467. Obtaining a JPA <code>Query</code> or a <code>TypedQuery</code> reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">TypedQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> typedQuery </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="jpql-api-named-query-example" class="exampleblock">
<div class="title">Example 468. Obtaining a JPA <code>Query</code> or a <code>TypedQuery</code> reference for a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_person_by_name"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select p from Person p where name = :name"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"get_person_by_name"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">TypedQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> typedQuery </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"get_person_by_name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate offers a specific
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedQuery.html"><code>@NamedQuery</code></a> annotation
which provides ways to configure various query features, like flush mode, cacheability, time out interval.</p>
</div>
<div id="jpql-api-hibernate-named-query-example" class="exampleblock">
<div class="title">Example 469. Obtaining a Hibernate <code>Query</code> or a <code>TypedQuery</code> reference for a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedQueries</span><span class="pun">({</span><span class="pln">
    </span><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_phone_by_number"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"where p.number = :number"</span><span class="pun">,</span><span class="pln">
        timeout </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        readOnly </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">

</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> entityManager
	</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"get_phone_by_number"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>Query</code> interface can then be used to control the execution of the query.
For example, we may want to specify an execution timeout or control caching.</p>
</div>
<div id="jpql-api-basic-usage-example" class="exampleblock">
<div class="title">Example 470. Basic JPA <code>Query</code> usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="com">// timeout - in milliseconds</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"javax.persistence.query.timeout"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2000</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="com">// flush only at commit time</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setFlushMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FlushModeType</span><span class="pun">.</span><span class="pln">COMMIT </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For complete details, see the <code>Query</code> <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Query.html">Javadocs</a>.
Many of the settings controlling the execution of the query are defined as hints.
JPA defines some standard hints (like timeout in the example), but most are provider specific.
Relying on provider specific hints limits your applications portability to some degree.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>javax.persistence.query.timeout</code></dt>
<dd>
<p>Defines the query timeout, in milliseconds.</p>
</dd>
<dt class="hdlist1"><code>javax.persistence.fetchgraph</code></dt>
<dd>
<p>Defines a <em>fetchgraph</em> EntityGraph.
Attributes explicitly specified as <code>AttributeNodes</code> are treated as <code>FetchType.EAGER</code> (via join fetch or subsequent select).
For details, see the EntityGraph discussions in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching">Fetching</a>.</p>
</dd>
<dt class="hdlist1"><code>javax.persistence.loadgraph</code></dt>
<dd>
<p>Defines a <em>loadgraph</em> EntityGraph.
Attributes explicitly specified as AttributeNodes are treated as <code>FetchType.EAGER</code> (via join fetch or subsequent select).
Attributes that are not specified are treated as <code>FetchType.LAZY</code> or <code>FetchType.EAGER</code> depending on the attributeâ€™s definition in metadata.
For details, see the EntityGraph discussions in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching">Fetching</a>.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.cacheMode</code></dt>
<dd>
<p>Defines the <code>CacheMode</code> to use. See <code>org.hibernate.query.Query#setCacheMode</code>.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.cacheable</code></dt>
<dd>
<p>Defines whether the query is cacheable. true/false. See <code>org.hibernate.query.Query#setCacheable</code>.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.cacheRegion</code></dt>
<dd>
<p>For queries that are cacheable, defines a specific cache region to use. See <code>org.hibernate.query.Query#setCacheRegion</code>.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.comment</code></dt>
<dd>
<p>Defines the comment to apply to the generated SQL. See <code>org.hibernate.query.Query#setComment</code>.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.fetchSize</code></dt>
<dd>
<p>Defines the JDBC fetch-size to use. See <code>org.hibernate.query.Query#setFetchSize</code></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.flushMode</code></dt>
<dd>
<p>Defines the Hibernate-specific <code>FlushMode</code> to use. See <code>org.hibernate.query.Query#setFlushMode.</code> If possible, prefer using <code>javax.persistence.Query#setFlushMode</code> instead.</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.readOnly</code></dt>
<dd>
<p>Defines that entities and collections loaded by this query should be marked as read-only. See <code>org.hibernate.query.Query#setReadOnly</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The final thing that needs to happen before the query can be executed is to bind the values for any defined parameters.
JPA defines a simplified set of parameter binding methods.
Essentially, it supports setting the parameter value (by name/position) and a specialized form for <code>Calendar</code>/<code>Date</code> types additionally accepting a <code>TemporalType</code>.</p>
</div>
<div id="jpql-api-parameter-example" class="exampleblock">
<div class="title">Example 471. JPA name parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// For generic temporal field types (e.g. `java.util.Date`, `java.util.Calendar`)</span><span class="pln">
</span><span class="com">// we also need to provide the associated `TemporalType`</span><span class="pln">
</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.createdOn &gt; :timestamp"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">DATE </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>JPQL-style positional parameters are declared using a question mark followed by an ordinal - <code>?1</code>, <code>?2</code>.
The ordinals start with 1.
Just like with named parameters, positional parameters can also appear multiple times in a query.</p>
</div>
<div id="jpql-api-positional-parameter-example" class="exampleblock">
<div class="title">Example 472. JPA positional parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like ?1"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Itâ€™s good practice not to mix forms in a given query.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In terms of execution, JPA <code>Query</code> offers 2 different methods for retrieving a result set.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Query#getResultList()</code> - executes the select query and returns back the list of results.</p>
</li>
<li>
<p><code>Query#getSingleResult()</code> - executes the select query and returns a single result. If there were more than one result an exception is thrown.</p>
</li>
</ul>
</div>
<div id="jpql-api-list-example" class="exampleblock">
<div class="title">Example 473. JPA <code>getResultList()</code> result</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="jpql-api-unique-result-example" class="exampleblock">
<div class="title">Example 474. JPA <code>getSingleResult()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-api"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-api"></a>15.4. Hibernate Query API</h3>
<div class="paragraph">
<p>In Hibernate, the HQL query is represented as <code>org.hibernate.query.Query</code> which is obtained from a <code>Session</code>.
If the HQL is a named query, <code>Session#getNamedQuery</code> would be used; otherwise <code>Session#createQuery</code> is needed.</p>
</div>
<div id="hql-api-example" class="exampleblock">
<div class="title">Example 475. Obtaining a Hibernate <code>Query</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-api-named-query-example" class="exampleblock">
<div class="title">Example 476. Obtaining a Hibernate <code>Query</code> reference for a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"get_person_by_name"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not only was the JPQL syntax heavily inspired by HQL, but many of the JPA APIs were heavily inspired by Hibernate too.
The two <code>Query</code> contracts are very similar.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The Query interface can then be used to control the execution of the query.
For example, we may want to specify an execution timeout or control caching.</p>
</div>
<div id="hql-api-basic-usage-example" class="exampleblock">
<div class="title">Example 477. Basic Query usage - Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="com">// timeout - in seconds</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setTimeout</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="com">// write to L2 caches, but do not read from them</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheMode</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CacheMode</span><span class="pun">.</span><span class="pln">REFRESH </span><span class="pun">)</span><span class="pln">
</span><span class="com">// assuming query cache was enabled for the SessionFactory</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="com">// add a comment to the generated SQL if enabled via the hibernate.use_sql_comments configuration property</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setComment</span><span class="pun">(</span><span class="pln"> </span><span class="str">"+ INDEX(p idx_person_name)"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For complete details, see the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Query.html">Query</a> Javadocs.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Query hints here are database query hints.
They are added directly to the generated SQL according to <code>Dialect#getQueryHintString</code>.</p>
</div>
<div class="paragraph">
<p>The JPA notion of query hints, on the other hand, refer to hints that target the provider (Hibernate).
So even though they are called the same, be aware they have a very different purpose.
Also, be aware that Hibernate query hints generally make the application non-portable across databases unless the code adding them first checks the Dialect.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Flushing is covered in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#flushing">Flushing</a>.
Locking is covered in detail in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking">Locking</a>.
The concept of read-only state is covered in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc">Persistence Contexts</a>.</p>
</div>
<div class="paragraph">
<p>Hibernate also allows an application to hook into the process of building the query results via the <code>org.hibernate.transform.ResultTransformer</code> contract.
See its <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/transform/ResultTransformer.html">Javadocs</a> as well as the Hibernate-provided implementations for additional details.</p>
</div>
<div class="paragraph">
<p>The last thing that needs to happen before we can execute the query is to bind the values for any parameters defined in the query.
Query defines many overloaded methods for this purpose.
The most generic form takes the value as well as the Hibernate Type.</p>
</div>
<div id="hql-api-parameter-example" class="exampleblock">
<div class="title">Example 478. Hibernate name parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Hibernate generally understands the expected type of the parameter given its context in the query.
In the previous example since we are using the parameter in a <code>LIKE</code> comparison against a String-typed attribute Hibernate would automatically infer the type; so the above could be simplified.</p>
</div>
<div id="hql-api-parameter-inferred-type-example" class="exampleblock">
<div class="title">Example 479. Hibernate name parameter binding (inferred type)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are also short hand forms for binding common types such as strings, booleans, integers, etc.</p>
</div>
<div id="hql-api-parameter-short-form-example" class="exampleblock">
<div class="title">Example 480. Hibernate name parameter binding (short forms)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and p.createdOn &gt; :timestamp"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>HQL-style positional parameters follow JDBC positional parameter syntax.
They are declared using <code>?</code> without a following ordinal.
There is no way to relate two such positional parameters as being "the same" aside from binding the same value to each.</p>
</div>
<div id="hql-api-positional-parameter-example" class="exampleblock">
<div class="title">Example 481. Hibernate positional parameter binding</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like ?1"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This form should be considered deprecated and may be removed in the near future.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In terms of execution, Hibernate offers 4 different methods. The 2 most commonly used are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Query#list</code> - executes the select query and returns back the list of results.</p>
</li>
<li>
<p><code>Query#uniqueResult</code> - executes the select query and returns the single result. If there were more than one result an exception is thrown.</p>
</li>
</ul>
</div>
<div id="hql-api-list-example" class="exampleblock">
<div class="title">Example 482. Hibernate <code>list()</code> result</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to extract a single result from a <code>Query</code>.</p>
</div>
<div id="hql-api-unique-result-example" class="exampleblock">
<div class="title">Example 483. Hibernate <code>uniqueResult()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the unique result is used often and the attributes upon which it is based are unique, you may want to consider mapping a natural-id and using the natural-id loading API.
See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid">Natural Ids</a> for more information on this topic.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="hql-api-scroll"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-api-scroll"></a>15.4.1. Query scrolling</h4>
<div class="paragraph">
<p>Hibernate offers additional, specialized methods for scrolling the query and handling results using a server-side cursor.</p>
</div>
<div class="paragraph">
<p><code>Query#scroll</code> works in tandem with the JDBC notion of a scrollable <code>ResultSet</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Query#scroll</code> method is overloaded:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The main form accepts a single argument of type <code>org.hibernate.ScrollMode</code> which indicates the type of scrolling to be used.
See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/ScrollMode.html">Javadocs</a> for the details on each.</p>
</li>
<li>
<p>The second form takes no argument and will use the <code>ScrollMode</code> indicated by <code>Dialect#defaultScrollMode</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Query#scroll</code> returns a <code>org.hibernate.ScrollableResults</code> which wraps the underlying JDBC (scrollable) <code>ResultSet</code> and provides access to the results.
Unlike a typical forward-only <code>ResultSet</code>, the <code>ScrollableResults</code> allows you to navigate the <code>ResultSet</code> in any direction.</p>
</div>
<div id="hql-api-scroll-example" class="exampleblock">
<div class="title">Example 484. Scrolling through a <code>ResultSet</code> containing entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">ScrollableResults</span><span class="pln"> scrollableResults </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
		</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
		</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">scroll</span><span class="pun">()</span><span class="pln">
</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">while</span><span class="pun">(</span><span class="pln">scrollableResults</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> scrollableResults</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">()[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
		process</span><span class="pun">(</span><span class="pln">person</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since this form holds the JDBC <code>ResultSet</code> open, the application should indicate when it is done with the <code>ScrollableResults</code> by calling its <code>close()</code> method (as inherited from <code>java.io.Closeable</code>
so that <code>ScrollableResults</code> will work with <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> blocks).</p>
</div>
<div class="paragraph">
<p>If left unclosed by the application, Hibernate will automatically close the underlying resources (e.g. <code>ResultSet</code> and <code>PreparedStatement</code>) used internally by the <code>ScrollableResults</code> when the current transaction is ended (either commit or rollback).</p>
</div>
<div class="paragraph">
<p>However, it is good practice to close the <code>ScrollableResults</code> explicitly.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to use <code>Query#scroll</code> with collection fetches it is important that your query explicitly order the results so that the JDBC results contain the related rows sequentially.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate also supports <code>Query#iterate</code>, which is intended for loading entities when it is known that the loaded entries are already stored in the second-level cache.
The idea behind iterate is that just the matching identifiers will be obtained in the SQL query.
From these the identifiers are resolved by second-level cache lookup.
If these second-level cache lookups fail, additional queries will need to be issued against the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This operation can perform significantly better for loading large numbers of entities that for certain already exist in the second-level cache.
In cases where many of the entities do not exist in the second-level cache, this operation will almost definitely perform worse.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>Iterator</code> returned from <code>Query#iterate</code> is actually a specially typed Iterator: <code>org.hibernate.engine.HibernateIterator</code>.
It is specialized to expose a <code>close()</code> method (again, inherited from <code>java.io.Closeable</code>).
When you are done with this <code>Iterator</code> you should close it, either by casting to <code>HibernateIterator</code> or <code>Closeable</code>, or by calling <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Hibernate.html#close-java.util.Iterator-"><code>Hibernate#close(java.util.Iterator)</code></a>.</p>
</div>
<div class="paragraph">
<p>Since 5.2, Hibernate offers support for returning a <code>Stream</code> which can be later used to transform the underlying <code>ResultSet</code>.</p>
</div>
<div class="paragraph">
<p>Internally, the <code>stream()</code> behaves like a <code>Query#scroll</code> and the underlying result is backed by a <code>ScrollableResults</code>.</p>
</div>
<div class="paragraph">
<p>Fetching a projection using the <code>Query#stream</code> method can be done as follows:</p>
</div>
<div id="hql-api-stream-projection-example" class="exampleblock">
<div class="title">Example 485. Hibernate <code>stream()</code> using a projection result type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.name, p.nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	persons
	</span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> row </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonNames</span><span class="pun">(</span><span class="pln">
			</span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> row</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln">
			</span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> row</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">process </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When fetching a single result, like a <code>Person</code> entity, instead of a <code>Stream&lt;Object[]&gt;</code>, Hibernate is going to figure out the actual type, so the result is a <code>Stream&lt;Person&gt;</code>.</p>
</div>
<div id="hql-api-stream-example" class="exampleblock">
<div class="title">Example 486. Hibernate <code>stream()</code> using an entity result type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;&gt;</span><span class="pln"> callRegistry </span><span class="pun">=</span><span class="pln"> persons
			</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">-&gt;</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">().</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
			</span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln"> phone </span><span class="pun">-&gt;</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getCalls</span><span class="pun">().</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
			</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">groupingBy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">::</span><span class="pln">getPhone </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	process</span><span class="pun">(</span><span class="pln">callRegistry</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just like with <code>ScrollableResults</code>, you should always close a Hibernate <code>Stream</code> either explicitly or using a <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> block.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-case-sensitivity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-case-sensitivity"></a>15.5. Case Sensitivity</h3>
<div class="paragraph">
<p>With the exception of names of Java classes and properties, queries are case-insensitive.
So <code>SeLeCT</code> is the same as <code>sELEct</code> is the same as <code>SELECT</code>, but <code>org.hibernate.eg.FOO</code> and <code>org.hibernate.eg.Foo</code> are different, as are <code>foo.barSet</code> and <code>foo.BARSET</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This documentation uses lowercase keywords as a convention in examples.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-statement-types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-statement-types"></a>15.6. Statement types</h3>
<div class="paragraph">
<p>Both HQL and JPQL allow <code>SELECT</code>, <code>UPDATE</code> and <code>DELETE</code> statements to be performed.
HQL additionally allows <code>INSERT</code> statements, in a form similar to a SQL <code>INSERT FROM SELECT</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Care should be taken as to when an <code>UPDATE</code> or <code>DELETE</code> statement is executed.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Caution should be used when executing bulk update or delete operations because they may result in
inconsistencies between the database and the entities in the active persistence context. In general, bulk
update and delete operations should only be performed within a transaction in a new persistence context
or before fetching or accessing entities whose state might be affected by such operations.</p>
</div>
</blockquote>
<div class="attribution">
â€” Section 4.10 of the JPA 2.0 Specification
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-select"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-select"></a>15.7. Select statements</h3>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">BNF</a> for <code>SELECT</code> statements in HQL is:</p>
</div>
<div id="hql-select-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">select_statement </span><span class="pun">::</span><span class="pln"> </span><span class="pun">=</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">select_clause</span><span class="pun">]</span><span class="pln">
    from_clause
    </span><span class="pun">[</span><span class="pln">where_clause</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">groupby_clause</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">having_clause</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">orderby_clause</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The simplest possible HQL <code>SELECT</code> statement is of the form:</p>
</div>
<div id="hql-select-simplest-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"from Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The select statement in JPQL is exactly the same as for HQL except that JPQL requires a <code>select_clause</code>, whereas HQL does not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though HQL does not require the presence of a <code>select_clause</code>, it is generally good practice to include one.
For simple queries the intent is clear and so the intended result of the <code>select_clause</code> is easy to infer.
But on more complex queries that is not always the case.</p>
</div>
<div class="paragraph">
<p>It is usually better to explicitly specify intent.
Hibernate does not actually enforce that a <code>select_clause</code> be present even when parsing JPQL queries, however, applications interested in JPA portability should take heed of this.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-update"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-update"></a>15.8. Update statements</h3>
<div class="paragraph">
<p>The BNF for <code>UPDATE</code> statements is the same in HQL and JPQL:</p>
</div>
<div id="hql-update-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">update_statement </span><span class="pun">::=</span><span class="pln">
    update_clause </span><span class="pun">[</span><span class="pln">where_clause</span><span class="pun">]</span><span class="pln">

update_clause </span><span class="pun">::=</span><span class="pln">
    UPDATE entity_name </span><span class="pun">[[</span><span class="pln">AS</span><span class="pun">]</span><span class="pln"> identification_variable</span><span class="pun">]</span><span class="pln">
    SET update_item </span><span class="pun">{,</span><span class="pln"> update_item</span><span class="pun">}*</span><span class="pln">

update_item </span><span class="pun">::=</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">identification_variable</span><span class="pun">.]{</span><span class="pln">state_field </span><span class="pun">|</span><span class="pln"> single_valued_object_field</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> new_value

new_value </span><span class="pun">::=</span><span class="pln">
    scalar_expression </span><span class="pun">|</span><span class="pln"> simple_entity_expression </span><span class="pun">|</span><span class="pln"> NULL</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>UPDATE</code> statements, by default, do not affect the <code>version</code> or the <code>timestamp</code> attribute values for the affected entities.</p>
</div>
<div class="paragraph">
<p>However, you can force Hibernate to set the <code>version</code> or <code>timestamp</code> attribute values through the use of a <code>versioned update</code>.
This is achieved by adding the <code>VERSIONED</code> keyword after the <code>UPDATE</code> keyword.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a Hibernate specific feature and will not work in a portable manner.</p>
</div>
<div class="paragraph">
<p>Custom version types, <code>org.hibernate.usertype.UserVersionType</code>, are not allowed in conjunction with an <code>update versioned</code> statement.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>An <code>UPDATE</code> statement is executed using the <code>executeUpdate()</code> of either <code>org.hibernate.query.Query</code> or <code>javax.persistence.Query</code>.
The method is named for those familiar with the JDBC <code>executeUpdate()</code> on <code>java.sql.PreparedStatement</code>.</p>
</div>
<div class="paragraph">
<p>The <code>int</code> value returned by the <code>executeUpdate()</code> method indicates the number of entities affected by the operation.
This may or may not correlate to the number of rows affected in the database.
An HQL bulk operation might result in multiple actual SQL statements being executed (for joined-subclass, for example).
The returned number indicates the number of actual entities affected by the statement.
Using a JOINED inheritance hierarchy, a delete against one of the subclasses may actually result in deletes against not just the table to which that subclass is mapped, but also the "root" table and tables "in between".</p>
</div>
<div id="hql-update-example" class="exampleblock">
<div class="title">Example 487. UPDATE query statements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set p.name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> updatedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"update versioned Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"set name = :newName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where name = :oldName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"oldName"</span><span class="pun">,</span><span class="pln"> oldName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"newName"</span><span class="pun">,</span><span class="pln"> newName </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Neither <code>UPDATE</code> nor <code>DELETE</code> statements allow implicit joins. Their form already disallows explicit joins too.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-delete"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-delete"></a>15.9. Delete statements</h3>
<div class="paragraph">
<p>The BNF for <code>DELETE</code> statements is the same in HQL and JPQL:</p>
</div>
<div id="hql-delete-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">delete_statement </span><span class="pun">::=</span><span class="pln">
    delete_clause </span><span class="pun">[</span><span class="pln">where_clause</span><span class="pun">]</span><span class="pln">

delete_clause </span><span class="pun">::=</span><span class="pln">
    DELETE FROM entity_name </span><span class="pun">[[</span><span class="pln">AS</span><span class="pun">]</span><span class="pln"> identification_variable</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A <code>DELETE</code> statement is also executed using the <code>executeUpdate()</code> method of either <code>org.hibernate.query.Query</code> or <code>javax.persistence.Query</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-insert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-insert"></a>15.10. Insert statements</h3>
<div class="paragraph">
<p>HQL adds the ability to define <code>INSERT</code> statements as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is no JPQL equivalent to this.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The BNF for an HQL <code>INSERT</code> statement is:</p>
</div>
<div id="hql-insert-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert_statement </span><span class="pun">::=</span><span class="pln">
    insert_clause select_statement

insert_clause </span><span class="pun">::=</span><span class="pln">
    INSERT INTO entity_name </span><span class="pun">(</span><span class="pln">attribute_list</span><span class="pun">)</span><span class="pln">

attribute_list </span><span class="pun">::=</span><span class="pln">
    state_field</span><span class="pun">[,</span><span class="pln"> state_field </span><span class="pun">]*</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>attribute_list</code> is analogous to the <code>column specification</code> in the SQL <code>INSERT</code> statement.
For entities involved in mapped inheritance, only attributes directly defined on the named entity can be used in the <code>attribute_list</code>.
Superclass properties are not allowed and subclass properties do not make sense.
In other words, <code>INSERT</code> statements are inherently non-polymorphic.</p>
</div>
<div class="paragraph">
<p><code>select_statement</code> can be any valid HQL select query, with the caveat that the return types must match the types expected by the insert.
Currently, this is checked during query compilation rather than allowing the check to relegate to the database.
This may cause problems between Hibernate Types which are <em>equivalent</em> as opposed to <em>equal</em>.
For example, this might cause lead to issues with mismatches between an attribute mapped as a <code>org.hibernate.type.DateType</code> and an attribute defined as a <code>org.hibernate.type.TimestampType</code>,
even though the database might not make a distinction or might be able to handle the conversion.</p>
</div>
<div class="paragraph">
<p>For the id attribute, the insert statement gives you two options.
You can either explicitly specify the id property in the <code>attribute_list</code>, in which case its value is taken from the corresponding select expression, or omit it from the <code>attribute_list</code> in which case a generated value is used.
This latter option is only available when using id generators that operate "in the database"; attempting to use this option with any "in memory" type generators will cause an exception during parsing.</p>
</div>
<div class="paragraph">
<p>For optimistic locking attributes, the insert statement again gives you two options.
You can either specify the attribute in the <code>attribute_list</code> in which case its value is taken from the corresponding select expressions or omit it from the <code>attribute_list</code> in which case the <code>seed value</code> defined by the corresponding <code>org.hibernate.type.VersionType</code> is used.</p>
</div>
<div id="hql-insert-example" class="exampleblock">
<div class="title">Example 488. INSERT query statements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">int</span><span class="pln"> insertedEntities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"insert into Partner (id, name) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"select p.id, p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-from-clause"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-from-clause"></a>15.11. The <code>FROM</code> clause</h3>
<div class="paragraph">
<p>The <code>FROM</code> clause is responsible for defining the scope of object model types available to the rest of the query.
It is also responsible for defining all the "identification variables" available to the rest of the query.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-identification-variables"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-identification-variables"></a>15.12. Identification variables</h3>
<div class="paragraph">
<p>Identification variables are often referred to as aliases.
References to object model classes in the <code>FROM</code> clause can be associated with an identification variable that can then be used to refer to that type throughout the rest of the query.</p>
</div>
<div class="paragraph">
<p>In most cases declaring an identification variable is optional, though it is usually good practice to declare them.</p>
</div>
<div class="paragraph">
<p>An identification variable must follow the rules for Java identifier validity.</p>
</div>
<div class="paragraph">
<p>According to JPQL, identification variables must be treated as case-insensitive.
Good practice says you should use the same case throughout a query to refer to a given identification variable.
In other words, JPQL says they <em>can be</em> case-insensitive and so Hibernate must be able to treat them as such, but this does not make it good practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-root-reference"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-root-reference"></a>15.13. Root entity references</h3>
<div class="paragraph">
<p>A root entity reference, or what JPA calls a <code>range variable declaration</code>, is specifically a reference to a mapped entity type from the application.
It cannot name component/ embeddable types.
And associations, including collections, are handled in a different manner, as later discussed.</p>
</div>
<div class="paragraph">
<p>The BNF for a root entity reference is:</p>
</div>
<div id="hql-root-reference-bnf-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">root_entity_reference </span><span class="pun">::=</span><span class="pln">
    entity_name </span><span class="pun">[</span><span class="pln">AS</span><span class="pun">]</span><span class="pln"> identification_variable</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-root-reference-jpql-fqn-example" class="exampleblock">
<div class="title">Example 489. Simple query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from org.hibernate.userguide.model.Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We see that the query is defining a root entity reference to the <code>org.hibernate.userguide.model.Person</code> object model type.
Additionally, it declares an alias of <code>p</code> to that <code>org.hibernate.userguide.model.Person</code> reference, which is the identification variable.</p>
</div>
<div class="paragraph">
<p>Usually, the root entity reference represents just the <code>entity name</code> rather than the entity class FQN (fully-qualified name).
By default, the entity name is the unqualified entity class name, here <code>Person</code></p>
</div>
<div id="hql-root-reference-jpql-example" class="exampleblock">
<div class="title">Example 490. Simple query using entity name for root entity reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Multiple root entity references can also be specified, even when naming the same entity.</p>
</div>
<div id="hql-multiple-root-reference-jpql-example" class="exampleblock">
<div class="title">Example 491. Simple query using multiple root entity references</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr, ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr, Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.person = pr and ph is not null"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr1 "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr1, Person pr2 "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr1.id &lt;&gt; pr2.id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and pr1.address = pr2.address "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and pr1.createdOn &lt; pr2.createdOn"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-explicit-join"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-explicit-join"></a>15.14. Explicit joins</h3>
<div class="paragraph">
<p>The <code>FROM</code> clause can also contain explicit relationship joins using the <code>join</code> keyword.
These joins can be either <code>inner</code> or <code>left outer</code> style joins.</p>
</div>
<div id="hql-explicit-inner-join-example" class="exampleblock">
<div class="title">Example 492. Explicit inner join examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.type = :phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">MOBILE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// same query but specifying join type as 'inner' explicitly</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"inner join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.type = :phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">MOBILE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-explicit-outer-join-example" class="exampleblock">
<div class="title">Example 493. Explicit left (outer) join examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph is null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   or ph.type = :phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// functionally the same query but using the 'left outer' phrase</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left outer join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph is null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   or ph.type = :phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>HQL also defines a <code>WITH</code> clause to qualify the join conditions.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is specific to HQL. JPQL defines the <code>ON</code> clause for this feature.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="hql-explicit-join-with-example" class="exampleblock">
<div class="title">Example 494. HQL <code>WITH</code> clause join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personsAndPhones </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select pr.name, ph.number "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join pr.phones ph with ph.type = :phoneType "</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="hql-explicit-join-jpql-on-example" class="exampleblock">
<div class="title">Example 495. JPQL <code>ON</code> clause join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personsAndPhones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select pr.name, ph.number "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join pr.phones ph on ph.type = :phoneType "</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneType"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The important distinction is that in the generated SQL the conditions of the <code>WITH/ON</code> clause are made part of the <code>ON</code> clause in the generated SQL,
as opposed to the other queries in this section where the HQL/JPQL conditions are made part of the <code>WHERE</code> clause in the generated SQL.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The distinction in this specific example is probably not that significant.
The <code>with clause</code> is sometimes necessary for more complicated queries.</p>
</div>
<div class="paragraph">
<p>Explicit joins may reference association or component/embedded attributes.
In the case of component/embedded attributes, the join is simply logical and does not correlate to a physical (SQL) join.
For further information about collection-valued association references, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-valued-associations">Collection member references</a>.</p>
</div>
<div class="paragraph">
<p>An important use case for explicit joins is to define <code>FETCH JOINS</code> which override the laziness of the joined association.
As an example, given an entity named <code>Person</code> with a collection-valued association named <code>phones</code>, the <code>JOIN FETCH</code> will also load the child collection in the same SQL query:</p>
</div>
<div id="hql-explicit-fetch-join-example" class="exampleblock">
<div class="title">Example 496. Fetch join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// functionally the same query but using the 'left outer' phrase</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join fetch pr.phones "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example, a fetch join is specified by injecting the keyword <code>fetch</code> after the keyword <code>join</code>.
In the example, we used a left outer join because we also wanted to return customers who have no orders.</p>
</div>
<div class="paragraph">
<p>Inner joins can also be fetched, but inner joins filter out the root entity.
In the example, using an inner join instead would have resulted in customers without any orders being filtered out of the result.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Fetch joins are not valid in sub-queries.</p>
</div>
<div class="paragraph">
<p>Care should be taken when fetch joining a collection-valued association which is in any way further restricted (the fetched collection will be restricted too).
For this reason, it is usually considered best practice not to assign an identification variable to fetched joins except for the purpose of specifying nested fetch joins.</p>
</div>
<div class="paragraph">
<p>Fetch joins should not be used in paged queries (e.g. <code>setFirstResult()</code> or <code>setMaxResults()</code>), nor should they be used with the <code>scroll()</code> or <code>iterate()</code> features.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-implicit-join"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-implicit-join"></a>15.15. Implicit joins (path expressions)</h3>
<div class="paragraph">
<p>Another means of adding to the scope of object model types available to the query is through the use of implicit joins or path expressions.</p>
</div>
<div id="hql-implicit-join-example" class="exampleblock">
<div class="title">Example 497. Simple implicit join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.person.address = :address "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// same as</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr.address = :address "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An implicit join always starts from an <code>identification variable</code>, followed by the navigation operator ( <code>.</code> ),
followed by an attribute for the object model type referenced by the initial <code>identification variable</code>.
In the example, the initial <code>identification variable</code> is <code>ph</code> which refers to the <code>Phone</code> entity.
The <code>ph.person</code> reference then refers to the <code>person</code> attribute of the <code>Phone</code> entity.
<code>person</code> is an association type so we further navigate to its age attribute.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the attribute represents an entity association (non-collection) or a component/embedded, that reference can be further navigated.
Basic values and collection-valued associations cannot be further navigated.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As shown in the example, implicit joins can appear outside the <code>FROM clause</code>.
However, they affect the <code>FROM clause</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Implicit joins are always treated as inner joins.</p>
</div>
<div class="paragraph">
<p>Multiple references to the same implicit join always refer to the same logical and physical (SQL) join.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="hql-implicit-join-alias-example" class="exampleblock">
<div class="title">Example 498. Reused implicit join</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.person.address = :address "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and ph.person.createdOn &gt; :timestamp"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">//same as</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"inner join ph.person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr.address = :address "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and pr.createdOn &gt; :timestamp"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">,</span><span class="pln"> timestamp </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just as with explicit joins, implicit joins may reference association or component/embedded attributes.
For further information about collection-valued association references, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-valued-associations">Collection member references</a>.</p>
</div>
<div class="paragraph">
<p>In the case of component/embedded attributes, the join is simply logical and does not correlate to a physical (SQL) join.
Unlike explicit joins, however, implicit joins may also reference basic state fields as long as the path expression ends there.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-distinct"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-distinct"></a>15.16. Distinct</h3>
<div class="paragraph">
<p>For JPQL and HQL, <code>DISTINCT</code> has two meanings:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It can be passed to the database so that duplicates are removed from a result set</p>
</li>
<li>
<p>It can be used to filter out the same parent entity references when join fetching a child collection</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="hql-distinct-projection-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-distinct-projection-query"></a>15.16.1. Using DISTINCT with SQL projections</h4>
<div class="paragraph">
<p>For SQL projections, <code>DISTINCT</code> needs to be passed to the database because the duplicated entries need to be filtered out before being returned to the database client.</p>
</div>
<div id="hql-distinct-projection-query-example" class="exampleblock">
<div class="title">Example 499. Using DISTINCT with projection queries example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">         </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> lastNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p.lastName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When running the query above, Hibernate generates the following SQL query:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT DISTINCT
    p</span><span class="pun">.</span><span class="pln">last_name </span><span class="kwd">as</span><span class="pln"> col_0_0_
FROM person p</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For this particular use case, passing the <code>DISTINCT</code> keyword from JPQL/HQL to the database is the right thing to do.</p>
</div>
</div>
<div class="sect3">
<h4 id="hql-distinct-entity-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-distinct-entity-query"></a>15.16.2. Using DISTINCT with entity queries</h4>
<div class="paragraph">
<p><code>DISTINCT</code> can also be used to filter out entity object references when fetching a child association along with the parent entities.</p>
</div>
<div id="hql-distinct-entity-query-example" class="exampleblock">
<div class="title">Example 500. Using DISTINCT with entity queries example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> authors </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join fetch p.books"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>DISTINCT</code> is used because there can be multiple <code>Books</code> entities associated with a given <code>Person</code>.
If in the database there are 3 <code>Persons</code> in the database and each person has 2 <code>Books</code>, without <code>DISTINCT</code> this query will return 6 <code>Persons</code> since
the SQL-level result-set size is given by the number of joined <code>Book</code> records.</p>
</div>
<div class="paragraph">
<p>However, the <code>DISTINCT</code> keyword is passed to the database as well:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT DISTINCT
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">first_name </span><span class="kwd">as</span><span class="pln"> first_na2_1_0_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">last_name </span><span class="kwd">as</span><span class="pln"> last_nam3_1_0_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">author_id </span><span class="kwd">as</span><span class="pln"> author_i3_0_1_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">title </span><span class="kwd">as</span><span class="pln"> title2_0_1_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">author_id </span><span class="kwd">as</span><span class="pln"> author_i3_0_0__</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0__
FROM person p
LEFT OUTER JOIN book b ON p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">b</span><span class="pun">.</span><span class="pln">author_id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>DISTINCT</code> SQL keyword is undesirable since it does a redundant result set sorting, as explained <a href="http://in.relation.to/2016/08/04/introducing-distinct-pass-through-query-hint/">in this blog post</a>.
To fix this issue, Hibernate 5.2.2 added support for the <code>HINT_PASS_DISTINCT_THROUGH</code> entity query hint:</p>
</div>
<div id="hql-distinct-entity-query-hint-example" class="exampleblock">
<div class="title">Example 501. Using DISTINCT with entity queries example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> authors </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"left join fetch p.books"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="typ">QueryHints</span><span class="pun">.</span><span class="pln">HINT_PASS_DISTINCT_THROUGH</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this entity query hint, Hibernate will not pass the <code>DISTINCT</code> keyword to the SQL query:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    p</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_0_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_1_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">first_name </span><span class="kwd">as</span><span class="pln"> first_na2_1_0_</span><span class="pun">,</span><span class="pln">
    p</span><span class="pun">.</span><span class="pln">last_name </span><span class="kwd">as</span><span class="pln"> last_nam3_1_0_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">author_id </span><span class="kwd">as</span><span class="pln"> author_i3_0_1_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">title </span><span class="kwd">as</span><span class="pln"> title2_0_1_</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">author_id </span><span class="kwd">as</span><span class="pln"> author_i3_0_0__</span><span class="pun">,</span><span class="pln">
    b</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_0_0__
FROM person p
LEFT OUTER JOIN book b ON p</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=</span><span class="pln">b</span><span class="pun">.</span><span class="pln">author_id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using the <code>HINT_PASS_DISTINCT_THROUGH</code> entity query hint, Hibernate can still remove the duplicated parent-side entities from the query result.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-collection-valued-associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-valued-associations"></a>15.17. Collection member references</h3>
<div class="paragraph">
<p>References to collection-valued associations actually refer to the <em>values</em> of that collection.</p>
</div>
<div id="hql-collection-valued-associations-example" class="exampleblock">
<div class="title">Example 502. Collection references example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.calls c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr.address = :address "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and c.duration &gt; :duration"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"duration"</span><span class="pun">,</span><span class="pln"> duration </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// alternate syntax</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"in (pr.phones) ph, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"in (ph.calls) c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr.address = :address "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and c.duration &gt; :duration"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"duration"</span><span class="pun">,</span><span class="pln"> duration </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, the identification variable <code>ph</code> actually refers to the object model type <code>Phone</code>, which is the type of the elements of the <code>Person#phones</code> association.</p>
</div>
<div class="paragraph">
<p>The example also shows the alternate syntax for specifying collection association joins using the <code>IN</code> syntax.
Both forms are equivalent.
Which form an application chooses to use is simply a matter of taste.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-collection-qualification"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-qualification"></a>15.18. Special case - qualified path expressions</h3>
<div class="paragraph">
<p>We said earlier that collection-valued associations actually refer to the <em>values</em> of that collection.
Based on the type of collection, there are also available a set of explicit qualification expressions.</p>
</div>
<div id="hql-collection-qualification-example" class="exampleblock">
<div class="title">Example 503. Qualified collection references example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">mappedBy </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@MapKey</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"timestamp"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@MapKeyTemporal</span><span class="pun">(</span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> callHistory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">


</span><span class="com">// select all the calls (the map value) for a given Phone</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = :id "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// same as above</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select value(ch) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = :id "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// select all the Call timestamps (the map key) for a given Phone</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">&gt;</span><span class="pln"> timestamps </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select key(ch) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = :id "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// select all the Call and their timestamps (the 'Map.Entry') for a given Phone</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Map</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="typ">Date</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">&gt;&gt;</span><span class="pln"> callHistory </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select entry(ch) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = :id "</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Sum all call durations for a given Phone of a specific Person</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> duration </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select sum(ch.duration) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = :id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"  and index(ph) = :phoneIndex"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> id </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneIndex"</span><span class="pun">,</span><span class="pln"> phoneIndex </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">VALUE</dt>
<dd>
<p>Refers to the collection value.
Same as not specifying a qualifier.
Useful to explicitly show intent.
Valid for any type of collection-valued reference.</p>
</dd>
<dt class="hdlist1">INDEX</dt>
<dd>
<p>According to HQL rules, this is valid for both <code>Maps</code> and <code>Lists</code> which specify a <code>javax.persistence.OrderColumn</code> annotation to refer to the <code>Map</code> key or the <code>List</code> position (aka the <code>OrderColumn</code> value).
JPQL however, reserves this for use in the <code>List</code> case and adds <code>KEY</code> for the <code>Map</code> case.
Applications interested in JPA provider portability should be aware of this distinction.</p>
</dd>
<dt class="hdlist1">KEY</dt>
<dd>
<p>Valid only for <code>Maps</code>. Refers to the mapâ€™s key. If the key is itself an entity, it can be further navigated.</p>
</dd>
<dt class="hdlist1">ENTRY</dt>
<dd>
<p>Only valid for <code>Maps</code>. Refers to the mapâ€™s logical <code>java.util.Map.Entry</code> tuple (the combination of its key and value).
<code>ENTRY</code> is only valid as a terminal path and itâ€™s applicable to the <code>SELECT</code> clause only.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-expressions">Collection-related expressions</a> for additional details on collection-related expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-polymorphism"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-polymorphism"></a>15.19. Polymorphism</h3>
<div class="paragraph">
<p>HQL and JPQL queries are inherently polymorphic.</p>
</div>
<div id="hql-polymorphism-example" class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This query names the <code>Payment</code> entity explicitly.
However, all subclasses of <code>Payment</code> are also available to the query.
So, if the <code>CreditCardPayment</code> and <code>WireTransferPayment</code> entities extend the <code>Payment</code> class, all three types would be available to the entity query,
and the query would return instances of all three.</p>
</div>
<div class="paragraph">
<p>This behavior can be altered in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by limiting the query to select only from the subclass entity</p>
</li>
<li>
<p>by using either the <code>org.hibernate.annotations.Polymorphism</code> annotation (global, and Hibernate-specific). See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-polymorphism"><code>@Polymorphism</code> section for more info about this use case</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The HQL query <code>from java.lang.Object</code> is totally valid (although not very practical from a performance perspective)!</p>
</div>
<div class="paragraph">
<p>It returns every object of every entity type defined by your application mappings.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-expressions"></a>15.20. Expressions</h3>
<div class="paragraph">
<p>Essentially, expressions are references that resolve to basic or tuple values.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-identification-variable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-identification-variable"></a>15.21. Identification variable</h3>
<div class="paragraph">
<p>See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-from-clause">The <code>FROM</code> clause</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-path-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-path-expressions"></a>15.22. Path expressions</h3>
<div class="paragraph">
<p>Again, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-from-clause">The <code>FROM</code> clause</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-literals"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-literals"></a>15.23. Literals</h3>
<div class="paragraph">
<p>String literals are enclosed in single quotes.
To escape a single quote within a string literal, use double single quotes.</p>
</div>
<div id="hql-string-literals-example" class="exampleblock">
<div class="title">Example 504. String literals examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like 'Joe'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Escaping quotes</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like 'Joe''s'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Numeric literals are allowed in a few different forms.</p>
</div>
<div id="hql-numeric-literals-example" class="exampleblock">
<div class="title">Example 505. Numeric literal examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// simple integer literal</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id = 1"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="com">// simple integer literal, typed as a long</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id = 1L"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="com">// decimal notation</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration &gt; 100.5"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// decimal notation, typed as a float</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration &gt; 100.5F"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// scientific notation</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration &gt; 1e+2"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// scientific notation, typed as a float</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration &gt; 1e+2F"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the scientific notation form, the <code>E</code> is case-insensitive.</p>
</div>
<div class="paragraph">
<p>Specific typing can be achieved through the use of the same suffix approach specified by Java.
So, <code>L</code> denotes a long, <code>D</code> denotes a double, <code>F</code> denotes a float.
The actual suffix is case-insensitive.</p>
</div>
<div class="paragraph">
<p>The boolean literals are <code>TRUE</code> and <code>FALSE</code>, again case-insensitive.</p>
</div>
<div class="paragraph">
<p>Enums can even be referenced as literals. The fully-qualified enum class name must be used.
HQL can also handle constants in the same manner, though JPQL does not define that as being supported.</p>
</div>
<div class="paragraph">
<p>Entity names can also be used as literal. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-entity-type-exp">Entity type</a>.</p>
</div>
<div class="paragraph">
<p>Date/time literals can be specified using the JDBC escape syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{d 'yyyy-mm-dd'}</code> for dates</p>
</li>
<li>
<p><code>{t 'hh:mm:ss'}</code> for times</p>
</li>
<li>
<p><code>{ts 'yyyy-mm-dd hh:mm:ss[.millis]'}</code> (millis optional) for timestamps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These Date/time literals only work if the underlying JDBC driver supports them.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-numeric-arithmetic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-numeric-arithmetic"></a>15.24. Arithmetic</h3>
<div class="paragraph">
<p>Arithmetic operations also represent valid expressions.</p>
</div>
<div id="hql-numeric-arithmetic-example" class="exampleblock">
<div class="title">Example 506. Numeric arithmetic examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// select clause date/time arithmetic operations</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> duration </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select sum(ch.duration) * :multiplier "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join pr.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.callHistory ch "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ph.id = 1L "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"multiplier"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="com">// select clause date/time arithmetic operations</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> years </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select year( current_date() ) - year( p.createdOn ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id = 1L"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="com">// where clause arithmetic operations</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where year( current_date() ) - year( p.createdOn ) &gt; 1"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following rules apply to the result of arithmetic operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If either of the operands is <code>Double</code>/<code>double</code>, the result is a <code>Double</code></p>
</li>
<li>
<p>else, if either of the operands is <code>Float</code>/<code>float</code>, the result is a <code>Float</code></p>
</li>
<li>
<p>else, if either operand is <code>BigDecimal</code>, the result is <code>BigDecimal</code></p>
</li>
<li>
<p>else, if either operand is <code>BigInteger</code>, the result is <code>BigInteger</code> (except for division, in which case the result type is not further defined)</p>
</li>
<li>
<p>else, if either operand is <code>Long</code>/<code>long</code>, the result is <code>Long</code> (except for division, in which case the result type is not further defined)</p>
</li>
<li>
<p>else, (the assumption being that both operands are of integral type) the result is <code>Integer</code> (except for division, in which case the result type is not further defined)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Date arithmetic is also supported, albeit in a more limited fashion.
This is due  to differences in database support and partly to the lack of support for <code>INTERVAL</code> definition in the query language itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-concatenation"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-concatenation"></a>15.25. Concatenation (operation)</h3>
<div class="paragraph">
<p>HQL defines a concatenation operator in addition to supporting the concatenation (<code>CONCAT</code>) function.
This is not defined by JPQL, so portable applications should avoid its use.
The concatenation operator is taken from the SQL concatenation operator (e.g <code>||</code>).</p>
</div>
<div id="hql-concatenation-example" class="exampleblock">
<div class="title">Example 507. Concatenation operation example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select 'Customer ' || p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id = 1"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-exp-functions">Scalar functions</a> for details on the <code>concat()</code> function</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-aggregate-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-aggregate-functions"></a>15.26. Aggregate functions</h3>
<div class="paragraph">
<p>Aggregate functions are also valid expressions in HQL and JPQL.
The semantic is the same as their SQL counterpart.
The supported aggregate functions are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>COUNT</code> (including distinct/all qualifiers)</dt>
<dd>
<p>The result type is always <code>Long</code>.</p>
</dd>
<dt class="hdlist1"><code>AVG</code></dt>
<dd>
<p>The result type is always <code>Double</code>.</p>
</dd>
<dt class="hdlist1"><code>MIN</code></dt>
<dd>
<p>The result type is the same as the argument type.</p>
</dd>
<dt class="hdlist1"><code>MAX</code></dt>
<dd>
<p>The result type is the same as the argument type.</p>
</dd>
<dt class="hdlist1"><code>SUM</code></dt>
<dd>
<p>The result type of the <code>SUM()</code> function depends on the type of the values being summed.
For integral values (other than <code>BigInteger</code>), the result type is <code>Long</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For floating point values (other than <code>BigDecimal</code>) the result type is <code>Double</code>.
For <code>BigInteger</code> values, the result type is <code>BigInteger</code>. For <code>BigDecimal</code> values, the result type is <code>BigDecimal</code>.</p>
</div>
<div id="hql-aggregate-functions-example" class="exampleblock">
<div class="title">Example 508. Aggregate function examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> callStatistics </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	count(c), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	sum(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	min(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	max(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	avg(c.duration)  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Long</span><span class="pln"> phoneCount </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select count( distinct c.phone ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> callCount </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.number, count(c) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p.number"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Aggregations often appear with grouping. For information on grouping see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-group-by">Group by</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-exp-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-exp-functions"></a>15.27. Scalar functions</h3>
<div class="paragraph">
<p>Both HQL and JPQL define some standard functions that are available regardless of the underlying database in use.
HQL can also understand additional functions defined by the Dialect as well as the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="jpql-standardized-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jpql-standardized-functions"></a>15.28. JPQL standardized functions</h3>
<div class="paragraph">
<p>Here is the list of functions defined as supported by JPQL.
Applications interested in remaining portable between JPA providers should stick to these functions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CONCAT</dt>
<dd>
<p>String concatenation function. Variable argument length of 2 or more string values to be concatenated together.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> callHistory </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select concat( p.number, ' : ' , cast(c.duration as string) ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SUBSTRING</dt>
<dd>
<p>Extracts a portion of a string value.
The second argument denotes the starting position, where 1 is the first character of the string.
The third (optional) argument denotes the length.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> prefixes </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select substring( p.number, 1, 2 ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">UPPER</dt>
<dd>
<p>Upper cases the specified string</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select upper( p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LOWER</dt>
<dd>
<p>Lower cases the specified string</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select lower( p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TRIM</dt>
<dd>
<p>Follows the semantics of the SQL trim function.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select trim( p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LENGTH</dt>
<dd>
<p>Returns the length of a string.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> lengths </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select length( p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LOCATE</dt>
<dd>
<p>Locates a string within another string.
The third argument (optional) is used to denote a position from which to start looking.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> sizes </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select locate( 'John', p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ABS</dt>
<dd>
<p>Calculates the mathematical absolute value of a numeric value.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> abs </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select abs( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MOD</dt>
<dd>
<p>Calculates the remainder of dividing the first argument by the second.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> mods </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select mod( c.duration, 10 ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SQRT</dt>
<dd>
<p>Calculates the mathematical square root of a numeric value.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Double</span><span class="pun">&gt;</span><span class="pln"> sqrts </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select sqrt( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CURRENT_DATE</dt>
<dd>
<p>Returns the database current date.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.timestamp = current_date"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CURRENT_TIME</dt>
<dd>
<p>Returns the database current time.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.timestamp = current_time"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CURRENT_TIMESTAMP</dt>
<dd>
<p>Returns the database current timestamp.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.timestamp = current_timestamp"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-functions"></a>15.29. HQL functions</h3>
<div class="paragraph">
<p>Beyond the JPQL standardized functions, HQL makes some additional functions available regardless of the underlying database in use.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BIT_LENGTH</dt>
<dd>
<p>Returns the length of binary data.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Number</span><span class="pun">&gt;</span><span class="pln"> bits </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select bit_length( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Number</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CAST</dt>
<dd>
<p>Performs a SQL cast.
The cast target should name the Hibernate mapping type to use.
See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-provided">data types</a> chapter on for more information.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> durations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select cast( c.duration as string ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">EXTRACT</dt>
<dd>
<p>Performs a SQL extraction on datetime values.
An extraction extracts parts of the datetime (the year, for example).</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> years </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select extract( YEAR from c.timestamp ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the abbreviated forms below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">YEAR</dt>
<dd>
<p>Abbreviated extract form for extracting the year.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> years </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select year( c.timestamp ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MONTH</dt>
<dd>
<p>Abbreviated extract form for extracting the month.</p>
</dd>
<dt class="hdlist1">DAY</dt>
<dd>
<p>Abbreviated extract form for extracting the day.</p>
</dd>
<dt class="hdlist1">HOUR</dt>
<dd>
<p>Abbreviated extract form for extracting the hour.</p>
</dd>
<dt class="hdlist1">MINUTE</dt>
<dd>
<p>Abbreviated extract form for extracting the minute.</p>
</dd>
<dt class="hdlist1">SECOND</dt>
<dd>
<p>Abbreviated extract form for extracting the second.</p>
</dd>
<dt class="hdlist1">STR</dt>
<dd>
<p>Abbreviated form for casting a value as character data.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> timestamps </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select str( c.timestamp ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> timestamps </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select str( cast(duration as float) / 60, 4, 2 ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-non-standard-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-non-standard-functions"></a>15.30. Non-standardized functions</h3>
<div class="paragraph">
<p>Hibernate Dialects can register additional functions known to be available for that particular database product.
These functions are also available in HQL (and JPQL, though only when using Hibernate as the JPA provider obviously).
However, they would only be available when using that database Dialect.
Applications that aim for database portability should avoid using functions in this category.</p>
</div>
<div class="paragraph">
<p>Application developers can also supply their own set of functions.
This would usually represent either custom SQL functions or aliases for snippets of SQL.
Such function declarations are made by using the <code>addSqlFunction()</code> method of <code>org.hibernate.cfg.Configuration</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-collection-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-expressions"></a>15.31. Collection-related expressions</h3>
<div class="paragraph">
<p>There are a few specialized expressions for working with collection-valued associations.
Generally, these are just abbreviated forms or other expressions for the sake of conciseness.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SIZE</dt>
<dd>
<p>Calculate the size of a collection. Equates to a subquery!</p>
</dd>
<dt class="hdlist1">MAXELEMENT</dt>
<dd>
<p>Available for use on collections of basic type.
Refers to the maximum value as determined by applying the <code>max</code> SQL aggregation.</p>
</dd>
<dt class="hdlist1">MAXINDEX</dt>
<dd>
<p>Available for use on indexed collections.
Refers to the maximum index (key/position) as determined by applying the <code>max</code> SQL aggregation.</p>
</dd>
<dt class="hdlist1">MINELEMENT</dt>
<dd>
<p>Available for use on collections of basic type.
Refers to the minimum value as determined by applying the <code>min</code> SQL aggregation.</p>
</dd>
<dt class="hdlist1">MININDEX</dt>
<dd>
<p>Available for use on indexed collections.
Refers to the minimum index (key/position) as determined by applying the <code>min</code> SQL aggregation.</p>
</dd>
<dt class="hdlist1">ELEMENTS</dt>
<dd>
<p>Used to refer to the elements of a collection as a whole.
Only allowed in the where clause.
Often used in conjunction with <code>ALL</code>, <code>ANY</code> or <code>SOME</code> restrictions.</p>
</dd>
<dt class="hdlist1">INDICES</dt>
<dd>
<p>Similar to <code>elements</code> except that the <code>indices</code> expression refers to the collections indices (keys/positions) as a whole.</p>
</dd>
</dl>
</div>
<div id="hql-collection-expressions-example" class="exampleblock">
<div class="title">Example 509. Collection-related expressions examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where maxelement( p.calls ) = :call"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"call"</span><span class="pun">,</span><span class="pln"> call </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where minelement( p.calls ) = :call"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"call"</span><span class="pun">,</span><span class="pln"> call </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where maxindex( p.phones ) = 0"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// the above query can be re-written with member of</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where :phone member of p.phones"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> phone </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where :phone = some elements ( p.phones )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> phone </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where exists elements ( p.phones )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where current_date() &gt; key( p.callHistory )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where current_date() &gt; all elements( p.repairTimestamps )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where 1 in indices( p.phones )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where size( p.phones ) = 2"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Elements of indexed collections (arrays, lists, and maps) can be referred to by index operator.</p>
</div>
<div id="hql-collection-index-operator-example" class="exampleblock">
<div class="title">Example 510. Index operator examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// indexed lists</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.phones[ 0 ].type = 'LAND_LINE'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// maps</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.addresses[ 'HOME' ] = :address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">//max index in list</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where pr.phones[ maxindex(pr.phones) ].type = 'LAND_LINE'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-collection-qualification">Special case - qualified path expressions</a> as there is a good deal of overlap.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-entity-type-exp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-entity-type-exp"></a>15.32. Entity type</h3>
<div class="paragraph">
<p>We can also refer to the type of an entity as an expression.
This is mainly useful when dealing with entity inheritance hierarchies.
The type can be expressed using a <code>TYPE</code> function used to refer to the type of an identification variable representing an entity.
The name of the entity also serves as a way to refer to an entity type.
Additionally, the entity type can be parameterized, in which case the entityâ€™s Java Class reference would be bound as the parameter value.</p>
</div>
<div id="hql-entity-type-exp-example" class="exampleblock">
<div class="title">Example 511. Entity type expression examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type(p) = CreditCardPayment"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type(p) = :type"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"type"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WireTransferPayment</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>HQL also has a legacy form of referring to an entity type, though that legacy form is considered deprecated in favor of <code>TYPE</code>.
The legacy form would have used <code>p.class</code> in the examples rather than <code>type(p)</code>.
It is mentioned only for completeness.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-case-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-case-expressions"></a>15.33. CASE expressions</h3>
<div class="paragraph">
<p>Both the simple and searched forms are supported, as well as the two SQL defined abbreviated forms (<code>NULLIF</code> and <code>COALESCE</code>)</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-simple-case-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-simple-case-expressions"></a>15.34. Simple CASE expressions</h3>
<div class="paragraph">
<p>The simple form has the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">CASE </span><span class="pun">{</span><span class="pln">operand</span><span class="pun">}</span><span class="pln"> WHEN </span><span class="pun">{</span><span class="pln">test_value</span><span class="pun">}</span><span class="pln"> THEN </span><span class="pun">{</span><span class="pln">match_result</span><span class="pun">}</span><span class="pln"> ELSE </span><span class="pun">{</span><span class="pln">miss_result</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">END</span></code></pre>
</div>
</div>
<div id="hql-simple-case-expressions-example" class="exampleblock">
<div class="title">Example 512. Simple case expression example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	case p.nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	when 'NA' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	then '&lt;no nick name&gt;' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	else p.nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	end "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// same as above</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select coalesce(p.nickName, '&lt;no nick name&gt;') "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-searched-case-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-searched-case-expressions"></a>15.35. Searched CASE expressions</h3>
<div class="paragraph">
<p>The searched form has the following syntax:</p>
</div>
<div id="hql-searched-case-expressions-bnf" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">CASE </span><span class="pun">[</span><span class="pln"> WHEN </span><span class="pun">{</span><span class="pln">test_conditional</span><span class="pun">}</span><span class="pln"> THEN </span><span class="pun">{</span><span class="pln">match_result</span><span class="pun">}</span><span class="pln"> </span><span class="pun">]*</span><span class="pln"> ELSE </span><span class="pun">{</span><span class="pln">miss_result</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">END</span></code></pre>
</div>
</div>
<div id="hql-searched-case-expressions-example" class="exampleblock">
<div class="title">Example 513. Searched case expression example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	case "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	when p.nickName is null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	then "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"		case "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"		when p.name is null "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"		then '&lt;no nick name&gt;' "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"		else p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"		end"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	else p.nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	end "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// coalesce can handle this more succinctly</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select coalesce( p.nickName, p.name, '&lt;no nick name&gt;' ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-nullif"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-nullif"></a>15.36. NULLIF expressions</h3>
<div class="paragraph">
<p>NULLIF is an abbreviated CASE expression that returns NULL if its operands are considered equal.</p>
</div>
<div id="hql-nullif-example" class="exampleblock">
<div class="title">Example 514. NULLIF example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select nullif( p.nickName, p.name ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// equivalent CASE expression</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	case"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	when p.nickName = p.name"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	then null"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	else p.nickName"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	end "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_coalesce_expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_coalesce_expressions"></a>15.37. COALESCE expressions</h3>
<div class="paragraph">
<p><code>COALESCE</code> is an abbreviated CASE expression that returns the first non-null operand.
We have seen a number of <code>COALESCE</code> examples above.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-select-clause"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-select-clause"></a>15.38. The <code>SELECT</code> clause</h3>
<div class="paragraph">
<p>The <code>SELECT</code> clause identifies which objects and values to return as the query results.
The expressions discussed in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-expressions">Expressions</a> are all valid select expressions, except where otherwise noted.
See the section <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-api">Hibernate Query API</a> for information on handling the results depending on the types of values specified in the <code>SELECT</code> clause.</p>
</div>
<div class="paragraph">
<p>There is a particular expression type that is only valid in the select clause.
Hibernate calls this "dynamic instantiation".
JPQL supports some of that feature and calls it a "constructor expression".</p>
</div>
<div class="paragraph">
<p>So rather than dealing with the <code>Object[]</code> (again, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-api">Hibernate Query API</a>) here, we are wrapping the values in a type-safe Java object that will be returned as the results of the query.</p>
</div>
<div id="hql-select-clause-dynamic-instantiation-example" class="exampleblock">
<div class="title">Example 515. Dynamic HQL and JPQL instantiation example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CallStatistics</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> count</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> total</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> min</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> max</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> avg</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">CallStatistics</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> count</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> total</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> min</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> max</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> avg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">count </span><span class="pun">=</span><span class="pln"> count</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">total </span><span class="pun">=</span><span class="pln"> total</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">max </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">avg </span><span class="pun">=</span><span class="pln"> avg</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">CallStatistics</span><span class="pln"> callStatistics </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select new org.hibernate.userguide.hql.CallStatistics("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	count(c), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	sum(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	min(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	max(c.duration), "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	avg(c.duration)"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CallStatistics</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The class reference must be fully qualified and it must have a matching constructor.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The class here need not be mapped.
If it does represent an entity, the resulting instances are returned in the NEW state (not managed!).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>HQL supports additional "dynamic instantiation" features.
First, the query can specify to return a <code>List</code> rather than an <code>Object[]</code> for scalar results:</p>
</div>
<div id="hql-select-clause-dynamic-list-instantiation-example" class="exampleblock">
<div class="title">Example 516. Dynamic instantiation example - list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">List</span><span class="pun">&gt;</span><span class="pln"> phoneCallDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select new list("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	p.number, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	c.duration "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The results from this query will be a <code>List&lt;List&gt;</code> as opposed to a <code>List&lt;Object[]&gt;</code></p>
</div>
<div class="paragraph">
<p>HQL also supports wrapping the scalar results in a <code>Map</code>.</p>
</div>
<div id="hql-select-clause-dynamic-map-instantiation-example" class="exampleblock">
<div class="title">Example 517. Dynamic instantiation example - map</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Map</span><span class="pun">&gt;</span><span class="pln"> phoneCallTotalDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select new map("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	p.number as phoneNumber , "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	sum(c.duration) as totalDuration, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	avg(c.duration) as averageDuration "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p.number "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The results from this query will be a <code>List&lt;Map&lt;String, Object&gt;&gt;</code> as opposed to a <code>List&lt;Object[]&gt;</code>.
The keys of the map are defined by the aliases given to the select expressions.
If the user doesnâ€™t assign aliases, the key will be the index of each particular result set column (e.g. 0, 1, 2, etc).</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-conditional-expressions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-conditional-expressions"></a>15.39. Predicates</h3>
<div class="paragraph">
<p>Predicates form the basis of the where clause, the having clause and searched case expressions.
They are expressions which resolve to a truth value, generally <code>TRUE</code> or <code>FALSE</code>, although boolean comparisons involving <code>NULL</code> resolve typically to <code>UNKNOWN</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-relational-comparisons"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-relational-comparisons"></a>15.40. Relational comparisons</h3>
<div class="paragraph">
<p>Comparisons involve one of the comparison operators: <code>=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&lt;&gt;</code>.
HQL also defines <code>!=</code> as a comparison operator synonymous with <code>&lt;&gt;</code>.
The operands should be of the same type.</p>
</div>
<div id="hql-relational-comparisons-example" class="exampleblock">
<div class="title">Example 518. Relational comparison examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// numeric comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration &lt; 30 "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// string comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like 'John%' "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// datetime comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.createdOn &gt; '1950-01-01' "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// enum comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.type = 'MOBILE' "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// boolean comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.completed = true "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// boolean comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type(p) = WireTransferPayment "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// entity value comparison</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> phonePayments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p, Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.person = ph.person "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Comparisons can also involve subquery qualifiers: <code>ALL</code>, <code>ANY</code>, <code>SOME</code>. <code>SOME</code> and <code>ANY</code> are synonymous.</p>
</div>
<div class="paragraph">
<p>The <code>ALL</code> qualifier resolves to true if the comparison is true for all of the values in the result of the subquery.
It resolves to false if the subquery result is empty.</p>
</div>
<div id="hql-all-subquery-comparison-qualifier-example" class="exampleblock">
<div class="title">Example 519. ALL subquery comparison qualifier example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// select all persons with all calls shorter than 50 seconds</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p.person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join p.calls c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where 50 &gt; all ( "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	select duration"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	from Call"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	where phone = p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">") "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ANY</code>/<code>SOME</code> qualifier resolves to true if the comparison is true for some of (at least one of) the values in the result of the subquery.
It resolves to false if the subquery result is empty.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-null-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-null-predicate"></a>15.41. Nullness predicate</h3>
<div class="paragraph">
<p>It check a value for nullness.
It can be applied to basic attribute references, entity references, and parameters.
HQL additionally allows it to be applied to component/embeddable types.</p>
</div>
<div id="hql-null-predicate-example" class="exampleblock">
<div class="title">Example 520. Nullness checking examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// select all persons with a nickname</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.nickName is not null"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// select all persons without a nickname</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.nickName is null"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-like-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-like-predicate"></a>15.42. Like predicate</h3>
<div class="paragraph">
<p>Performs a like comparison on string values. The syntax is:</p>
</div>
<div id="hql-like-predicate-bnf" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">like_expression </span><span class="pun">::=</span><span class="pln">
    string_expression
    </span><span class="pun">[</span><span class="pln">NOT</span><span class="pun">]</span><span class="pln"> LIKE pattern_value
    </span><span class="pun">[</span><span class="pln">ESCAPE escape_character</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics follow that of the SQL like expression.
The <code>pattern_value</code> is the pattern to attempt to match in the <code>string_expression</code>.
Just like SQL, <code>pattern_value</code> can use <code>_</code> and <code>%</code> as wildcards.
The meanings are the same. The <code>_</code> symbol matches any single character and <code>%</code> matches any number of characters.</p>
</div>
<div id="hql-like-predicate-example" class="exampleblock">
<div class="title">Example 521. Like predicate examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like 'Jo%'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name not like 'Jo%'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The optional <code>escape 'escape character'</code> is used to specify an escape character used to escape the special meaning of <code>_</code> and <code>%</code> in the <code>pattern_value</code>.
This is useful when needing to search on patterns including either <code>_</code> or <code>%</code>.</p>
</div>
<div class="paragraph">
<p>The syntax is formed as follows: <code>'like_predicate' escape 'escape_symbol'</code>
So, if <code>|</code> is the escape symbol and we want to match all stored procedures prefixed with <code>Dr_</code>, the like criteria becomes: <code>'Dr|_%' escape '|'</code>:</p>
</div>
<div id="hql-like-predicate-escape-example" class="exampleblock">
<div class="title">Example 522. Like with escape symbol</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// find any person with a name starting with "Dr_"</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name like 'Dr|_%' escape '|'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-between-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-between-predicate"></a>15.43. Between predicate</h3>
<div class="paragraph">
<p>Analogous to the SQL <code>BETWEEN</code> expression,
it checks if the value is within boundaries.
All the operands should have comparable types.</p>
</div>
<div id="hql-between-predicate-example" class="exampleblock">
<div class="title">Example 523. Between predicate examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join p.phones ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.id = 1L and index(ph) between 0 and 3"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.createdOn between '1999-01-01' and '2001-01-02'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.duration between 5 and 20"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.name between 'H' and 'M'"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-in-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-in-predicate"></a>15.44. In predicate</h3>
<div class="paragraph">
<p><code>IN</code> predicates performs a check that a particular value is in a list of values. Its syntax is:</p>
</div>
<div id="hql-in-predicate-bnf" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">in_expression </span><span class="pun">::=</span><span class="pln">
    single_valued_expression </span><span class="pun">[</span><span class="pln">NOT</span><span class="pun">]</span><span class="pln"> IN single_valued_list

single_valued_list </span><span class="pun">::=</span><span class="pln">
    constructor_expression </span><span class="pun">|</span><span class="pln"> </span><span class="pun">(</span><span class="pln">subquery</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> collection_valued_input_parameter

constructor_expression </span><span class="pun">::=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">expression</span><span class="pun">[,</span><span class="pln"> expression</span><span class="pun">]*)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The types of the <code>single_valued_expression</code> and the individual values in the <code>single_valued_list</code> must be consistent.</p>
</div>
<div class="paragraph">
<p>JPQL limits the valid types here to string, numeric, date, time, timestamp, and enum types, and, in JPQL, <code>single_valued_expression</code> can only refer to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"state fields", which is its term for simple attributes. Specifically, this excludes association and component/embedded attributes.</p>
</li>
<li>
<p>entity type expressions. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-entity-type-exp">Entity type</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In HQL, <code>single_valued_expression</code> can refer to a far more broad set of expression types.
Single-valued association are allowed, and so are component/embedded attributes, although that feature depends on the level of support for tuple or "row value constructor syntax" in the underlying database.
Additionally, HQL does not limit the value type in any way, though application developers should be aware that different types may incur limited support based on the underlying database vendor.
This is largely the reason for the JPQL limitations.</p>
</div>
<div class="paragraph">
<p>The list of values can come from a number of different sources.
In the <code>constructor_expression</code> and <code>collection_valued_input_parameter</code>, the list of values must not be empty; it must contain at least one value.</p>
</div>
<div id="hql-in-predicate-example" class="exampleblock">
<div class="title">Example 524. In predicate examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type(p) in ( CreditCardPayment, WireTransferPayment )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type in ( 'MOBILE', 'LAND_LINE' )"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where type in :types"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"types"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">asList</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">MOBILE</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PhoneType</span><span class="pun">.</span><span class="pln">LAND_LINE </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.person.id in ("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	select py.person.id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	from Payment py"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	where py.completed = true and py.amount &gt; 50 "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Not JPQL compliant!</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.person in ("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	select py.person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	from Payment py"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	where py.completed = true and py.amount &gt; 50 "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Not JPQL compliant!</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Payment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select distinct p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where ( p.amount, p.completed ) in ("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(50, true ),"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(100, true ),"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"	(5, false )"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">")"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Payment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-exists-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-exists-predicate"></a>15.45. Exists predicate</h3>
<div class="paragraph">
<p>Exists expressions test the existence of results from a subquery.
The affirmative form returns true if the subquery result contains values. The negated form returns true if the subquery result is empty.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-empty-collection-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-empty-collection-predicate"></a>15.46. Empty collection predicate</h3>
<div class="paragraph">
<p>The <code>IS [NOT] EMPTY</code> expression applies to collection-valued path expressions.
It checks whether the particular collection has any associated values.</p>
</div>
<div id="hql-empty-collection-predicate-example" class="exampleblock">
<div class="title">Example 525. Empty collection expression examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.phones is empty"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.phones is not empty"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-member-of-collection-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-member-of-collection-predicate"></a>15.47. Member-of collection predicate</h3>
<div class="paragraph">
<p>The <code>[NOT] MEMBER [OF]</code> expression applies to collection-valued path expressions.
It checks whether a value is a member of the specified collection.</p>
</div>
<div id="hql-member-of-collection-predicate-example" class="exampleblock">
<div class="title">Example 526. Member-of collection expression examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where 'Home address' member of p.addresses"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where 'Home address' not member of p.addresses"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-not-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-not-predicate"></a>15.48. NOT predicate operator</h3>
<div class="paragraph">
<p>The <code>NOT</code> operator is used to negate the predicate that follows it.
If that following predicate is true, the NOT resolves to false.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the predicate is true, NOT resolves to false. If the predicate is unknown (e.g. <code>NULL</code>), the NOT resolves to unknown as well.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="hql-and-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-and-predicate"></a>15.49. AND predicate operator</h3>
<div class="paragraph">
<p>The <code>AND</code> operator is used to combine 2 predicate expressions.
The result of the AND expression is true if and only if both predicates resolve to true.
If either predicate resolves to unknown, the AND expression resolves to unknown as well. Otherwise, the result is false.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-or-predicate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-or-predicate"></a>15.50. OR predicate operator</h3>
<div class="paragraph">
<p>The <code>OR</code> operator is used to combine 2 predicate expressions.
The result of the OR expression is true if one predicate resolves to true.
If both predicates resolve to unknown, the OR expression resolves to unknown.
Otherwise, the result is false.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-where-clause"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-where-clause"></a>15.51. The <code>WHERE</code> clause</h3>
<div class="paragraph">
<p>The <code>WHERE</code> clause of a query is made up of predicates which assert whether values in each potential row match the current filtering criteria.
Thus, the where clause restricts the results returned from a select query and limits the scope of update and delete queries.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-group-by"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-group-by"></a>15.52. Group by</h3>
<div class="paragraph">
<p>The <code>GROUP BY</code> clause allows building aggregated results for various value groups. As an example, consider the following queries:</p>
</div>
<div id="hql-group-by-example" class="exampleblock">
<div class="title">Example 527. Group by example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Long</span><span class="pln"> totalDuration </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select sum( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personTotalCallDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.name, sum( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p.name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="com">//It's even possible to group by entities!</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personTotalCallDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p, sum( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first query retrieves the complete total of all orders.
The second retrieves the total for each customer, grouped by each customer.</p>
</div>
<div class="paragraph">
<p>In a grouped query, the where clause applies to the non-aggregated values (essentially it determines whether rows will make it into the aggregation).
The <code>HAVING</code> clause also restricts results, but it operates on the aggregated values.
In the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-group-by-example">Group by example</a>, we retrieved <code>Call</code> duration totals for all persons.
If that ended up being too much data to deal with, we might want to restrict the results to focus only on customers with a summed total of more than 1000:</p>
</div>
<div id="hql-group-by-having-example" class="exampleblock">
<div class="title">Example 528. Having example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personTotalCallDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.name, sum( c.duration ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"having sum( c.duration ) &gt; 1000"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>HAVING</code> clause follows the same rules as the <code>WHERE</code> clause and is also made up of predicates.
<code>HAVING</code> is applied after the groupings and aggregations have been done, while the <code>WHERE</code> clause is applied before.</p>
</div>
</div>
<div class="sect2">
<h3 id="hql-order-by"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-order-by"></a>15.53. Order by</h3>
<div class="paragraph">
<p>The results of the query can also be ordered.
The <code>ORDER BY</code> clause is used to specify the selected values to be used to order the result.
The types of expressions considered valid as part of the <code>ORDER BY</code> clause include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>state fields</p>
</li>
<li>
<p>component/embeddable attributes</p>
</li>
<li>
<p>scalar expressions such as arithmetic operations, functions, etc.</p>
</li>
<li>
<p>identification variable declared in the select clause for any of the previous expression types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, JPQL says that all values referenced in the <code>ORDER BY</code> clause must be named in the <code>SELECT</code> clause.
HQL does not mandate that restriction, but applications desiring database portability should be aware that not all databases support referencing values in the <code>ORDER BY</code> clause that are not referenced in the select clause.</p>
</div>
<div class="paragraph">
<p>Individual expressions in the order-by can be qualified with either <code>ASC</code> (ascending) or <code>DESC</code> (descending) to indicate the desired ordering direction.
Null values can be placed in front or at the end of the sorted set using <code>NULLS FIRST</code> or <code>NULLS LAST</code> clause respectively.</p>
</div>
<div id="hql-order-by-example" class="exampleblock">
<div class="title">Example 529. Order by example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"order by p.name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personTotalCallDurations </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select p.name, sum( c.duration ) as total "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join ph.person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"group by p.name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"order by total"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hql-read-only-entities"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#hql-read-only-entities"></a>15.54. Read-only entities</h3>
<div class="paragraph">
<p>As explained in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-immutability">entity immutability</a> section, fetching entities in read-only mode is much more efficient than fetching read-write entities.
Even if the entities are mutable, you can still fetch them in read-only mode, and benefit from reducing the memory footprint and speeding up the flushing process.</p>
</div>
<div class="paragraph">
<p>Read-only entities are skipped by the dirty checking mechanism as illustrated by the following example:</p>
</div>
<div id="hql-read-only-entities-example" class="exampleblock">
<div class="title">Example 530. Read-only entities query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.number = :phoneNumber "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneNumber"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setHint</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.readOnly"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

calls</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln"> c </span><span class="pun">-&gt;</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">setDuration</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT c</span><span class="pun">.</span><span class="pln">id AS id1_5_ </span><span class="pun">,</span><span class="pln">
       c</span><span class="pun">.</span><span class="pln">duration AS duration2_5_ </span><span class="pun">,</span><span class="pln">
       c</span><span class="pun">.</span><span class="pln">phone_id AS phone_id4_5_ </span><span class="pun">,</span><span class="pln">
       c</span><span class="pun">.</span><span class="pln">call_timestamp AS call_tim3_5_
FROM   phone_call c
INNER JOIN phone p ON c</span><span class="pun">.</span><span class="pln">phone_id </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">id
WHERE   p</span><span class="pun">.</span><span class="pln">phone_number </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123-456-7890'</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, there is no SQL <code>UPDATE</code> being executed.</p>
</div>
<div class="paragraph">
<p>You can also pass the read-only hint to named queries using the JPA <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/QueryHint.html"><code>@QueryHint</code></a> annotation.</p>
</div>
<div id="jpa-read-only-entities-native-example" class="exampleblock">
<div class="title">Example 531. Fetching read-only entities using a named query and the read-only hint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_read_only_person_by_name"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select p from Person p where name = :name"</span><span class="pun">,</span><span class="pln">
    hints </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">@QueryHint</span><span class="pun">(</span><span class="pln">
            name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.hibernate.readOnly"</span><span class="pun">,</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"true"</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Hibernate native API offers a <code>Query#setReadOnly</code> method, as an alternative to using a JPA query hint:</p>
</div>
<div id="hql-read-only-entities-native-example" class="exampleblock">
<div class="title">Example 532. Read-only entities native query example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Call c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join c.phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where p.number = :phoneNumber "</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Call</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneNumber"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"123-456-7890"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">query</span><span class="pun">.</span><span class="typ">Query</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setReadOnly</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="criteria"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria"></a>16. Criteria</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Criteria queries offer a type-safe alternative to HQL, JPQL and native SQL queries.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate offers an older, legacy <code>org.hibernate.Criteria</code> API which should be considered deprecated.
No feature development will target those APIs. Eventually, Hibernate-specific criteria features will be ported as extensions to the JPA <code>javax.persistence.criteria.CriteriaQuery</code>.
For details on the <code>org.hibernate.Criteria</code> API, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-criteria">Legacy Hibernate Criteria Queries</a>.</p>
</div>
<div class="paragraph">
<p>This chapter will focus on the JPA APIs for declaring type-safe criteria queries.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Criteria queries are a programmatic, type-safe way to express a query.
They are type-safe in terms of using interfaces and classes to represent various structural parts of a query such as the query itself, the select clause, or an order-by, etc.
They can also be type-safe in terms of referencing attributes as we will see in a bit.
Users of the older Hibernate <code>org.hibernate.Criteria</code> query API will recognize the general approach, though we believe the JPA API to be superior as it represents a clean look at the lessons learned from that API.</p>
</div>
<div class="paragraph">
<p>Criteria queries are essentially an object graph, where each part of the graph represents an increasing (as we navigate down this graph) more atomic part of the query.
The first step in performing a criteria query is building this graph.
The <code>javax.persistence.criteria.CriteriaBuilder</code> interface is the first thing with which you need to become acquainted with begin using criteria queries.
Its role is that of a factory for all the individual pieces of the criteria.
You obtain a <code>javax.persistence.criteria.CriteriaBuilder</code> instance by calling the <code>getCriteriaBuilder()</code> method of either <code>javax.persistence.EntityManagerFactory</code> or <code>javax.persistence.EntityManager</code>.</p>
</div>
<div class="paragraph">
<p>The next step is to obtain a <code>javax.persistence.criteria.CriteriaQuery</code>.
This is accomplished using one of the three methods on <code>javax.persistence.criteria.CriteriaBuilder</code> for this purpose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;T&gt; CriteriaQuery&lt;T&gt; createQuery( Class&lt;T&gt; resultClass )</code></p>
</li>
<li>
<p><code>CriteriaQuery&lt;Tuple&gt; createTupleQuery()</code></p>
</li>
<li>
<p><code>CriteriaQuery&lt;Object&gt; createQuery()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each serves a different purpose depending on the expected type of the query results.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Chapter 6 Criteria API of the JPA Specification already contains a decent amount of reference material pertaining to the various parts of a criteria query.
So rather than duplicate all that content here, letâ€™s instead look at some of the more widely anticipated usages of the API.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="criteria-typedquery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery"></a>16.1. Typed criteria queries</h3>
<div class="paragraph">
<p>The type of the criteria query (aka the <code>&lt;T&gt;</code>) indicates the expected types in the query result.
This might be an entity, an <code>Integer</code>, or any other object.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-entity"></a>16.2. Selecting an entity</h3>
<div class="paragraph">
<p>This is probably the most common form of query.
The application wants to select entity instances.</p>
</div>
<div id="criteria-typedquery-entity-example" class="exampleblock">
<div class="title">Example 533. Selecting the root entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln"> root </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The example uses <code>createQuery()</code> passing in the <code>Person</code> class reference as the results of the query will be <code>Person</code> objects.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The call to the <code>CriteriaQuery#select</code> method in this example is unnecessary because <em>root</em> will be the implied selection since we have only a single query root.
It was done here only for completeness of an example.</p>
</div>
<div class="paragraph">
<p>The <code>Person_.name</code> reference is an example of the static form of JPA Metamodel reference.
We will use that form exclusively in this chapter.
See the documentation for the <a href="https://docs.jboss.org/hibernate/orm/5.3/topical/html_single/metamodelgen/MetamodelGenerator.html">Hibernate JPA Metamodel Generator</a> for additional details on the JPA static Metamodel.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-expression"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-expression"></a>16.3. Selecting an expression</h3>
<div class="paragraph">
<p>The simplest form of selecting an expression is selecting a particular attribute from an entity.
But this expression might also represent an aggregation, a mathematical operation, etc.</p>
</div>
<div id="criteria-typedquery-expression-example" class="exampleblock">
<div class="title">Example 534. Selecting an attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example, the query is typed as <code>java.lang.String</code> because that is the anticipated type of the results (the type of the <code>Person#nickName</code> attribute is <code>java.lang.String</code>).
Because a query might contain multiple references to the <code>Person</code> entity, attribute references always need to be qualified.
This is accomplished by the <code>Root#get</code> method call.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-multiselect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect"></a>16.4. Selecting multiple values</h3>
<div class="paragraph">
<p>There are actually a few different ways to select multiple values using criteria queries.
We will explore two options here, but an alternative recommended approach is to use tuples as described in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-tuple">Tuple criteria queries</a>,
or consider a wrapper query, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-wrapper">Selecting a wrapper</a> for details.</p>
</div>
<div id="criteria-typedquery-multiselect-array-explicit-example" class="exampleblock">
<div class="title">Example 535. Selecting an array</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> idPath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNamePath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName</span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">array</span><span class="pun">(</span><span class="pln"> idPath</span><span class="pun">,</span><span class="pln"> nickNamePath </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> idAndNickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Technically this is classified as a typed query, but you can see from handling the results that this is sort of misleading.
Anyway, the expected result type here is an array.</p>
</div>
<div class="paragraph">
<p>The example then uses the array method of <code>javax.persistence.criteria.CriteriaBuilder</code> which explicitly combines individual selections into a <code>javax.persistence.criteria.CompoundSelection</code>.</p>
</div>
<div id="criteria-typedquery-multiselect-array-implicit-example" class="exampleblock">
<div class="title">Example 536. Selecting an array using <code>multiselect</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> idPath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNamePath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName</span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="pln">multiselect</span><span class="pun">(</span><span class="pln"> idPath</span><span class="pun">,</span><span class="pln"> nickNamePath </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> idAndNickNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just as we saw in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect-array-explicit-example">Selecting an array</a> we have a typed criteria query returning an <code>Object</code> array.
Both queries are functionally equivalent.
This second example uses the <code>multiselect()</code> method which behaves slightly differently based on the type given when the criteria query was first built,
but, in this case, it says to select and return an <em>Object[]</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-typedquery-wrapper"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-wrapper"></a>16.5. Selecting a wrapper</h3>
<div class="paragraph">
<p>Another alternative to <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect">Selecting multiple values</a> is to instead select an object that will "wrap" the multiple values.
Going back to the example query there, rather than returning an array of <em>[Person#id, Person#nickName]</em>, instead declare a class that holds these values and use that as a return object.</p>
</div>
<div id="criteria-typedquery-wrapper-example" class="exampleblock">
<div class="title">Example 537. Selecting a wrapper</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonWrapper</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersonWrapper</span><span class="pun">(</span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">nickName </span><span class="pun">=</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getNickName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">PersonWrapper</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonWrapper</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> idPath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNamePath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName</span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">construct</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonWrapper</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> idPath</span><span class="pun">,</span><span class="pln"> nickNamePath </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonWrapper</span><span class="pun">&gt;</span><span class="pln"> wrappers </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>First, we see the simple definition of the wrapper object we will be using to wrap our result values.
Specifically, notice the constructor and its argument types.
Since we will be returning <code>PersonWrapper</code> objects, we use <code>PersonWrapper</code> as the type of our criteria query.</p>
</div>
<div class="paragraph">
<p>This example illustrates the use of the <code>javax.persistence.criteria.CriteriaBuilder</code> method construct which is used to build a wrapper expression.
For every row in the result, we are saying we would like a <code>PersonWrapper</code> instantiated with the remaining arguments by the matching constructor.
This wrapper expression is then passed as the select.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-tuple"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-tuple"></a>16.6. Tuple criteria queries</h3>
<div class="paragraph">
<p>A better approach to <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect">Selecting multiple values</a> is to use either a wrapper (which we just saw in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-wrapper">Selecting a wrapper</a>) or using the <code>javax.persistence.Tuple</code> contract.</p>
</div>
<div id="criteria-tuple-example" class="exampleblock">
<div class="title">Example 538. Selecting a tuple</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> idPath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">id </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Path</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNamePath </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName</span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="pln">multiselect</span><span class="pun">(</span><span class="pln"> idPath</span><span class="pun">,</span><span class="pln"> nickNamePath </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> idPath </span><span class="pun">);</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> nickName </span><span class="pun">=</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> nickNamePath </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">//or using indices</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> nickName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example illustrates accessing the query results through the <code>javax.persistence.Tuple</code> interface.
The example uses the explicit <code>createTupleQuery()</code> of <code>javax.persistence.criteria.CriteriaBuilder</code>.
An alternate approach is to use <code>createQuery( Tuple.class )</code>.</p>
</div>
<div class="paragraph">
<p>Again we see the use of the <code>multiselect()</code> method, just like in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect-array-implicit-example">Selecting an array using <code>multiselect</code></a>.
The difference here is that the type of the <code>javax.persistence.criteria.CriteriaQuery</code> was defined as <code>javax.persistence.Tuple</code> so the compound selections, in this case, are interpreted to be the tuple elements.</p>
</div>
<div class="paragraph">
<p>The javax.persistence.Tuple contract provides three forms of access to the underlying elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">typed</dt>
<dd>
<p>The <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-tuple-example">Selecting a tuple</a> example illustrates this form of access in the <code>tuple.get( idPath )</code> and <code>tuple.get( nickNamePath )</code> calls.
This allows typed access to the underlying tuple values based on the <code>javax.persistence.TupleElement</code> expressions used to build the criteria.</p>
</dd>
<dt class="hdlist1">positional</dt>
<dd>
<p>Allows access to the underlying tuple values based on the position.
The simple <em>Object get(int position)</em> form is very similar to the access illustrated in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect-array-explicit-example">Selecting an array</a> and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-typedquery-multiselect-array-implicit-example">Selecting an array using <code>multiselect</code></a>.
The <em>&lt;X&gt; X get(int position, Class&lt;X&gt; type</em> form allows typed positional access, but based on the explicitly supplied type which the tuple value must be type-assignable to.</p>
</dd>
<dt class="hdlist1">aliased</dt>
<dd>
<p>Allows access to the underlying tuple values based an (optionally) assigned alias.
The example query did not apply an alias.
An alias would be applied via the alias method on <code>javax.persistence.criteria.Selection</code>.
Just like <code>positional</code> access, there is both a typed (<em>Object get(String alias)</em>) and an untyped (<em>&lt;X&gt; X get(String alias, Class&lt;X&gt; type</em> form.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-from"></a>16.7. FROM clause</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>A <code>CriteriaQuery</code> object defines a query over one or more entity, embeddable, or basic abstract schema types.
The root objects of the query are entities, from which the other types are reached by navigation.</p>
</div>
<div class="paragraph">
<p>â€” JPA Specification, section 6.5.2 Query Roots, pg 262</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the individual parts of the FROM clause (roots, joins, paths) implement the <code>javax.persistence.criteria.From</code> interface.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-root"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-from-root"></a>16.8. Roots</h3>
<div class="paragraph">
<p>Roots define the basis from which all joins, paths and attributes are available in the query.
A root is always an entity type. Roots are defined and added to the criteria by the overloaded from methods on <code>javax.persistence.criteria.CriteriaQuery</code>:</p>
</div>
<div id="criteria-from-root-methods-example" class="exampleblock">
<div class="title">Example 539. Root methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="tag">&lt;X&gt;</span><span class="pln"> Root</span><span class="tag">&lt;X&gt;</span><span class="pln"> from( Class</span><span class="tag">&lt;X&gt;</span><span class="pln"> );

</span><span class="tag">&lt;X&gt;</span><span class="pln"> Root</span><span class="tag">&lt;X&gt;</span><span class="pln"> from( EntityType</span><span class="tag">&lt;X&gt;</span><span class="pln"> );</span></code></pre>
</div>
</div>
</div>
</div>
<div id="criteria-from-root-example" class="exampleblock">
<div class="title">Example 540. Adding a root example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Criteria queries may define multiple roots, the effect of which is to create a Cartesian Product between the newly added root and the others.
Here is an example defining a Cartesian Product between <code>Person</code> and <code>Partner</code> entities:</p>
</div>
<div id="criteria-from-multiple-root-example" class="exampleblock">
<div class="title">Example 541. Adding multiple roots example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> personRoot </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Partner</span><span class="pun">&gt;</span><span class="pln"> partnerRoot </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Partner</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="pln">multiselect</span><span class="pun">(</span><span class="pln"> personRoot</span><span class="pun">,</span><span class="pln"> partnerRoot </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Predicate</span><span class="pln"> personRestriction </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="kwd">and</span><span class="pun">(</span><span class="pln">
	builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> personRoot</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">address </span><span class="pun">),</span><span class="pln"> address </span><span class="pun">),</span><span class="pln">
	builder</span><span class="pun">.</span><span class="pln">isNotEmpty</span><span class="pun">(</span><span class="pln"> personRoot</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">phones </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Predicate</span><span class="pln"> partnerRestriction </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="kwd">and</span><span class="pun">(</span><span class="pln">
	builder</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="pln"> partnerRoot</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Partner_</span><span class="pun">.</span><span class="pln">name </span><span class="pun">),</span><span class="pln"> prefix </span><span class="pun">),</span><span class="pln">
	builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> partnerRoot</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Partner_</span><span class="pun">.</span><span class="pln">version </span><span class="pun">),</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="kwd">and</span><span class="pun">(</span><span class="pln"> personRestriction</span><span class="pun">,</span><span class="pln"> partnerRestriction </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-join"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-from-join"></a>16.9. Joins</h3>
<div class="paragraph">
<p>Joins allow navigation from other <code>javax.persistence.criteria.From</code> to either association or embedded attributes.
Joins are created by the numerous overloaded join methods of the <code>javax.persistence.criteria.From</code> interface.</p>
</div>
<div id="criteria-from-join-example" class="exampleblock">
<div class="title">Example 542. Join example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Phone.person is a @ManyToOne</span><span class="pln">
</span><span class="typ">Join</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> personJoin </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone_</span><span class="pun">.</span><span class="pln">person </span><span class="pun">);</span><span class="pln">
</span><span class="com">// Person.addresses is an @ElementCollection</span><span class="pln">
</span><span class="typ">Join</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> addressesJoin </span><span class="pun">=</span><span class="pln"> personJoin</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">addresses </span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">isNotEmpty</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone_</span><span class="pun">.</span><span class="pln">calls </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-from-fetch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-from-fetch"></a>16.10. Fetches</h3>
<div class="paragraph">
<p>Just like in HQL and JPQL, criteria queries can specify that associated data be fetched along with the owner.
Fetches are created by the numerous overloaded fetch methods of the <code>javax.persistence.criteria.From</code> interface.</p>
</div>
<div id="criteria-from-fetch-example" class="exampleblock">
<div class="title">Example 543. Join fetch example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// Phone.person is a @ManyToOne</span><span class="pln">
</span><span class="typ">Fetch</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> personFetch </span><span class="pun">=</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">fetch</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone_</span><span class="pun">.</span><span class="pln">person </span><span class="pun">);</span><span class="pln">
</span><span class="com">// Person.addresses is an @ElementCollection</span><span class="pln">
</span><span class="typ">Fetch</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> addressesJoin </span><span class="pun">=</span><span class="pln"> personFetch</span><span class="pun">.</span><span class="pln">fetch</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">addresses </span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">isNotEmpty</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone_</span><span class="pun">.</span><span class="pln">calls </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically speaking, embedded attributes are always fetched with their owner.
However, in order to define the fetching of <em>Phone#addresses</em> we needed a <code>javax.persistence.criteria.Fetch</code> because element collections are <code>LAZY</code> by default.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-path"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-path"></a>16.11. Path expressions</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Roots, joins and fetches are themselves paths as well.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="criteria-param"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-param"></a>16.12. Using parameters</h3>
<div id="criteria-param-example" class="exampleblock">
<div class="title">Example 544. Parameters example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ParameterExpression</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> nickNameParameter </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
criteria</span><span class="pun">.</span><span class="kwd">where</span><span class="pun">(</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln"> root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person_</span><span class="pun">.</span><span class="pln">nickName </span><span class="pun">),</span><span class="pln"> nickNameParameter </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">TypedQuery</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> nickNameParameter</span><span class="pun">,</span><span class="pln"> </span><span class="str">"JD"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Use the parameter method of <code>javax.persistence.criteria.CriteriaBuilder</code> to obtain a parameter reference.
Then use the parameter reference to bind the parameter value to the <code>javax.persistence.Query</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-group-by"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-group-by"></a>16.13. Using group by</h3>
<div id="criteria-group-by-example" class="exampleblock">
<div class="title">Example 545. Group by example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CriteriaBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getCriteriaBuilder</span><span class="pun">();</span><span class="pln">

</span><span class="typ">CriteriaQuery</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> criteria </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Root</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> criteria</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

criteria</span><span class="pun">.</span><span class="pln">groupBy</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"address"</span><span class="pun">));</span><span class="pln">
criteria</span><span class="pun">.</span><span class="pln">multiselect</span><span class="pun">(</span><span class="pln">root</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"address"</span><span class="pun">),</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">count</span><span class="pun">(</span><span class="pln">root</span><span class="pun">));</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Tuple</span><span class="pun">&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln"> criteria </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Tuple</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="typ">Long</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sql"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql"></a>17. Native SQL Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may also express queries in the native SQL dialect of your database.
This is useful if you want to utilize database-specific features such as window functions, Common Table Expressions (CTE) or the <code>CONNECT BY</code> option in Oracle.
It also provides a clean migration path from a direct SQL/JDBC based application to Hibernate/JPA.
Hibernate also allows you to specify handwritten SQL (including stored procedures) for all create, update, delete, and retrieve operations.</p>
</div>
<div class="sect2">
<h3 id="sql-jpa-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-jpa-query"></a>17.1. Creating a native query using JPA</h3>
<div class="paragraph">
<p>Execution of native SQL queries is controlled via the <code>NativeQuery</code> interface, which is obtained by calling <code>Session.createNativeQuery()</code>.
The following sections describe how to use this API for querying.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-scalar-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-scalar-query"></a>17.2. Scalar queries</h3>
<div class="paragraph">
<p>The most basic SQL query is to get a list of scalars (column) values.</p>
</div>
<div id="sql-jpa-all-columns-scalar-query-example" class="exampleblock">
<div class="title">Example 546. JPA native query selecting all columns</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-custom-column-selection-scalar-query-example" class="exampleblock">
<div class="title">Example 547. JPA native query with a custom column selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, name FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> persons</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-all-columns-scalar-query-example" class="exampleblock">
<div class="title">Example 548. Hibernate native query selecting all columns</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-custom-column-selection-scalar-query-example" class="exampleblock">
<div class="title">Example 549. Hibernate native query with a custom column selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, name FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> persons</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These will return a <code>List</code> of <code>Object</code> arrays ( <code>Object[]</code> ) with scalar values for each column in the <code>PERSON</code> table.
Hibernate will use <code>java.sql.ResultSetMetadata</code> to deduce the actual order and types of the returned scalar values.</p>
</div>
<div class="paragraph">
<p>To avoid the overhead of using <code>ResultSetMetadata</code>, or simply to be more explicit in what is returned, one can use <code>addScalar()</code>:</p>
</div>
<div id="sql-hibernate-scalar-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 550. Hibernate native query with explicit result set selection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addScalar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LongType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addScalar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">StringType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> persons</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although it still returns an <code>Object</code> arrays, this query will not use the <code>ResultSetMetadata</code> anymore since it explicitly gets the <code>id</code> and <code>name</code> columns as respectively a <code>BigInteger</code> and a <code>String</code> from the underlying <code>ResultSet</code>.
This also means that only these two columns will be returned, even though the query is still using <code>*</code> and the <code>ResultSet</code> contains more than the three listed columns.</p>
</div>
<div class="paragraph">
<p>It is possible to leave out the type information for all or some of the scalars.</p>
</div>
<div id="sql-hibernate-scalar-query-partial-explicit-result-set-example" class="exampleblock">
<div class="title">Example 551. Hibernate native query with result set selection thatâ€™s a partially explicit</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addScalar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LongType</span><span class="pun">.</span><span class="pln">INSTANCE </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addScalar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> persons</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> person</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is essentially the same query as before, but now <code>ResultSetMetaData</code> is used to determine the type of <code>name</code>, whereas the type of <code>id</code> is explicitly specified.</p>
</div>
<div class="paragraph">
<p>How the <code>java.sql.Types</code> returned from <code>ResultSetMetaData</code> is mapped to Hibernate types is controlled by the <code>Dialect</code>.
If a specific type is not mapped, or does not result in the expected type, it is possible to customize it via calls to <code>registerHibernateType</code> in the Dialect.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-entity-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-entity-query"></a>17.3. Entity queries</h3>
<div class="paragraph">
<p>The above queries were all about returning scalar values, basically returning the <em>raw</em> values from the <code>ResultSet</code>.</p>
</div>
<div id="sql-jpa-entity-query-example" class="exampleblock">
<div class="title">Example 552. JPA native query selecting entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-query-example" class="exampleblock">
<div class="title">Example 553. Hibernate native query selecting entities</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Assuming that <code>Person</code> is mapped as a class with the columns <code>id</code>, <code>name</code>, <code>nickName</code>, <code>address</code>, <code>createdOn</code>, and <code>version</code>,
the following query will also return a <code>List</code> where each element is a <code>Person</code> entity.</p>
</div>
<div id="sql-jpa-entity-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 554. JPA native query selecting entities with explicit result set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, name, nickName, address, createdOn, version "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-query-explicit-result-set-example" class="exampleblock">
<div class="title">Example 555. Hibernate native query selecting entities with explicit result set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, name, nickName, address, createdOn, version "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-entity-associations-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-entity-associations-query"></a>17.4. Handling associations and collections</h3>
<div class="paragraph">
<p>If the entity is mapped with a <code>many-to-one</code> or a child-side <code>one-to-one</code> to another entity,
it is required to also return this when performing the native query,
otherwise, a database-specific <em>column not found</em> error will occur.</p>
</div>
<div id="sql-jpa-entity-associations-query-many-to-one-example" class="exampleblock">
<div class="title">Example 556. JPA native query selecting entities with many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, phone_number, phone_type, person_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-example" class="exampleblock">
<div class="title">Example 557. Hibernate native query selecting entities with many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT id, phone_number, phone_type, person_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will allow the <code>Phone#person</code> to function properly since the <code>many-to-one</code> or <code>one-to-one</code>
association is going to use a proxy that will be initialized when being navigated for the first time.</p>
</div>
<div class="paragraph">
<p>It is possible to eagerly join the <code>Phone</code> and the <code>Person</code> entities to avoid the possible extra roundtrip for initializing the <code>many-to-one</code> association.</p>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-join-example" class="exampleblock">
<div class="title">Example 558. Hibernate native query selecting entities with joined many-to-one association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"JOIN Person pr ON ph.person_id = pr.id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addJoin</span><span class="pun">(</span><span class="pln"> </span><span class="str">"pr"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"phone.person"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	assertNotNull</span><span class="pun">(</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT
    </span><span class="pun">*</span><span class="pln">
FROM
    </span><span class="typ">Phone</span><span class="pln"> ph
JOIN
    </span><span class="typ">Person</span><span class="pln"> pr
ON  ph</span><span class="pun">.</span><span class="pln">person_id </span><span class="pun">=</span><span class="pln"> pr</span><span class="pun">.</span><span class="pln">id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As seen in the associated SQL query, Hibernate manages to construct the entity hierarchy without requiring any extra database roundtrip.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By default, when using the <code>addJoin()</code> method, the result set will contain both entities that are joined.
To construct the entity hierarchy, you need to use a <code>ROOT_ENTITY</code> or <code>DISTINCT_ROOT_ENTITY</code> <code>ResultTransformer</code>.</p>
</div>
<div id="sql-hibernate-entity-associations-query-many-to-one-join-result-transformer-example" class="exampleblock">
<div class="title">Example 559. Hibernate native query selecting entities with joined many-to-one association and <code>ResultTransformer</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"JOIN Person pr ON ph.person_id = pr.id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addJoin</span><span class="pun">(</span><span class="pln"> </span><span class="str">"pr"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"phone.person"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setResultTransformer</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Criteria</span><span class="pun">.</span><span class="pln">ROOT_ENTITY </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">:</span><span class="pln"> persons</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	person</span><span class="pun">.</span><span class="pln">getPhones</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because of the <code>ROOT_ENTITY</code> <code>ResultTransformer</code>, this query will return the parent-side as root entities.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Notice that you added an alias name <em>pr</em> to be able to specify the target property path of the join.
It is possible to do the same eager joining for collections (e.g. the <code>Phone#calls</code> <code>one-to-many</code> association).</p>
</div>
<div id="sql-jpa-entity-associations-query-one-to-many-join-example" class="exampleblock">
<div class="title">Example 560. JPA native query selecting entities with joined one-to-many association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Phone</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"JOIN phone_call c ON c.phone_id = ph.id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">:</span><span class="pln"> phones</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Call</span><span class="pun">&gt;</span><span class="pln"> calls </span><span class="pun">=</span><span class="pln"> phone</span><span class="pun">.</span><span class="pln">getCalls</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT </span><span class="pun">*</span><span class="pln">
FROM phone ph
JOIN call c ON c</span><span class="pun">.</span><span class="pln">phone_id </span><span class="pun">=</span><span class="pln"> ph</span><span class="pun">.</span><span class="pln">id</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations-query-one-to-many-join-example" class="exampleblock">
<div class="title">Example 561. Hibernate native query selecting entities with joined one-to-many association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Phone ph "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"JOIN phone_call c ON c.phone_id = ph.id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="str">"phone"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addJoin</span><span class="pun">(</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"phone.calls"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Call</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Call</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT </span><span class="pun">*</span><span class="pln">
FROM phone ph
JOIN call c ON c</span><span class="pun">.</span><span class="pln">phone_id </span><span class="pun">=</span><span class="pln"> ph</span><span class="pun">.</span><span class="pln">id</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this stage, you are reaching the limits of what is possible with native queries, without starting to enhance the sql queries to make them usable in Hibernate.
Problems can arise when returning multiple entities of the same type or when the default alias/column names are not enough.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-multi-entity-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-multi-entity-query"></a>17.5. Returning multiple entities</h3>
<div class="paragraph">
<p>Until now, the result set column names are assumed to be the same as the column names specified in the mapping document.
This can be problematic for SQL queries that join multiple tables since the same column names can appear in more than one table.</p>
</div>
<div class="paragraph">
<p>Column alias injection is needed in the following query which otherwise throws <code>NonUniqueDiscoveredSqlAliasException</code>.</p>
</div>
<div id="sql-jpa-multi-entity-query-example" class="exampleblock">
<div class="title">Example 562. JPA native query selecting entities with the same column names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> entities </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person pr, Partner pt "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"WHERE pr.name = pt.name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multi-entity-query-example" class="exampleblock">
<div class="title">Example 563. Hibernate native query selecting entities with the same column names</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> entities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person pr, Partner pt "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"WHERE pr.name = pt.name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The query was intended to return all <code>Person</code> and <code>Partner</code> instances with the same name.
The query fails because there is a conflict of names since the two entities are mapped to the same column names (e.g. <code>id</code>, <code>name</code>, <code>version</code>).
Also, on some databases, the returned column aliases will most likely be on the form <code>pr.id</code>, <code>pr.name</code>, etc.
which are not equal to the columns specified in the mappings (<code>id</code> and <code>name</code>).</p>
</div>
<div class="paragraph">
<p>The following form is not vulnerable to column name duplication:</p>
</div>
<div id="sql-hibernate-multi-entity-query-alias-example" class="exampleblock">
<div class="title">Example 564. Hibernate native query selecting entities with the same column names and aliases</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> entities </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT {pr.*}, {pt.*} "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person pr, Partner pt "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"WHERE pr.name = pt.name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="str">"pr"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="str">"pt"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Partner</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thereâ€™s no such equivalent in JPA because the <code>Query</code> interface doesnâ€™t define an <code>addEntity</code> method equivalent.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>{pr.<strong>}</strong></code><strong> and <code>{pt.</code></strong><code>}</code> notation used above is shorthand for "all properties".
Alternatively, you can list the columns explicitly, but even in this case, Hibernate injects the SQL column aliases for each property.
The placeholder for a column alias is just the property name qualified by the table alias.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-alias-references"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-alias-references"></a>17.6. Alias and property references</h3>
<div class="paragraph">
<p>In most cases, the above alias injection is needed.
For queries relating to more complex mappings, like composite properties, inheritance discriminators, collections etc., you can use specific aliases that allow Hibernate to inject the proper aliases.</p>
</div>
<div class="paragraph">
<p>The following table shows the different ways you can use the alias injection.
Please note that the alias names in the result are simply examples, each alias will have a unique and probably different name when used.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Alias injection names</caption>
<colgroup>
<col style="width: 23%;">
<col style="width: 22%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simple property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].[propertyname]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A_NAME as {item.name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A composite property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].[componentname].[propertyname]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENCY as {item.amount.currency}, VALUE as {item.amount.value}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discriminator of an entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].class}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DISC as {item.class}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of an entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{item.*}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A collection key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].key}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORGID as {coll.key}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EMPID as {coll.id}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element of a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XID as {coll.element}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">property of the element in the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element.[propertyname]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NAME as {coll.element.name}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of the element in the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].element.*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{coll.element.*}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All properties of the collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{[aliasname].*}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{coll.*}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sql-dto-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-dto-query"></a>17.7. Returning DTOs (Data Transfer Objects)</h3>
<div class="paragraph">
<p>It is possible to apply a <code>ResultTransformer</code> to native SQL queries, allowing it to return non-managed entities.</p>
</div>
<div id="sql-hibernate-dto-query-example" class="exampleblock">
<div class="title">Example 565. Hibernate native query selecting DTOs</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonSummaryDTO</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Number</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Number</span><span class="pln"> getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setId</span><span class="pun">(</span><span class="typ">Number</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonSummaryDTO</span><span class="pun">&gt;</span><span class="pln"> dtos </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT p.id as \"id\", p.name as \"name\" "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person p"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setResultTransformer</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Transformers</span><span class="pun">.</span><span class="pln">aliasToBean</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonSummaryDTO</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thereâ€™s no such equivalent in JPA because the <code>Query</code> interface doesnâ€™t define a <code>setResultTransformer</code> method equivalent.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The above query will return a list of <code>PersonSummaryDTO</code> which has been instantiated and injected the values of <code>id</code> and <code>name</code> into its corresponding properties or fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-inheritance-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-inheritance-query"></a>17.8. Handling inheritance</h3>
<div class="paragraph">
<p>Native SQL queries which query for entities that are mapped as part of an inheritance must include all properties for the base class and all its subclasses.</p>
</div>
<div id="sql-hibernate-inheritance-query-example" class="exampleblock">
<div class="title">Example 566. Hibernate native query selecting subclasses</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">CreditCardPayment</span><span class="pun">&gt;</span><span class="pln"> payments </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Payment p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"JOIN CreditCardPayment cp on cp.id = p.id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CreditCardPayment</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Thereâ€™s no such equivalent in JPA because the <code>Query</code> interface doesnâ€™t define an <code>addEntity</code> method equivalent.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="sql-query-parameters"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-query-parameters"></a>17.9. Parameters</h3>
<div class="paragraph">
<p>Native SQL queries support positional as well as named parameters:</p>
</div>
<div id="sql-jpa-query-parameters-example" class="exampleblock">
<div class="title">Example 567. JPA native query with parameters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"WHERE name like :name"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-query-parameters-example" class="exampleblock">
<div class="title">Example 568. Hibernate native query with parameters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"SELECT * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"FROM Person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"WHERE name like :name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-named-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-named-queries"></a>17.10. Named SQL queries</h3>
<div class="paragraph">
<p>Named SQL queries can also be defined during mapping and called in exactly the same way as a named HQL query.
In this case, you do <em>not</em> need to call <code>addEntity()</code> anymore.</p>
</div>
<div class="paragraph">
<p>JPA defines the <code>javax.persistence.NamedNativeQuery</code> annotation for this purpose,
and the Hibernate <code>org.hibernate.annotations.NamedNativeQuery</code> annotation extends it and adds the following attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>flushMode()</code></dt>
<dd>
<p>The flush mode for the query. By default, it uses the current Persistence Context flush mode.</p>
</dd>
<dt class="hdlist1"><code>cacheable()</code></dt>
<dd>
<p>Whether the query (results) is cacheable or not. By default, queries are not cached.</p>
</dd>
<dt class="hdlist1"><code>cacheRegion()</code></dt>
<dd>
<p>If the query results are cacheable, name the query cache region to use.</p>
</dd>
<dt class="hdlist1"><code>fetchSize()</code></dt>
<dd>
<p>The number of rows fetched by the JDBC Driver per database trip. The default value is given by the JDBC driver.</p>
</dd>
<dt class="hdlist1"><code>timeout()</code></dt>
<dd>
<p>The query timeout (in seconds). By default, thereâ€™s no timeout.</p>
</dd>
<dt class="hdlist1"><code>callable()</code></dt>
<dd>
<p>Does the SQL query represent a call to a procedure/function? The default is false.</p>
</dd>
<dt class="hdlist1"><code>comment()</code></dt>
<dd>
<p>A comment added to the SQL query for tuning the execution plan.</p>
</dd>
<dt class="hdlist1"><code>cacheMode()</code></dt>
<dd>
<p>The cache mode used for this query. This refers to entities/collections returned by the query.
The default value is <code>CacheModeType.NORMAL</code>.</p>
</dd>
<dt class="hdlist1"><code>readOnly()</code></dt>
<dd>
<p>Whether the results should be read-only. By default, queries are not read-only so entities are stored in the Persistence Context.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="sql-scalar-named-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-scalar-named-queries"></a>17.10.1. Named SQL queries selecting scalar values</h4>
<div class="paragraph">
<p>To fetch a single column of given table, the named query looks as follows:</p>
</div>
<div id="sql-scalar-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 569. Single scalar value <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_person_name"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"SELECT name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"FROM Person "</span><span class="pln">
</span><span class="pun">),</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-scalar-named-query-example" class="exampleblock">
<div class="title">Example 570. JPA named native query selecting a scalar value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-scalar-named-query-example" class="exampleblock">
<div class="title">Example 571. Hibernate named native query selecting a scalar value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Selecting multiple scalar values is done like this:</p>
</div>
<div id="sql-multiple-scalar-values-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 572. Multiple scalar values <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_person_name_and_nickName"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   name, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"FROM Person "</span><span class="pln">
</span><span class="pun">),</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Without specifying an explicit result type, Hibernate will assume an <code>Object</code> array:</p>
</div>
<div id="sql-jpa-multiple-scalar-values-named-query-example" class="exampleblock">
<div class="title">Example 573. JPA named native query selecting multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name_and_nickName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> nickName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-named-query-example" class="exampleblock">
<div class="title">Example 574. Hibernate named native query selecting multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name_and_nickName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">String</span><span class="pln"> nickName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Itâ€™s possible to use a DTO to store the resulting scalar values:</p>
</div>
<div id="sql-ConstructorResult-dto-example" class="exampleblock">
<div class="title">Example 575. DTO to store multiple scalar values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonNames</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PersonNames</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> nickName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">nickName </span><span class="pun">=</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getNickName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> nickName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-multiple-scalar-values-dto-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 576. Multiple scalar values <code>NamedNativeQuery</code> with <code>ConstructorResult</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_person_name_and_nickName_dto"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   name, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   nickName "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"FROM Person "</span><span class="pun">,</span><span class="pln">
    resultSetMapping </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name_and_nickName_dto"</span><span class="pln">
</span><span class="pun">),</span><span class="pln">
</span><span class="lit">@SqlResultSetMapping</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name_and_nickName_dto"</span><span class="pun">,</span><span class="pln">
    classes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ConstructorResult</span><span class="pun">(</span><span class="pln">
        targetClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PersonNames</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        columns </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nickName"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-multiple-scalar-values-dto-named-query-example" class="exampleblock">
<div class="title">Example 577. JPA named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonNames</span><span class="pun">&gt;</span><span class="pln"> personNames </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name_and_nickName_dto"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-dto-named-query-example" class="exampleblock">
<div class="title">Example 578. Hibernate named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonNames</span><span class="pun">&gt;</span><span class="pln"> personNames </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_name_and_nickName_dto"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also use the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedNativeQuery.html"><code>@NamedNativeQuery</code></a> Hibernate annotation
to customize the named query using various configurations such as fetch mode, cacheability, time out interval.</p>
</div>
<div id="sql-multiple-scalar-values-dto-NamedNativeQuery-hibernate-example" class="exampleblock">
<div class="title">Example 579. Multiple scalar values using <code>ConstructorResult</code> and Hibernate <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQueries</span><span class="pun">({</span><span class="pln">
    </span><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"get_person_phone_count"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SELECT pr.name AS name, count(*) AS phoneCount "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"FROM Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"JOIN Person pr ON pr.id = p.person_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"GROUP BY pr.name"</span><span class="pun">,</span><span class="pln">
        resultSetMapping </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_phone_count"</span><span class="pun">,</span><span class="pln">
        timeout </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        readOnly </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">),</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@SqlResultSetMapping</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_phone_count"</span><span class="pun">,</span><span class="pln">
    classes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@ConstructorResult</span><span class="pun">(</span><span class="pln">
        targetClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PersonPhoneCount</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        columns </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"phoneCount"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-multiple-scalar-values-dto-hibernate-named-query-example" class="exampleblock">
<div class="title">Example 580. Hibernate <code>NamedNativeQuery</code> named native query selecting multiple scalar values into a DTO</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PersonPhoneCount</span><span class="pun">&gt;</span><span class="pln"> personNames </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedNativeQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"get_person_phone_count"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sql-entity-named-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-entity-named-queries"></a>17.10.2. Named SQL queries selecting entities</h4>
<div class="paragraph">
<p>Considering the following named query:</p>
</div>
<div id="sql-entity-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 581. Single-entity <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_person_by_name"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.id AS \"id\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.name AS \"name\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.nickName AS \"nickName\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.address AS \"address\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.createdOn AS \"createdOn\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   p.version AS \"version\" "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"FROM Person p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"WHERE p.name LIKE :name"</span><span class="pun">,</span><span class="pln">
    resultClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">),</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result set mapping declares the entities retrieved by this native query.
Each field of the entity is bound to an SQL alias (or column name).
All fields of the entity including the ones of subclasses and the foreign key columns of related entities have to be present in the SQL query.
Field definitions are optional provided that they map to the same column name as the one declared on the class property.</p>
</div>
<div class="paragraph">
<p>Executing this named native query can be done as follows:</p>
</div>
<div id="sql-jpa-entity-named-query-example" class="exampleblock">
<div class="title">Example 582. JPA named native entity query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_by_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-named-query-example" class="exampleblock">
<div class="title">Example 583. Hibernate named native entity query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_by_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To join multiple entities, you need to use a <code>SqlResultSetMapping</code> for each entity the SQL query is going to fetch.</p>
</div>
<div id="sql-entity-associations-NamedNativeQuery-example" class="exampleblock">
<div class="title">Example 584. Joined-entities <code>NamedNativeQuery</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_person_with_phones_by_name"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.id AS \"pr.id\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.name AS \"pr.name\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.nickName AS \"pr.nickName\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.address AS \"pr.address\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.createdOn AS \"pr.createdOn\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   pr.version AS \"pr.version\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   ph.id AS \"ph.id\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   ph.person_id AS \"ph.person_id\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   ph.phone_number AS \"ph.number\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"   ph.phone_type AS \"ph.type\" "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"FROM Person pr "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"JOIN Phone ph ON pr.id = ph.person_id "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"WHERE pr.name LIKE :name"</span><span class="pun">,</span><span class="pln">
    resultSetMapping </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_with_phones"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
 </span><span class="lit">@SqlResultSetMapping</span><span class="pun">(</span><span class="pln">
     name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_with_phones"</span><span class="pun">,</span><span class="pln">
     entities </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         </span><span class="lit">@EntityResult</span><span class="pun">(</span><span class="pln">
             entityClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
             fields </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.id"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.name"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nickName"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.nickName"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.address"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"createdOn"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.createdOn"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"version"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pr.version"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
             </span><span class="pun">}</span><span class="pln">
         </span><span class="pun">),</span><span class="pln">
         </span><span class="lit">@EntityResult</span><span class="pun">(</span><span class="pln">
             entityClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Phone</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
             fields </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ph.id"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ph.person_id"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"number"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ph.number"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
                 </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"type"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ph.type"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
             </span><span class="pun">}</span><span class="pln">
         </span><span class="pun">)</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">
 </span><span class="pun">),</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 585. JPA named native entity query with joined associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_with_phones_by_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 586. Hibernate named native entity query with joined associations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_person_with_phones_by_name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"J%"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Phone</span><span class="pln"> phone </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Phone</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Finally, if the association to a related entity involve a composite primary key, a <code>@FieldResult</code> element should be used for each foreign key column.
The <code>@FieldResult</code> name is composed of the property name for the relationship, followed by a dot ("."), followed by the name or the field or property of the primary key.
For this example, the following entities are going to be used:</p>
</div>
<div id="sql-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 587. Entity associations with composite keys and named native queries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Dimensions</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> length</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> width</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Embeddable</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Identity</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastname</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> equals</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> o </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Identity</span><span class="pln"> identity </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Identity</span><span class="pun">)</span><span class="pln"> o</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">firstname</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> identity</span><span class="pun">.</span><span class="pln">firstname </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">lastname</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> identity</span><span class="pun">.</span><span class="pln">lastname </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> firstname</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">();</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="lit">29</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> result </span><span class="pun">+</span><span class="pln"> lastname</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Captain</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@EmbeddedId</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Identity</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@NamedNativeQueries</span><span class="pun">({</span><span class="pln">
    </span><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_all_spaceships"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln">
            </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   name as \"name\", "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   model, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   speed, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   lname as lastn, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   fname as firstn, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   length, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   width, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   length * width as surface, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"   length * width * 10 as volume "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"FROM SpaceShip"</span><span class="pun">,</span><span class="pln">
        resultSetMapping </span><span class="pun">=</span><span class="pln"> </span><span class="str">"spaceship"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@SqlResultSetMapping</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"spaceship"</span><span class="pun">,</span><span class="pln">
    entities </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@EntityResult</span><span class="pun">(</span><span class="pln">
        entityClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SpaceShip</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        fields </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"model"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"model"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"speed"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"speed"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"captain.lastname"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"lastn"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"captain.firstname"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"firstn"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"dimensions.length"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"length"</span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@FieldResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"dimensions.width"</span><span class="pun">,</span><span class="pln"> column </span><span class="pun">=</span><span class="pln"> </span><span class="str">"width"</span><span class="pun">),</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">),</span><span class="pln">
    columns </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"surface"</span><span class="pun">),</span><span class="pln">
        </span><span class="lit">@ColumnResult</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"volume"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SpaceShip</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> model</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> speed</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@JoinColumns</span><span class="pun">({</span><span class="pln">
        </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"fname"</span><span class="pun">,</span><span class="pln"> referencedColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"firstname"</span><span class="pun">),</span><span class="pln">
        </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"lname"</span><span class="pun">,</span><span class="pln"> referencedColumnName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"lastname"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">})</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Captain</span><span class="pln"> captain</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Dimensions</span><span class="pln"> dimensions</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-jpa-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 588. JPA named native entity query with joined associations and composite keys</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_all_spaceships"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">SpaceShip</span><span class="pln"> spaceShip </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">SpaceShip</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> surface </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> volume </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">2</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-composite-key-entity-associations_named-query-example" class="exampleblock">
<div class="title">Example 589. Hibernate named native entity query with joined associations and composite keys</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> tuples </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"find_all_spaceships"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> tuple </span><span class="pun">:</span><span class="pln"> tuples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">SpaceShip</span><span class="pln"> spaceShip </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">SpaceShip</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> surface </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span><span class="pln">
	</span><span class="typ">Number</span><span class="pln"> volume </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> tuple</span><span class="pun">[</span><span class="lit">2</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-global-catalog-schema"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-global-catalog-schema"></a>17.11. Resolving global catalog and schema in native SQL queries</h3>
<div class="paragraph">
<p>When using multiple database catalogs and schemas, Hibernate offers the possibility of
setting a global catalog or schema so that you donâ€™t have to declare it explicitly for every entity.</p>
</div>
<div id="sql-global-catalog-schema-configuration" class="exampleblock">
<div class="title">Example 590. Setting global catalog and schema</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.default_catalog"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"crm"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.default_schema"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"analytics"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way, we can imply the global <strong>crm</strong> catalog and <strong>analytics</strong> schema in every JPQL, HQL or Criteria API query.</p>
</div>
<div class="paragraph">
<p>However, for native queries, the SQL query is passed as is, therefore you need to explicitly set the global catalog and schema whenever you are referencing a database table.
Fortunately, Hibernate allows you to resolve the current global catalog and schema using the following placeholders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">{h-catalog}</dt>
<dd>
<p>resolves the current <code>hibernate.default_catalog</code> configuration property value.</p>
</dd>
<dt class="hdlist1">{h-schema}</dt>
<dd>
<p>resolves the current <code>hibernate.default_schema</code> configuration property value.</p>
</dd>
<dt class="hdlist1">{h-domain}</dt>
<dd>
<p>resolves the current <code>hibernate.default_catalog</code> and <code>hibernate.default_schema</code> configuration property values (e.g. catalog.schema).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With these placeholders, you can imply the catalog, schema, or both catalog and schema for every native query.</p>
</div>
<div class="paragraph">
<p>So, when running the following native query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
    name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"last_30_days_hires"</span><span class="pun">,</span><span class="pln">
    query </span><span class="pun">=</span><span class="pln">
        </span><span class="str">"select * "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"from {h-domain}person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"where age(hired_on) &lt; '30 days'"</span><span class="pun">,</span><span class="pln">
    resultClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hibernate is going to resolve the <code>{h-domain}</code> placeholder according to the values of the default catalog and schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">SELECT </span><span class="pun">*</span><span class="pln">
FROM   crm</span><span class="pun">.</span><span class="pln">analytics</span><span class="pun">.</span><span class="pln">person
WHERE  age</span><span class="pun">(</span><span class="pln">hired_on</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="str">'30 days'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-sp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-sp"></a>17.12. Using stored procedures for querying</h3>
<div class="paragraph">
<p>Hibernate provides support for queries via stored procedures and functions.
A stored procedure arguments are declared using the <code>IN</code> parameter type, and the result can be either marked with an <code>OUT</code>
parameter type, a <code>REF_CURSOR</code> or it could just return the result like a function.</p>
</div>
<div id="sql-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 591. MySQL stored procedure with <code>OUT</code> parameter type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"CREATE PROCEDURE sp_count_phones ("</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"   IN personId INT, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"   OUT phoneCount INT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">") "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"BEGIN "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    SELECT COUNT(*) INTO phoneCount "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    FROM Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    WHERE p.person_id = personId; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"END"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use this stored procedure, you can execute the following JPA 2.1 query:</p>
</div>
<div id="sql-jpa-call-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 592. Calling a MySQL stored procedure with <code>OUT</code> parameter type using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StoredProcedureQuery</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createStoredProcedureQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_count_phones"</span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">registerStoredProcedureParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"personId"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN</span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">registerStoredProcedureParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneCount"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">OUT</span><span class="pun">);</span><span class="pln">

query</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"personId"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">);</span><span class="pln">

query</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> phoneCount </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> query</span><span class="pun">.</span><span class="pln">getOutputParameterValue</span><span class="pun">(</span><span class="str">"phoneCount"</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-out-mysql-example" class="exampleblock">
<div class="title">Example 593. Calling a MySQL stored procedure with <code>OUT</code> parameter type using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ProcedureCall</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createStoredProcedureCall</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_count_phones"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
call</span><span class="pun">.</span><span class="pln">registerParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"personId"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN </span><span class="pun">).</span><span class="pln">bindValue</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
call</span><span class="pun">.</span><span class="pln">registerParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneCount"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">OUT </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Long</span><span class="pln"> phoneCount </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Long</span><span class="pun">)</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">getOutputs</span><span class="pun">().</span><span class="pln">getOutputParameterValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"phoneCount"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> phoneCount </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the stored procedure outputs the result directly without an <code>OUT</code> parameter type:</p>
</div>
<div id="sql-sp-mysql-return-no-out-example" class="exampleblock">
<div class="title">Example 594. MySQL stored procedure without an <code>OUT</code> parameter type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"CREATE PROCEDURE sp_phones(IN personId INT) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"BEGIN "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    SELECT *  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    FROM Phone   "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    WHERE person_id = personId;  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"END"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can retrieve the results of the aforementioned MySQL stored procedure as follows:</p>
</div>
<div id="sql-jpa-call-sp-no-out-mysql-example" class="exampleblock">
<div class="title">Example 595. Calling a MySQL stored procedure and fetching the result set without an <code>OUT</code> parameter type using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StoredProcedureQuery</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createStoredProcedureQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_phones"</span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">registerStoredProcedureParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN</span><span class="pun">);</span><span class="pln">

query</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personComments </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-no-out-mysql-example" class="exampleblock">
<div class="title">Example 596. Calling a MySQL stored procedure and fetching the result set without an <code>OUT</code> parameter type using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ProcedureCall</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createStoredProcedureCall</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_phones"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
call</span><span class="pun">.</span><span class="pln">registerParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN </span><span class="pun">).</span><span class="pln">bindValue</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Output</span><span class="pln"> output </span><span class="pun">=</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">getOutputs</span><span class="pun">().</span><span class="pln">getCurrent</span><span class="pun">();</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> personComments </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ResultSetOutput</span><span class="pun">)</span><span class="pln"> output </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For a <code>REF_CURSOR</code> result sets, weâ€™ll consider the following Oracle stored procedure:</p>
</div>
<div id="sql-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 597. Oracle <code>REF_CURSOR</code> stored procedure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"CREATE OR REPLACE PROCEDURE sp_person_phones ( "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"   personId IN NUMBER, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"   personPhones OUT SYS_REFCURSOR ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"AS  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"BEGIN "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    OPEN personPhones FOR "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    SELECT *"</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    FROM phone "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    WHERE person_id = personId; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"END;"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>REF_CURSOR</code> result sets are only supported by Oracle and PostgreSQL because other database systems JDBC drivers donâ€™t support this feature.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This function can be called using the standard Java Persistence API:</p>
</div>
<div id="sql-jpa-call-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 598. Calling an Oracle <code>REF_CURSOR</code> stored procedure using JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">StoredProcedureQuery</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createStoredProcedureQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">registerStoredProcedureParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN </span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">registerStoredProcedureParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">REF_CURSOR </span><span class="pun">);</span><span class="pln">
query</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

query</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> postComments </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div id="sql-hibernate-call-sp-ref-cursor-oracle-example" class="exampleblock">
<div class="title">Example 599. Calling an Oracle <code>REF_CURSOR</code> stored procedure using Hibernate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">

</span><span class="typ">ProcedureCall</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createStoredProcedureCall</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pun">);</span><span class="pln">
call</span><span class="pun">.</span><span class="pln">registerParameter</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN</span><span class="pun">).</span><span class="pln">bindValue</span><span class="pun">(</span><span class="lit">1L</span><span class="pun">);</span><span class="pln">
call</span><span class="pun">.</span><span class="pln">registerParameter</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">REF_CURSOR</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Output</span><span class="pln"> output </span><span class="pun">=</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">getOutputs</span><span class="pun">().</span><span class="pln">getCurrent</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> postComments </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ResultSetOutput</span><span class="pun">)</span><span class="pln"> output </span><span class="pun">).</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> postComments</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the database defines an SQL function:</p>
</div>
<div id="sql-function-mysql-example" class="exampleblock">
<div class="title">Example 600. MySQL function</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"CREATE FUNCTION fn_count_phones(personId integer)  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"RETURNS integer "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"DETERMINISTIC "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"READS SQL DATA "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"BEGIN "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    DECLARE phoneCount integer; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    SELECT COUNT(*) INTO phoneCount "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    FROM Phone p "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    WHERE p.person_id = personId; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"    RETURN phoneCount; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"END"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because the current <code>StoredProcedureQuery</code> implementation doesnâ€™t yet support SQL functions,
we need to use the JDBC syntax.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This limitation is acknowledged and will be addressed by the <a href="https://hibernate.atlassian.net/browse/HHH-10530">HHH-10530</a> issue.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="sql-call-function-mysql-example" class="exampleblock">
<div class="title">Example 601. Calling a MySQL function</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">final</span><span class="pln"> </span><span class="typ">AtomicReference</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> phoneCount </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AtomicReference</span><span class="pun">&lt;&gt;();</span><span class="pln">
</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">doWork</span><span class="pun">(</span><span class="pln"> connection </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">CallableStatement</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> connection</span><span class="pun">.</span><span class="pln">prepareCall</span><span class="pun">(</span><span class="pln">
            </span><span class="str">"{ ? = call fn_count_phones(?) }"</span><span class="pln"> </span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">.</span><span class="pln">registerOutParameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Types</span><span class="pun">.</span><span class="pln">INTEGER </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">.</span><span class="pln">setInt</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">();</span><span class="pln">
        phoneCount</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">.</span><span class="pln">getInt</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Stored procedure queries cannot be paged with <code>setFirstResult()/setMaxResults()</code>.</p>
</div>
<div class="paragraph">
<p>Since these servers can return multiple result sets and update counts,
Hibernate will iterate the results and take the first result that is a result set as its return value, so everything else will be discarded.</p>
</div>
<div class="paragraph">
<p>For SQL Server, if you can enable <code>SET NOCOUNT ON</code> in your procedure it will probably be more efficient, but this is not a requirement.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="sql-sp-named-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-sp-named-query"></a>17.13. Using named queries to call stored procedures</h3>
<div class="paragraph">
<p>Just like with SQL statements, you can also use named queries to call stored procedures.
For this purpose, JPA defines the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedStoredProcedureQuery.html"><code>@NamedStoredProcedureQuery</code></a> annotation.</p>
</div>
<div id="sql-sp-ref-cursor-oracle-named-query-example" class="exampleblock">
<div class="title">Example 602. Oracle <code>REF_CURSOR</code> named query stored procedure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NamedStoredProcedureQueries</span><span class="pun">(</span><span class="pln">
    </span><span class="lit">@NamedStoredProcedureQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pun">,</span><span class="pln">
        procedureName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pun">,</span><span class="pln">
        parameters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">
                name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"personId"</span><span class="pun">,</span><span class="pln">
                type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                mode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">IN
            </span><span class="pun">),</span><span class="pln">
            </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">
                name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"personPhones"</span><span class="pun">,</span><span class="pln">
                type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                mode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span class="pun">.</span><span class="pln">REF_CURSOR
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Calling this stored procedure is straightforward, as illustrated by the following example.</p>
</div>
<div id="sql-jpa-call-sp-ref-cursor-oracle-named-query-example" class="exampleblock">
<div class="title">Example 603. Calling an Oracle <code>REF_CURSOR</code> stored procedure using a JPA named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> postComments </span><span class="pun">=</span><span class="pln"> entityManager
</span><span class="pun">.</span><span class="pln">createNamedStoredProcedureQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"sp_person_phones"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"personId"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sql-crud"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-crud"></a>17.14. Custom SQL for CRUD (Create, Read, Update and Delete)</h3>
<div class="paragraph">
<p>Hibernate can use custom SQL for CRUD operations.
The SQL can be overridden at the statement level or individual column level.
This section describes statement overrides.
For columns, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write">Column transformers: read and write expressions</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to define custom SQL operations using annotations.
<code>@SQLInsert</code>, <code>@SQLUpdate</code>, and <code>@SQLDelete</code> override the INSERT, UPDATE, DELETE statements of a given entity.
For the SELECT clause, a <code>@Loader</code> must be defined along with a <code>@NamedNativeQuery</code> used for loading the underlying table record.</p>
</div>
<div class="paragraph">
<p>For collections, Hibernate allows defining a custom <code>@SQLDeleteAll</code> which is used for removing all child records associated with a given parent entity.
To filter collections, the <code>@Where</code> annotation allows customizing the underlying SQL WHERE clause.</p>
</div>
<div id="sql-custom-crud-example" class="exampleblock">
<div class="title">Example 604. Custom CRUD</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLInsert</span><span class="pun">(</span><span class="pln">
	sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"INSERT INTO person (name, id, valid) VALUES (?, ?, true) "</span><span class="pun">,</span><span class="pln">
	check </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ResultCheckStyle</span><span class="pun">.</span><span class="pln">COUNT
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLUpdate</span><span class="pun">(</span><span class="pln">
	sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE person SET name = ? where id = ? "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLDelete</span><span class="pun">(</span><span class="pln">
	sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE person SET valid = false WHERE id = ? "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Loader</span><span class="pun">(</span><span class="pln">namedQuery </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_valid_person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NamedNativeQueries</span><span class="pun">({</span><span class="pln">
	</span><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_valid_person"</span><span class="pun">,</span><span class="pln">
		query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SELECT id, name "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
				</span><span class="str">"FROM person "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
				</span><span class="str">"WHERE id = ? and valid = true"</span><span class="pun">,</span><span class="pln">
		resultClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@SQLInsert</span><span class="pun">(</span><span class="pln">
		sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"INSERT INTO person_phones (person_id, phones, valid) VALUES (?, ?, true) "</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@SQLDeleteAll</span><span class="pun">(</span><span class="pln">
		sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE person_phones SET valid = false WHERE person_id = ?"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Where</span><span class="pun">(</span><span class="pln"> clause </span><span class="pun">=</span><span class="pln"> </span><span class="str">"valid = true"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> phones </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the entity is mapped so that entries are soft-deleted (the records are not removed from the database, but instead, a flag marks the row validity).
The <code>Person</code> entity benefits from custom INSERT, UPDATE, and DELETE statements which update the <code>valid</code> column accordingly.
The custom <code>@Loader</code> is used to retrieve only <code>Person</code> rows that are valid.</p>
</div>
<div class="paragraph">
<p>The same is done for the <code>phones</code> collection. The <code>@SQLDeleteAll</code> and the <code>SQLInsert</code> queries are used whenever the collection is modified.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also call a store procedure using the custom CRUD statements.
The only requirement is to set the <code>callable</code> attribute to <code>true</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To check that the execution happens correctly, Hibernate allows you to define one of those three strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none: no check is performed; the store procedure is expected to fail upon constraint violations</p>
</li>
<li>
<p>count: use of row-count returned by the <code>executeUpdate()</code> method call to check that the update was successful</p>
</li>
<li>
<p>param: like count but using a <code>CallableStatement</code> output parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define the result check style, use the <code>check</code> parameter.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The parameter order is important and is defined by the order Hibernate handles properties.
You can see the expected order by enabling debug logging, so Hibernate can print out the static SQL that is used to create, update, delete etc. entities.</p>
</div>
<div class="paragraph">
<p>To see the expected sequence, remember to not include your custom SQL through annotations or mapping files as that will override the Hibernate generated static sql.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Overriding SQL statements for secondary tables is also possible using <code>@org.hibernate.annotations.Table</code> and the <code>sqlInsert</code>, <code>sqlUpdate</code>, <code>sqlDelete</code> attributes.</p>
</div>
<div id="sql-custom-crud-secondary-table-example" class="exampleblock">
<div class="title">Example 605. Overriding SQL statements for secondary tables</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLInsert</span><span class="pun">(</span><span class="pln">
    sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"INSERT INTO person (name, id, valid) VALUES (?, ?, true) "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SQLDelete</span><span class="pun">(</span><span class="pln">
    sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE person SET valid = false WHERE id = ? "</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@SecondaryTable</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_details"</span><span class="pun">,</span><span class="pln">
    pkJoinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@PrimaryKeyJoinColumn</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_id"</span><span class="pun">))</span><span class="pln">
</span><span class="lit">@org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="typ">Table</span><span class="pun">(</span><span class="pln">
    appliesTo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_details"</span><span class="pun">,</span><span class="pln">
    sqlInsert </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@SQLInsert</span><span class="pun">(</span><span class="pln">
        sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"INSERT INTO person_details (image, person_id, valid) VALUES (?, ?, true) "</span><span class="pun">,</span><span class="pln">
        check </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ResultCheckStyle</span><span class="pun">.</span><span class="pln">COUNT
    </span><span class="pun">),</span><span class="pln">
    sqlDelete </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@SQLDelete</span><span class="pun">(</span><span class="pln">
        sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE person_details SET valid = false WHERE person_id = ? "</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Loader</span><span class="pun">(</span><span class="pln">namedQuery </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_valid_person"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NamedNativeQueries</span><span class="pun">({</span><span class="pln">
    </span><span class="lit">@NamedNativeQuery</span><span class="pun">(</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"find_valid_person"</span><span class="pun">,</span><span class="pln">
        query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SELECT "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"    p.id, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"    p.name, "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"    pd.image  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"FROM person p  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"LEFT OUTER JOIN person_details pd ON p.id = pd.person_id  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                </span><span class="str">"WHERE p.id = ? AND p.valid = true AND pd.valid = true"</span><span class="pun">,</span><span class="pln">
        resultClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="lit">@GeneratedValue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"image"</span><span class="pun">,</span><span class="pln"> table </span><span class="pun">=</span><span class="pln"> </span><span class="str">"person_details"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> image</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SQL is directly executed in your database, so you can use any dialect you like.
This will, however, reduce the portability of your mapping if you use database-specific SQL.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also use stored procedures for customizing the CRUD statements.</p>
</div>
<div class="paragraph">
<p>Assuming the following stored procedure:</p>
</div>
<div id="sql-sp-soft-delete-example" class="exampleblock">
<div class="title">Example 606. Oracle stored procedure to soft-delete a given entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">statement</span><span class="pun">.</span><span class="pln">executeUpdate</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"CREATE OR REPLACE PROCEDURE sp_delete_person ( "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"   personId IN NUMBER ) "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"AS  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"BEGIN "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"    UPDATE person SET valid = 0 WHERE id = personId; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"END;"</span><span class="pln">
</span><span class="pun">);}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The entity can use this stored procedure to soft-delete the entity in question:</p>
</div>
<div id="sql-sp-custom-crud-example" class="exampleblock">
<div class="title">Example 607. Customizing the entity delete statement to use the Oracle stored procedure= instead</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@SQLDelete</span><span class="pun">(</span><span class="pln">
	sql </span><span class="pun">=</span><span class="pln">   </span><span class="str">"{ call sp_delete_person( ? ) } "</span><span class="pun">,</span><span class="pln">
	callable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to set the <code>callable</code> attribute when using a stored procedure instead of an SQL statement.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial"></a>18. Spatial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spatial-overview"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-overview"></a>18.1. Overview</h3>
<div class="paragraph">
<p>Hibernate Spatial was originally developed as a generic extension to Hibernate for handling geographic data.
Since 5.0, Hibernate Spatial is now part of the Hibernate ORM project,
and it allows you to deal with geographic data in a standardized way.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial provides a standardized, cross-database interface to geographic data storage and query functions.
It supports most of the functions described by the OGC Simple Feature Specification. Supported databases are Oracle 10g/11g,
PostgreSQL/PostGIS, MySQL, Microsoft SQL Server and H2/GeoDB.</p>
</div>
<div class="paragraph">
<p>Spatial data types are not part of the Java standard library, and they are absent from the JDBC specification.
Over the years <a href="http://tsusiatsoftware.net/jts/main.html">JTS</a> has emerged the <em>de facto</em> standard to fill this gap. JTS is
an implementation of the <a href="https://portal.opengeospatial.org/files/?artifact_id=829">Simple Feature Specification (SFS)</a>. Many databases
on the other hand implement the SQL/MM - Part 3: Spatial Data specification - a related, but broader specification. The biggest difference is that
SFS is limited to 2D geometries in the projected plane (although JTS supports 3D coordinates), whereas
SQL/MM supports 2-, 3- or 4-dimensional coordinate spaces.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial supports two different geometry models: <a href="http://tsusiatsoftware.net/jts/main.html">JTS</a> and
<a href="https://github.com/GeoLatte/geolatte-geom">geolatte-geom</a>. As already mentioned, JTS is the <em>de facto</em>
standard. Geolatte-geom (also written by the lead developer of Hibernate Spatial) is a more recent library that
supports many features specified in SQL/MM but not available in JTS (such as support for 4D geometries, and support for extended WKT/WKB formats).
Geolatte-geom also implements encoders/decoders for the database native types. Geolatte-geom has good interoperability with
JTS. Converting a Geolatte <code>geometry</code> to a JTS `geometry, for instance, doesnâ€™t require copying of the coordinates.
It also delegates spatial processing to JTS.</p>
</div>
<div class="paragraph">
<p>Whether you use JTS or Geolatte-geom, Hibernate spatial maps the database spatial types to your geometry model of choice. It will, however,
always use Geolatte-geom to decode the database native types.</p>
</div>
<div class="paragraph">
<p>Hibernate Spatial also makes a number of spatial functions available in HQL and in the Criteria Query API. These functions are
specified in both SQL/MM as SFS, and are commonly implemented in databases with spatial support (see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-configuration-dialect-features">Hibernate Spatial dialect function support</a>)</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-configuration"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-configuration"></a>18.2. Configuration</h3>
<div class="paragraph">
<p>Hibernate Spatial requires some configuration prior to start using it.</p>
</div>
<div class="sect3">
<h4 id="spatial-configuration-dependency"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-configuration-dependency"></a>18.2.1. Dependency</h4>
<div class="paragraph">
<p>You need to include the <code>hibernate-spatial</code> dependency in your build environment.
For Maven, you need to add the following dependency:</p>
</div>
<div id="spatial-configuration-maven-example" class="exampleblock">
<div class="title">Example 608. Maven dependency</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-spatial</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">${hibernate.version}</span><span class="tag">&lt;/version&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spatial-configuration-dialect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-configuration-dialect"></a>18.2.2. Dialects</h4>
<div class="paragraph">
<p>Hibernate Spatial extends the Hibernate ORM dialects so that the spatial functions of the database are made available within HQL and JPQL.
So, for instance, instead of using the <code>PostgreSQL82Dialect</code>, we use the Hibernate Spatial extension of that dialect which is the <code>PostgisDialect</code>.</p>
</div>
<div id="spatial-configuration-dialect-example" class="exampleblock">
<div class="title">Example 609. Specifying a spatial dialect</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.dialect"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.spatial.dialect.postgis.PostgisDialect"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Not all databases support all the functions defined by Hibernate Spatial.
The table below provides an overview of the functions provided by each database. If the function is defined in the
<a href="https://portal.opengeospatial.org/files/?artifact_id=829">Simple Feature Specification</a>, the description references the
relevant section.</p>
</div>
<table id="spatial-configuration-dialect-features" class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Hibernate Spatial dialect function support</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgresSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle 10g/11g</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQLServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GeoDB (H2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic functions on Geometry</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int dimension(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String geometrytype(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int srid(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry envelope(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String astext(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[] asbinary(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean isempty(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean issimple(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry boundary(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions for testing Spatial Relations between geometric objects</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean equals(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean disjoint(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean intersects(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean touches(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean crosses(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean within(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean contains(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean overlaps(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean relate(Geometry, Geometry, String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions that support Spatial Analysis</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double distance(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry buffer(Geometry, double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry convexhull(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry intersection(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry geomunion(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3 (renamed from union)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry difference(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry symdifference(Geometry, Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFS Â§2.1.1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span><sup>(1)</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common non-SFS functions</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean dwithin(Geometry, Geometry, double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the geometries are within the specified distance of one another</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry transform(Geometry, int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a new geometry with its coordinates transformed to the SRID referenced by the integer parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spatial aggregate Functions</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Geometry extent(Geometry)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a bounding box that bounds the set of returned geometries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon green"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon red"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>(1)</sup> Argument Geometries need to have the same dimensionality.</p>
</div>
<div id="spatial-configuration-dialect-postgis" class="dlist">
<dl>
<dt class="hdlist1">Postgis</dt>
<dd>
<p>For Postgis from versions 1.3 and later, the best dialect to use is <code>org.hibernate.spatial.dialect.postgis.PostgisDialect</code>.</p>
<div class="paragraph">
<p>This translates the HQL spatial functions to the Postgis SQL/MM-compliant functions.
For older, pre v1.3 versions of Postgis, which are not SQL/MM compliant, the dialect <code>org.hibernate.spatial.dialect.postgis.PostgisNoSQLMM</code> is provided.</p>
</div>
</dd>
</dl>
</div>
<div id="spatial-configuration-dialect-mysql" class="dlist">
<dl>
<dt class="hdlist1">MySQL</dt>
<dd>
<p>There are several dialects for MySQL:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MySQLSpatialDialect</code></dt>
<dd>
<p>a spatially-extended version of Hibernate <code>MySQLDialect</code></p>
</dd>
<dt class="hdlist1"><code>MySQL5SpatialDialect</code></dt>
<dd>
<p>a spatially-extended version of Hibernate <code>MySQL5Dialect</code></p>
</dd>
<dt class="hdlist1"><code>MySQLSpatial56Dialect</code></dt>
<dd>
<p>a spatially-extended version of Hibernate <code>MySQL55Dialect</code>.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>MySQL versions before 5.6.1 had only limited support for spatial operators.
Most operators only took account of the minimum bounding rectangles (MBR) of the geometries, and not the geometries themselves.</p>
</div>
<div class="paragraph">
<p>This changed in version 5.6.1, when MySQL introduced <code>ST_*</code> spatial operators.
The dialect <code>MySQLSpatial56Dialect</code> uses these newer, more precise operators.</p>
</div>
<div class="paragraph">
<p>These dialects may, therefore, produce results that differ from that of the other spatial dialects.</p>
</div>
<div class="paragraph">
<p>For more information, see this page in the MySQL reference guide (esp. the section <a href="https://dev.mysql.com/doc/refman/5.7/en/spatial-relation-functions.html">Functions That Test Spatial Relations Between Geometry Objects</a>)</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="spatial-configuration-dialect-oracle" class="dlist">
<dl>
<dt class="hdlist1">Oracle10g/11g</dt>
<dd>
<p>There is currently only one Oracle spatial dialect: <code>OracleSpatial10gDialect</code> which extends the Hibernate dialect <code>Oracle10gDialect</code>.
This dialect has been tested on both Oracle 10g and Oracle 11g with the <code>SDO_GEOMETRY</code> spatial database type.</p>
<div class="paragraph">
<p>This dialect can be configured using the Hibernate property:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hibernate.spatial.connection_finder</code></dt>
<dd>
<p>the fully-qualified class name for the implementation of the <code>ConnectionFinder</code> to use (see below).</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">The <code>ConnectionFinder</code> interface</div>
<div class="paragraph">
<p>The <code>SDOGeometryType</code> requires access to an <code>OracleConnection</code> object when converting a geometry to SDO_GEOMETRY.
In some environments, however, the <code>OracleConnection</code> is not available (e.g. because a Java EE container or connection pool proxy wraps the connection object in its own <code>Connection</code> implementation).
A <code>ConnectionFinder</code> knows how to retrieve the <code>OracleConnection</code> from the wrapper or proxy Connection object that is passed into prepared statements.</p>
</div>
<div class="paragraph">
<p>When the passed object is not already an <code>OracleConnection</code>, the default implementation will attempt to retrieve the <code>OracleConnection</code> by recursive reflection.
It will search for methods that return <code>Connection</code> objects, execute these methods and check the result.
If the result is of type <code>OracleConnection</code> the object is returned.
Otherwise, it recurses on it.</p>
</div>
<div class="paragraph">
<p>In may cases, this strategy will suffice.
If not, you can provide your own implementation of this interface on the classpath, and configure it in the <code>hibernate.spatial.connection_finder</code> property.
Note that implementations must be thread-safe and have a default no-args constructor.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SQL Server</dt>
<dd>
<p>The dialect <code>SqlServer2008Dialect</code> supports the <code>GEOMETRY</code> type in SQL Server 2008 and later.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>GEOGRAPHY</code> type is not currently supported.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GeoDB (H2)</dt>
<dd>
<p>The <code>GeoDBDialect</code> supports the GeoDB a spatial extension of the H2 in-memory database.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The dialect has been tested with GeoDB version 0.7</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DB2</dt>
<dd>
<p>The <code>DB2SpatialDialect</code> supports the spatial extensions of the DB2 LUW database.
The dialect has been tested with DB2 LUW 11.1.
The dialect does not support DB2 for z/OS or DB2 column-oriented databases.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to use the DB2 Hibernate Spatial capabilities, it is necessary to first execute the following
SQL statements which will allow DB2 to accept Extended WellKnown Text (EWKT) data and return EWKT data.
One way to do this is to copy these statements into a file such as ewkt.sql and execute it in a DB2 command window
with a command like 'db2 -tvf ewkt.sql'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create </span><span class="kwd">or</span><span class="pln"> replace </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">asewkt</span><span class="pun">(</span><span class="pln">geometry db2gse</span><span class="pun">.</span><span class="pln">st_geometry</span><span class="pun">)</span><span class="pln">
returns clob</span><span class="pun">(</span><span class="lit">2G</span><span class="pun">)</span><span class="pln">
specific db2gse</span><span class="pun">.</span><span class="pln">asewkt1
language sql
deterministic
</span><span class="kwd">no</span><span class="pln"> external action
reads sql data
</span><span class="kwd">return</span><span class="pln"> </span><span class="str">'srid='</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> varchar</span><span class="pun">(</span><span class="pln">db2gse</span><span class="pun">.</span><span class="pln">st_srsid</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">))</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="str">';'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">st_astext</span><span class="pun">(</span><span class="pln">geometry</span><span class="pun">);</span><span class="pln">

create </span><span class="kwd">or</span><span class="pln"> replace </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">geomfromewkt</span><span class="pun">(</span><span class="pln">instring varchar</span><span class="pun">(</span><span class="lit">32000</span><span class="pun">))</span><span class="pln">
returns db2gse</span><span class="pun">.</span><span class="pln">st_geometry
specific db2gse</span><span class="pun">.</span><span class="pln">fromewkt1
language sql
deterministic
</span><span class="kwd">no</span><span class="pln"> external action
reads sql data
</span><span class="kwd">return</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">st_geometry</span><span class="pun">(</span><span class="pln">
substr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="pln">posstr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="str">';'</span><span class="pun">)+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> length</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> posstr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="str">';'</span><span class="pun">)),</span><span class="pln">
integer</span><span class="pun">(</span><span class="pln">substr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="pln">posstr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="str">'='</span><span class="pun">)+</span><span class="lit">1</span><span class="pun">,</span><span class="pln">posstr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="str">';'</span><span class="pun">)-(</span><span class="pln">posstr</span><span class="pun">(</span><span class="pln">instring</span><span class="pun">,</span><span class="str">'='</span><span class="pun">)+</span><span class="lit">1</span><span class="pun">))));</span><span class="pln">

create transform </span><span class="kwd">for</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">st_geometry ewkt </span><span class="pun">(</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> sql </span><span class="kwd">with</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">asewkt</span><span class="pun">(</span><span class="pln">db2gse</span><span class="pun">.</span><span class="pln">st_geometry</span><span class="pun">),</span><span class="pln">
 to   sql </span><span class="kwd">with</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">geomfromewkt</span><span class="pun">(</span><span class="pln">varchar</span><span class="pun">(</span><span class="lit">32000</span><span class="pun">))</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

drop transform db2_program </span><span class="kwd">for</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">st_geometry</span><span class="pun">;</span><span class="pln">
create transform </span><span class="kwd">for</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">st_geometry db2_program </span><span class="pun">(</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> sql </span><span class="kwd">with</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">asewkt</span><span class="pun">(</span><span class="pln">db2gse</span><span class="pun">.</span><span class="pln">st_geometry</span><span class="pun">),</span><span class="pln">
 to   sql </span><span class="kwd">with</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> db2gse</span><span class="pun">.</span><span class="pln">geomfromewkt</span><span class="pun">(</span><span class="pln">varchar</span><span class="pun">(</span><span class="lit">32000</span><span class="pun">))</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spatial-types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#spatial-types"></a>18.3. Types</h3>
<div class="paragraph">
<p>Hibernate Spatial comes with the following types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">jts_geometry</dt>
<dd>
<p>Handled by <code>org.hibernate.spatial.JTSGeometryType</code> it maps a database geometry column type to a <code>com.vividsolutions.jts.geom.Geometry</code> entity property type.</p>
</dd>
<dt class="hdlist1">geolatte_geometry</dt>
<dd>
<p>Handled by <code>org.hibernate.spatial.GeolatteGeometryType</code>, it maps a database geometry column type to an <code>org.geolatte.geom.Geometry</code> entity property type.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It suffices to declare a property as either a JTS or a Geolatte-geom <code>Geometry</code> and Hibernate Spatial will map it using the
relevant type.</p>
</div>
<div class="paragraph">
<p>Here is an example using JTS:</p>
</div>
<div id="spatial-types-mapping-example" class="exampleblock">
<div class="title">Example 610. Type mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">vividsolutions</span><span class="pun">.</span><span class="pln">jts</span><span class="pun">.</span><span class="pln">geom</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Event"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> location</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We can now treat spatial geometries like any other type.</p>
</div>
<div id="spatial-types-point-creation-example" class="exampleblock">
<div class="title">Example 611. Creating a Point</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Hibernate ORM presentation"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Point</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> geometryFactory</span><span class="pun">.</span><span class="pln">createPoint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Coordinate</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">setLocation</span><span class="pun">(</span><span class="pln"> point </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Spatial Dialects defines many query functions that are available both in HQL and JPQL queries. Below we show how we
could use the <code>within</code> function to find all objects within a given spatial extent or window.</p>
</div>
<div id="spatial-types-query-example" class="exampleblock">
<div class="title">Example 612. Querying the geometry</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="typ">Polygon</span><span class="pln"> window </span><span class="pun">=</span><span class="pln"> geometryFactory</span><span class="pun">.</span><span class="pln">createPolygon</span><span class="pun">(</span><span class="pln"> coordinates </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Event</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
    </span><span class="str">"select e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"from Event e "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
    </span><span class="str">"where within(e.location, :window) = true"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="str">"window"</span><span class="pun">,</span><span class="pln"> window</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multitenacy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy"></a>19. Multitenancy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="multitenacy-intro"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-intro"></a>19.1. What is multitenancy?</h3>
<div class="paragraph">
<p>The term multitenancy, in general, is applied to software development to indicate an architecture in which a single running instance of an application simultaneously serves multiple clients (tenants).
This is highly common in SaaS solutions.
Isolating information (data, customizations, etc.) pertaining to the various tenants is a particular challenge in these systems.
This includes the data owned by each tenant stored in the database.
It is this last piece, sometimes called multitenant data, on which we will focus.</p>
</div>
</div>
<div class="sect2">
<h3 id="multitenacy-approaches"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-approaches"></a>19.2. Multitenant data approaches</h3>
<div class="paragraph">
<p>There are three main approaches to isolating information in these multitenant systems which go hand-in-hand with different database schema definitions and JDBC setups.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each approach has pros and cons as well as specific techniques and considerations.
Such topics are beyond the scope of this documentation.
Many resources exist which delve into these other topics, like <a href="http://msdn.microsoft.com/en-us/library/aa479086.aspx">this one</a> which does a great job of covering these topics.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="multitenacy-separate-database"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-separate-database"></a>19.2.1. Separate database</h4>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/multitenacy_database.png" alt="multitenacy database"></span></p>
</div>
<div class="paragraph">
<p>Each tenantâ€™s data is kept in a physically separate database instance.
JDBC Connections would point specifically to each database so any pooling would be per-tenant.
A general application approach, here, would be to define a JDBC Connection pool per-tenant and to select the pool to use based on the <em>tenant identifier</em> associated with the currently logged in user.</p>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-separate-schema"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-separate-schema"></a>19.2.2. Separate schema</h4>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/multitenacy_schema.png" alt="multitenacy schema"></span></p>
</div>
<div class="paragraph">
<p>Each tenantâ€™s data is kept in a distinct database schema on a single database instance.
There are two different ways to define JDBC Connections here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connections could point specifically to each schema as we saw with the <code>Separate database</code> approach.
This is an option provided that the driver supports naming the default schema in the connection URL or if the pooling mechanism supports naming a schema to use for its Connections.
Using this approach, we would have a distinct JDBC Connection pool per-tenant where the pool to use would be selected based on the "tenant identifier" associated with the currently logged in user.</p>
</li>
<li>
<p>Connections could point to the database itself (using some default schema) but the Connections would be altered using the SQL <code>SET SCHEMA</code> (or similar) command.
Using this approach, we would have a single JDBC Connection pool for use to service all tenants, but before using the Connection, it would be altered to reference the schema named by the "tenant identifier" associated with the currently logged in user.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multitenacy-discriminator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-discriminator"></a>19.3. Partitioned (discriminator) data</h3>
<div class="paragraph">
<p><span class="image"><img src="./Hibernate ORM 5.3.18.Final User Guide_files/multitenacy_discriminator.png" alt="multitenacy discriminator"></span></p>
</div>
<div class="paragraph">
<p>All data is kept in a single database schema.
The data for each tenant is partitioned by the use of partition value or discriminator.
The complexity of this discriminator might range from a simple column value to a complex SQL formula.
Again, this approach would use a single Connection pool to service all tenants.
However, in this approach, the application needs to alter each and every SQL statement sent to the database to reference the "tenant identifier" discriminator.</p>
</div>
</div>
<div class="sect2">
<h3 id="multitenacy-hibernate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-hibernate"></a>19.4. Multitenancy in Hibernate</h3>
<div class="paragraph">
<p>Using Hibernate with multitenant data comes down to both an API and then integration piece(s).
As usual, Hibernate strives to keep the API simple and isolated from any underlying integration complexities.
The API is really just defined by passing the tenant identifier as part of opening any session.</p>
</div>
<div id="multitenacy-hibernate-session-example" class="exampleblock">
<div class="title">Example 613. Specifying tenant identifier from <code>SessionFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doInSession</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> tenant</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Consumer</span><span class="pun">&lt;</span><span class="typ">Session</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">Transaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        session </span><span class="pun">=</span><span class="pln"> sessionFactory
            </span><span class="pun">.</span><span class="pln">withOptions</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">tenantIdentifier</span><span class="pun">(</span><span class="pln"> tenant </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
        txn </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">getTransaction</span><span class="pun">();</span><span class="pln">
        txn</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">session</span><span class="pun">);</span><span class="pln">
        txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Throwable</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> txn </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> txn</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">session </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            session</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Additionally, when specifying the configuration, an <code>org.hibernate.MultiTenancyStrategy</code> should be named using the <code>hibernate.multiTenancy</code> setting.
Hibernate will perform validations based on the type of strategy you specify.
The strategy here correlates with the isolation approach discussed above.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NONE</dt>
<dd>
<p>(the default) No multitenancy is expected.
In fact, it is considered an error if a tenant identifier is specified when opening a session using this strategy.</p>
</dd>
<dt class="hdlist1">SCHEMA</dt>
<dd>
<p>Correlates to the separate schema approach.
It is an error to attempt to open a session without a tenant identifier using this strategy.
Additionally, a <code>MultiTenantConnectionProvider</code> must be specified.</p>
</dd>
<dt class="hdlist1">DATABASE</dt>
<dd>
<p>Correlates to the separate database approach.
It is an error to attempt to open a session without a tenant identifier using this strategy.
Additionally, a <code>MultiTenantConnectionProvider</code> must be specified.</p>
</dd>
<dt class="hdlist1">DISCRIMINATOR</dt>
<dd>
<p>Correlates to the partitioned (discriminator) approach.
It is an error to attempt to open a session without a tenant identifier using this strategy.
This strategy is not yet implemented and you can follow its progress via the <a href="https://hibernate.atlassian.net/browse/HHH-6054">HHH-6054 Jira issue</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-MultiTenantConnectionProvider"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-hibernate-MultiTenantConnectionProvider"></a>19.4.1. MultiTenantConnectionProvider</h4>
<div class="paragraph">
<p>When using either the DATABASE or SCHEMA approach, Hibernate needs to be able to obtain Connections in a tenant-specific manner.</p>
</div>
<div class="paragraph">
<p>That is the role of the <code>MultiTenantConnectionProvider</code> contract.
Application developers will need to provide an implementation of this contract.</p>
</div>
<div class="paragraph">
<p>Most of its methods are extremely self-explanatory.
The only ones which might not be are <code>getAnyConnection</code> and <code>releaseAnyConnection</code>.
It is important to note also that these methods do not accept the tenant identifier.
Hibernate uses these methods during startup to perform various configuration, mainly via the <code>java.sql.DatabaseMetaData</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>MultiTenantConnectionProvider</code> to use can be specified in a number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>hibernate.multi_tenant_connection_provider</code> setting.
It could name a <code>MultiTenantConnectionProvider</code> instance, a <code>MultiTenantConnectionProvider</code> implementation class reference or a <code>MultiTenantConnectionProvider</code> implementation class name.</p>
</li>
<li>
<p>Passed directly to the <code>org.hibernate.boot.registry.StandardServiceRegistryBuilder</code>.</p>
</li>
<li>
<p>If none of the above options match, but the settings do specify a <code>hibernate.connection.datasource</code> value,
Hibernate will assume it should use the specific <code>DataSourceBasedMultiTenantConnectionProviderImpl</code> implementation which works on a number of pretty reasonable assumptions when running inside of an app server and using one <code>javax.sql.DataSource</code> per tenant.
See its <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/connections/spi/DataSourceBasedMultiTenantConnectionProviderImpl.html">Javadocs</a> for more details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example portrays a <code>MultiTenantConnectionProvider</code> implementation that handles multiple <code>ConnectionProviders</code>.</p>
</div>
<div id="multitenacy-hibernate-ConfigurableMultiTenantConnectionProvider-example" class="exampleblock">
<div class="title">Example 614. A <code>MultiTenantConnectionProvider</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConfigurableMultiTenantConnectionProvider</span><span class="pln">
        </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractMultiTenantConnectionProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConnectionProvider</span><span class="pun">&gt;</span><span class="pln"> connectionProviderMap </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ConfigurableMultiTenantConnectionProvider</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConnectionProvider</span><span class="pun">&gt;</span><span class="pln"> connectionProviderMap</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">connectionProviderMap</span><span class="pun">.</span><span class="pln">putAll</span><span class="pun">(</span><span class="pln"> connectionProviderMap </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">ConnectionProvider</span><span class="pln"> getAnyConnectionProvider</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> connectionProviderMap</span><span class="pun">.</span><span class="pln">values</span><span class="pun">().</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">ConnectionProvider</span><span class="pln"> selectConnectionProvider</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> tenantIdentifier</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> connectionProviderMap</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> tenantIdentifier </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>ConfigurableMultiTenantConnectionProvider</code> can be set up as follows:</p>
</div>
<div id="multitenacy-hibernate-MultiTenantConnectionProvider-example" class="exampleblock">
<div class="title">Example 615. A <code>MultiTenantConnectionProvider</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    registerConnectionProvider</span><span class="pun">(</span><span class="pln"> FRONT_END_TENANT </span><span class="pun">);</span><span class="pln">
    registerConnectionProvider</span><span class="pun">(</span><span class="pln"> BACK_END_TENANT </span><span class="pun">);</span><span class="pln">

    </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> settings </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">

    settings</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">MULTI_TENANT</span><span class="pun">,</span><span class="pln"> multiTenancyStrategy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    settings</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AvailableSettings</span><span class="pun">.</span><span class="pln">MULTI_TENANT_CONNECTION_PROVIDER</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigurableMultiTenantConnectionProvider</span><span class="pun">(</span><span class="pln"> connectionProviderMap </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    sessionFactory </span><span class="pun">=</span><span class="pln"> sessionFactory</span><span class="pun">(</span><span class="pln">settings</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> registerConnectionProvider</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> tenantIdentifier</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Properties</span><span class="pln"> properties </span><span class="pun">=</span><span class="pln"> properties</span><span class="pun">();</span><span class="pln">
    properties</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Environment</span><span class="pun">.</span><span class="pln">URL</span><span class="pun">,</span><span class="pln">
        tenantUrl</span><span class="pun">(</span><span class="pln">properties</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Environment</span><span class="pun">.</span><span class="pln">URL </span><span class="pun">),</span><span class="pln"> tenantIdentifier</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

    </span><span class="typ">DriverManagerConnectionProviderImpl</span><span class="pln"> connectionProvider </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DriverManagerConnectionProviderImpl</span><span class="pun">();</span><span class="pln">
    connectionProvider</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln"> properties </span><span class="pun">);</span><span class="pln">
    connectionProviderMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> tenantIdentifier</span><span class="pun">,</span><span class="pln"> connectionProvider </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using multitenancy, itâ€™s possible to save an entity with the same identifier across different tenants:</p>
</div>
<div id="multitenacy-hibernate-same-entity-example" class="exampleblock">
<div class="title">Example 616. A <code>MultiTenantConnectionProvider</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">doInSession</span><span class="pun">(</span><span class="pln"> FRONT_END_TENANT</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInSession</span><span class="pun">(</span><span class="pln"> BACK_END_TENANT</span><span class="pun">,</span><span class="pln"> session </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">  </span><span class="pun">);</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    session</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> person </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-CurrentTenantIdentifierResolver"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-hibernate-CurrentTenantIdentifierResolver"></a>19.4.2. CurrentTenantIdentifierResolver</h4>
<div class="paragraph">
<p><code>org.hibernate.context.spi.CurrentTenantIdentifierResolver</code> is a contract for Hibernate to be able to resolve what the application considers the current tenant identifier.
The implementation to use is either passed directly to <code>Configuration</code> via its <code>setCurrentTenantIdentifierResolver</code> method.
It can also be specified via the <code>hibernate.tenant_identifier_resolver</code> setting.</p>
</div>
<div class="paragraph">
<p>There are two situations where CurrentTenantIdentifierResolver is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first situation is when the application is using the <code>org.hibernate.context.spi.CurrentSessionContext</code> feature in conjunction with multitenancy.
In the case of the current-session feature, Hibernate will need to open a session if it cannot find an existing one in scope.
However, when a session is opened in a multitenant environment, the tenant identifier has to be specified.
This is where the <code>CurrentTenantIdentifierResolver</code> comes into play; Hibernate will consult the implementation you provide to determine the tenant identifier to use when opening the session.
In this case, it is required that a <code>CurrentTenantIdentifierResolver</code> is supplied.</p>
</li>
<li>
<p>The other situation is when you do not want to have to explicitly specify the tenant identifier all the time.
If a <code>CurrentTenantIdentifierResolver</code> has been specified, Hibernate will use it to determine the default tenant identifier to use when opening the session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if the <code>CurrentTenantIdentifierResolver</code> implementation returns <code>true</code> for its <code>validateExistingCurrentSessions</code> method, Hibernate will make sure any existing sessions that are found in scope have a matching tenant identifier.
This capability is only pertinent when the <code>CurrentTenantIdentifierResolver</code> is used in current-session settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="multitenacy-hibernate-caching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#multitenacy-hibernate-caching"></a>19.4.3. Caching</h4>
<div class="paragraph">
<p>Multitenancy support in Hibernate works seamlessly with the Hibernate second level cache.
The key used to cache data encodes the tenant identifier.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, schema export will not really work with multitenancy. That may not change.</p>
</div>
<div class="paragraph">
<p>The JPA expert group is in the process of defining multitenancy support for an upcoming version of the specification.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="osgi"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi"></a>20. OSGi</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_osgi_specification_and_environment"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_osgi_specification_and_environment"></a>20.1. OSGi Specification and Environment</h3>
<div class="paragraph">
<p>Hibernate targets the OSGi 4.3 spec or later.
It was necessary to start with 4.3, over 4.2, due to our dependency on OSGiâ€™s <code>BundleWiring</code> for entity/mapping scanning.</p>
</div>
<div class="paragraph">
<p>Hibernate supports three types of configurations within OSGi.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container-Managed JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-managed-jpa">Container-Managed JPA</a></p>
</li>
<li>
<p>Unmanaged JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-unmanaged-jpa">Unmanaged JPA</a></p>
</li>
<li>
<p>Unmanaged Native <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-unmanaged-native">Unmanaged Native</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_hibernate_osgi"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_hibernate_osgi"></a>20.2. hibernate-osgi</h3>
<div class="paragraph">
<p>Rather than embed OSGi capabilities into hibernate-core, and sub-modules, hibernate-osgi was created.
Itâ€™s purposefully separated, isolating all OSGi dependencies.
It provides an OSGi-specific <code>ClassLoader</code> (aggregates the containerâ€™s <code>ClassLoader</code> with core and <code>EntityManager</code> <code>ClassLoader`s),
JPA persistence provider, `SessionFactory</code>/<code>EntityManagerFactory</code> bootstrapping, entities/mappings scanner, and service management.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features_xml"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_features_xml"></a>20.3. features.xml</h3>
<div class="paragraph">
<p>Apache Karaf environments tend to make heavy use of its "features" concept, where a feature is a set of order-specific bundles focused on a concise capability.
These features are typically defined in a <code>features.xml</code> file.
Hibernate produces and releases its own <code>features.xml</code> that defines a core <code>hibernate-orm</code>, as well as additional features for optional functionality (caching, Envers, etc.).
This is included in the binary distribution, as well as deployed to the JBoss Nexus repository (using the <code>org.hibernate</code> groupId and <code>hibernate-osgi</code> with the <code>karaf.xml</code> classifier).</p>
</div>
<div class="paragraph">
<p>Note that our features are versioned using the same ORM artifact versions they wrap.
Also, note that the features are heavily tested against Karaf 3.0.3 as a part of our PaxExam-based integration tests.
However, theyâ€™ll likely work on other versions as well.</p>
</div>
<div class="paragraph">
<p>hibernate-osgi, theoretically, supports a variety of OSGi containers, such as Equinox.
In that case, please use `features.xm`l as a reference for necessary bundles to activate and their correct ordering.
However, note that Karaf starts a number of bundles automatically, several of which would need to be installed manually on alternatives.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quickstarts_demos"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_quickstarts_demos"></a>20.4. QuickStarts/Demos</h3>
<div class="paragraph">
<p>All three configurations have a QuickStart/Demo available in the <a href="https://github.com/hibernate/hibernate-demos">hibernate-demos</a> project:</p>
</div>
</div>
<div class="sect2">
<h3 id="osgi-managed-jpa"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-managed-jpa"></a>20.5. Container-Managed JPA</h3>
<div class="paragraph">
<p>The Enterprise OSGi specification includes container-managed JPA.
The container is responsible for discovering persistence units in bundles and automatically creating the <code>EntityManagerFactory</code> (one <code>EntityManagerFactory</code> per <code>PersistenceUnit</code>).
It uses the JPA provider (hibernate-osgi) that has registered itself with the OSGi <code>PersistenceProvider</code> service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enterprise_osgi_jpa_container"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_enterprise_osgi_jpa_container"></a>20.6. Enterprise OSGi JPA Container</h3>
<div class="paragraph">
<p>In order to utilize container-managed JPA, an Enterprise OSGi JPA container must be active in the runtime.
In Karaf, this means Aries JPA, which is included out-of-the-box (simply activate the <code>jpa</code> and <code>transaction</code> features).
Originally, we intended to include those dependencies within our own <code>features.xml</code>.
However, after guidance from the Karaf and Aries teams, it was pulled out.
This allows Hibernate OSGi to be portable and not be directly tied to Aries versions, instead of having the user choose which to use.</p>
</div>
<div class="paragraph">
<p>That being said, the QuickStart/Demo projects include a sample <a href="https://github.com/hibernate/hibernate-demos/tree/master/hibernate-orm/osgi/managed-jpa/features.xml">features.xml</a>
showing which features need to be activated in Karaf in order to support this environment.
As mentioned, use this purely as a reference!</p>
</div>
</div>
<div class="sect2">
<h3 id="_persistence_xml"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_persistence_xml"></a>20.7. persistence.xml</h3>
<div class="paragraph">
<p>Similar to any other JPA setup, your bundle must include a <code>persistence.xml</code> file. This is typically located in <code>META-INF</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_datasource"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_datasource"></a>20.8. DataSource</h3>
<div class="paragraph">
<p>Typical Enterprise OSGi JPA usage includes a <code>DataSource</code> installed in the container.
Your bundleâ€™s <code>persistence.xml</code> calls out the <code>DataSource</code> through JNDI.
For example, you could install the following H2 <code>DataSource</code>.
You can deploy the <code>DataSource</code> manually (Karaf has a <code>deploy</code> dir), or through a "blueprint bundle" (<code>blueprint:file:/[PATH]/datasource-h2.xml</code>).</p>
</div>
<div class="exampleblock">
<div class="title">Example 617. datasource-h2.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="com">&lt;!--
First install the H2 driver using:
&gt; install -s mvn:com.h2database/h2/1.3.163

Then copy this file to the deploy folder
--&gt;</span><span class="pln">
</span><span class="tag">&lt;blueprint</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"dataSource"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.h2.jdbcx.JdbcDataSource"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"URL"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1;MVCC=TRUE"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"user"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"sa"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"password"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">""</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;service</span><span class="pln"> </span><span class="atn">interface</span><span class="pun">=</span><span class="atv">"javax.sql.DataSource"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"dataSource"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;service-properties&gt;</span><span class="pln">
            </span><span class="tag">&lt;entry</span><span class="pln"> </span><span class="atn">key</span><span class="pun">=</span><span class="atv">"osgi.jndi.service.name"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"jdbc/h2ds"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/service-properties&gt;</span><span class="pln">
    </span><span class="tag">&lt;/service&gt;</span><span class="pln">
</span><span class="tag">&lt;/blueprint&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That <code>DataSource</code> is then used by your <code>persistence.xml</code> persistence-unit. The following works in Karaf, but the names may need tweaked in alternative containers.</p>
</div>
<div class="exampleblock">
<div class="title">Example 618. META-INF/persistence.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;jta-data-source&gt;</span><span class="pln">osgi:service/javax.sql.DataSource/(osgi.jndi.service.name=jdbc/h2ds)</span><span class="tag">&lt;/jta-data-source&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bundle_package_imports"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_bundle_package_imports"></a>20.9. Bundle Package Imports</h3>
<div class="paragraph">
<p>Your bundleâ€™s manifest will need to import, at a minimum,</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.persistence</code></p>
</li>
<li>
<p><code>org.hibernate.proxy</code> and <code>javassist.util.proxy</code>, due to Hibernateâ€™s ability to return proxies for lazy initialization (Javassist enhancement occurs on the entityâ€™s <code>ClassLoader</code> during runtime).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_obtaining_an_entitymanger"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_obtaining_an_entitymanger"></a>20.10. Obtaining an EntityManger</h3>
<div class="paragraph">
<p>The easiest, and most supported, method of obtaining an <code>EntityManager</code> utilizes OSGiâ€™s <code>OSGI-INF/blueprint/blueprint.xml</code> in your bundle.
The container takes the name of your persistence unit, then automatically injects an <code>EntityManager</code> instance into your given bean attribute.</p>
</div>
<div class="exampleblock">
<div class="title">Example 619. OSGI-INF/blueprint/blueprint.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;blueprint</span><span class="pln"> </span><span class="atn">xmlns:jpa</span><span class="pun">=</span><span class="atv">"http://aries.apache.org/xmlns/jpa/v1.0.0"</span><span class="pln">
           </span><span class="atn">xmlns:tx</span><span class="pun">=</span><span class="atv">"http://aries.apache.org/xmlns/transactions/v1.0.0"</span><span class="pln">
           </span><span class="atn">default-activation</span><span class="pun">=</span><span class="atv">"eager"</span><span class="pln">
           </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="com">&lt;!-- This gets the container-managed EntityManager and injects it into the DataPointServiceImpl bean.
    Assumes DataPointServiceImpl has an "entityManager" field with a getter and setter. --&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"dpService"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.osgitest.DataPointServiceImpl"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;jpa:context</span><span class="pln"> </span><span class="atn">unitname</span><span class="pun">=</span><span class="atv">"managed-jpa"</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"entityManager"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;tx:transaction</span><span class="pln"> </span><span class="atn">method</span><span class="pun">=</span><span class="atv">"*"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Required"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;service</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"dpService"</span><span class="pln"> </span><span class="atn">interface</span><span class="pun">=</span><span class="atv">"org.hibernate.osgitest.DataPointService"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/blueprint&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="osgi-unmanaged-jpa"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-unmanaged-jpa"></a>20.11. Unmanaged JPA</h3>
<div class="paragraph">
<p>Hibernate also supports the use of JPA, unmanaged by the OSGi container.
The client bundle is responsible for managing the <code>EntityManagerFactory</code> and `EntityManager`s.</p>
</div>
</div>
<div class="sect2">
<h3 id="_persistence_xml_2"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_persistence_xml_2"></a>20.12. persistence.xml</h3>
<div class="paragraph">
<p>Similar to any other JPA setup, your bundle must include a <code>persistence.xml</code> file. This is typically located in <code>META-INF</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bundle_package_imports_2"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_bundle_package_imports_2"></a>20.13. Bundle Package Imports</h3>
<div class="paragraph">
<p>Your bundleâ€™s manifest will need to import, at a minimum,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>javax.persistence</p>
</li>
<li>
<p><code>org.hibernate.proxy</code> and <code>javassist.util.proxy</code>, due to Hibernateâ€™s ability to return proxies for lazy initialization (Javassist enhancement occurs on the entityâ€™s <code>ClassLoader</code> during runtime)</p>
</li>
<li>
<p>JDBC driver package (example: <code>org.h2</code>)</p>
</li>
<li>
<p><code>org.osgi.framework</code>, necessary to discover the <code>EntityManagerFactory</code> (described below)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_obtaining_an_entitymangerfactory"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_obtaining_an_entitymangerfactory"></a>20.14. Obtaining an EntityMangerFactory</h3>
<div class="paragraph">
<p><code>hibernate-osgi</code> registers an OSGi service, using the JPA <code>PersistenceProvider</code> interface name, that bootstraps and creates an <code>EntityManagerFactory</code> specific for OSGi environments.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is VITAL that your <code>EntityManagerFactory</code> be obtained through the service, rather than creating it manually.
The service handles the OSGi <code>ClassLoader</code>, discovered extension points, scanning, etc.
Manually creating an <code>EntityManagerFactory</code> is guaranteed to NOT work during runtime!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="osgi-discover-EntityManagerFactory" class="exampleblock">
<div class="title">Example 620. Discover/Use <code>EntityManagerFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">HibernateUtil</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span class="pln"> emf</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> getEntityManager</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> getEntityManagerFactory</span><span class="pun">().</span><span class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span class="pln"> getEntityManagerFactory</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> emf </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Bundle</span><span class="pln"> thisBundle </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FrameworkUtil</span><span class="pun">.</span><span class="pln">getBundle</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">HibernateUtil</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
            </span><span class="typ">BundleContext</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> thisBundle</span><span class="pun">.</span><span class="pln">getBundleContext</span><span class="pun">();</span><span class="pln">

            </span><span class="typ">ServiceReference</span><span class="pln"> serviceReference </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getServiceReference</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">PersistenceProvider</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
            </span><span class="typ">PersistenceProvider</span><span class="pln"> persistenceProvider </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersistenceProvider</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> context
            </span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln">
                serviceReference
            </span><span class="pun">);</span><span class="pln">

            emf </span><span class="pun">=</span><span class="pln"> persistenceProvider</span><span class="pun">.</span><span class="pln">createEntityManagerFactory</span><span class="pun">(</span><span class="pln">
                </span><span class="str">"YourPersistenceUnitName"</span><span class="pun">,</span><span class="pln">
                </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> emf</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="osgi-unmanaged-native"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#osgi-unmanaged-native"></a>20.15. Unmanaged Native</h3>
<div class="paragraph">
<p>Native Hibernate use is also supported. The client bundle is responsible for managing the <code>SessionFactory</code> and `Session`s.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bundle_package_imports_3"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_bundle_package_imports_3"></a>20.16. Bundle Package Imports</h3>
<div class="paragraph">
<p>Your bundleâ€™s manifest will need to import, at a minimum,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>javax.persistence</p>
</li>
<li>
<p><code>org.hibernate.proxy</code> and <code>javassist.util.proxy</code>, due to Hibernateâ€™s ability to return proxies for lazy initialization (Javassist enhancement occurs on the entityâ€™s <code>ClassLoader</code> during runtime)</p>
</li>
<li>
<p>JDBC driver package (example: <code>org.h2</code>)</p>
</li>
<li>
<p><code>org.osgi.framework</code>, necessary to discover the <code>SessionFactory</code> (described below)</p>
</li>
<li>
<p><code>org.hibernate.*</code> packages, as necessary (ex: cfg, criterion, service, etc.)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_obtaining_a_sessionfactory"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_obtaining_a_sessionfactory"></a>20.17. Obtaining a SessionFactory</h3>
<div class="paragraph">
<p><code>hibernate-osgi</code> registers an OSGi service, using the <code>SessionFactory</code> interface name, that bootstraps and creates a <code>SessionFactory</code> specific for OSGi environments.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is VITAL that your <code>SessionFactory</code> be obtained through the service, rather than creating it manually. The service handles the OSGi <code>ClassLoader</code>, discovered extension points, scanning, etc.
Manually creating a <code>SessionFactory</code> is guaranteed to NOT work during runtime!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="osgi-discover-SessionFactory" class="exampleblock">
<div class="title">Example 621. Discover/Use <code>SessionFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">HibernateUtil</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pln"> sf</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Session</span><span class="pln"> getSession</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> getSessionFactory</span><span class="pun">().</span><span class="pln">openSession</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pln"> getSessionFactory</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> sf </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Bundle</span><span class="pln"> thisBundle </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FrameworkUtil</span><span class="pun">.</span><span class="pln">getBundle</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">HibernateUtil</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
            </span><span class="typ">BundleContext</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> thisBundle</span><span class="pun">.</span><span class="pln">getBundleContext</span><span class="pun">();</span><span class="pln">

            </span><span class="typ">ServiceReference</span><span class="pln"> sr </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getServiceReference</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">SessionFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
            sf </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">SessionFactory</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="pln"> sr </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> sf</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optional_modules"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_optional_modules"></a>20.18. Optional Modules</h3>
<div class="paragraph">
<p>The <a href="https://github.com/hibernate/hibernate-demos/tree/master/hibernate-orm/osgi/unmanaged-native">unmanaged-native</a> demo project displays the use of optional Hibernate modules.
Each module adds additional dependency bundles that must first be activated, either manually or through an additional feature.
As of ORM 4.2, Envers is fully supported.
Support for C3P0, Proxool, EhCache, and Infinispan were added in 4.3. However, none of their 3rd party libraries currently work in OSGi (lots of <code>ClassLoader</code> problems, etc.).
Weâ€™re tracking the issues in JIRA.</p>
</div>
</div>
<div class="sect2">
<h3 id="_extension_points"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_extension_points"></a>20.19. Extension Points</h3>
<div class="paragraph">
<p>Multiple contracts exist to allow applications to integrate with and extend Hibernate capabilities.
Most apps utilize JDK services to provide their implementations.
<code>hibernate-osgi</code> supports the same extensions through OSGi services.
Implement and register them in any of the three configurations.
<code>hibernate-osgi</code> will discover and integrate them during <code>EntityManagerFactory</code>/<code>SessionFactory</code> bootstrapping. Supported extension points are as follows.
The specified interface should be used during service registration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.integrator.spi.Integrator</code></dt>
<dd>
<p>(as of 4.2)</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.boot.registry.selector.StrategyRegistrationProvider</code></dt>
<dd>
<p>(as of 4.3)</p>
</dd>
<dt class="hdlist1"><code>org.hibernate.boot.model.TypeContributor</code></dt>
<dd>
<p>(as of 4.3)</p>
</dd>
<dt class="hdlist1">JTAâ€™s</dt>
<dd>
<p><code>javax.transaction.TransactionManager</code> and <code>javax.transaction.UserTransaction</code> (as of 4.2). However, these are typically provided by the OSGi container.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The easiest way to register extension point implementations is through a <code>blueprint.xml</code> file.
Add <code>OSGI-INF/blueprint/blueprint.xml</code> to your classpath. Envers' blueprint is a great example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 622. Example extension point registrations in blueprint.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="com">&lt;!--
  ~ Hibernate, Relational Persistence for Idiomatic Java
  ~
  ~ License: GNU Lesser General Public License (LGPL), version 2.1 or later.
  ~ See the lgpl.txt file in the root directory or &lt;http://www.gnu.org/licenses/lgpl-2.1.html&gt;.
  --&gt;</span><span class="pln">
</span><span class="tag">&lt;blueprint</span><span class="pln"> </span><span class="atn">default-activation</span><span class="pun">=</span><span class="atv">"eager"</span><span class="pln">
           </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"integrator"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.envers.boot.internal.EnversIntegrator"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;service</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"integrator"</span><span class="pln"> </span><span class="atn">interface</span><span class="pun">=</span><span class="atv">"org.hibernate.integrator.spi.Integrator"</span><span class="tag">/&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"typeContributor"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.envers.boot.internal.TypeContributorImpl"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;service</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"typeContributor"</span><span class="pln"> </span><span class="atn">interface</span><span class="pun">=</span><span class="atv">"org.hibernate.boot.model.TypeContributor"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/blueprint&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Extension points can also be registered programmatically with <code>BundleContext#registerService</code>, typically within your <code>BundleActivator#start</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_caveats"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_caveats"></a>20.20. Caveats</h3>
<div class="ulist">
<ul>
<li>
<p>Technically, multiple persistence units are supported by Enterprise OSGi JPA and unmanaged Hibernate JPA use.
However, we cannot currently support this in OSGi.
In Hibernate 4, only one instance of the OSGi-specific <code>ClassLoader</code> is used per Hibernate bundle, mainly due to heavy use of static TCCL utilities.
We hope to support one OSGi <code>ClassLoader</code> per persistence unit in Hibernate 5.</p>
</li>
<li>
<p>Scanning is supported to find non-explicitly listed entities and mappings.
However, they MUST be in the same bundle as your persistence unit (fairly typical anyway).
Our OSGi <code>ClassLoader</code> only considers the "requesting bundle" (hence the requirement on using services to create <code>EntityManagerFactory</code>/<code>SessionFactory</code>), rather than attempting to scan all available bundles.
This is primarily for versioning considerations, collision protection, etc.</p>
</li>
<li>
<p>Some containers (ex: Aries) always return true for <code>PersistenceUnitInfo#excludeUnlistedClasses</code>, even if your <code>persistence.xml</code> explicitly has <code>exclude-unlisted-classes</code> set to <code>false</code>.
They claim itâ€™s to protect JPA providers from having to implement scanning ("we handle it for you"), even though we still want to support it in many cases.
The workaround is to set <code>hibernate.archive.autodetection</code> to, for example, <code>hbm,class</code>.
This tells hibernate to ignore the <code>excludeUnlistedClasses</code> value and scan for <code>*.hbm.xml</code> and entities regardless.</p>
</li>
<li>
<p>Scanning does not currently support annotated packages on <code>package-info.java</code>.</p>
</li>
<li>
<p>Currently, Hibernate OSGi is primarily tested using Apache Karaf and Apache Aries JPA. Additional testing is needed with Equinox, Gemini, and other container providers.</p>
</li>
<li>
<p>Hibernate ORM has many dependencies that do not currently provide OSGi manifests. The QuickStart tutorials make heavy use of 3rd party bundles (SpringSource, ServiceMix) or the <code>wrap:â€¦â€‹</code> operator.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="envers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers"></a>21. Envers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="envers-basics"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-basics"></a>21.1. Basics</h3>
<div class="paragraph">
<p>To audit changes that are performed on an entity, you only need two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>hibernate-envers</code> jar on the classpath,</p>
</li>
<li>
<p>an <code>@Audited</code> annotation on the entity.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike in previous versions, you no longer need to specify listeners in the Hibernate configuration file.
Just putting the Envers jar on the classpath is enough because listeners will be registered automatically.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>And thatâ€™s all.
You can create, modify and delete the entities as always.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of JPAâ€™s <code>CriteriaUpdate</code> and <code>CriteriaDelete</code> bulk operations are not currently supported by Envers
due to how an entityâ€™s lifecycle events are dispatched.  Such operations should be avoided as theyâ€™re not
captured by Envers and leads to incomplete audit history.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you look at the generated schema for your entities, or at the data persisted by Hibernate, you will notice that there are no changes.
However, for each audited entity, a new table is introduced - <code>entity_table_AUD</code>, which stores the historical data, whenever you commit a transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Envers automatically creates audit tables if <code>hibernate.hbm2ddl.auto</code> option is set to <code>create</code>, <code>create-drop</code> or <code>update</code>.
Appropriate DDL statements can also be generated with an Ant task in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-generateschema">Generating Envers schema with Hibernate hbm2ddl tool</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Considering we have a <code>Customer</code> entity, when annotating it with the <code>Audited</code> annotation,
Hibernate is going to generate the following tables using the <code>hibernate.hbm2ddl.auto</code> schema tool:</p>
</div>
<div id="envers-audited-mapping-example" class="exampleblock">
<div class="title">Example 623. Basic Envers entity mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Customer_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table REVINFO </span><span class="pun">(</span><span class="pln">
    REV integer generated </span><span class="kwd">by</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> identity</span><span class="pun">,</span><span class="pln">
    REVTSTMP bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Customer_AUD</span><span class="pln">
   add constraint FK5ecvi1a0ykunrriib7j28vpdj
   foreign key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
   references REVINFO</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Instead of annotating the whole class and auditing all properties, you can annotate only some persistent properties with <code>@Audited</code>.
This will cause only these properties to be audited.</p>
</div>
<div class="paragraph">
<p>Now, considering the previous <code>Customer</code> entity,
letâ€™s see how Envers auditing works when inserting, updating, and deleting the entity in question.</p>
</div>
<div id="envers-audited-insert-example" class="exampleblock">
<div class="title">Example 624. Auditing the entity <code>INSERT</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">();</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> customer </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Mon</span><span class="pln"> </span><span class="typ">Jul</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">21</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    REVINFO
    </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">,</span><span class="pln"> REVTSTMP</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1500906092803</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">REVTYPE</span><span class="pun">,</span><span class="pln"> created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Mon</span><span class="pln"> </span><span class="typ">Jul</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">21</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div id="envers-audited-update-example" class="exampleblock">
<div class="title">Example 625. Auditing the entity <code>UPDATE</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe Jr."</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">update
    </span><span class="typ">Customer</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    created_on</span><span class="pun">=?,</span><span class="pln">
    firstName</span><span class="pun">=?,</span><span class="pln">
    lastName</span><span class="pun">=?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">07</span><span class="pun">-</span><span class="lit">24</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">21</span><span class="pun">:</span><span class="lit">32.757</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    REVINFO
    </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">,</span><span class="pln"> REVTSTMP</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1500906092853</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">REVTYPE</span><span class="pun">,</span><span class="pln"> created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">07</span><span class="pun">-</span><span class="lit">24</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">21</span><span class="pun">:</span><span class="lit">32.757</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div id="envers-audited-delete-example" class="exampleblock">
<div class="title">Example 626. Auditing the entity <code>DELETE</code> operation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
entityManager</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln"> customer </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">delete</span><span class="pln">
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    REVINFO
    </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">,</span><span class="pln"> REVTSTMP</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1500906092876</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">REVTYPE</span><span class="pun">,</span><span class="pln"> created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>REVTYPE</code> column value is taken from the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/envers/RevisionType.html"><code>RevisionType</code></a> Enum.</p>
</div>
<table id="envers-revtype-column" class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. <code>REVTYPE</code> column values</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database column value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associated <code>RevisionType</code> Enum value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ADD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was inserted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A database table row was deleted.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The audit (history) of an entity can be accessed using the <code>AuditReader</code> interface, which can be obtained by having an open <code>EntityManager</code> or <code>Session</code> via the <code>AuditReaderFactory</code>.</p>
</div>
<div id="envers-audited-revisions-example" class="exampleblock">
<div class="title">Example 627. Getting a list of revisions for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Number</span><span class="pun">&gt;</span><span class="pln"> revisions </span><span class="pun">=</span><span class="pln"> doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	 </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">).</span><span class="pln">getRevisions</span><span class="pun">(</span><span class="pln">
		</span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
		</span><span class="lit">1L</span><span class="pln">
	</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> col_0_0_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
cross join
    REVINFO r
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REV </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">.</span><span class="pln">REV
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using the previously fetched revisions, we can now inspect the state of the <code>Customer</code> entity at that particular revision:</p>
</div>
<div id="envers-audited-rev1-example" class="exampleblock">
<div class="title">Example 628. Getting the first revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="str">"Doe"</span><span class="pun">,</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getLastName</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_4_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam5_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName6_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">select</span><span class="pln">
            max</span><span class="pun">(</span><span class="pln"> c_max</span><span class="pun">.</span><span class="pln">REV </span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">from</span><span class="pln">
            </span><span class="typ">Customer_AUD</span><span class="pln"> c_max
        </span><span class="kwd">where</span><span class="pln">
            c_max</span><span class="pun">.</span><span class="pln">REV </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> c_max</span><span class="pun">.</span><span class="pln">id
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="pun">&lt;&gt;</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When executing the aforementioned SQL query, there are two parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">revision_number</dt>
<dd>
<p>The first parameter marks the revision number we are interested in or the latest one that exists up to this particular revision.</p>
</dd>
<dt class="hdlist1">revision_type</dt>
<dd>
<p>The second parameter specifies that we are not interested in <code>DEL</code> <code>RevisionType</code> so that deleted entries are filtered out.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The same goes for the second revision associated with the <code>UPDATE</code> statement.</p>
</div>
<div id="envers-audited-rev2-example" class="exampleblock">
<div class="title">Example 629. Getting the second revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="str">"Doe Jr."</span><span class="pun">,</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getLastName</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For the deleted entity revision, Envers throws a <code>NoResultException</code> since the entity was no longer valid at that revision.</p>
</div>
<div id="envers-audited-rev3-example" class="exampleblock">
<div class="title">Example 630. Getting the third revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

	fail</span><span class="pun">(</span><span class="str">"The Customer was deleted at this revision: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">NoResultException</span><span class="pln"> expected</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can use the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/envers/query/AuditQueryCreator.html#forEntitiesAtRevision-java.lang.Class-java.lang.String-java.lang.Number-boolean-"><code>forEntitiesAtRevision(Class&lt;T&gt; cls, String entityName, Number revision, boolean includeDeletions)</code></a>
method to get the deleted entity revision so that, instead of a <code>NoResultException</code>,
all attributes, except for the entity identifier, are going to be <code>null</code>.</p>
</div>
<div id="envers-audited-rev4-example" class="exampleblock">
<div class="title">Example 631. Getting the third revision for the <code>Customer</code> entity without getting a <code>NoResultException</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln">
	revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
	</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getFirstName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getLastName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getCreatedOn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/envers/AuditReader.html">Javadocs</a> for details on other functionality offered.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-configuration"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-configuration"></a>21.2. Configuration Properties</h3>
<div class="paragraph">
<p>It is possible to configure various aspects of Hibernate Envers behavior, such as table names, etc.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_table_prefix</strong></code></dt>
<dd>
<p>String that will be prepended to the name of an audited entity to create the name of the entity and that will hold audit information.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_table_suffix</strong></code> (default: <code>_AUD</code>)</dt>
<dd>
<p>String that will be appended to the name of an audited entity to create the name of the entity and that will hold audit information.</p>
<div class="paragraph">
<p>If you audit an entity with a table name Person, in the default setting Envers will generate a <code>Person_AUD</code> table to store historical data.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_field_name</strong></code> (default: <code>REV</code>)</dt>
<dd>
<p>Name of a field in the audit entity that will hold the revision number.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_type_field_name</strong></code> (default: <code>REVTYPE</code> )</dt>
<dd>
<p>Name of a field in the audit entity that will hold the type of the revision (currently, this can be: <code>add</code>, <code>mod</code>, <code>del</code>).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.revision_on_collection_change</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>Should a revision be generated when a not-owned relation field changes (this can be either a collection in a one-to-many relation or the field using <code>mappedBy</code> attribute in a one-to-one relation).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.do_not_audit_optimistic_locking_field</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>When true, properties to be used for optimistic locking, annotated with <code>@Version</code>, will not be automatically audited (their history wonâ€™t be stored; it normally doesnâ€™t make sense to store it).</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.store_data_at_delete</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Should the entity data be stored in the revision when the entity is deleted (instead of only storing the id and all other properties as null).</p>
<div class="paragraph">
<p>This is not normally needed, as the data is present in the last-but-one revision.
Sometimes, however, it is easier and more efficient to access it in the last revision (then the data that the entity contained before deletion is stored twice).</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.default_schema</strong></code> (default: <code>null</code> - same schema as the table being audited)</dt>
<dd>
<p>The default schema name that should be used for audit tables.</p>
<div class="paragraph">
<p>Can be overridden using the <code>@AuditTable( schema="â€¦â€‹" )</code> annotation.</p>
</div>
<div class="paragraph">
<p>If not present, the schema will be the same as the schema of the table being audited.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.default_catalog</strong></code> (default: <code>null</code> - same catalog as the table being audited)</dt>
<dd>
<p>The default catalog name that should be used for audit tables.</p>
<div class="paragraph">
<p>Can be overridden using the <code>@AuditTable( catalog="â€¦â€‹" )</code> annotation.</p>
</div>
<div class="paragraph">
<p>If not present, the catalog will be the same as the catalog of the normal tables.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy</strong></code>(default: <code>org.hibernate.envers.strategy.DefaultAuditStrategy</code> )</dt>
<dd>
<p>The audit strategy that should be used when persisting audit data.
The default stores only the revision, at which an entity was modified.</p>
<div class="paragraph">
<p>An alternative, the <code>org.hibernate.envers.strategy.ValidityAuditStrategy</code> stores both the start revision and the end revision.
Together these define when an audit row was valid, hence the name ValidityAuditStrategy.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</strong></code> (default: <code>REVEND</code>)</dt>
<dd>
<p>The column name that will hold the end revision number in audit entities.
This property is only valid if the validity audit strategy is used.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</strong></code>(default: <code>false</code> )</dt>
<dd>
<p>Should the timestamp of the end revision be stored, until which the data was valid, in addition to the end revision itself.
This is useful to be able to purge old Audit records out of a relational database by using table partitioning.</p>
<div class="paragraph">
<p>Partitioning requires a column that exists within the table.
This property is only evaluated if the <code>ValidityAuditStrategy</code> is used.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</strong></code>(default: <code>REVEND_TSTMP</code> )</dt>
<dd>
<p>Column name of the timestamp of the end revision until which the data was valid.
Only used if the <code>ValidityAuditStrategy</code> is used, and <code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> evaluates to true</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.use_revision_entity_with_native_id</strong></code> (default: <code>true</code> )</dt>
<dd>
<p>Boolean flag that determines the strategy of revision number generation.
Default implementation of revision entity uses native identifier generator.</p>
<div class="paragraph">
<p>If the current database engine does not support identity columns, users are advised to set this property to false.</p>
</div>
<div class="paragraph">
<p>In this case revision numbers are created by preconfigured <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code>.
See: <code>org.hibernate.envers.DefaultRevisionEntity</code> and <code>org.hibernate.envers.enhanced.SequenceIdRevisionEntity</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.track_entities_changed_in_revision</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Should entity types, that have been modified during each revision, be tracked.
The default implementation creates <code>REVCHANGES</code> table that stores entity names of modified persistent objects.
Single record encapsulates the revision identifier (foreign key to <code>REVINFO</code> table) and a string value.
For more information, refer to <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a> and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-queries">Querying for entity types modified in a given revision</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.global_with_modified_flag</strong></code> (default: <code>false</code>, can be individually overridden with <code>@Audited( withModifiedFlag=true )</code> )</dt>
<dd>
<p>Should property modification flags be stored for all audited entities and all properties.</p>
<div class="paragraph">
<p>When set to true, for all properties an additional boolean column in the audit tables will be created, filled with information if the given property changed in the given revision.</p>
</div>
<div class="paragraph">
<p>When set to false, such column can be added to selected entities or properties using the <code>@Audited</code> annotation.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes">Tracking entity changes at the property level</a> and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes-queries">Querying for entity revisions that modified a given property</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.modified_flag_suffix</strong></code> (default: <code>_MOD</code> )</dt>
<dd>
<p>The suffix for columns storing "Modified Flags".</p>
<div class="paragraph">
<p>For example, a property called "age", will by default get modified flag with column name "age_MOD".</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.embeddable_set_ordinal_field_name</strong></code> (default: <code>SETORDINAL</code> )</dt>
<dd>
<p>Name of column used for storing ordinal of the change in sets of embeddable elements.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.cascade_delete_revision</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>While deleting revision entry, remove data of associated audited entities. Requires database support for cascade row removal.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.allow_identifier_reuse</strong></code> (default: <code>false</code> )</dt>
<dd>
<p>Guarantees proper validity audit strategy behavior when application reuses identifiers of deleted entities. Exactly one row with <code>null</code> end date exists for each identifier.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.envers.original_id_prop_name</strong></code> (default: <code>originalId</code> )</dt>
<dd>
<p>Specifies the composite-id key property name used by the audit table mappings.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following configuration options have been added recently and should
be regarded as experimental:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>org.hibernate.envers.track_entities_changed_in_revision</code></p>
</li>
<li>
<p><code>org.hibernate.envers.using_modified_flag</code></p>
</li>
<li>
<p><code>org.hibernate.envers.modified_flag_suffix</code></p>
</li>
<li>
<p><code>org.hibernate.envers.original_id_prop_name</code></p>
</li>
</ol>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="envers-additional-mappings"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-additional-mappings"></a>21.3. Additional mapping annotations</h3>
<div class="paragraph">
<p>The name of the audit table can be set on a per-entity basis, using the <code>@AuditTable</code> annotation.
It may be tedious to add this annotation to every audited entity, so if possible, itâ€™s better to use a prefix/suffix.</p>
</div>
<div class="paragraph">
<p>If you have a mapping with secondary tables, audit tables for them will be generated in the same way (by adding the prefix and suffix).
If you wish to overwrite this behavior, you can use the <code>@SecondaryAuditTable</code> and <code>@SecondaryAuditTables</code> annotations.</p>
</div>
<div class="paragraph">
<p>If youâ€™d like to override auditing behavior of some fields/properties inherited from <code>@MappedSuperclass</code> or in an embedded component,
you can apply the <code>@AuditOverride</code> annotation on the subtype or usage site of the component.</p>
</div>
<div class="paragraph">
<p>If you want to audit a relation mapped with <code>@OneToMany</code> and <code>@JoinColumn</code>,
please see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-mappingexceptions">Mapping exceptions</a> for a description of the additional <code>@AuditJoinTable</code> annotation that youâ€™ll probably want to use.</p>
</div>
<div class="paragraph">
<p>If you want to audit a relation, where the target entity is not audited (that is the case for example with dictionary-like entities, which donâ€™t change and donâ€™t have to be audited),
just annotate it with <code>@Audited( targetAuditMode = RelationTargetAuditMode.NOT_AUDITED )</code>.
Then, while reading historic versions of your entity, the relation will always point to the "current" related entity.
By default Envers throws <code>javax.persistence.EntityNotFoundException</code> when "current" entity does not exist in the database.
Apply <code>@NotFound( action = NotFoundAction.IGNORE )</code> annotation to silence the exception and assign null value instead.
The hereby solution causes implicit eager loading of to-one relations.</p>
</div>
<div class="paragraph">
<p>If youâ€™d like to audit properties of a superclass of an entity, which are not explicitly audited (they donâ€™t have the <code>@Audited</code> annotation on any properties or on the class),
you can set the <code>@AuditOverride( forClass = SomeEntity.class, isAudited = true/false )</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>@Audited</code> annotation also features an <code>auditParents</code> attribute but itâ€™s now deprecated in favor of <code>@AuditOverride</code>,</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="envers-audit-strategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-audit-strategy"></a>21.4. Choosing an audit strategy</h3>
<div class="paragraph">
<p>After the basic configuration, it is important to choose the audit strategy that will be used to persist and retrieve audit information.
There is a trade-off between the performance of persisting and the performance of querying the audit information.
Currently, there are two audit strategies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The default audit strategy persists the audit data together with a start revision.
For each row inserted, updated or deleted in an audited table, one or more rows are inserted in the audit tables, together with the start revision of its validity.
Rows in the audit tables are never updated after insertion.
Queries of audit information use subqueries to select the applicable rows in the audit tables.</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
These subqueries are notoriously slow and difficult to index.
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>The alternative is a validity audit strategy.
This strategy stores the start-revision and the end-revision of audit information.
For each row inserted, updated or deleted in an audited table, one or more rows are inserted in the audit tables, together with the start revision of its validity.
But at the same, time the end-revision field of the previous audit rows (if available) is set to this revision.
Queries on the audit information can then use 'between start and end revision' instead of subqueries as used by the default audit strategy.</p>
<div class="paragraph">
<p>The consequence of this strategy is that persisting audit information will be a bit slower because of the extra updates involved,
but retrieving audit information will be a lot faster.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This can be improved even further by adding extra indexes.
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="envers-audit-ValidityAuditStrategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-audit-ValidityAuditStrategy"></a>21.4.1. Configuring the <code>ValidityAuditStrategy</code></h4>
<div class="paragraph">
<p>To better visualize how the <code>ValidityAuditStrategy</code>, consider the following exercise where
we replay the previous audit logging example for the <code>Customer</code> entity.</p>
</div>
<div class="paragraph">
<p>First, you need to configure the <code>ValidityAuditStrategy</code>:</p>
</div>
<div id="envers-audited-validity-configuration-example" class="exampleblock">
<div class="title">Example 632. Configuring the <code>ValidityAuditStrategy</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">options</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">EnversSettings</span><span class="pun">.</span><span class="pln">AUDIT_STRATEGY</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">ValidityAuditStrategy</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If, youâ€™re using the <code>persistence.xml</code> configuration file,
then the mapping will looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;property</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"org.hibernate.envers.audit_strategy"</span><span class="pln">
    </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"org.hibernate.envers.strategy.ValidityAuditStrategy"</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you configured the <code>ValidityAuditStrategy</code>, the following schema is going to be automatically generated:</p>
</div>
<div id="envers-audited-validity-mapping-example" class="exampleblock">
<div class="title">Example 633. Envers schema for the <code>ValidityAuditStrategy</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Customer_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
   id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    REVEND integer</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table REVINFO </span><span class="pun">(</span><span class="pln">
    REV integer generated </span><span class="kwd">by</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> identity</span><span class="pun">,</span><span class="pln">
    REVTSTMP bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Customer_AUD</span><span class="pln">
    add constraint FK5ecvi1a0ykunrriib7j28vpdj
    foreign key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
    references REVINFO

alter table </span><span class="typ">Customer_AUD</span><span class="pln">
    add constraint </span><span class="typ">FKqd4fy7ww1yy95wi4wtaonre3f</span><span class="pln">
    foreign key </span><span class="pun">(</span><span class="pln">REVEND</span><span class="pun">)</span><span class="pln">
    references REVINFO</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>REVEND</code> column is added as well as its Foreign key to the <code>REVINFO</code> table.</p>
</div>
<div class="paragraph">
<p>When rerunning the previous <code>Customer</code> audit log queries against the <code>ValidityAuditStrategy</code>,
we get the following results:</p>
</div>
<div id="envers-audited-validity-rev1-example" class="exampleblock">
<div class="title">Example 634. Getting the first revision for the <code>Customer</code> entity</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="pun">&lt;&gt;</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Compared to the default strategy, the <code>ValidityAuditStrategy</code> generates simpler queries that can render better execution plans.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-revisionlog"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-revisionlog"></a>21.5. Revision Log</h3>
<div class="paragraph">
<p>When Envers starts a new revision, it creates a new revision entity which stores information about the revision.</p>
</div>
<div class="paragraph">
<p>By default, that includes just:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">revision number</dt>
<dd>
<p>An integral value (<code>int/Integer</code> or <code>long/Long</code>). Essentially, the primary key of the revision</p>
</dd>
<dt class="hdlist1">revision timestamp</dt>
<dd>
<p>Either a <code>long/Long</code> or <code>java.util.Date</code> value representing the instant at which the revision was made.
When using a <code>java.util.Date</code>, instead of a <code>long/Long</code> for the revision timestamp, take care not to store it to a column data type which will lose precision.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Envers handles this information as an entity.
By default it uses its own internal class to act as the entity, mapped to the <code>REVINFO</code> table.
You can, however, supply your own approach to collecting this information which might be useful to capture additional details such as who made a change
or the IP address from which the request came.
There are two things you need to make this work:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, you will need to tell Envers about the entity you wish to use.
Your entity must use the <code>@org.hibernate.envers.RevisionEntity</code> annotation.
It must define the two attributes described above annotated with <code>@org.hibernate.envers.RevisionNumber</code> and <code>@org.hibernate.envers.RevisionTimestamp</code>, respectively.
You can extend from <code>org.hibernate.envers.DefaultRevisionEntity</code>, if you wish, to inherit all these required behaviors.</p>
<div class="paragraph">
<p>Simply add the custom revision entity as you do your normal entities and Envers will <strong>find it</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is an error for there to be multiple entities marked as <code>@org.hibernate.envers.RevisionEntity</code>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Second, you need to tell Envers how to create instances of your revision entity which is handled by the
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/envers/RevisionListener.html#newRevision-java.lang.Object-"><code>newRevision( Object revisionEntity )</code></a>
method of the <code>org.hibernate.envers.RevisionListener</code> interface.</p>
<div class="paragraph">
<p>You tell Envers your custom <code>org.hibernate.envers.RevisionListener</code> implementation to use by specifying it on the <code>@org.hibernate.envers.RevisionEntity</code> annotation, using the value attribute.
If your <code>RevisionListener</code> class is inaccessible from <code>@RevisionEntity</code> (e.g. it exists in a different module),
set <code>org.hibernate.envers.revision_listener</code> property to its fully qualified class name.
Class name defined by the configuration parameter overrides the revision entityâ€™s value attribute.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considering we have a <code>CurrentUser</code> utility which stores the currently logged user:</p>
</div>
<div id="envers-revisionlog-CurrentUser-example" class="exampleblock">
<div class="title">Example 635. <code>CurrentUser</code> utility</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CurrentUser</span><span class="pun">();</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ThreadLocal</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> storage </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ThreadLocal</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> logIn</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> user</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		storage</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="pln"> user </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> logOut</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		storage</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> storage</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">();</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, we need to provide a custom <code>@RevisionEntity</code> to store the currently logged user</p>
</div>
<div id="envers-revisionlog-RevisionEntity-example" class="exampleblock">
<div class="title">Example 636. Custom <code>@RevisionEntity</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CustomRevisionEntity"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CUSTOM_REV_INFO"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@RevisionEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CustomRevisionEntityListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomRevisionEntity</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultRevisionEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getUsername</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUsername</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the custom <code>RevisionEntity</code> implementation in place,
we only need to provide the <code>RevisionEntity</code> implementation which acts as a factory
of <code>RevisionEntity</code> instances.</p>
</div>
<div id="envers-revisionlog-RevisionListener-example" class="exampleblock">
<div class="title">Example 637. Custom <code>@RevisionListener</code> example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomRevisionEntityListener</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">RevisionListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> newRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> revisionEntity </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">CustomRevisionEntity</span><span class="pln"> customRevisionEntity </span><span class="pun">=</span><span class="pln">
			</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CustomRevisionEntity</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> revisionEntity</span><span class="pun">;</span><span class="pln">

		customRevisionEntity</span><span class="pun">.</span><span class="pln">setUsername</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">()</span><span class="pln">
		</span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When generating the database schema, Envers creates the following <code>RevisionEntity</code> table:</p>
</div>
<div id="envers-revisionlog-custom-revision-entity-table-example" class="exampleblock">
<div class="title">Example 638. Auto-generated <code>RevisionEntity</code> Envers table</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table CUSTOM_REV_INFO </span><span class="pun">(</span><span class="pln">
    id integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    timestamp bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    username varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can see the <code>username</code> column in place.</p>
</div>
<div class="paragraph">
<p>Now, when inserting a <code>Customer</code> entity, Envers generates the following statements:</p>
</div>
<div id="envers-revisionlog-RevisionEntity-persist-example" class="exampleblock">
<div class="title">Example 639. Auditing using the custom <code>@RevisionEntity</code> instance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logIn</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Vlad Mihalcea"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

doInJPA</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">entityManagerFactory</span><span class="pun">,</span><span class="pln"> entityManager </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">();</span><span class="pln">
	customer</span><span class="pun">.</span><span class="pln">setId</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	customer</span><span class="pun">.</span><span class="pln">setFirstName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	customer</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

	entityManager</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln"> customer </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CurrentUser</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">logOut</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Thu</span><span class="pln"> </span><span class="typ">Jul</span><span class="pln"> </span><span class="lit">27</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">45</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    CUSTOM_REV_INFO
    </span><span class="pun">(</span><span class="pln">timestamp</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1501159500888</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Vlad</span><span class="pln"> </span><span class="typ">Mihalcea</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">REVTYPE</span><span class="pun">,</span><span class="pln"> created_on</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Thu</span><span class="pln"> </span><span class="typ">Jul</span><span class="pln"> </span><span class="lit">27</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">45</span><span class="pun">:</span><span class="lit">00</span><span class="pln"> EEST </span><span class="lit">2017</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As demonstrated by the example above, the username is properly set and propagated to the <code>CUSTOM_REV_INFO</code> table.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>This strategy is deprecated since version 5.2.  The alternative is to use dependency injection offered as of version 5.3.</strong></p>
</div>
<div class="paragraph">
<p>An alternative method to using the <code>org.hibernate.envers.RevisionListener</code> is to instead call the
<span class="line-through"><a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/envers/AuditReader.html#getCurrentRevision-java.lang.Class-boolean-"><code>getCurrentRevision( Class&lt;T&gt; revisionEntityClass, boolean persist )</code></a></span>
method of the <code>org.hibernate.envers.AuditReader</code> interface to obtain the current revision,
and fill it with desired information.</p>
</div>
<div class="paragraph">
<p>The method accepts a <code>persist</code> parameter indicating whether the revision entity should be persisted prior to returning from this method:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>ensures that the returned entity has access to its identifier value (revision number), but the revision entity will be persisted regardless of whether there are any audited entities changed.</p>
</dd>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>means that the revision number will be <code>null</code>, but the revision entity will be persisted only if some audited entities have changed.</p>
</dd>
</dl>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Hibernate Envers 5.3, dependency injection is now supported for a <code>RevisionListener</code>.</p>
</div>
<div class="paragraph">
<p>This feature is up to the various dependency frameworks, such as CDI and Spring, to supply the
necessary implementation during Hibernate ORM bootstrap to support injection.  If no qualifying
implementation is supplied, the <code>RevisionListener</code> will be constructed without injection.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-modified-entities-revchanges"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-revchanges"></a>21.6. Tracking entity names modified during revisions</h3>
<div class="paragraph">
<p>By default, entity types that have been changed in each revision are not being tracked.
This implies the necessity to query all tables storing audited data in order to retrieve changes made during the specified revision.
Envers provides a simple mechanism that creates <code>REVCHANGES</code> table which stores entity names of modified persistent objects.
Single record encapsulates the revision identifier (foreign key to <code>REVINFO</code> table) and a string value.</p>
</div>
<div class="paragraph">
<p>Tracking of modified entity names can be enabled in three different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set <code>org.hibernate.envers.track_entities_changed_in_revision</code> parameter to <code>true</code>.
In this case <code>org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> will be implicitly used as the revision log entity.</p>
</li>
<li>
<p>Create a custom revision entity that extends <code>org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> class.</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CustomTrackingRevisionEntity"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"TRACKING_REV_INFO"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@RevisionEntity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln">
	</span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultTrackingModifiedEntitiesRevisionEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Mark an appropriate field of a custom revision entity with <code>@org.hibernate.envers.ModifiedEntityNames</code> annotation.
The property is required to be of <code>Set&lt;String&gt;</code> type.</p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CustomTrackingRevisionEntity"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"TRACKING_REV_INFO"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@RevisionEntity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultRevisionEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@ElementCollection</span><span class="pln">
	</span><span class="lit">@JoinTable</span><span class="pun">(</span><span class="pln">
		name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"REVCHANGES"</span><span class="pun">,</span><span class="pln">
		joinColumns </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@JoinColumn</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"REV"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ENTITYNAME"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@ModifiedEntityNames</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> modifiedEntityNames </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> getModifiedEntityNames</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> modifiedEntityNames</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considering we have a <code>Customer</code> entity illustrated by the following example:</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-before-rename-example" class="exampleblock">
<div class="title">Example 640. <code>Customer</code> entity before renaming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the <code>Customer</code> entity class name is changed to <code>ApplicationCustomer</code>,
Envers is going to insert a new record in the <code>REVCHANGES</code> table with the previous entity class name:</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-after-rename-example" class="exampleblock">
<div class="title">Example 641. <code>Customer</code> entity after renaming</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ApplicationCustomer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">insert
</span><span class="kwd">into</span><span class="pln">
    REVCHANGES
    </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">,</span><span class="pln"> ENTITYNAME</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">userguide</span><span class="pun">.</span><span class="pln">envers</span><span class="pun">.</span><span class="typ">EntityTypeChangeAuditTest$Customer</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Users, that have chosen one of the approaches listed above,
can retrieve all entities modified in a specified revision by utilizing API described in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-queries">Querying for entity types modified in a given revision</a>.</p>
</div>
<div class="paragraph">
<p>Users are also allowed to implement custom mechanisms of tracking modified entity types.
In this case, they shall pass their own implementation of <code>org.hibernate.envers.EntityTrackingRevisionListener</code>
interface as the value of <code>@org.hibernate.envers.RevisionEntity</code> annotation.</p>
</div>
<div class="paragraph">
<p><code>EntityTrackingRevisionListener</code> interface exposes one method that notifies whenever audited entity instance has been
added, modified or removed within current revision boundaries.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-EntityTrackingRevisionListener-example" class="exampleblock">
<div class="title">Example 642. The <code>EntityTrackingRevisionListener</code> implementation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionListener</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">EntityTrackingRevisionListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> entityChanged</span><span class="pun">(</span><span class="typ">Class</span><span class="pln"> entityClass</span><span class="pun">,</span><span class="pln">
							  </span><span class="typ">String</span><span class="pln"> entityName</span><span class="pun">,</span><span class="pln">
							  </span><span class="typ">Serializable</span><span class="pln"> entityId</span><span class="pun">,</span><span class="pln">
							  </span><span class="typ">RevisionType</span><span class="pln"> revisionType</span><span class="pun">,</span><span class="pln">
							  </span><span class="typ">Object</span><span class="pln"> revisionEntity </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="typ">String</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> entityClass</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">();</span><span class="pln">
		</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">CustomTrackingRevisionEntity</span><span class="pun">)</span><span class="pln"> revisionEntity </span><span class="pun">).</span><span class="pln">addModifiedEntityType</span><span class="pun">(</span><span class="pln"> type </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="lit">@Override</span><span class="pln">
	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> newRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> revisionEntity </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CustomTrackingRevisionListener</code> adds the fully-qualified class name to the <code>modifiedEntityTypes</code> attribute of the <code>CustomTrackingRevisionEntity</code>.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-RevisionEntity-example" class="exampleblock">
<div class="title">Example 643. The <code>RevisionEntity</code> using the custom <code>EntityTrackingRevisionListener</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"CustomTrackingRevisionEntity"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Table</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"TRACKING_REV_INFO"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@RevisionEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionListener</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="lit">@RevisionNumber</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> customId</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@RevisionTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> customTimestamp</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@OneToMany</span><span class="pun">(</span><span class="pln">
		mappedBy</span><span class="pun">=</span><span class="str">"revision"</span><span class="pun">,</span><span class="pln">
		cascade</span><span class="pun">={</span><span class="pln">
			</span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">PERSIST</span><span class="pun">,</span><span class="pln">
			</span><span class="typ">CascadeType</span><span class="pun">.</span><span class="pln">REMOVE
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">EntityType</span><span class="pun">&gt;</span><span class="pln"> modifiedEntityTypes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">EntityType</span><span class="pun">&gt;</span><span class="pln"> getModifiedEntityTypes</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">return</span><span class="pln"> modifiedEntityTypes</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addModifiedEntityType</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> entityClassName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		modifiedEntityTypes</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EntityType</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> entityClassName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CustomTrackingRevisionEntity</code> contains a <code>@OneToMany</code> list of <code>ModifiedTypeRevisionEntity</code></p>
</div>
<div id="envers-tracking-modified-entities-revchanges-EntityType-example" class="exampleblock">
<div class="title">Example 644. The <code>EntityType</code> encapsulatets the entity type name before a class name modification</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"EntityType"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">EntityType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="lit">@GeneratedValue</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln"> revision</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> entityClassName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">EntityType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityType</span><span class="pun">(</span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln"> revision</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> entityClassName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">revision </span><span class="pun">=</span><span class="pln"> revision</span><span class="pun">;</span><span class="pln">
		</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">entityClassName </span><span class="pun">=</span><span class="pln"> entityClassName</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, when fetching the <code>CustomTrackingRevisionEntity</code>, you cna get access to the previous entity class name.</p>
</div>
<div id="envers-tracking-modified-entities-revchanges-query-example" class="exampleblock">
<div class="title">Example 645. Getting the <code>EntityType</code> through the <code>CustomTrackingRevisionEntity</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">AuditReader</span><span class="pln"> auditReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Number</span><span class="pun">&gt;</span><span class="pln"> revisions </span><span class="pun">=</span><span class="pln"> auditReader</span><span class="pun">.</span><span class="pln">getRevisions</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">ApplicationCustomer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	</span><span class="lit">1L</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">CustomTrackingRevisionEntity</span><span class="pln"> revEntity </span><span class="pun">=</span><span class="pln"> auditReader</span><span class="pun">.</span><span class="pln">findRevision</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">CustomTrackingRevisionEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">EntityType</span><span class="pun">&gt;</span><span class="pln"> modifiedEntityTypes </span><span class="pun">=</span><span class="pln"> revEntity</span><span class="pun">.</span><span class="pln">getModifiedEntityTypes</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> modifiedEntityTypes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">EntityType</span><span class="pln"> entityType </span><span class="pun">=</span><span class="pln"> modifiedEntityTypes</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln">
	entityType</span><span class="pun">.</span><span class="pln">getEntityClassName</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-properties-changes"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes"></a>21.7. Tracking entity changes at the property level</h3>
<div class="paragraph">
<p>By default, the only information stored by Envers are revisions of modified entities.
This approach lets users create audit queries based on historical values of entity properties.
Sometimes it is useful to store additional metadata for each revision, when you are interested also in the type of changes, not only about the resulting values.</p>
</div>
<div class="paragraph">
<p>The feature described in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a> makes it possible to tell which entities were modified in a given revision.</p>
</div>
<div class="paragraph">
<p>The feature described here takes it one step further.
<em>Modification Flags</em> enable Envers to track which properties of audited entities were modified in a given revision.</p>
</div>
<div class="paragraph">
<p>Tracking entity changes at the property level can be enabled by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>setting <code>org.hibernate.envers.global_with_modified_flag</code> configuration property to <code>true</code>.
This global switch will cause adding modification flags to be stored for all audited properties of all audited entities.</p>
</li>
<li>
<p>using <code>@Audited( withModifiedFlag=true )</code> on a property or on an entity.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The trade-off coming with this functionality is an increased size of audit tables and a very little, almost negligible, performance drop during audit writes.
This is due to the fact that every tracked property has to have an accompanying boolean column in the schema that stores information about the property modifications.
Of course, it is Enverâ€™s job to fill these columns accordingly - no additional work by the developer is required.
Because of costs mentioned, it is recommended to enable the feature selectively, when needed with use of the granular configuration means described above.</p>
</div>
<div id="envers-tracking-properties-changes-mapping-example" class="exampleblock">
<div class="title">Example 646. Mapping for tracking entity changes at the property level</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pun">(</span><span class="pln">withModifiedFlag </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters are omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Customer_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    createdOn_MOD </span><span class="kwd">boolean</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    firstName_MOD </span><span class="kwd">boolean</span><span class="pun">,</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName_MOD </span><span class="kwd">boolean</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, every property features a <code>_MOD</code> column (e.g. <code>createdOn_MOD</code>) in the audit log.</p>
</div>
<div id="envers-tracking-properties-changes-example" class="exampleblock">
<div class="title">Example 647. Tracking entity changes at the property level example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
customer</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe Jr."</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">update
    </span><span class="typ">Customer</span><span class="pln">
</span><span class="kwd">set</span><span class="pln">
    created_on </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    firstName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?,</span><span class="pln">
    lastName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">07</span><span class="pun">-</span><span class="lit">31</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">58</span><span class="pun">:</span><span class="lit">20.342</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    REVINFO
    </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">,</span><span class="pln"> REVTSTMP</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1501505900439</span><span class="pun">]</span><span class="pln">

insert
</span><span class="kwd">into</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln">
    </span><span class="pun">(</span><span class="pln">REVTYPE</span><span class="pun">,</span><span class="pln"> created_on</span><span class="pun">,</span><span class="pln"> createdOn_MOD</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">,</span><span class="pln"> firstName_MOD</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">,</span><span class="pln"> lastName_MOD</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
values
    </span><span class="pun">(?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">TIMESTAMP</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2017</span><span class="pun">-</span><span class="lit">07</span><span class="pun">-</span><span class="lit">31</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="lit">58</span><span class="pun">:</span><span class="lit">20.342</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">John</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Doe</span><span class="pln"> </span><span class="typ">Jr</span><span class="pun">.]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">    </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">9</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln">   </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To see how "Modified Flags" can be utilized, check out the very simple query API that uses them: <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes-queries">Querying for entity revisions that modified a given property</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-queries"></a>21.8. Queries</h3>
<div class="paragraph">
<p>You can think of historic data as having two dimensions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">horizontal</dt>
<dd>
<p>The state of the database at a given revision. Thus, you can query for entities as they were at revision N.</p>
</dd>
<dt class="hdlist1">vertical</dt>
<dd>
<p>The revisions, at which entities changed. Hence, you can query for revisions, in which a given entity changed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The queries in Envers are similar to Hibernate Criteria queries, so if you are common with them, using Envers queries will be much easier.</p>
</div>
<div class="paragraph">
<p>The main limitation of the current queries implementation is that you cannot traverse relations.
You can only specify constraints on the ids of the related entities, and only on the "owning" side of the relation.
This, however, will be changed in future releases.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The queries on the audited data will be in many cases much slower than corresponding queries on "live" data,
as, especially for the default audit strategy, they involve correlated subselects.</p>
</div>
<div class="paragraph">
<p>Queries are improved both in terms of speed and possibilities when using the validity audit strategy,
which stores both start and end revisions for entities. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-audit-ValidityAuditStrategy">Configuring the <code>ValidityAuditStrategy</code></a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="entities-at-revision"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entities-at-revision"></a>21.9. Querying for entities of a class at a given revision</h3>
<div class="paragraph">
<p>The entry point for this type of queries is:</p>
</div>
<div id="entities-at-revision-example" class="exampleblock">
<div class="title">Example 648. Getting the <code>Customer</code> entity at a given revision</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="str">"Doe"</span><span class="pun">,</span><span class="pln"> customer</span><span class="pun">.</span><span class="pln">getLastName</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entities-filtering"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entities-filtering"></a>21.10. Querying for entities using filtering criteria</h3>
<div class="paragraph">
<p>You can then specify constraints, which should be met by the entities returned, by adding restrictions,
which can be obtained using the <code>AuditEntity</code> factory class.</p>
</div>
<div class="paragraph">
<p>For example, to select only entities where the <code>firstName</code> property is equal to "John":</p>
</div>
<div id="entities-filtering-example" class="exampleblock">
<div class="title">Example 649. Getting the <code>Customer</code> audit log with a given <code>firstName</code> attribute value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"firstName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe"</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getLastName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe Jr."</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getLastName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And, to select only entities whose relationships are related to a given entity,
you can use either the target entity or its identifier.</p>
</div>
<div id="entities-filtering-by-entity-example" class="exampleblock">
<div class="title">Example 650. Getting the <code>Customer</code> entities whose <code>address</code> attribute matches the given entity reference</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Address</span><span class="pln"> address </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">getReference</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> address </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_3_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same SQL is generated even if we provide the identifier instead of the target entity reference.</p>
</div>
<div id="entities-filtering-by-entity-identifier-example" class="exampleblock">
<div class="title">Example 651. Getting the <code>Customer</code> entities whose <code>address</code> identifier matches the given entity identifier</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">relatedId</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Apart for strict equality matching, you can also use an <code>IN</code> clause to provide multiple entity identifiers:</p>
</div>
<div id="entities-in-clause-filtering-by-entity-identifier-example" class="exampleblock">
<div class="title">Example 652. Getting the <code>Customer</code> entities whose <code>address</code> identifier matches one of the given entity identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">relatedId</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pln"> </span><span class="pun">).</span><span class="kwd">in</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">1L</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2L</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_3_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        </span><span class="pun">?</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can limit the number of results, order them, and set aggregations and projections (except grouping) in the usual way.
When your query is complete, you can obtain the results by calling the <code>getSingleResult()</code> or <code>getResultList()</code> methods.</p>
</div>
<div class="paragraph">
<p>A full query, can look for example like this:</p>
</div>
<div id="entities-filtering-and-pagination" class="exampleblock">
<div class="title">Example 653. Getting the <code>Customer</code> entities using filtering and pagination</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lastName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">desc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">relatedId</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setFirstResult</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_3_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName desc
limit </span><span class="pun">?</span><span class="pln">
offset </span><span class="pun">?</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="revisions-of-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#revisions-of-entity"></a>21.11. Querying for revisions, at which entities of a given class changed</h3>
<div class="paragraph">
<p>The entry point for this type of queries is:</p>
</div>
<div id="revisions-of-entity-query-example" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">AuditQuery</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add constraints to this query in the same way as to the previous one.</p>
</div>
<div class="paragraph">
<p>There are some additional possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>using <code>AuditEntity.revisionNumber()</code> you can specify constraints, projections and order on the revision number, in which the audited entity was modified</p>
</li>
<li>
<p>similarly, using <code>AuditEntity.revisionProperty( propertyName )</code> you can specify constraints, projections and order on a property of the revision entity,
corresponding to the revision in which the audited entity was modified</p>
</li>
<li>
<p><code>AuditEntity.revisionType()</code> gives you access as above to the type of the revision (<code>ADD</code>, <code>MOD</code>, <code>DEL</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using these methods, you can order the query results by revision number, set projection or constraint the revision number to be greater or less than a specified value, etc.
For example, the following query will select the smallest revision number, at which entity of class <code>MyEntity</code> with id <code>entityId</code> has changed, after revision number 2:</p>
</div>
<div id="revisions-of-entity-query-by-revision-number-example" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Number</span><span class="pln"> revision </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">revisionNumber</span><span class="pun">().</span><span class="pln">min</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">revisionNumber</span><span class="pun">().</span><span class="pln">gt</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second additional feature you can use in queries for revisions is the ability to <em>maximize</em>/<em>minimize</em> a property.</p>
</div>
<div class="paragraph">
<p>For example, if you want to select the smallest possibler revision at which the value of the <code>createdOn</code>
attribute was larger then a given value,
you can run the following query:</p>
</div>
<div id="revisions-of-entity-query-minimize-example" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Number</span><span class="pln"> revision </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">revisionNumber</span><span class="pun">().</span><span class="pln">min</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"createdOn"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">minimize</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"createdOn"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
		</span><span class="pun">.</span><span class="pln">ge</span><span class="pun">(</span><span class="pln">
			</span><span class="typ">Timestamp</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln">
				</span><span class="typ">LocalDateTime</span><span class="pun">.</span><span class="pln">now</span><span class="pun">()</span><span class="pln">
					</span><span class="pun">.</span><span class="pln">minusDays</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
					</span><span class="pun">.</span><span class="pln">toInstant</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ZoneOffset</span><span class="pun">.</span><span class="pln">UTC </span><span class="pun">)</span><span class="pln">
				</span><span class="pun">)</span><span class="pln">
		</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>minimize()</code> and <code>maximize()</code> methods return a criteria, to which you can add constraints,
which must be met by the entities with the <em>maximized</em>/<em>minimized</em> properties.</p>
</div>
<div class="paragraph">
<p>You probably also noticed that there are two boolean parameters, passed when creating the query.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>selectEntitiesOnly</code></dt>
<dd>
<p>The first parameter is only valid when you donâ€™t set an explicit projection.</p>
<div class="paragraph">
<p>If true, the result of the query will be a list of entities (which changed at revisions satisfying the specified constraints).</p>
</div>
<div class="paragraph">
<p>If false, the result will be a list of three element arrays:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the first element will be the changed entity instance.</p>
</li>
<li>
<p>the second will be an entity containing revision data (if no custom entity is used, this will be an instance of <code>DefaultRevisionEntity</code>).</p>
</li>
<li>
<p>the third will be the type of the revision (one of the values of the <code>RevisionType</code> enumeration: <code>ADD</code>, <code>MOD</code>, <code>DEL</code>).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>selectDeletedEntities</code></dt>
<dd>
<p>The second parameter specifies if revisions,
in which the entity was deleted should be included in the results.</p>
<div class="paragraph">
<p>If yes, such entities will have the revision type <code>DEL</code> and all attributes, except the <code>id</code>, will be set to <code>null</code>.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Another useful feature is <code>AggregatedAuditExpression#computeAggregationInInstanceContext()</code>.  This can be used to create
an aggregate query based on the entity instance primary key.</p>
</div>
<div class="paragraph">
<p>For example, if you wanted to locate all customers but only wanted to retrieve the instances with the
maximum revision number, you would use the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">revisionNumber</span><span class="pun">().</span><span class="pln">maximize</span><span class="pun">().</span><span class="pln">computeAggregationInInstanceContext</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, the result set would contain a list of <code>Customer</code> instances, one per primary key.  Each instance would
hold the audited property data at the <em>maximum</em> revision number for each <code>Customer</code> primary key.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-properties-changes-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes-queries"></a>21.12. Querying for entity revisions that modified a given property</h3>
<div class="paragraph">
<p>For the two types of queries described above itâ€™s possible to use special <code>Audit</code> criteria called <code>hasChanged()</code> and <code>hasNotChanged()</code>
that makes use of the functionality described in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-properties-changes">Tracking entity changes at the property level</a>.</p>
</div>
<div class="paragraph">
<p>Letâ€™s have a look at various queries that can benefit from these two criteria.</p>
</div>
<div class="paragraph">
<p>First, you must make sure that your entity can track <em>modification flags</em>:</p>
</div>
<div id="envers-tracking-properties-changes-queries-entity-example" class="exampleblock">
<div class="title">Example 654. Valid only when audit logging tracks entity attribute modification flags</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pun">(</span><span class="pln"> withModifiedFlag </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following query will return all revisions of the <code>Customer</code> entity with the given <code>id</code>,
for which the <code>lastName</code> property has changed.</p>
</div>
<div id="envers-tracking-properties-changes-queries-hasChanged-example" class="exampleblock">
<div class="title">Example 655. Getting all <code>Customer</code> revisions for which the <code>lastName</code> attribute has changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lastName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">hasChanged</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_0_</span><span class="pun">,</span><span class="pln">
    defaultrev1_</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV1_4_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">createdOn_MOD </span><span class="kwd">as</span><span class="pln"> createdO6_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam7_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName_MOD </span><span class="kwd">as</span><span class="pln"> firstNam8_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName9_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName_MOD </span><span class="kwd">as</span><span class="pln"> lastNam10_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address11_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_MOD </span><span class="kwd">as</span><span class="pln"> address12_3_0_</span><span class="pun">,</span><span class="pln">
    defaultrev1_</span><span class="pun">.</span><span class="pln">REVTSTMP </span><span class="kwd">as</span><span class="pln"> REVTSTMP2_4_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c cross
join
    REVINFO defaultrev1_
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">lastName_MOD </span><span class="pun">=</span><span class="pln"> </span><span class="pun">?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">=</span><span class="pln">defaultrev1_</span><span class="pun">.</span><span class="pln">REV
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Using this query we wonâ€™t get all other revisions in which <code>lastName</code> wasnâ€™t touched.
From the SQL query you can see that the <code>lastName_MOD</code> column is being used in the WHERE clause,
hence the aforementioned requirement for tracking modification flags.</p>
</div>
<div class="paragraph">
<p>Of course, nothing prevents users from combining <code>hasChanged</code> condition with some additional criteria.</p>
</div>
<div id="envers-tracking-properties-changes-queries-hasChanged-and-hasNotChanged-example" class="exampleblock">
<div class="title">Example 656. Getting all <code>Customer</code> revisions for which the <code>lastName</code> attribute has changed and the <code>firstName</code> attribute has not changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lastName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">hasChanged</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"firstName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">hasNotChanged</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_0_</span><span class="pun">,</span><span class="pln">
    defaultrev1_</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV1_4_1_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">createdOn_MOD </span><span class="kwd">as</span><span class="pln"> createdO6_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam7_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName_MOD </span><span class="kwd">as</span><span class="pln"> firstNam8_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName9_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName_MOD </span><span class="kwd">as</span><span class="pln"> lastNam10_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address11_3_0_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_MOD </span><span class="kwd">as</span><span class="pln"> address12_3_0_</span><span class="pun">,</span><span class="pln">
    defaultrev1_</span><span class="pun">.</span><span class="pln">REVTSTMP </span><span class="kwd">as</span><span class="pln"> REVTSTMP2_4_1_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c cross
join
    REVINFO defaultrev1_
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">lastName_MOD</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">firstName_MOD</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">=</span><span class="pln">defaultrev1_</span><span class="pun">.</span><span class="pln">REV
order </span><span class="kwd">by</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get the <code>Customer</code> entities changed at a given <code>revisionNumber</code> with <code>lastName</code> modified and <code>firstName</code> untouched,
we have to use the <code>forEntitiesModifiedAtRevision</code> query:</p>
</div>
<div id="envers-tracking-properties-changes-queries-at-revision-example" class="exampleblock">
<div class="title">Example 657. Getting the <code>Customer</code> entity for a given revision if the <code>lastName</code> attribute has changed and the <code>firstName</code> attribute has not changed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Customer</span><span class="pun">)</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesModifiedAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"lastName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">hasChanged</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"firstName"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">hasNotChanged</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">createdOn_MOD </span><span class="kwd">as</span><span class="pln"> createdO6_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam7_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName_MOD </span><span class="kwd">as</span><span class="pln"> firstNam8_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName9_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName_MOD </span><span class="kwd">as</span><span class="pln"> lastNam10_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address11_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_MOD </span><span class="kwd">as</span><span class="pln"> address12_3_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">id</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">lastName_MOD</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">firstName_MOD</span><span class="pun">=?</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BIGINT</span><span class="pun">]</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">BOOLEAN</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-obtain-properties-changed-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-obtain-properties-changed-queries"></a>21.13. Querying for revisions of entity including property names that were modified</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature described here is still considered experimental.
It is subject to change in future releases based on user feedback to improve its usefulness.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Sometimes it may be useful to query entity revisions and also determine all the properties of that revision which
were modified without having to issue multiple queries using <code>hasChanged()</code> and <code>hasNotChanged()</code> criteria.</p>
</div>
<div class="paragraph">
<p>You can now obtain this information easily by using the following query:</p>
</div>
<div class="exampleblock">
<div class="title">Example 658. Querying entity revisions including property names modified.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pln"> results  </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">forRevisionsOfEntityWithChanges</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">id</span><span class="pun">().</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> entry </span><span class="pun">:</span><span class="pln"> results </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> array </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[])</span><span class="pln"> entry</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> propertiesChanged </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> array</span><span class="pun">[</span><span class="lit">3</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> propertyName </span><span class="pun">:</span><span class="pln"> propertiesChanged </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">/* Do something useful with the modified property `propertyName` */</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-tracking-modified-entities-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-queries"></a>21.14. Querying for entity types modified in a given revision</h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The methods described below can be used only when the default mechanism of tracking changed entity types is enabled (see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-tracking-modified-entities-revchanges">Tracking entity names modified during revisions</a>).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This basic query allows retrieving entity names and corresponding Java classes changed in a specified revision:</p>
</div>
<div id="envers-tracking-modified-entities-queries-example" class="exampleblock">
<div class="title">Example 659. Retrieving entity names and corresponding Java classes changed in a specified revision</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln">assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"org.hibernate.userguide.envers.EntityTypeChangeAuditTest$Customer"</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">AuditReaderFactory</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getCrossTypeRevisionChangesReader</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">findEntityTypes</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getFirst</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"org.hibernate.userguide.envers.EntityTypeChangeAuditTest$ApplicationCustomer"</span><span class="pun">,</span><span class="pln">
	</span><span class="typ">AuditReaderFactory</span><span class="pln">
	</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getCrossTypeRevisionChangesReader</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">findEntityTypes</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">getFirst</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Other queries (also accessible from <code>org.hibernate.envers.CrossTypeRevisionChangesReader</code>):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>List&lt;Object&gt; findEntities( Number )</code></dt>
<dd>
<p>Returns snapshots of all audited entities changed (added, updated and removed) in a given revision.
Executes <code>N+1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
<dt class="hdlist1"><code>List&lt;Object&gt; findEntities( Number, RevisionType )</code></dt>
<dd>
<p>Returns snapshots of all audited entities changed (added, updated or removed) in a given revision filtered by modification type.
Executes <code>N+1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
<dt class="hdlist1"><code>Map&lt;RevisionType, List&lt;Object&gt;&gt; findEntitiesGroupByRevisionType( Number )</code></dt>
<dd>
<p>Returns a map containing lists of entity snapshots grouped by modification operation (e.g. addition, update and removal).
Executes <code>3N+1</code> SQL queries, where <code>N</code> is a number of different entity classes modified within specified revision.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="envers-querying-entity-relation-joins"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-querying-entity-relation-joins"></a>21.15. Querying for entities using entity relation joins</h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Relation join queries are considered experimental and may change in future releases.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Audit queries support the ability to apply constraints, projections, and sort operations based on entity relations.  In order
to traverse entity relations through an audit query, you must use the relation traversal API with a join type.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Relation joins can be applied to <code>many-to-one</code> and <code>many-to-one</code> mappings only when using <code>JoinType.LEFT</code> or <code>JoinType.INNER</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The basis for creating an entity relation join query is as follows:</p>
</div>
<div id="envers-querying-entity-relation-inner-join" class="exampleblock">
<div class="title">Example 660. INNER JOIN entity audit query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">AuditQuery</span><span class="pln"> innerJoinAuditQuery </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div id="envers-querying-entity-relation-left-join" class="exampleblock">
<div class="title">Example 661. LEFT JOIN entity audit query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">AuditQuery</span><span class="pln"> innerJoinAuditQuery </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">LEFT </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Like any other query, constraints may be added to restrict the results.</p>
</div>
<div class="paragraph">
<p>For example, to find a <code>Customers</code> entities at a given revision whose addresses are in <code>RomÃ¢nia</code>,
you can use the following query:</p>
</div>
<div id="envers-querying-entity-relation-join-restriction" class="exampleblock">
<div class="title">Example 662. Filtering the join relation with a WHERE clause predicate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"country"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"RomÃ¢nia"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_3_</span><span class="pun">,</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_3_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> c
inner join
    </span><span class="typ">Address_AUD</span><span class="pln"> a
        on </span><span class="pun">(</span><span class="pln">
            c</span><span class="pun">.</span><span class="pln">address_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVTYPE</span><span class="pun">&lt;&gt;?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        c</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">country</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Rom</span><span class="pun">Ã¢</span><span class="pln">nia</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to traverse beyond the first relation in an entity graph.</p>
</div>
<div class="paragraph">
<p>For example, to find all <code>Customer</code> entities at a given revision
with the country attribute of the address property being <code>RomÃ¢nia</code>:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-restriction" class="exampleblock">
<div class="title">Example 663. Filtering a nested join relation with a WHERE clause predicate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"country"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"RomÃ¢nia"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> customers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_5_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> cu
inner join
    </span><span class="typ">Address_AUD</span><span class="pln"> a
        on </span><span class="pun">(</span><span class="pln">
            cu</span><span class="pun">.</span><span class="pln">address_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
inner join
    </span><span class="typ">Country_AUD</span><span class="pln"> co
        on </span><span class="pun">(</span><span class="pln">
            a</span><span class="pun">.</span><span class="pln">country_id</span><span class="pun">=</span><span class="pln">co</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">country_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                co</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVTYPE</span><span class="pun">&lt;&gt;?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        cu</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">name</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        co</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Rom</span><span class="pun">Ã¢</span><span class="pln">nia</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Constraints may also be added to the properties of nested joined relations, such as testing for <code>null</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following query illustrates how to find all <code>Customer</code> entities at a given revision
having the <code>address</code> in <code>Cluj-Napoca</code> or the <code>address</code> does <em>not</em> have any country entity reference:</p>
</div>
<div id="envers-querying-entity-relation-join-multiple-restrictions" class="exampleblock">
<div class="title">Example 664. Filtering a join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">LEFT</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">or</span><span class="pun">(</span><span class="pln">
		</span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"city"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Cluj-Napoca"</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
		</span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">relatedId</span><span class="pun">(</span><span class="pln"> </span><span class="str">"country"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_5_</span><span class="pun">,</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_5_
</span><span class="kwd">from</span><span class="pln">
  </span><span class="typ">Customer_AUD</span><span class="pln"> c
left outer join
  </span><span class="typ">Address_AUD</span><span class="pln"> a
    on </span><span class="pun">(</span><span class="pln">
      c</span><span class="pun">.</span><span class="pln">address_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
      </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        c</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
      </span><span class="pun">)</span><span class="pln">
      </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
      </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
  c</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
  </span><span class="kwd">and</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVTYPE</span><span class="pun">&lt;&gt;?</span><span class="pln">
  </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
    </span><span class="kwd">or</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
  </span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
      a</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
      </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
  </span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    a</span><span class="pun">.</span><span class="pln">city</span><span class="pun">=?</span><span class="pln">
    </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">country_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
  </span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Cluj</span><span class="pun">-</span><span class="typ">Napoca</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Queries can use the <code>up</code> method to navigate back up the entity graph.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Disjunction criterion may also be applied to relation join queries.</p>
</div>
<div class="paragraph">
<p>For example, the following query will find all <code>Customer</code> entities at a given revision
where the country name is <code>RomÃ¢nia</code> or that the <code>Customer</code> lives in <code>Cluj-Napoca</code>:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions" class="exampleblock">
<div class="title">Example 665. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"country"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER</span><span class="pun">,</span><span class="pln"> </span><span class="str">"cn"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">up</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">up</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">disjunction</span><span class="pun">()</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"city"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Cluj-Napoca"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"cn"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"RomÃ¢nia"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"createdOn"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">asc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_5_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> cu
inner join
    </span><span class="typ">Address_AUD</span><span class="pln"> a
        on </span><span class="pun">(</span><span class="pln">
            cu</span><span class="pun">.</span><span class="pln">address_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
inner join
    </span><span class="typ">Country_AUD</span><span class="pln"> co
        on </span><span class="pun">(</span><span class="pln">
            a</span><span class="pun">.</span><span class="pln">country_id</span><span class="pun">=</span><span class="pln">co</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">country_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                co</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVTYPE</span><span class="pun">&lt;&gt;?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        cu</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">city</span><span class="pun">=?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">name</span><span class="pun">=?</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        co</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> co</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
order </span><span class="kwd">by</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">created_on asc

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Cluj</span><span class="pun">-</span><span class="typ">Napoca</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">VARCHAR</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Rom</span><span class="pun">Ã¢</span><span class="pln">nia</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">9</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Lastly, this example illustrates how related entity properties can be compared in a single constraint.</p>
</div>
<div class="paragraph">
<p>Assuming, the <code>Customer</code> and the <code>Address</code> were previously changed as follows:</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions-combined-entities" class="exampleblock">
<div class="title">Example 666. Changing the <code>Address</code> to match the <code>Country</code> name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Customer</span><span class="pln"> customer </span><span class="pun">=</span><span class="pln"> entityManager</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">(</span><span class="pln">
	</span><span class="str">"select c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"from Customer c "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join fetch c.address a "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"join fetch a.country "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
	</span><span class="str">"where c.id = :id"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"id"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1L</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getSingleResult</span><span class="pun">();</span><span class="pln">

customer</span><span class="pun">.</span><span class="pln">setLastName</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Doe Sr."</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

customer</span><span class="pun">.</span><span class="pln">getAddress</span><span class="pun">().</span><span class="pln">setCity</span><span class="pun">(</span><span class="pln">
	customer</span><span class="pun">.</span><span class="pln">getAddress</span><span class="pun">().</span><span class="pln">getCountry</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following query shows how to find the <code>Customer</code> entities
where the <code>city</code> property of the <code>address</code> attribute equals the <code>name</code> of the associated <code>country</code> attribute.</p>
</div>
<div id="envers-querying-entity-relation-nested-join-multiple-restrictions-combined" class="exampleblock">
<div class="title">Example 667. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Number</span><span class="pun">&gt;</span><span class="pln"> revisions </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">).</span><span class="pln">getRevisions</span><span class="pun">(</span><span class="pln">
	</span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
	</span><span class="lit">1L</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AuditReaderFactory</span><span class="pln">
</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> entityManager </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">forEntitiesAtRevision</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> revisions</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> revisions</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"address"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">traverseRelation</span><span class="pun">(</span><span class="pln"> </span><span class="str">"country"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">JoinType</span><span class="pun">.</span><span class="pln">INNER</span><span class="pun">,</span><span class="pln"> </span><span class="str">"cn"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">up</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">up</span><span class="pun">()</span><span class="pln">
</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"city"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">eqProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"cn"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">getResultList</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="kwd">select</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">as</span><span class="pln"> id1_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV </span><span class="kwd">as</span><span class="pln"> REV2_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVTYPE </span><span class="kwd">as</span><span class="pln"> REVTYPE3_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">as</span><span class="pln"> REVEND4_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">created_on </span><span class="kwd">as</span><span class="pln"> created_5_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">firstName </span><span class="kwd">as</span><span class="pln"> firstNam6_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">lastName </span><span class="kwd">as</span><span class="pln"> lastName7_5_</span><span class="pun">,</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">as</span><span class="pln"> address_8_5_
</span><span class="kwd">from</span><span class="pln">
    </span><span class="typ">Customer_AUD</span><span class="pln"> cu
inner join
    </span><span class="typ">Address_AUD</span><span class="pln"> a
        on </span><span class="pun">(</span><span class="pln">
            cu</span><span class="pun">.</span><span class="pln">address_id</span><span class="pun">=</span><span class="pln">a</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                cu</span><span class="pun">.</span><span class="pln">address_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
inner join
    </span><span class="typ">Country_AUD</span><span class="pln"> cr
        on </span><span class="pun">(</span><span class="pln">
            a</span><span class="pun">.</span><span class="pln">country_id</span><span class="pun">=</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">id
            </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                a</span><span class="pun">.</span><span class="pln">country_id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
                cr</span><span class="pun">.</span><span class="pln">id </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">where</span><span class="pln">
    cu</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVTYPE</span><span class="pun">&lt;&gt;?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">city</span><span class="pun">=</span><span class="pln">cr</span><span class="pun">.</span><span class="pln">name
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        cu</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> cu</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        a</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> cr</span><span class="pun">.</span><span class="pln">REV</span><span class="pun">&lt;=?</span><span class="pln">
    </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
        cr</span><span class="pun">.</span><span class="pln">REVEND</span><span class="pun">&gt;?</span><span class="pln">
        </span><span class="kwd">or</span><span class="pln"> cr</span><span class="pun">.</span><span class="pln">REVEND </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">--</span><span class="pln"> binding parameter </span><span class="pun">[</span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="pun">[</span><span class="pln">INTEGER</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-querying-revision-entities"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-querying-revision-entities"></a>21.16. Querying for revision information without loading entities</h3>
<div class="paragraph">
<p>Sometimes, it may be useful to load information about revisions to find out who performed specific revisions or
to know what entity names were modified but the change log about the related audited entities isnâ€™t needed.
This API allows an efficient way to get the revision information entity log without instantiating the actual
entities themselves.</p>
</div>
<div class="paragraph">
<p>Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">AuditQuery</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> getAuditReader</span><span class="pun">().</span><span class="pln">createQuery</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">forRevisionsOfEntity</span><span class="pun">(</span><span class="pln"> </span><span class="typ">DefaultRevisionEntity</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">AuditEntity</span><span class="pun">.</span><span class="pln">revisionNumber</span><span class="pun">().</span><span class="pln">between</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">25</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will return all revision information entities for revisions between 1 and 25 including those which are
related to deletions.  If deletions are not of interest, you would pass <code>false</code> as the second argument.</p>
</div>
<div class="paragraph">
<p>Note that this query uses the <code>DefaultRevisionEntity</code> class type.  The class provided will vary depending on the
configuration properties used to configure Envers or if you supply your own revision entity.  Typically users who
will use this API will likely be providing a custom revision entity implementation to obtain custom information
being maintained per revision.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-conditional-auditing"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-conditional-auditing"></a>21.17. Conditional auditing</h3>
<div class="paragraph">
<p>Envers persists audit data in reaction to various Hibernate events (e.g. <code>post update</code>, <code>post insert</code>, and so on),
using a series of event listeners from the <code>org.hibernate.envers.event.spi</code> package.
By default, if the Envers jar is in the classpath, the event listeners are auto-registered with Hibernate.</p>
</div>
<div class="paragraph">
<p>Conditional auditing can be implemented by overriding some of the Envers event listeners.
To use customized Envers event listeners, the following steps are needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Turn off automatic Envers event listeners registration by setting the <code>hibernate.envers.autoRegisterListeners</code> Hibernate property to <code>false</code>.</p>
</li>
<li>
<p>Create subclasses for appropriate event listeners.
For example, if you want to conditionally audit entity insertions, extend the <code>org.hibernate.envers.event.spi.EnversPostInsertEventListenerImpl</code> class.
Place the conditional-auditing logic in the subclasses, call the super method if auditing should be performed.</p>
</li>
<li>
<p>Create your own implementation of <code>org.hibernate.integrator.spi.Integrator</code>, similar to <code>org.hibernate.envers.boot.internal.EnversIntegrator</code>.
Use your event listener classes instead of the default ones.</p>
</li>
<li>
<p>For the integrator to be automatically used when Hibernate starts up, you will need to add a <code>META-INF/services/org.hibernate.integrator.spi.Integrator</code> file to your jar.
The file should contain the fully qualified name of the class implementing the interface.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of <code>hibernate.listeners.envers.autoRegister</code> has been deprecated.
A new configuration setting <code>hibernate.envers.autoRegisterListeners</code> should be used instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="envers-schema"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-schema"></a>21.18. Understanding the Envers Schema</h3>
<div class="paragraph">
<p>For each audited entity (that is, for each entity containing at least one audited field), an audit table is created.
By default, the audit tableâ€™s name is created by adding an "_AUD" suffix to the original table name,
but this can be overridden by specifying a different suffix/prefix in the configuration properties or per-entity using the <code>@org.hibernate.envers.AuditTable</code> annotation.</p>
</div>
<div class="paragraph">
<p>The audit table contains the following columns:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p><code>id</code> of the original entity (this can be more then one column in the case of composite primary keys)</p>
</dd>
<dt class="hdlist1">revision number</dt>
<dd>
<p>an integer, which matches to the revision number in the revision entity table.</p>
</dd>
<dt class="hdlist1">revision type</dt>
<dd>
<p>The <code>org.hibernate.envers.RevisionType</code> enumeration ordinal stating if the change represents an INSERT, UPDATE or DELETE.</p>
</dd>
<dt class="hdlist1">audited fields</dt>
<dd>
<p>properties from the original entity being audited</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The primary key of the audit table is the combination of the original id of the entity and the revision number,
so there can be at most one historic entry for a given entity instance at a given revision.</p>
</div>
<div class="paragraph">
<p>The current entity data is stored in the original table and in the audit table.
This is a duplication of data, however as this solution makes the query system much more powerful, and as memory is cheap, hopefully, this wonâ€™t be a major drawback for the users.</p>
</div>
<div class="paragraph">
<p>A row in the audit table with entity id <code>ID</code>, revision <code>N</code>, and data <code>D</code> means: entity with id <code>ID</code> has data <code>D</code> from revision <code>N</code> upwards.
Hence, if we want to find an entity at revision <code>M</code>, we have to search for a row in the audit table, which has the revision number smaller or equal to <code>M</code>, but as large as possible.
If no such row is found, or a row with a "deleted" marker is found, it means that the entity didnâ€™t exist at that revision.</p>
</div>
<div class="paragraph">
<p>The "revision type" field can currently have three values: <code>0</code>, <code>1</code> and <code>2</code>, which means <code>ADD</code>, <code>MOD</code>, and <code>DEL</code>, respectively.
A row with a revision of type <code>DEL</code> will only contain the id of the entity and no data (all fields <code>NULL</code>), as it only serves as a marker saying "this entity was deleted at that revision".</p>
</div>
<div class="paragraph">
<p>Additionally, there is a revision entity table which contains the information about the global revision.
By default, the generated table is named <code>REVINFO</code> and contains just two columns: <code>ID</code> and <code>TIMESTAMP</code>.
A row is inserted into this table on each new revision, that is, on each commit of a transaction, which changes audited data.
The name of this table can be configured, the name of its columns as well as adding additional columns can be achieved as discussed in <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-revisionlog">Revision Log</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While global revisions are a good way to provide correct auditing of relations, some people have pointed out that this may be a bottleneck in systems, where data is very often modified.</p>
</div>
<div class="paragraph">
<p>One viable solution is to introduce an option to have an entity "locally revisioned", that is revisions would be created for it independently.
This would not enable correct versioning of relations, but it would work without the <code>REVINFO</code> table.</p>
</div>
<div class="paragraph">
<p>Another possibility is to introduce a notion of "revisioning groups", which would group entities sharing the same revision numbering.
Each such group would have to consist of one or more strongly connected components belonging to the entity graph induced by relations between entities.</p>
</div>
<div class="paragraph">
<p>Your opinions on the subject are very welcome on the forum.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="envers-generateschema"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-generateschema"></a>21.19. Generating Envers schema with Hibernate hbm2ddl tool</h3>
<div class="paragraph">
<p>If you would like to generate the database schema file with Hibernate,
you simply need to use the hbm2ddl too.</p>
</div>
<div class="paragraph">
<p>This task will generate the definitions of all entities, both of which are audited by Envers and those which are not.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation">Schema generation</a> chapter for more info.</p>
</div>
<div class="paragraph">
<p>For the following entities, Hibernate is going to generate the following database schema:</p>
</div>
<div id="envers-generateschema-example" class="exampleblock">
<div class="title">Example 668. Filtering a nested join relation using multiple predicates</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Customer"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@Temporal</span><span class="pun">(</span><span class="pln"> </span><span class="typ">TemporalType</span><span class="pun">.</span><span class="pln">TIMESTAMP </span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@Column</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"created_on"</span><span class="pun">)</span><span class="pln">
	</span><span class="lit">@CreationTimestamp</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> createdOn</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> address</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Address"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="lit">@ManyToOne</span><span class="pun">(</span><span class="pln">fetch </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FetchType</span><span class="pun">.</span><span class="pln">LAZY</span><span class="pun">)</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> country</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> city</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> street</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> streetNumber</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Audited</span><span class="pln">
</span><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Country"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

	</span><span class="lit">@Id</span><span class="pln">
	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

	</span><span class="com">//Getters and setters omitted for brevity</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-SQL" data-lang="SQL"><span class="pln">create table </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    city varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    street varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    streetNumber varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    country_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Address_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    REVEND integer</span><span class="pun">,</span><span class="pln">
    city varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    street varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    streetNumber varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    country_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Country</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Country_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    REVEND integer</span><span class="pun">,</span><span class="pln">
    name varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Customer</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    address_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table </span><span class="typ">Customer_AUD</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
    id bigint </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REV integer </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">
    REVTYPE tinyint</span><span class="pun">,</span><span class="pln">
    REVEND integer</span><span class="pun">,</span><span class="pln">
    created_on timestamp</span><span class="pun">,</span><span class="pln">
    firstName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    lastName varchar</span><span class="pun">(</span><span class="lit">255</span><span class="pun">),</span><span class="pln">
    address_id bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

create table REVINFO </span><span class="pun">(</span><span class="pln">
    REV integer generated </span><span class="kwd">by</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> identity</span><span class="pun">,</span><span class="pln">
    REVTSTMP bigint</span><span class="pun">,</span><span class="pln">
    primary key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

alter table </span><span class="typ">Address</span><span class="pln">
add constraint </span><span class="typ">FKpr4rl83u5fv832kdihl6w3kii</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">country_id</span><span class="pun">)</span><span class="pln">
references </span><span class="typ">Country</span><span class="pln">

alter table </span><span class="typ">Address_AUD</span><span class="pln">
add constraint </span><span class="typ">FKgwp5sek4pjb4awy66sp184hrv</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
references REVINFO

alter table </span><span class="typ">Address_AUD</span><span class="pln">
add constraint FK52pqkpismfxg2b9tmwtncnk0d
foreign key </span><span class="pun">(</span><span class="pln">REVEND</span><span class="pun">)</span><span class="pln">
references REVINFO

alter table </span><span class="typ">Country_AUD</span><span class="pln">
add constraint </span><span class="typ">FKrix4g8hm9ui6sut5sy86ujggr</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
references REVINFO

alter table </span><span class="typ">Country_AUD</span><span class="pln">
add constraint </span><span class="typ">FKpjeqmdccv22y1lbtswjb84ghi</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">REVEND</span><span class="pun">)</span><span class="pln">
references REVINFO

alter table </span><span class="typ">Customer</span><span class="pln">
add constraint </span><span class="typ">FKfok4ytcqy7lovuiilldbebpd9</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">address_id</span><span class="pun">)</span><span class="pln">
references </span><span class="typ">Address</span><span class="pln">

alter table </span><span class="typ">Customer_AUD</span><span class="pln">
add constraint FK5ecvi1a0ykunrriib7j28vpdj
foreign key </span><span class="pun">(</span><span class="pln">REV</span><span class="pun">)</span><span class="pln">
references REVINFO

alter table </span><span class="typ">Customer_AUD</span><span class="pln">
add constraint </span><span class="typ">FKqd4fy7ww1yy95wi4wtaonre3f</span><span class="pln">
foreign key </span><span class="pun">(</span><span class="pln">REVEND</span><span class="pun">)</span><span class="pln">
references REVINFO</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="envers-mappingexceptions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-mappingexceptions"></a>21.20. Mapping exceptions</h3>
<div class="sect3">
<h4 id="_what_isn_t_and_will_not_be_supported"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_what_isn_t_and_will_not_be_supported"></a>21.20.1. What isnâ€™t and will not be supported</h4>
<div class="paragraph">
<p>Bags are not supported because they can contain non-unique elements.
Persisting, a bag of `String`s violates the relational database principle that each table is a set of tuples.</p>
</div>
<div class="paragraph">
<p>In case of bags, however (which require a join table), if there is a duplicate element, the two tuples corresponding to the elements will be the same.
Although Hibernate allows this, Envers (or more precisely: the database connector) will throw an exception when trying to persist two identical elements because of a unique constraint violation.</p>
</div>
<div class="paragraph">
<p>There are at least two ways out if you need bag semantics:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use an indexed collection, with the <code>@javax.persistence.OrderColumn</code> annotation</p>
</li>
<li>
<p>provide a unique id for your elements with the <code>@CollectionId</code> annotation.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_what_isn_t_and_em_will_em_be_supported"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_what_isn_t_and_em_will_em_be_supported"></a>21.20.2. What isnâ€™t and <em>will</em> be supported</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bag style collections with a <code>@CollectionId</code> identifier column (see <a href="https://hibernate.atlassian.net/browse/HHH-3950">HHH-3950</a>).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_onetomany_code_with_code_joincolumn_code"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_code_onetomany_code_with_code_joincolumn_code"></a>21.21. <code>@OneToMany</code> with <code>@JoinColumn</code></h3>
<div class="paragraph">
<p>When a collection is mapped using these two annotations, Hibernate doesnâ€™t generate a join table.
Envers, however, has to do this so that when you read the revisions in which the related entity has changed, you donâ€™t get false results.</p>
</div>
<div class="paragraph">
<p>To be able to name the additional join table, there is a special annotation: <code>@AuditJoinTable</code>, which has similar semantics to JPA <code>@JoinTable</code>.</p>
</div>
<div class="paragraph">
<p>One special case is to have relations mapped with <code>@OneToMany</code> with <code>@JoinColumn</code> on the one side, and <code>@ManyToOne</code> and <code>@JoinColumn( insertable=false, updatable=false</code>) on the many side.
Such relations are, in fact, bidirectional, but the owning side is the collection.</p>
</div>
<div class="paragraph">
<p>To properly audit such relations with Envers, you can use the <code>@AuditMappedBy</code> annotation.
It enables you to specify the reverse property (using the <code>mappedBy</code> element).
In case of indexed collections, the index column must also be mapped in the referenced entity (using <code>@Column( insertable=false, updatable=false )</code>, and specified using <code>positionMappedBy</code>.
This annotation will affect only the way Envers works.
Please note that the annotation is experimental and may change in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning"></a>21.22. Advanced: Audit table partitioning</h3>

</div>
<div class="sect2">
<h3 id="envers-partitioning-benefits"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning-benefits"></a>21.23. Benefits of audit table partitioning</h3>
<div class="paragraph">
<p>Because audit tables tend to grow indefinitely, they can quickly become really large.
When the audit tables have grown to a certain limit (varying per RDBMS and/or operating system) it makes sense to start using table partitioning.
SQL table partitioning offers a lot of advantages including, but certainly not limited to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Improved query performance by selectively moving rows to various partitions (or even purging old rows)</p>
</li>
<li>
<p>Faster data loads, index creation, etc.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-columns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning-columns"></a>21.24. Suitable columns for audit table partitioning</h3>
<div class="paragraph">
<p>Generally, SQL tables must be partitioned on a column that exists within the table.
As a rule, it makes sense to use either the <em>end revision</em> or the <em>end revision timestamp</em> column for partitioning of audit tables.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>End revision information is not available for the default <code>AuditStrategy</code>.</p>
</div>
<div class="paragraph">
<p>Therefore the following Envers configuration options are required:</p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy</code> = <code>org.hibernate.envers.strategy.ValidityAuditStrategy</code></p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> = <code>true</code></p>
</div>
<div class="paragraph">
<p>Optionally, you can also override the default values using following properties:</p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_end_rev_field_name</code></p>
</div>
<div class="paragraph">
<p><code>org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</code></p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-configuration">Configuration Properties</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The reason why the end revision information should be used for audit table partitioning is based on the assumption that audit tables should be partitioned on an 'increasing level of relevancy', like so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A couple of partitions with audit data that is not very (or no longer) relevant.
This can be stored on slow media, and perhaps even be purged eventually.</p>
</li>
<li>
<p>Some partitions for audit data that is potentially relevant.</p>
</li>
<li>
<p>One partition for audit data that is most likely to be relevant.
This should be stored on the fastest media, both for reading and writing.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning-example"></a>21.25. Audit table partitioning example</h3>
<div class="paragraph">
<p>In order to determine a suitable column for the 'increasing level of relevancy',
consider a simplified example of a salary registration for an unnamed agency.</p>
</div>
<div class="paragraph">
<p>Currently, the salary table contains the following rows for a certain person X:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Salaries table</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Year</th>
<th class="tableblock halign-left valign-top">Salary (USD)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3300</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4500</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The salary for the current fiscal year (2010) is unknown.
The agency requires that all changes in registered salaries for a fiscal year are recorded (i.e. an audit trail).
The rationale behind this is that decisions made at a certain date are based on the registered salary at that time.
And at any time it must be possible reproduce the reason why a certain decision was made at a certain date.</p>
</div>
<div class="paragraph">
<p>The following audit information is available, sorted on in order of occurrence:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. Salaries - audit table</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Year</th>
<th class="tableblock halign-left valign-top">Revision type</th>
<th class="tableblock halign-left valign-top">Revision timestamp</th>
<th class="tableblock halign-left valign-top">Salary (USD)</th>
<th class="tableblock halign-left valign-top">End revision timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-02</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-04-02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-07-01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009-07-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-02-01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MOD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-02-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-04-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example-column"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning-example-column"></a>21.26. Determining a suitable partitioning column</h3>
<div class="paragraph">
<p>To partition this data, the <em>level of relevancy</em> must be defined. Consider the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For the fiscal year 2006, there is only one revision.
It has the oldest <em>revision timestamp</em> of all audit rows,
but should still be regarded as relevant because itâ€™s the latest modification for this fiscal year in the salary table (its <em>end revision timestamp</em> is null).</p>
<div class="paragraph">
<p>Also, note that it would be very unfortunate if in 2011 there would be an update of the salary for the fiscal year 2006 (which is possible until at least 10 years after the fiscal year),
and the audit information would have been moved to a slow disk (based on the age of the <em>revision timestamp</em>).
Remember that, in this case, Envers will have to update the <em>end revision timestamp</em> of the most recent audit row.</p>
</div>
</li>
<li>
<p>There are two revisions in the salary of the fiscal year 2007 which both have nearly the same <em>revision timestamp</em> and a different <em>end revision timestamp</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On first sight, it is evident that the first revision was a mistake and probably not relevant.
The only relevant revision for 2007 is the one with <em>end revision timestamp</em> null.</p>
</div>
<div class="paragraph">
<p>Based on the above, it is evident that only the <em>end revision timestamp</em> is suitable for audit table partitioning.
The <em>revision timestamp</em> is not suitable.</p>
</div>
</div>
<div class="sect2">
<h3 id="envers-partitioning-example-scheme"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-partitioning-example-scheme"></a>21.27. Determining a suitable partitioning scheme</h3>
<div class="paragraph">
<p>A possible partitioning scheme for the salary table would be as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>end revision timestamp</em> year = 2008</dt>
<dd>
<p>This partition contains audit data that is not very (or no longer) relevant.</p>
</dd>
<dt class="hdlist1"><em>end revision timestamp</em> year = 2009</dt>
<dd>
<p>This partition contains audit data that is potentially relevant.</p>
</dd>
<dt class="hdlist1"><em>end revision timestamp</em> year &gt;= 2010 or null</dt>
<dd>
<p>This partition contains the most relevant audit data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This partitioning scheme also covers the potential problem of the update of the <em>end revision timestamp</em>,
which occurs if a row in the audited table is modified.
Even though Envers will update the <em>end revision timestamp</em> of the audit row to the system date at the instant of modification,
the audit row will remain in the same partition (the 'extension bucket').</p>
</div>
<div class="paragraph">
<p>And sometime in 2011, the last partition (or 'extension bucket') is split into two new partitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>end revision timestamp</em> year = 2010:: This partition contains audit data that is potentially relevant (in 2011).</p>
</li>
<li>
<p><em>end revision timestamp</em> year &gt;= 2011 or null:: This partition contains the most interesting audit data and is the new 'extension bucket'.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="envers-links"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#envers-links"></a>21.28. Envers links</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://hibernate.org/">Hibernate main page</a></p>
</li>
<li>
<p><a href="http://community.jboss.org/en/envers?view=discussions">Forum</a></p>
</li>
<li>
<p><a href="https://hibernate.atlassian.net/">JIRA issue tracker</a> (when adding issues concerning Envers, be sure to select the "envers" component!)</p>
</li>
<li>
<p><a href="https://hibernate.hipchat.com/chat/room/1238636">HipChat channel</a></p>
</li>
<li>
<p><a href="https://community.jboss.org/wiki/EnversFAQ">FAQ</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="portability"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability"></a>22. Database Portability Considerations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="portability-basics"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-basics"></a>22.1. Portability Basics</h3>
<div class="paragraph">
<p>One of the selling points of Hibernate (and really Object/Relational Mapping as a whole) is the notion of database portability.
This could mean an internal IT user migrating from one database vendor to another, or it could mean a framework or deployable application consuming Hibernate to simultaneously target multiple database products by their users.
Regardless of the exact scenario, the basic idea is that you want Hibernate to help you run against any number of databases without changes to your code, and ideally without any changes to the mapping metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-dialect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-dialect"></a>22.2. Dialect</h3>
<div class="paragraph">
<p>The first line of portability for Hibernate is the dialect, which is a specialization of the <code>org.hibernate.dialect.Dialect</code> contract.
A dialect encapsulates all the differences in how Hibernate must communicate with a particular database to accomplish some task like getting a sequence value or structuring a SELECT query.
Hibernate bundles a wide range of dialects for many of the most popular databases.
If you find that your particular database is not among them, it is not terribly difficult to write your own.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-dialectresolver"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-dialectresolver"></a>22.3. Dialect resolution</h3>
<div class="paragraph">
<p>Originally, Hibernate would always require that users specify which dialect to use. In the case of users looking to simultaneously target multiple databases with their build that was problematic.
Generally, this required their users to configure the Hibernate dialect or defining their own method of setting that value.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.2, Hibernate introduced the notion of automatically detecting the dialect to use based on the <code>java.sql.DatabaseMetaData</code> obtained from a <code>java.sql.Connection</code> to that database.
This was much better, except that this resolution was limited to databases Hibernate know about ahead of time and was in no way configurable or overrideable.</p>
</div>
<div class="paragraph">
<p>Starting with version 3.3, Hibernate has a fare more powerful way to automatically determine which dialect to should be used by relying on a series of delegates which implement the <code>org.hibernate.dialect.resolver.DialectResolver</code> which defines only a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="typ">Dialect</span><span class="pln"> resolveDialect</span><span class="pun">(</span><span class="typ">DatabaseMetaData</span><span class="pln"> metaData</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">JDBCConnectionException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic contract here is that if the resolver 'understands' the given database metadata then it returns the corresponding Dialect; if not it returns null and the process continues to the next resolver.
The signature also identifies <code>org.hibernate.exception.JDBCConnectionException</code> as possibly being thrown.
A <code>JDBCConnectionException</code> here is interpreted to imply a <em>non-transient</em> (aka non-recoverable) connection problem and is used to indicate an immediate stop to resolution attempts.
All other exceptions result in a warning and continuing on to the next resolver.</p>
</div>
<div class="paragraph">
<p>The cool part about these resolvers is that users can also register their own custom resolvers which will be processed ahead of the built-in Hibernate ones.
This might be useful in a number of different situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it allows easy integration for auto-detection of dialects beyond those shipped with Hibernate itself</p>
</li>
<li>
<p>it allows you to specify to use a custom dialect when a particular database is recognized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To register one or more resolvers, simply specify them (separated by commas, tabs or spaces) using the 'hibernate.dialect_resolvers' configuration setting (see the <code>DIALECT_RESOLVERS</code> constant on <code>org.hibernate.cfg.Environment</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-idgen"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-idgen"></a>22.4. Identifier generation</h3>
<div class="paragraph">
<p>When considering portability between databases, another important decision is selecting the identifier generation strategy you want to use.
Originally, Hibernate provided the <em>native</em> generator for this purpose, which was intended to select between a <em>sequence</em>, <em>identity</em>, or <em>table</em> strategy depending on the capability of the underlying database.</p>
</div>
<div class="paragraph">
<p>However, an insidious implication of this approach comes about when targeting some databases which support <em>identity</em> generation and some which do not.
<em>identity</em> generation relies on the SQL definition of an IDENTITY (or auto-increment) column to manage the identifier value.
It is what is known as a <em>post-insert</em> generation strategy because the insert must actually happen before we can know the identifier value.</p>
</div>
<div class="paragraph">
<p>Because Hibernate relies on this identifier value to uniquely reference entities within a persistence context,
it must then issue the insert immediately when the user requests that the entity be associated with the session (e.g. like via <code>save()</code> or <code>persist()</code>), regardless of current transactional semantics.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hibernate was changed slightly, once the implications of this were better understood, so now the insert could be delayed in cases where this is feasible.</p>
</div>
<div class="paragraph">
<p>The underlying issue is that the actual semantics of the application itself changes in these cases.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Starting with version 3.2.3, Hibernate comes with a set of <a href="http://in.relation.to/2082.lace">enhanced</a> identifier generators targeting portability in a much different way.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are specifically 2 bundled <em>enhanced</em>generators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.hibernate.id.enhanced.SequenceStyleGenerator</code></p>
</li>
<li>
<p><code>org.hibernate.id.enhanced.TableGenerator</code></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The idea behind these generators is to port the actual semantics of the identifier value generation to the different databases.
For example, the <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code> mimics the behavior of a sequence on databases which do not support sequences by using a table.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability-functions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-functions"></a>22.5. Database functions</h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an area in Hibernate in need of improvement.
In terms of portability concerns, this function handling currently works pretty well in HQL, however, it is quite lacking in all other aspects.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>SQL functions can be referenced in many ways by users.
However, not all databases support the same set of functions.
Hibernate, provides a means of mapping a <em>logical</em> function name to a delegate which knows how to render that particular function, perhaps even using a totally different physical function call.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically this function registration is handled through the <code>org.hibernate.dialect.function.SQLFunctionRegistry</code> class which is intended to allow users to provide custom function definitions without having to provide a custom dialect.
This specific behavior is not fully completed as of yet.</p>
</div>
<div class="paragraph">
<p>It is sort of implemented such that users can programmatically register functions with the <code>org.hibernate.cfg.Configuration</code> and those functions will be recognized for HQL.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="portability-types"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-types"></a>22.6. Type mappings</h3>
<div class="paragraph">
<p>TODO: document the following as well</p>
</div>
<div class="sect3">
<h4 id="portability-types-lobs"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-types-lobs"></a>22.6.1. BLOB/CLOB mappings</h4>

</div>
<div class="sect3">
<h4 id="portability-types-bool"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#portability-types-bool"></a>22.6.2. Boolean mappings</h4>
<div class="paragraph">
<p>JPA portability</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HQL/JPQL differences</p>
</li>
<li>
<p>naming strategies</p>
</li>
<li>
<p>basic types</p>
</li>
<li>
<p>simple id types</p>
</li>
<li>
<p>generated id types</p>
</li>
<li>
<p>composite ids and many-to-one</p>
</li>
<li>
<p>"embedded composite identifiers"</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configurations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations"></a>23. Configurations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configurations-strategy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-strategy"></a>23.1. Strategy configurations</h3>
<div class="paragraph">
<p>Many configuration settings define pluggable strategies that Hibernate uses for various purposes.
The configurations of many of these strategy type settings accept definition in various forms.
The documentation of such configuration settings refers here.
The types of forms available in such cases include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">short name (if defined)</dt>
<dd>
<p>Certain built-in strategy implementations have a corresponding short name.</p>
</dd>
<dt class="hdlist1">strategy instance</dt>
<dd>
<p>An instance of the strategy implementation to use can be specified</p>
</dd>
<dt class="hdlist1">strategy Class reference</dt>
<dd>
<p>A <code>java.lang.Class</code> reference of the strategy implementation to use</p>
</dd>
<dt class="hdlist1">strategy Class name</dt>
<dd>
<p>The class name (<code>java.lang.String</code>) of the strategy implementation to use</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-general"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-general"></a>23.2. General configuration</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.dialect</strong></code> (e.g. <code>org.hibernate.dialect.PostgreSQL94Dialect</code>)</dt>
<dd>
<p>The class name of a Hibernate <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html"><code>Dialect</code></a> from which Hibernate can generate SQL optimized for a particular relational database.</p>
<div class="paragraph">
<p>In most cases, Hibernate can choose the correct <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html"><code>Dialect</code></a> implementation based on the JDBC metadata returned by the JDBC driver.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.current_session_context_class</strong></code> (e.g. <code>jta</code>, <code>thread</code>, <code>managed</code>, or a custom class implementing <code>org.hibernate.context.spi.CurrentSessionContext</code>)</dt>
<dd>
<div class="paragraph">
<p>Supply a custom strategy for the scoping of the <em>current</em> <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>The definition of what exactly <em>current</em> means is controlled by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/spi/CurrentSessionContext.html"><code>CurrentSessionContext</code></a> implementation in use.</p>
</div>
<div class="paragraph">
<p>Note that for backward compatibility, if a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/spi/CurrentSessionContext.html"><code>CurrentSessionContext</code></a> is not configured but JTA is configured this will default to the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/internal/JTASessionContext.html"><code>JTASessionContext</code></a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-jpa-compliance"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-jpa-compliance"></a>23.3. JPA compliance</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.transaction</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>This setting controls if Hibernate  <code>Transaction</code> should behave as defined by the spec for JPAâ€™s <code>javax.persistence.EntityTransaction</code>
since it extends the JPA one.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.query</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Controls whether Hibernateâ€™s handling of <code>javax.persistence.Query</code> (JPQL, Criteria and native-query) should strictly follow the JPA spec.</p>
<div class="paragraph">
<p>This includes both in terms of parsing or translating a query as well as calls to the <code>javax.persistence.Query</code> methods throwing spec
defined exceptions whereas Hibernate might not.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.list</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Controls whether Hibernate should recognize what it considers a "bag" (<code>org.hibernate.collection.internal.PersistentBag</code>)
as a List (<code>org.hibernate.collection.internal.PersistentList</code>) or as a bag.</p>
<div class="paragraph">
<p>If enabled, we will recognize it as a List where <code>javax.persistence.OrderColumn</code>
is just missing (and its defaults will apply).</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.closed</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>JPA defines specific exceptions upon calling specific methods on <code>javax.persistence.EntityManager</code> and <code>javax.persistence.EntityManagerFactory</code>
objects which have been closed previously.</p>
<div class="paragraph">
<p>This setting controls whether the JPA spec-defined behavior or the Hibernate behavior will be used.</p>
</div>
<div class="paragraph">
<p>If enabled, Hibernate will operate in the JPA specified way, throwing exceptions when the spec says it should.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.proxy</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>The JPA spec says that a <code>javax.persistence.EntityNotFoundException</code> should be thrown when accessing an entity Proxy
which does not have an associated table row in the database.</p>
<div class="paragraph">
<p>Traditionally, Hibernate does not initialize an entity proxy when accessing its identifier since we already know the identifier value,
hence we can save a database roundtrip.</p>
</div>
<div class="paragraph">
<p>If enabled Hibernate will initialize the entity proxy even when accessing its identifier.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.compliance.global_id_generators</strong></code> (e.g. <code>true</code> or <code>false</code> (default value) )</dt>
<dd>
<p>The JPA spec says that the scope of TableGenerator and SequenceGenerator names is global to the persistence unit (across all generator types).</p>
<div class="paragraph">
<p>Traditionally, Hibernate has considered the names locally scoped.</p>
</div>
<div class="paragraph">
<p>If enabled, the names used by <code>@TableGenerator</code> and <code>@SequenceGenerator</code> will be considered global so configuring two different generators
with the same name will cause a `java.lang.IllegalArgumentException' to be thrown at boot time.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-database-connection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-database-connection"></a>23.4. Database connection properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.connection.driver_class</strong></code> or <code><strong>javax.persistence.jdbc.driver</strong></code> (e.g. <code>org.postgresql.Driver</code>)</dt>
<dd>
<p>Names the JDBC <code>Driver</code> class name.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.url</strong></code> or <code><strong>javax.persistence.jdbc.url</strong></code> (e.g. <code>jdbc:postgresql:hibernate_orm_test</code>)</dt>
<dd>
<p>Names the JDBC connection URL.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.username</strong></code> or <code><strong>javax.persistence.jdbc.user</strong></code></dt>
<dd>
<p>Names the JDBC connection user name.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.password</strong></code> or <code><strong>javax.persistence.jdbc.password</strong></code></dt>
<dd>
<p>Names the JDBC connection password.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.isolation</strong></code> (e.g. <code>REPEATABLE_READ</code> or <code>Connection.TRANSACTION_REPEATABLE_READ</code>)</dt>
<dd>
<p>Names the JDBC connection transaction isolation level.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.autocommit</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Names the initial autocommit mode for JDBC Connections returned from a connection pool created in certain ConnectionProvider impl.</p>
<div class="paragraph">
<p>See discussion of <code>hibernate.connection.provider_disables_autocommit</code> as well.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.provider_disables_autocommit</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Indicates a promise by the user that Connections that Hibernate obtains from the configured ConnectionProvider
have auto-commit disabled when they are obtained from that provider, whether that provider is backed by
a DataSource or some other Connection pooling mechanism.  Generally, this occurs when:</p>
<div class="ulist">
<ul>
<li>
<p>Hibernate is configured to get Connections from an underlying DataSource, and that DataSource is already configured to disable auto-commit on its managed Connections</p>
</li>
<li>
<p>Hibernate is configured to get Connections from a non-DataSource connection pool and that connection pool is already configured to disable auto-commit.
For the Hibernate provided implementation this will depend on the value of <code>hibernate.connection.autocommit</code> setting.</p>
<div class="paragraph">
<p>Hibernate uses this assurance as an opportunity to opt-out of certain operations that may have a performance
impact (although this impact is generally negligible).  Specifically, when a transaction is started via the
Hibernate or JPA transaction APIs Hibernate will generally immediately acquire a Connection from the
provider and:</p>
</div>
</li>
<li>
<p>check whether the Connection is initially in auto-commit mode via a call to <code>Connection#getAutocommit</code> to know how to clean up the Connection when released.</p>
</li>
<li>
<p>start a JDBC transaction by calling <code>Connection#setAutocommit(false)</code></p>
<div class="paragraph">
<p>We can skip both of those steps if we know that the ConnectionProvider will always return Connections with auto-commit disabled.
That is the purpose of this setting.  By setting it to <code>true</code>, the <code>Connection</code> acquisition can be delayed until the first
SQL statement is needed to be executed.  The connection acquisition delay allows you to reduce the database connection lease
time, therefore allowing you to increase the transaction throughput.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>It is <strong>inappropriate</strong> to set this value to <code>true</code> when the Connections Hibernate gets
from the provider do not, in fact, have auto-commit disabled.</p>
</div>
<div class="paragraph">
<p>Doing so will lead to Hibernate executing SQL operations outside of any JDBC/SQL transaction.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.datasource</strong></code></dt>
<dd>
<p>Either a <code>javax.sql.DataSource</code> instance or a JNDI name under which to locate the <code>DataSource</code>.</p>
<div class="paragraph">
<p>For JNDI names, ses also <code>hibernate.jndi.class</code>, <code>hibernate.jndi.url</code>, <code>hibernate.jndi</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection</strong></code></dt>
<dd>
<p>Names a prefix used to define arbitrary JDBC connection properties. These properties are passed along to the JDBC provider when creating a connection.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.provider_class</strong></code> (e.g. <code>org.hibernate.hikaricp.internal. HikariCPConnectionProvider</code>)</dt>
<dd>
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/connections/spi/ConnectionProvider.html"><code>ConnectionProvider</code></a> to use for obtaining JDBC connections.</p>
<div class="paragraph">
<p>Can reference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>ConnectionProvider</code></p>
</li>
<li>
<p>a <code>Class&lt;? extends ConnectionProvider</code> object reference</p>
</li>
<li>
<p>a fully qualified name of a class implementing <code>ConnectionProvider</code></p>
<div class="paragraph">
<p>The term <code>class</code> appears in the setting name due to legacy reasons. However, it can accept instances.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jndi.class</strong></code></dt>
<dd>
<p>Names the JNDI <code>javax.naming.InitialContext</code> class.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jndi.url</strong></code> (e.g. java:global/jdbc/default)</dt>
<dd>
<p>Names the JNDI provider/connection url.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jndi</strong></code></dt>
<dd>
<p>Names a prefix used to define arbitrary JNDI <code>javax.naming.InitialContext</code> properties.</p>
<div class="paragraph">
<p>These properties are passed along to <code>javax.naming.InitialContext#InitialContext(java.util.Hashtable)</code></p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.acquisition_mode</strong></code> (e.g. <code>immediate</code>)</dt>
<dd>
<p>Specifies how Hibernate should acquire JDBC connections. The possible values are given by <code>org.hibernate.ConnectionAcquisitionMode</code>.</p>
<div class="paragraph">
<p>Should generally only configure this or <code>hibernate.connection.release_mode</code>, not both.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.release_mode</strong></code> (e.g. <code>auto</code> (default value))</dt>
<dd>
<p>Specifies how Hibernate should release JDBC connections. The possible values are given by the current transaction mode (<code>after_transaction</code> for JDBC transactions and <code>after_statement</code> for JTA transactions).</p>
<div class="paragraph">
<p>Should generally only configure this or <code>hibernate.connection.acquisition_mode</code>, not both.</p>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_hibernate_internal_connection_pool_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_hibernate_internal_connection_pool_options"></a>23.4.1. Hibernate internal connection pool options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.connection.initial_pool_size</strong></code> (e.g. 1 (default value))</dt>
<dd>
<p>Minimum number of connections for the built-in Hibernate connection pool.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.pool_size</strong></code> (e.g. 20 (default value))</dt>
<dd>
<p>Maximum number of connections for the built-in Hibernate connection pool.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection.pool_validation_interval</strong></code> (e.g. 30 (default value))</dt>
<dd>
<p>The number of seconds between two consecutive pool validations. During validation, the pool size can increase or decreases based on the connection acquisition request count.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurations-c3p0"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-c3p0"></a>23.5. c3p0 properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.c3p0.min_size</strong></code> (e.g. 1)</dt>
<dd>
<p>Minimum size of C3P0 connection pool. Refers to <a href="http://www.mchange.com/projects/c3p0/#minPoolSize">c3p0 <code>minPoolSize</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0.max_size</strong></code> (e.g. 5)</dt>
<dd>
<p>Maximum size of C3P0 connection pool. Refers to <a href="http://www.mchange.com/projects/c3p0/#maxPoolSize">c3p0 <code>maxPoolSize</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0.timeout</strong></code> (e.g. 30)</dt>
<dd>
<p>Maximum idle time for C3P0 connection pool. Refers to <a href="http://www.mchange.com/projects/c3p0/#maxIdleTime">c3p0 <code>maxIdleTime</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0.max_statements</strong></code> (e.g. 5)</dt>
<dd>
<p>Maximum size of C3P0 statement cache. Refers to <a href="http://www.mchange.com/projects/c3p0/#maxStatements">c3p0 <code>maxStatements</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0.acquire_increment</strong></code> (e.g. 2)</dt>
<dd>
<p>The number of connections acquired at a time when thereâ€™s no connection available in the pool. Refers to <a href="http://www.mchange.com/projects/c3p0/#acquireIncrement">c3p0 <code>acquireIncrement</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0.idle_test_period</strong></code> (e.g. 5)</dt>
<dd>
<p>Idle time before a C3P0 pooled connection is validated. Refers to <a href="http://www.mchange.com/projects/c3p0/#idleConnectionTestPeriod">c3p0 <code>idleConnectionTestPeriod</code> setting</a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.c3p0</strong></code></dt>
<dd>
<p>A setting prefix used to indicate additional c3p0 properties that need to be passed to the underlying c3p0 connection pool.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-mapping"></a>23.6. Mapping Properties</h3>
<div class="sect3">
<h4 id="_table_qualifying_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_table_qualifying_options"></a>23.6.1. Table qualifying options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.default_catalog</strong></code> (e.g. A catalog name)</dt>
<dd>
<p>Qualifies unqualified table names with the given catalog in generated SQL.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.default_schema</strong></code> (e.g. A schema name)</dt>
<dd>
<p>Qualify unqualified table names with the given schema or tablespace in generated SQL.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.schema_name_resolver</strong></code> (e.g. The fully qualified name of an <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/env/spi/SchemaNameResolver.html"><code>org.hibernate.engine.jdbc.env.spi.SchemaNameResolver</code></a> implementation class)</dt>
<dd>
<p>By default, Hibernate uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html#getSchemaNameResolver--"><code>org.hibernate.dialect.Dialect#getSchemaNameResolver</code></a>.
You can customize how the schema name is resolved by providing a custom implementation of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/env/spi/SchemaNameResolver.html"><code>SchemaNameResolver</code></a> interface.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_identifier_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_identifier_options"></a>23.6.2. Identifier options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.id.new_generator_mappings</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Setting which indicates whether or not the new <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/id/IdentifierGenerator.html"><code>IdentifierGenerator</code></a> are used for <code>AUTO</code>, <code>TABLE</code> and <code>SEQUENCE</code>.</p>
<div class="paragraph">
<p>Existing applications may want to disable this (set it <code>false</code>) for upgrade compatibility from 3.x and 4.x to 5.x.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.use_identifier_rollback</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>If true, generated identifier properties are reset to default values when objects are deleted.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.id.optimizer.pooled.preferred</strong></code> (e.g. <code>none</code>, <code>hilo</code>, <code>legacy-hilo</code>, <code>pooled</code> (default value), <code>pooled-lo</code>, <code>pooled-lotl</code> or a fully-qualified name of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/id/enhanced/Optimizer.html"><code>Optimizer</code></a> implementation)</dt>
<dd>
<p>When a generator specified an increment-size and an optimizer was not explicitly specified, which of the <em>pooled</em> optimizers should be preferred?</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.id.generator.stored_last_used</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>If true, the value stored in the table used by the <code>@TableGenerator</code> is the last value used, if false the value is the next value to be used.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.model.generator_name_as_sequence_name</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>If true, the value specified by the <code>generator</code> attribute of the <code>@GeneratedValue</code> annotation should be used as the sequence/table name when no matching
<code>@SequenceGenerator</code> or <code>TableGenerator</code> is found.</p>
<div class="paragraph">
<p>The default value is <code>true</code> meaning that <code>@GeneratedValue.generator()</code> will be used as the sequence/table name by default.
Users migrating from earlier versions using the legacy <code>hibernate_sequence</code> name should disable this setting.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.identifier_generator_strategy_provider</strong></code> (e.g. fully-qualified class name or an actual the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/spi/IdentifierGeneratorStrategyProvider.html"><code>IdentifierGeneratorStrategyProvider</code></a> instance)</dt>
<dd>
<p>This setting allows you to provide an instance or the class implementing the <code>org.hibernate.jpa.spi.IdentifierGeneratorStrategyProvider</code> interface,
so you can provide a set of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/id/IdentifierGenerator.html"><code>IdentifierGenerator</code></a> strategies allowing to override the Hibernate Core default ones.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_quoting_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_quoting_options"></a>23.6.3. Quoting options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.globally_quoted_identifiers</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Should all database identifiers be quoted.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.globally_quoted_identifiers_skip_column_definitions</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Assuming <code>hibernate.globally_quoted_identifiers</code> is <code>true</code>, this allows the global quoting to skip column-definitions as defined by <code>javax.persistence.Column</code>,
<code>javax.persistence.JoinColumn</code>, etc, and while it avoids column-definitions being quoted due to global quoting, they can still be explicitly quoted in the annotation/xml mappings.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.auto_quote_keyword</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Specifies whether to automatically quote any names that are deemed keywords.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_discriminator_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_discriminator_options"></a>23.6.4. Discriminator options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.discriminator.implicit_for_joined</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>The legacy behavior of Hibernate is to not use discriminators for joined inheritance (Hibernate does not need the discriminator).
However, some JPA providers do need the discriminator for handling joined inheritance so, in the interest of portability, this capability has been added to Hibernate too.</p>
<div class="paragraph">
<p>Because want to make sure that legacy applications continue to work as well, that puts us in a bind in terms of how to handle <em>implicit</em> discriminator mappings.
The solution is to assume that the absence of discriminator metadata means to follow the legacy behavior <em>unless</em> this setting is enabled.</p>
</div>
<div class="paragraph">
<p>With this setting enabled, Hibernate will interpret the absence of discriminator metadata as an indication to use the JPA-defined defaults for these absent annotations.</p>
</div>
<div class="paragraph">
<p>See Hibernate Jira issue <a href="https://hibernate.atlassian.net/browse/HHH-6911">HHH-6911</a> for additional background info.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.discriminator.ignore_explicit_for_joined</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>The legacy behavior of Hibernate is to not use discriminators for joined inheritance (Hibernate does not need the discriminator).
However, some JPA providers do need the discriminator for handling joined inheritance so, in the interest of portability, this capability has been added to Hibernate too.</p>
<div class="paragraph">
<p>Existing applications rely (implicitly or explicitly) on Hibernate ignoring any <code>DiscriminatorColumn</code> declarations on joined inheritance hierarchies.
This setting allows these applications to maintain the legacy behavior of <code>DiscriminatorColumn</code> annotations being ignored when paired with joined inheritance.</p>
</div>
<div class="paragraph">
<p>See Hibernate Jira issue <a href="https://hibernate.atlassian.net/browse/HHH-6911">HHH-6911</a> for additional background info.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_naming_strategies"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_naming_strategies"></a>23.6.5. Naming strategies</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.implicit_naming_strategy</strong></code> (e.g. <code>default</code> (default value), <code>jpa</code>, <code>legacy-jpa</code>, <code>legacy-hbm</code>, <code>component-path</code>)</dt>
<dd>
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategy.html"><code>ImplicitNamingStrategy</code></a> class to use.
The following short names are defined for this setting:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>default</code></dt>
<dd>
<p>Uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategyJpaCompliantImpl.html"><code>ImplicitNamingStrategyJpaCompliantImpl</code></a></p>
</dd>
<dt class="hdlist1"><code>jpa</code></dt>
<dd>
<p>Uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategyJpaCompliantImpl.html"><code>ImplicitNamingStrategyJpaCompliantImpl</code></a></p>
</dd>
<dt class="hdlist1"><code>legacy-jpa</code></dt>
<dd>
<p>Uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategyLegacyJpaImpl.html"><code>ImplicitNamingStrategyLegacyJpaImpl</code></a></p>
</dd>
<dt class="hdlist1"><code>legacy-hbm</code></dt>
<dd>
<p>Uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategyLegacyHbmImpl.html"><code>ImplicitNamingStrategyLegacyHbmImpl</code></a></p>
</dd>
<dt class="hdlist1"><code>component-path</code></dt>
<dd>
<p>Uses the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/ImplicitNamingStrategyComponentPathImpl.html"><code>ImplicitNamingStrategyComponentPathImpl</code></a></p>
<div class="paragraph">
<p>If this property happens to be empty, the fallback is to use the <code>default</code> strategy.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.physical_naming_strategy</strong></code> (e.g. <code>org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</code> (default value))</dt>
<dd>
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/naming/PhysicalNamingStrategy.html"><code>PhysicalNamingStrategy</code></a> class to use.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_metadata_scanning_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_metadata_scanning_options"></a>23.6.6. Metadata scanning options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.archive.scanner</strong></code></dt>
<dd>
<p>Pass an implementation of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/archive/scan/spi/Scanner.html"><code>Scanner</code></a>.
By default, <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/archive/scan/internal/StandardScanner.html"><code>StandardScanner</code></a> is used.</p>
<div class="paragraph">
<p>Accepts either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an actual <code>Scanner</code> instance</p>
</li>
<li>
<p>a reference to a Class that implements <code>Scanner</code></p>
</li>
<li>
<p>a fully qualified name of a Class that implements <code>Scanner</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.archive.interpreter</strong></code></dt>
<dd>
<p>Pass <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/archive/spi/ArchiveDescriptorFactory.html"><code>ArchiveDescriptorFactory</code></a> to use in the scanning process.</p>
<div class="paragraph">
<p>Accepts either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an actual <code>ArchiveDescriptorFactory</code> instance</p>
</li>
<li>
<p>a reference to a Class that implements <code>ArchiveDescriptorFactory</code></p>
</li>
<li>
<p>a fully qualified name of a Class that implements <code>ArchiveDescriptorFactory</code></p>
<div class="paragraph">
<p>See information on <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/archive/scan/spi/Scanner.html"><code>Scanner</code></a> about expected constructor forms.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.archive.autodetection</strong></code> (e.g. <code>hbm,class</code> (default value))</dt>
<dd>
<p>Identifies a comma-separate list of values indicating the mapping types we should auto-detect during scanning.</p>
<div class="paragraph">
<p>Allowable values include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>class</code></dt>
<dd>
<p>scan classes (e.g. <code>.class</code>) to extract entity mapping metadata</p>
</dd>
<dt class="hdlist1"><code>hbm</code></dt>
<dd>
<p>scan <code>hbm</code> mapping files (e.g. <code>hbm.xml</code>) to extract entity mapping metadata</p>
<div class="paragraph">
<p>By default both HBM, annotations, and JPA XML mappings are scanned.</p>
</div>
<div class="paragraph">
<p>When using JPA, to disable the automatic scanning of all entity classes, the <code>exclude-unlisted-classes</code> <code>persistence.xml</code> element must be set to true.
Therefore, when setting <code>exclude-unlisted-classes</code> to true, only the classes that are explicitly declared in the <code>persistence.xml</code> configuration files are going to be taken into consideration.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.mapping.precedence</strong></code> (e.g. <code>hbm,class</code> (default value))</dt>
<dd>
<p>Used to specify the order in which metadata sources should be processed.
Value is a delimited-list whose elements are defined by <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/cfg/MetadataSourceType.html"><code>MetadataSourceType</code></a>.</p>
<div class="paragraph">
<p>The default is <code>hbm,class"</code>, therefore <code>hbm.xml</code> files are processed first, followed by annotations (combined with <code>orm.xml</code> mappings).</p>
</div>
<div class="paragraph">
<p>When using JPA, the XML mapping overrides a conflicting annotation mapping that targets the same entity attribute.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_related_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_jdbc_related_options"></a>23.6.7. JDBC-related options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.use_nationalized_character_data</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable nationalized character support on all string / clob based attribute ( string, char, clob, text etc ).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.lob.non_contextual_creation</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Should we not use contextual LOB creation (aka based on <code>java.sql.Connection#createBlob()</code> et al)? The default value for HANA, H2, and PostgreSQL is <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.time_zone</strong></code> (e.g. A <code>java.util.TimeZone</code>, a <code>java.time.ZoneId</code> or a <code>String</code> representation of a <code>ZoneId</code>)</dt>
<dd>
<p>Unless specified, the JDBC Driver uses the default JVM time zone. If a different time zone is configured via this setting, the JDBC <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setTimestamp-int-java.sql.Timestamp-java.util.Calendar-">PreparedStatement#setTimestamp</a> is going to use a <code>Calendar</code> instance according to the specified time zone.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.dialect.oracle.prefer_long_raw</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>This setting applies to Oracle Dialect only, and it specifies whether <code>byte[]</code> or <code>Byte[]</code> arrays should be mapped to the deprecated <code>LONG RAW</code> (when this configuration property value is <code>true</code>) or to a <code>BLOB</code> column type (when this configuration property value is <code>false</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_bean_validation_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_bean_validation_options"></a>23.6.8. Bean Validation options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>javax.persistence.validation.factory</strong></code> (e.g. <code>javax.validation.ValidationFactory</code> implementation)</dt>
<dd>
<p>Specify the  <code>javax.validation.ValidationFactory</code> implementation to use for Bean Validation.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.check_nullability</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Enable nullability checking. Raises an exception if a property marked as not-null is null.</p>
<div class="paragraph">
<p>Default to <code>false</code> if Bean Validation is present in the classpath and Hibernate Annotations is used, <code>true</code> otherwise.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.validator.apply_to_ddl</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<div class="paragraph">
<p>Bean Validation constraints will be applied in DDL if the automatic schema generation is enabled.
In other words, the database schema will reflect the Bean Validation constraints.</p>
</div>
<div class="paragraph">
<p>To disable constraint propagation to DDL, set up <code>hibernate.validator.apply_to_ddl</code> to <code>false</code> in the configuration file.
Such a need is very uncommon and not recommended.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_misc_options"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_misc_options"></a>23.6.9. Misc options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.create_empty_composites.enabled</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable instantiation of composite/embeddable objects when all of its attribute values are <code>null</code>. The default (and historical) behavior is that a <code>null</code> reference will be used to represent the composite when all of its attributes are <code>null</code>.</p>
<div class="paragraph">
<p>This is an experimental feature that has known issues. It should not be used in production until it is stabilized. See Hibernate Jira issue <a href="https://hibernate.atlassian.net/browse/HHH-11936">HHH-11936</a> for details.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.entity_dirtiness_strategy</strong></code> (e.g. fully-qualified class name or an actual <code>CustomEntityDirtinessStrategy</code> instance)</dt>
<dd>
<p>Setting to identify a <code>org.hibernate.CustomEntityDirtinessStrategy</code> to use.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.default_entity_mode</strong></code> (e.g. <code>pojo</code> (default value) or <code>dynamic-map</code>)</dt>
<dd>
<p>Default <code>EntityMode</code> for entity representation for all sessions opened from this <code>SessionFactory</code>, defaults to <code>pojo</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurations-bytecode-enhancement"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-bytecode-enhancement"></a>23.7. Bytecode Enhancement Properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableDirtyTracking</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable dirty tracking feature in runtime bytecode enhancement.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableLazyInitialization</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable lazy loading feature in runtime bytecode enhancement. This way, even basic types (e.g. <code>@Basic(fetch = FetchType.LAZY</code>)) can be fetched lazily.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.enhancer.enableAssociationManagement</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable association management feature in runtime bytecode enhancement which automatically synchronizes a bidirectional association when only one side is changed.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.bytecode.provider</strong></code> (e.g. <code>bytebuddy</code> (default value))</dt>
<dd>
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/bytecode/spi/BytecodeProvider.html"><code>BytecodeProvider</code></a> built-in implementation flavor. Currently, only <code>bytebuddy</code> and <code>javassist</code> are valid values.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.bytecode.use_reflection_optimizer</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Should we use reflection optimization? The reflection optimizer implements the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/bytecode/spi/ReflectionOptimizer.html"><code>ReflectionOptimizer</code></a> interface and improves entity instantiation and property getter/setter calls.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.bytecode.enforce_legacy_proxy_classnames</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Some other libraries, such as Spring, used to depend on a specific naming pattern used for proxy classes generated at runtime. Set this to <code>true</code> to have proxy class names conform to the old pattern.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-query"></a>23.8. Query settings</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.query.plan_cache_max_size</strong></code> (e.g. <code>2048</code> (default value))</dt>
<dd>
<p>The maximum number of entries including:
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/query/spi/HQLQueryPlan.html"><code>HQLQueryPlan</code></a>,
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/query/spi/FilterQueryPlan.html"><code>FilterQueryPlan</code></a>,
<a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/query/spi/NativeSQLQueryPlan.html"><code>NativeSQLQueryPlan</code></a>.</p>
<div class="paragraph">
<p>Maintained by <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/query/spi/QueryPlanCache.html"><code>QueryPlanCache</code></a>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.plan_parameter_metadata_max_size</strong></code> (e.g. <code>128</code> (default value))</dt>
<dd>
<p>The maximum number of strong references associated with <code>ParameterMetadata</code> maintained by <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/query/spi/QueryPlanCache.html"><code>QueryPlanCache</code></a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.order_by.default_null_ordering</strong></code> (e.g. <code>none</code>, <code>first</code> or <code>last</code>)</dt>
<dd>
<p>Defines precedence of null values in <code>ORDER BY</code> clause. Defaults to <code>none</code> which varies between RDBMS implementation.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.discriminator.force_in_select</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>For entities which do not explicitly say, should we force discriminators into SQL selects?</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.substitutions</strong></code> (e.g. <code>true=1,false=0</code>)</dt>
<dd>
<p>A comma-separated list of token substitutions to use when translating a Hibernate query to SQL.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.factory_class</strong></code> (e.g. <code>org.hibernate.hql.internal.ast.ASTQueryTranslatorFactory</code> (default value) or <code>org.hibernate.hql.internal.classic.ClassicQueryTranslatorFactory</code>)</dt>
<dd>
<p>Chooses the HQL parser implementation.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.jpaql_strict_compliance</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Map from tokens in Hibernate queries to SQL tokens, such as function or literal names.</p>
<div class="paragraph">
<p>Should we strictly adhere to JPA Query Language (JPQL) syntax, or more broadly support all of Hibernateâ€™s superset (HQL)?</p>
</div>
<div class="paragraph">
<p>Setting this to <code>true</code> may cause valid HQL to throw an exception because it violates the JPQL subset.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.startup_check</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Should named queries be checked during startup?</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.proc.param_null_passing</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Global setting for whether <code>null</code> parameter bindings should be passed to database procedure/function calls as part of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/procedure/ProcedureCall.html"><code>ProcedureCall</code></a> handling.
Implicitly Hibernate will not pass the <code>null</code>, the intention being to allow any default argument values to be applied.</p>
<div class="paragraph">
<p>This defines a global setting, which can then be controlled per parameter via <code>org.hibernate.procedure.ParameterRegistration#enablePassingNulls(boolean)</code></p>
</div>
<div class="paragraph">
<p>Values are <code>true</code> (pass the NULLs) or <code>false</code> (do not pass the NULLs).</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.log.warnings</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Enable fetching JDBC statement warning for logging. Default value is given by <code>org.hibernate.dialect.Dialect#isJdbcLogWarningsEnabledByDefault()</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session_factory.statement_inspector</strong></code> (e.g. A fully-qualified class name, an instance, or a <code>Class</code> object reference)</dt>
<dd>
<p>Names a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/resource/jdbc/spi/StatementInspector.html"><code>StatementInspector</code></a> implementation to be applied to every <code>Session</code> created by the current <code>SessionFactory</code>.</p>
<div class="paragraph">
<p>Can reference a
<code>StatementInspector</code> instance,
<code>StatementInspector</code> implementation <code>Class</code> reference or
<code>StatementInspector</code> implementation class name (fully-qualified class name).</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.validate_parameters</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>This configuration property can be used to disable parameters validation performed by <code>org.hibernate.query.Query#setParameter</code> when the Session is bootstrapped via JPA
<code>javax.persistence.EntityManagerFactory</code></p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.criteria.literal_handling_mode</strong></code> (e.g. <code>AUTO</code> (default value), <code>BIND</code> or <code>INLINE</code>)</dt>
<dd>
<p>By default, Criteria queries uses bind parameters for any literal that is not a numeric value.
However, to increase the likelihood of JDBC statement caching, you might want to use bind parameters for numeric values too.</p>
<div class="paragraph">
<p>The <code>org.hibernate.query.criteria.LiteralHandlingMode#BIND</code> mode will use bind variables for any literal value.
The <code>org.hibernate.query.criteria.LiteralHandlingMode#INLINE</code> mode will inline literal values as-is.</p>
</div>
<div class="paragraph">
<p>To prevent SQL injection, never use <code>org.hibernate.query.criteria.LiteralHandlingMode#INLINE</code> with String variables.
Always use constants with the <code>org.hibernate.query.criteria.LiteralHandlingMode#INLINE</code> mode.</p>
</div>
<div class="paragraph">
<p>Valid options are defined by the <code>org.hibernate.query.criteria.LiteralHandlingMode</code> enum.
The default value is <code>org.hibernate.query.criteria.LiteralHandlingMode#AUTO</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.fail_on_pagination_over_collection_fetch</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Raises an exception when in-memory pagination over collection fetch is about to be performed.</p>
<div class="paragraph">
<p>Disabled by default. Set to true to enable.</p>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_multi_table_bulk_hql_operations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_multi_table_bulk_hql_operations"></a>23.8.1. Multi-table bulk HQL operations</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.hql.bulk_id_strategy</strong></code> (e.g. A fully-qualified class name, an instance, or a <code>Class</code> object reference)</dt>
<dd>
<p>Provide a custom <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/hql/spi/id/MultiTableBulkIdStrategy.html"><code>org.hibernate.hql.spi.id.MultiTableBulkIdStrategy</code></a> implementation for handling multi-table bulk HQL operations.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hql.bulk_id_strategy.global_temporary.drop_tables</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>For databases that donâ€™t support local tables, but just global ones, this configuration property allows you to DROP the global tables used for multi-table bulk HQL operations when the <code>SessionFactory</code> or the <code>EntityManagerFactory</code> is closed.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hql.bulk_id_strategy.persistent.drop_tables</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>This configuration property is used by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/hql/spi/id/persistent/PersistentTableBulkIdStrategy.html"><code>PersistentTableBulkIdStrategy</code></a>, that mimics temporary tables for databases which do not support temporary tables.
It follows a pattern similar to the ANSI SQL definition of the global temporary table using a "session id" column to segment rows from the various sessions.</p>
<div class="paragraph">
<p>This configuration property allows you to DROP the tables used for multi-table bulk HQL operations when the <code>SessionFactory</code> or the <code>EntityManagerFactory</code> is closed.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hql.bulk_id_strategy.persistent.schema</strong></code> (e.g. Database schema name. By default, the <code>hibernate.default_schema</code> is used.)</dt>
<dd>
<p>This configuration property is used by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/hql/spi/id/persistent/PersistentTableBulkIdStrategy.html"><code>PersistentTableBulkIdStrategy</code></a>, that mimics temporary tables for databases which do not support temporary tables.
It follows a pattern similar to the ANSI SQL definition of the global temporary table using a "session id" column to segment rows from the various sessions.</p>
<div class="paragraph">
<p>This configuration property defines the database schema used for storing the temporary tables used for bulk HQL operations.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hql.bulk_id_strategy.persistent.catalog</strong></code> (e.g. Database catalog name. By default, the <code>hibernate.default_catalog</code> is used.)</dt>
<dd>
<p>This configuration property is used by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/hql/spi/id/persistent/PersistentTableBulkIdStrategy.html"><code>PersistentTableBulkIdStrategy</code></a>, that mimics temporary tables for databases which do not support temporary tables.
It follows a pattern similar to the ANSI SQL definition of the global temporary table using a "session id" column to segment rows from the various sessions.</p>
<div class="paragraph">
<p>This configuration property defines the database catalog used for storing the temporary tables used for bulk HQL operations.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.legacy_limit_handler</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Setting which indicates whether or not to use <code>org.hibernate.dialect.pagination.LimitHandler</code>
implementations that sacrifices performance optimizations to allow legacy 4.x limit behavior.</p>
<div class="paragraph">
<p>Legacy 4.x behavior favored performing pagination in-memory by avoiding the use of the offset value, which is overall poor performance.
In 5.x, the limit handler behavior favors performance, thus, if the dialect doesnâ€™t support offsets, an exception is thrown instead.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.query.conventional_java_constants</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Setting which indicates whether or not Java constants follow the <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/variables.html">Java Naming conventions</a>.</p>
<div class="paragraph">
<p>The default is <code>true</code>.
Existing applications may want to disable this (set it <code>false</code>) if non-conventional Java constants are used.
However, there is a significant performance overhead for using non-conventional Java constants
since Hibernate cannot determine if aliases should be treated as Java constants or not.</p>
</div>
<div class="paragraph">
<p>Check out <a href="https://hibernate.atlassian.net/browse/HHH-4959">HHH-4959</a> for more details.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurations-batch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-batch"></a>23.9. Batching properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.jdbc.batch_size</strong></code> (e.g. 5)</dt>
<dd>
<p>Maximum JDBC batch size. A nonzero value enables batch updates.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.order_inserts</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Forces Hibernate to order SQL inserts by the primary key value of the items being inserted. This preserves batching when using cascading.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.order_updates</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Forces Hibernate to order SQL updates by the primary key value of the items being updated. This preserves batching when using cascading and reduces the likelihood of transaction deadlocks in highly-concurrent systems.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.batch_versioned_data</strong></code> (e.g. <code>true</code>(default value) or <code>false</code>)</dt>
<dd>
<p>Should versioned entities be included in batching?</p>
<div class="paragraph">
<p>Set this property to <code>true</code> if your JDBC driver returns correct row counts from executeBatch(). This option is usually safe, but is disabled by default. If enabled, Hibernate uses batched DML for automatically versioned data.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.batch_fetch_style</strong></code> (e.g. <code>LEGACY</code>(default value))</dt>
<dd>
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/loader/BatchFetchStyle.html"><code>BatchFetchStyle</code></a> to use.</p>
<div class="paragraph">
<p>Can specify either the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/loader/BatchFetchStyle.html"><code>BatchFetchStyle</code></a> name (insensitively), or a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/loader/BatchFetchStyle.html"><code>BatchFetchStyle</code></a> instance. <code>LEGACY}</code> is the default value.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.batch.builder</strong></code> (e.g. The fully qualified name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/batch/spi/BatchBuilder.html"><code>BatchBuilder</code></a> implementation class type or an actual object instance)</dt>
<dd>
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/batch/spi/BatchBuilder.html"><code>BatchBuilder</code></a> implementation to use.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="configurations-database-fetch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-database-fetch"></a>23.9.1. Fetching properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.max_fetch_depth</strong></code> (e.g. A value between <code>0</code> and <code>3</code>)</dt>
<dd>
<p>Sets a maximum depth for the outer join fetch tree for single-ended associations. A single-ended association is a one-to-one or many-to-one association. A value of <code>0</code> disables default outer join fetching.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.default_batch_fetch_size</strong></code> (e.g. <code>4</code>,<code>8</code>, or <code>16</code>)</dt>
<dd>
<p>The default size for Hibernate Batch fetching of associations (lazily fetched associations can be fetched in batches to prevent N+1 query problems).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.fetch_size</strong></code> (e.g. <code>0</code> or an integer)</dt>
<dd>
<p>A non-zero value determines the JDBC fetch size, by calling <code>Statement.setFetchSize()</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.use_scrollable_resultset</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Enables Hibernate to use JDBC2 scrollable resultsets. This property is only relevant for user-supplied JDBC connections. Otherwise, Hibernate uses connection metadata.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.use_streams_for_binary</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Use streams when writing or reading <code>binary</code> or <code>serializable</code> types to or from JDBC. This is a system-level property.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.use_get_generated_keys</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Allows Hibernate to use JDBC3 <code>PreparedStatement.getGeneratedKeys()</code> to retrieve natively-generated keys after insert. You need the JDBC3+ driver and JRE1.4+. Disable this property if your driver has problems with the Hibernate identifier generators. By default, it tries to detect the driver capabilities from connection metadata.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jdbc.wrap_result_sets</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable wrapping of JDBC result sets in order to speed up column name lookups for broken JDBC drivers.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.enable_lazy_load_no_trans</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Initialize Lazy Proxies or Collections outside a given Transactional Persistence Context.</p>
<div class="paragraph">
<p>Although enabling this configuration can make <code>LazyInitializationException</code> go away, itâ€™s better to use a fetch plan that guarantees that all properties are properly initialized before the Session is closed.</p>
</div>
<div class="paragraph">
<p>In reality, you shouldnâ€™t probably enable this setting anyway.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurations-logging"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-logging"></a>23.10. Statement logging and statistics</h3>
<div class="sect3">
<h4 id="_sql_statement_logging"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_sql_statement_logging"></a>23.10.1. SQL statement logging</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.show_sql</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Write all SQL statements to the console. This is an alternative to setting the log category <code>org.hibernate.SQL</code> to debug.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.format_sql</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Pretty-print the SQL in the log and console.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.use_sql_comments</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>If true, Hibernate generates comments inside the SQL, for easier debugging.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_statistics_settings"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_statistics_settings"></a>23.10.2. Statistics settings</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.generate_statistics</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Causes Hibernate to collect statistics for performance tuning.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.stats.factory</strong></code> (e.g. the fully qualified name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/stat/spi/StatisticsFactory.html"><code>StatisticsFactory</code></a> implementation or an actual instance)</dt>
<dd>
<p>The <code>StatisticsFactory</code> allow you to customize how the Hibernate Statistics are being collected.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session.events.log</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>A setting to control whether the <code>org.hibernate.engine.internal.StatisticalLoggingSessionEventListener</code> is enabled on all <code>Sessions</code> (unless explicitly disabled for a given <code>Session</code>).</p>
<div class="paragraph">
<p>The default value of this setting is determined by the value for <code>hibernate.generate_statistics</code>, meaning that if statistics are enabled, then logging of Session metrics is enabled by default too.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurations-cache"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-cache"></a>23.11. Cache Properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.cache.region.factory_class</strong></code> (e.g. <code>jcache</code>)</dt>
<dd>
<p>Either a shortcut name (e.g. <code>jcache</code>, <code>ehcache</code>) or the fully-qualified name of the <code>RegionFactory</code> implementation class.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.default_cache_concurrency_strategy</strong></code></dt>
<dd>
<p>Setting used to give the name of the default <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CacheConcurrencyStrategy.html"><code>CacheConcurrencyStrategy</code></a> to use
when either <code>@javax.persistence.Cacheable</code> or <code>@org.hibernate.annotations.Cache</code>. <code>@org.hibernate.annotations.Cache</code> is used to override the global setting.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.use_minimal_puts</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Optimizes second-level cache operation to minimize writes, at the cost of more frequent reads. This is most useful for clustered caches and is enabled by default for clustered cache implementations.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.use_query_cache</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enables the query cache. You still need to set individual queries to be cachable.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.use_second_level_cache</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Enable/disable the second level cache, which is enabled by default, although the default <code>RegionFactor</code> is <code>NoCachingRegionFactory</code> (meaning there is no actual caching implementation).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.query_cache_factory</strong></code> (e.g. Fully-qualified class name)</dt>
<dd>
<p>A custom <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/cache/spi/QueryCacheFactory.html"><code>QueryCacheFactory</code></a> interface. The default is the built-in <code>StandardQueryCacheFactory</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.region_prefix</strong></code> (e.g. A string)</dt>
<dd>
<p>A prefix for second-level cache region names.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.use_structured_entries</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Forces Hibernate to store data in the second-level cache in a more human-readable format.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.auto_evict_collection_cache</strong></code> (e.g. <code>true</code> or <code>false</code> (default: false))</dt>
<dd>
<p>Enables the automatic eviction of a bi-directional associationâ€™s collection cache when an element in the <code>ManyToOne</code> collection is added/updated/removed without properly managing the change on the <code>OneToMany</code> side.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.cache.use_reference_entries</strong></code> (e.g. <code>true</code> or <code>false</code>)</dt>
<dd>
<p>Optimizes second-level cache operation to store immutable entities (aka "reference") which do not have associations into cache directly, this case, disassembling and deep copy operations can be avoided. The default value of this property is <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.classcache</strong></code> (e.g. <code>hibernate.ejb.classcache.org.hibernate.ejb.test.Item</code> = <code>read-write</code>)</dt>
<dd>
<p>Sets the associated entity class cache concurrency strategy for the designated region. Caching configuration should follow the following pattern <code>hibernate.ejb.classcache.&lt;fully.qualified.Classname&gt;</code> usage[, region] where usage is the cache strategy used and region the cache region name.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.collectioncache</strong></code> (e.g. <code>hibernate.ejb.collectioncache.org.hibernate.ejb.test.Item.distributors</code> = <code>read-write, RegionName</code>)</dt>
<dd>
<p>Sets the associated collection cache concurrency strategy for the designated region. Caching configuration should follow the following pattern <code>hibernate.ejb.collectioncache.&lt;fully.qualified.Classname&gt;.&lt;role&gt;</code> usage[, region] where usage is the cache strategy used and region the cache region name</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-infinispan"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-infinispan"></a>23.12. Infinispan properties</h3>
<div class="paragraph">
<p>For more details about how to customize the Infinispan second-level cache provider, check out the
<a href="http://infinispan.org/docs/stable/user_guide/user_guide.html#configuration_properties">Infinispan User Guide</a></p>
</div>
</div>
<div class="sect2">
<h3 id="configurations-transactions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-transactions"></a>23.13. Transactions properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.transaction.jta.platform</strong></code> (e.g. <code>JBossAS</code>, <code>BitronixJtaPlatform</code>)</dt>
<dd>
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a> implementation to use for integrating with JTA systems.
Can reference either a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a> instance or the name of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/transaction/jta/platform/spi/JtaPlatform.html"><code>JtaPlatform</code></a> implementation class</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jta.prefer_user_transaction</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Should we prefer using the <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform#retrieveUserTransaction</code> over using <code>org.hibernate.engine.transaction.jta.platform.spi.JtaPlatform#retrieveTransactionManager</code></p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.transaction.jta.platform_resolver</strong></code></dt>
<dd>
<p>Names the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/transaction/jta/platform/spi/JtaPlatformResolver.html"><code>JtaPlatformResolver</code></a> implementation to use.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jta.cacheTransactionManager</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>A configuration value key used to indicate that it is safe to cache.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jta.cacheUserTransaction</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>A configuration value key used to indicate that it is safe to cache.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.transaction.flush_before_completion</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Causes the session be flushed during the before completion phase of the transaction. If possible, use built-in and automatic session context management instead.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.transaction.auto_close_session</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Causes the session to be closed during the after completion phase of the transaction. If possible, use built-in and automatic session context management instead.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.transaction.coordinator_class</strong></code></dt>
<dd>
<p>Names the implementation of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/resource/transaction/spi/TransactionCoordinatorBuilder.html"><code>TransactionCoordinatorBuilder</code></a> to use for creating <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/resource/transaction/spi/TransactionCoordinator.html"><code>TransactionCoordinator</code></a> instances.</p>
<div class="paragraph">
<p>Can be a`TransactionCoordinatorBuilder` instance, <code>TransactionCoordinatorBuilder</code> implementation <code>Class</code> reference, a <code>TransactionCoordinatorBuilder</code> implementation class name (fully-qualified name) or a short name.</p>
</div>
<div class="paragraph">
<p>The following short names are defined for this setting:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>jdbc</code></dt>
<dd>
<p>Manages transactions via calls to <code>java.sql.Connection</code> (default for non-JPA applications)</p>
</dd>
<dt class="hdlist1"><code>jta</code></dt>
<dd>
<p>Manages transactions via JTA. See <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant">Java EE bootstrapping</a></p>
<div class="paragraph">
<p>If a JPA application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate will
automatically build the proper transaction coordinator based on the transaction type for the persistence unit.</p>
</div>
<div class="paragraph">
<p>If a non-JPA application does not provide a setting for <code>hibernate.transaction.coordinator_class</code>, Hibernate
will use <code>jdbc</code> as the default. This default will cause problems if the application actually uses JTA-based transactions.
A non-JPA application that uses JTA-based transactions should explicitly set <code>hibernate.transaction.coordinator_class=jta</code>
or provide a custom <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/resource/transaction/TransactionCoordinatorBuilder.html"><code>TransactionCoordinatorBuilder</code></a> that builds a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/resource/transaction/TransactionCoordinator.html"><code>TransactionCoordinator</code></a> that properly coordinates with JTA-based transactions.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jta.track_by_thread</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>A transaction can be rolled back by another thread ("tracking by thread") and not the original application.
Examples of this include a JTA transaction timeout handled by a background reaper thread.</p>
<div class="paragraph">
<p>The ability to handle this situation requires checking the Thread ID every time Session is called, so enabling this can certainly have a performance impact.</p>
</div>
</dd>
<dt class="hdlist1"><span class="line-through"><code><strong>hibernate.transaction.factory_class</strong></code></span></dt>
<dd>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is a legacy setting thatâ€™s been deprecated and you should use the <code>hibernate.transaction.jta.platform</code> instead.
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jta.allowTransactionAccess</strong></code>(e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>It allows access to the underlying <code>org.hibernate.Transaction</code> even when using JTA
since the JPA specification prohibits this behavior.</p>
<div class="paragraph">
<p>If this configuration property is set to <code>true</code>, access is granted to the underlying <code>org.hibernate.Transaction</code>.
If itâ€™s set to <code>false</code>, you wonâ€™t be able to access the <code>org.hibernate.Transaction</code>.</p>
</div>
<div class="paragraph">
<p>The default behavior is to allow access unless the <code>Session</code> is bootstrapped via JPA.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-multi-tenancy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-multi-tenancy"></a>23.14. Multi-tenancy settings</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.multiTenancy</strong></code> (e.g. <code>NONE</code> (default value), <code>SCHEMA</code>, <code>DATABASE</code>, and <code>DISCRIMINATOR</code> (not implemented yet))</dt>
<dd>
<p>The multi-tenancy strategy in use.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.multi_tenant_connection_provider</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Names a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/connections/spi/MultiTenantConnectionProvider.html"><code>MultiTenantConnectionProvider</code></a> implementation to use. As <code>MultiTenantConnectionProvider</code> is also a service, can be configured directly through the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/registry/StandardServiceRegistryBuilder.html"><code>StandardServiceRegistryBuilder</code></a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.tenant_identifier_resolver</strong></code></dt>
<dd>
<p>Names a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/context/spi/CurrentTenantIdentifierResolver.html"><code>CurrentTenantIdentifierResolver</code></a> implementation to resolve the resolve the current tenant identifier so that calling <code>SessionFactory#openSession()</code> would get a <code>Session</code> thatâ€™s connected to the right tenant.</p>
<div class="paragraph">
<p>Can be a <code>CurrentTenantIdentifierResolver</code> instance, <code>CurrentTenantIdentifierResolver</code> implementation <code>Class</code> object reference or a <code>CurrentTenantIdentifierResolver</code> implementation class name.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.multi_tenant.datasource.identifier_for_any</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>When the <code>hibernate.connection.datasource</code> property value is resolved to a <code>javax.naming.Context</code> object, this configuration property defines the JNDI name used to locate the <code>DataSource</code> used for fetching the initial <code>Connection</code> which is used to access to the database metadata of the underlying database(s) (in situations where we do not have a tenant id, like startup processing).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-hbmddl"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-hbmddl"></a>23.15. Automatic schema generation</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.auto</strong></code> (e.g. <code>none</code> (default value), <code>create-only</code>, <code>drop</code>, <code>create</code>, <code>create-drop</code>, <code>validate</code>, and <code>update</code>)</dt>
<dd>
<p>Setting to perform <code>SchemaManagementTool</code> actions automatically as part of the <code>SessionFactory</code> lifecycle.
Valid options are defined by the <code>externalHbm2ddlName</code> value of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/Action.html"><code>Action</code></a> enum:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>No action will be performed.</p>
</dd>
<dt class="hdlist1"><code>create-only</code></dt>
<dd>
<p>Database creation will be generated.</p>
</dd>
<dt class="hdlist1"><code>drop</code></dt>
<dd>
<p>Database dropping will be generated.</p>
</dd>
<dt class="hdlist1"><code>create</code></dt>
<dd>
<p>Database dropping will be generated followed by database creation.</p>
</dd>
<dt class="hdlist1"><code>create-drop</code></dt>
<dd>
<p>Drop the schema and recreate it on SessionFactory startup.  Additionally, drop the schema on SessionFactory shutdown.</p>
</dd>
<dt class="hdlist1"><code>validate</code></dt>
<dd>
<p>Validate the database schema</p>
</dd>
<dt class="hdlist1"><code>update</code></dt>
<dd>
<p>Update the database schema</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.database.action</strong></code> (e.g. <code>none</code> (default value), <code>create-only</code>, <code>drop</code>, <code>create</code>, <code>create-drop</code>, <code>validate</code>, and <code>update</code>)</dt>
<dd>
<p>Setting to perform <code>SchemaManagementTool</code> actions automatically as part of the <code>SessionFactory</code> lifecycle.
Valid options are defined by the <code>externalJpaName</code> value of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/Action.html"><code>Action</code></a> enum:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>No action will be performed.</p>
</dd>
<dt class="hdlist1"><code>create</code></dt>
<dd>
<p>Database creation will be generated.</p>
</dd>
<dt class="hdlist1"><code>drop</code></dt>
<dd>
<p>Database dropping will be generated.</p>
</dd>
<dt class="hdlist1"><code>drop-and-create</code></dt>
<dd>
<p>Database dropping will be generated followed by database creation.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.scripts.action</strong></code> (e.g. <code>none</code> (default value), <code>create-only</code>, <code>drop</code>, <code>create</code>, <code>create-drop</code>, <code>validate</code>, and <code>update</code>)</dt>
<dd>
<p>Setting to perform <code>SchemaManagementTool</code> actions writing the commands into a DDL script file.
Valid options are defined by the <code>externalJpaName</code> value of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/Action.html"><code>Action</code></a> enum:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>No action will be performed.</p>
</dd>
<dt class="hdlist1"><code>create</code></dt>
<dd>
<p>Database creation will be generated.</p>
</dd>
<dt class="hdlist1"><code>drop</code></dt>
<dd>
<p>Database dropping will be generated.</p>
</dd>
<dt class="hdlist1"><code>drop-and-create</code></dt>
<dd>
<p>Database dropping will be generated followed by database creation.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation-connection</strong></code></dt>
<dd>
<p>Allows passing a specific <code>java.sql.Connection</code> instance to be used by <code>SchemaManagementTool</code></p>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.database-product-name</strong></code></dt>
<dd>
<p>Specifies the name of the database provider in cases where a Connection to the underlying database is not available (aka, mainly in generating scripts).
In such cases, a value for this setting <em>must</em> be specified.</p>
<div class="paragraph">
<p>The value of this setting is expected to match the value returned by <code>java.sql.DatabaseMetaData#getDatabaseProductName()</code> for the target database.</p>
</div>
<div class="paragraph">
<p>Additionally, specifying <code>javax.persistence.database-major-version</code> and/or <code>javax.persistence.database-minor-version</code> may be required to understand exactly how to generate the required schema commands.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.database-major-version</strong></code></dt>
<dd>
<p>Specifies the major version of the underlying database, as would be returned by <code>java.sql.DatabaseMetaData#getDatabaseMajorVersion</code> for the target database.</p>
<div class="paragraph">
<p>This value is used to help more precisely determine how to perform schema generation tasks for the underlying database in cases where <code>javax.persistence.database-product-name</code> does not provide enough distinction.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.database-minor-version</strong></code></dt>
<dd>
<p>Specifies the minor version of the underlying database, as would be returned by <code>java.sql.DatabaseMetaData#getDatabaseMinorVersion</code> for the target database.</p>
<div class="paragraph">
<p>This value is used to help more precisely determine how to perform schema generation tasks for the underlying database in cases where <code>javax.persistence.database-product-name</code> and <code>javax.persistence.database-major-version</code> does not provide enough distinction.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.create-source</strong></code></dt>
<dd>
<p>Specifies whether schema generation commands for schema creation are to be determined based on object/relational mapping metadata, DDL scripts, or a combination of the two.
See <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/SourceType.html"><code>SourceType</code></a> for valid set of values.</p>
<div class="paragraph">
<p>If no value is specified, a default is assumed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if source scripts are specified (per <code>javax.persistence.schema-generation.create-script-source</code>), then <code>script</code> is assumed</p>
</li>
<li>
<p>otherwise, <code>metadata</code> is assumed</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.drop-source</strong></code></dt>
<dd>
<p>Specifies whether schema generation commands for schema dropping are to be determined based on object/relational mapping metadata, DDL scripts, or a combination of the two.
See <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/SourceType.html"><code>SourceType</code></a> for valid set of values.</p>
<div class="paragraph">
<p>If no value is specified, a default is assumed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if source scripts are specified (per <code>javax.persistence.schema-generation.create-script-source</code>), then the <code>script</code> option is assumed</p>
</li>
<li>
<p>otherwise, <code>metadata</code> is assumed</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.create-script-source</strong></code></dt>
<dd>
<p>Specifies the <code>create</code> script file as either a <code>java.io.Reader</code> configured for reading of the DDL script file or a string designating a file <code>java.net.URL</code> for the DDL script.</p>
<div class="paragraph">
<p>Hibernate historically also accepted <code>hibernate.hbm2ddl.import_files</code> for a similar purpose, but <code>javax.persistence.schema-generation.create-script-source</code> should be preferred over <code>hibernate.hbm2ddl.import_files</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.drop-script-source</strong></code></dt>
<dd>
<p>Specifies the <code>drop</code> script file as either a <code>java.io.Reader</code> configured for reading of the DDL script file or a string designating a file <code>java.net.URL</code> for the DDL script.</p>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.scripts.create-target</strong></code></dt>
<dd>
<p>For cases where the <code>javax.persistence.schema-generation.scripts.action</code> value indicates that schema creation commands should be written to DDL script file, <code>javax.persistence.schema-generation.scripts.create-target</code> specifies either a <code>java.io.Writer</code> configured for output of the DDL script or a string specifying the file URL for the DDL script.</p>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.schema-generation.scripts.drop-target</strong></code></dt>
<dd>
<p>For cases where the <code>javax.persistence.schema-generation.scripts.action</code> value indicates that schema dropping commands should be written to DDL script file, <code>javax.persistence.schema-generation.scripts.drop-target</code> specifies either a <code>java.io.Writer</code> configured for output of the DDL script or a string specifying the file URL for the DDL script.</p>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.hibernate.hbm2ddl.import_files</strong></code> (e.g. <code>import.sql</code> (default value))</dt>
<dd>
<p>Comma-separated names of the optional files containing SQL DML statements executed during the <code>SessionFactory</code> creation.
File order matters, the statements of a given file are executed before the statements of the following one.</p>
<div class="paragraph">
<p>These statements are only executed if the schema is created, meaning that <code>hibernate.hbm2ddl.auto</code> is set to <code>create</code>, <code>create-drop</code>, or <code>update</code>.
<code>javax.persistence.schema-generation.create-script-source</code> / <code>javax.persistence.schema-generation.drop-script-source</code> should be preferred.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.sql-load-script-source</strong></code></dt>
<dd>
<p>JPA variant of <code>hibernate.hbm2ddl.import_files</code>. Specifies a <code>java.io.Reader</code> configured for reading of the SQL load script or a string designating the file <code>java.net.URL</code> for the SQL load script.
A "SQL load script" is a script that performs some database initialization (INSERT, etc).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.import_files_sql_extractor</strong></code></dt>
<dd>
<p>Reference to the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/hbm2ddl/ImportSqlCommandExtractor.html"><code>ImportSqlCommandExtractor</code></a> implementation class to use for parsing source/import files as defined by <code>javax.persistence.schema-generation.create-script-source</code>,
<code>javax.persistence.schema-generation.drop-script-source</code> or <code>hibernate.hbm2ddl.import_files</code>.</p>
<div class="paragraph">
<p>Reference may refer to an instance, a Class implementing <code>ImportSqlCommandExtractor</code> of the fully-qualified name of the <code>ImportSqlCommandExtractor</code> implementation.
If the fully-qualified name is given, the implementation must provide a no-arg constructor.</p>
</div>
<div class="paragraph">
<p>The default value is <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/hbm2ddl/SingleLineSqlCommandExtractor.html"><code>SingleLineSqlCommandExtractor</code></a>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2dll.create_namespaces</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Specifies whether to automatically create also the database schema/catalog.</p>
</dd>
<dt class="hdlist1"><code><strong>javax.persistence.create-database-schemas</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>The JPA variant of <code>hibernate.hbm2dll.create_namespaces</code>. Specifies whether the persistence provider is to create the database schema(s) in addition to creating database objects (tables, sequences, constraints, etc).
The value of this boolean property should be set to <code>true</code> if the persistence provider is to create schemas in the database or to generate DDL that contains "CREATE SCHEMA" commands.</p>
<div class="paragraph">
<p>If this property is not supplied (or is explicitly <code>false</code>), the provider should not attempt to create database schemas.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.schema_filter_provider</strong></code></dt>
<dd>
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaFilterProvider.html"><code>SchemaFilterProvider</code></a> to be used by <code>create</code>, <code>drop</code>, <code>migrate</code>, and <code>validate</code> operations on the database schema.
<code>SchemaFilterProvider</code> provides filters that can be used to limit the scope of these operations to specific namespaces, tables and sequences. All objects are included by default.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.jdbc_metadata_extraction_strategy</strong></code> (e.g. <code>grouped</code> (default value) or <code>individually</code>)</dt>
<dd>
<p>Setting to choose the strategy used to access the JDBC Metadata.
Valid options are defined by the <code>strategy</code> value of the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/JdbcMetadaAccessStrategy.html"><code>JdbcMetadaAccessStrategy</code></a> enum:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>grouped</code></dt>
<dd>
<p><a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaMigrator.html"><code>SchemaMigrator</code></a> and <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaValidator.html"><code>SchemaValidator</code></a> execute a single <code>java.sql.DatabaseMetaData#getTables(String, String, String, String[])</code> call to retrieve all the database table in order to determine if all the <code>javax.persistence.Entity</code> have a corresponding mapped database tables.This strategy may require <code>hibernate.default_schema</code> and/or <code>hibernate.default_catalog</code> to be provided.</p>
</dd>
<dt class="hdlist1"><code>individually</code></dt>
<dd>
<p><a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaMigrator.html"><code>SchemaMigrator</code></a> and <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaValidator.html"><code>SchemaValidator</code></a> execute one <code>java.sql.DatabaseMetaData#getTables(String, String, String, String[])</code> call for each <code>javax.persistence.Entity</code> in order to determine if a corresponding database table exists.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.delimiter</strong></code> (e.g. <code>;</code>)</dt>
<dd>
<p>Identifies the delimiter to use to separate schema management statements in script outputs.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.schema_management_tool</strong></code> (e.g. A schema name)</dt>
<dd>
<p>Used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/spi/SchemaManagementTool.html"><code>SchemaManagementTool</code></a> to use for performing schema management. The default is to use <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/schema/internal/HibernateSchemaManagementTool.html"><code>HibernateSchemaManagementTool</code></a></p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.synonyms</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>If enabled, allows schema update and validation to support synonyms. Due to the possibility that this would return duplicate tables (especially in Oracle), this is disabled by default.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2dll.extra_physical_table_types</strong></code> (e.g. <code>BASE TABLE</code>)</dt>
<dd>
<p>Identifies a comma-separated list of values to specify extra table types, other than the default <code>TABLE</code> value, to recognize as defining a physical table by schema update, creation and validation.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.schema_update.unique_constraint_strategy</strong></code> (e.g. <code>DROP_RECREATE_QUIETLY</code>, <code>RECREATE_QUIETLY</code>, <code>SKIP</code>)</dt>
<dd>
<p>Unique columns and unique keys both use unique constraints in most dialects.
<code>SchemaUpdate</code> needs to create these constraints, but DBs support for finding existing constraints is extremely inconsistent.
Further, non-explicitly-named unique constraints use randomly generated characters.</p>
<div class="paragraph">
<p>Therefore, the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tool/hbm2ddl/UniqueConstraintSchemaUpdateStrategy.html"><code>UniqueConstraintSchemaUpdateStrategy</code></a> offers the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DROP_RECREATE_QUIETLY</code></dt>
<dd>
<p>Default option.
Attempt to drop, then (re-)create each unique constraint. Ignore any exceptions being thrown.</p>
</dd>
<dt class="hdlist1"><code>RECREATE_QUIETLY</code></dt>
<dd>
<p>Attempts to (re-)create unique constraints, ignoring exceptions thrown if the constraint already existed</p>
</dd>
<dt class="hdlist1"><code>SKIP</code></dt>
<dd>
<p>Does not attempt to create unique constraints on a schema update.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.charset_name</strong></code> (e.g. <code>Charset.defaultCharset()</code>)</dt>
<dd>
<p>Defines the charset (encoding) used for all input/output schema generation resources. By default, Hibernate uses the default charset given by <code>Charset.defaultCharset()</code>. This configuration property allows you to override the default JVM setting so that you can specify which encoding is used when reading and writing schema generation resources (e.g. File, URL).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.hbm2ddl.halt_on_error</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Whether the schema migration tool should halt on error, therefore terminating the bootstrap process. By default, the <code>EntityManagerFactory</code> or <code>SessionFactory</code> are created even if the schema migration throws exceptions. To prevent this default behavior, set this property value to <code>true</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-exception-handling"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-exception-handling"></a>23.16. Exception handling</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.jdbc.sql_exception_converter</strong></code> (e.g. Fully-qualified name of class implementing <code>SQLExceptionConverter</code>)</dt>
<dd>
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/exception/spi/SQLExceptionConverter.html"><code>SQLExceptionConverter</code></a> to use for converting <code>SQLExceptions</code> to Hibernateâ€™s <code>JDBCException</code> hierarchy. The default is to use the configured <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/dialect/Dialect.html"><code>Dialect</code></a>'s preferred <code>SQLExceptionConverter</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.native_exception_handling_51_compliance</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Indicates if exception handling for a <code>SessionFactory</code> built via Hibernateâ€™s native bootstrapping
should behave the same as native exception handling in Hibernate ORM 5.1. When set to <code>true</code>,
<code>HibernateException</code> will be not wrapped or converted according to the JPA specification. This
setting will be ignored for a <code>SessionFactory</code> built via JPA bootstrapping.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-session-events"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-session-events"></a>23.17. Session events</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.session.events.auto</strong></code></dt>
<dd>
<p>Fully qualified class name implementing the <code>SessionEventListener</code> interface.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session_factory.interceptor</strong></code> (e.g. <code>org.hibernate.EmptyInterceptor</code> (default value))</dt>
<dd>
<p>Names a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/Interceptor"><code>Interceptor</code></a> implementation to be applied to every <code>Session</code> created by the current <code>org.hibernate.SessionFactory</code></p>
<div class="paragraph">
<p>Can reference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Interceptor</code> instance</p>
</li>
<li>
<p><code>Interceptor</code> implementation <code>Class</code> object reference</p>
</li>
<li>
<p><code>Interceptor</code> implementation class name</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><span class="line-through"><code><strong>hibernate.ejb.interceptor</strong></code></span> (e.g. <code>hibernate.session_factory.interceptor</code> (default value))</dt>
<dd>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Deprecated setting. Use <code>hibernate.session_factory.session_scoped_interceptor</code> instead.
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session_factory.session_scoped_interceptor</strong></code> (e.g. fully-qualified class name or class reference)</dt>
<dd>
<p>Names a <code>org.hibernate.Interceptor</code> implementation to be applied to the <code>org.hibernate.SessionFactory</code> and propagated to each <code>Session</code> created from the <code>SessionFactory</code>.</p>
<div class="paragraph">
<p>This setting identifies an <code>Interceptor</code> implementation that is to be applied to every <code>Session</code> opened from the <code>SessionFactory</code>,
but unlike <code>hibernate.session_factory.interceptor</code>, a unique instance of the <code>Interceptor</code> is
used for each <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>Can reference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Interceptor</code> instance</p>
</li>
<li>
<p><code>Interceptor</code> implementation <code>Class</code> object reference</p>
</li>
<li>
<p><code>java.util.function.Supplier</code> instance which is used to retrieve the <code>Interceptor</code> instance.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Specifically, this setting cannot name an <code>Interceptor</code> instance.
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><span class="line-through"><code><strong>hibernate.ejb.interceptor.session_scoped</strong></code></span> (e.g. fully-qualified class name or class reference)</dt>
<dd>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Deprecated setting. Use <code>hibernate.session_factory.session_scoped_interceptor</code> instead.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>An optional Hibernate interceptor.</p>
</div>
<div class="paragraph">
<p>The interceptor instance is specific to a given Session instance (and hence is not thread-safe) has to implement <code>org.hibernate.Interceptor</code> and have a no-arg constructor.</p>
</div>
<div class="paragraph">
<p>This property cannot be combined with <code>hibernate.ejb.interceptor</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.session_factory_observer</strong></code> (e.g. fully-qualified class name or class reference)</dt>
<dd>
<p>Specifies a <code>SessionFactoryObserver</code> to be applied to the SessionFactory. The class must have a no-arg constructor.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.event</strong></code> (e.g. <code>hibernate.ejb.event.pre-load</code> = <code>com.acme.SecurityListener,com.acme.AuditListener</code>)</dt>
<dd>
<p>Event listener list for a given event type. The list of event listeners is a comma separated fully qualified class name list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-jmx"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-jmx"></a>23.18. JMX settings</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.jmx.enabled</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable JMX.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jmx.usePlatformServer</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Uses the platform MBeanServer as returned by <code>ManagementFactory#getPlatformMBeanServer()</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jmx.agentId</strong></code></dt>
<dd>
<p>The agent identifier of the associated <code>MBeanServer</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jmx.defaultDomain</strong></code></dt>
<dd>
<p>The domain name of the associated <code>MBeanServer</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jmx.sessionFactoryName</strong></code></dt>
<dd>
<p>The <code>SessionFactory</code> name appended to the object name the Manageable Bean is registered with. If null, the <code>hibernate.session_factory_name</code> configuration value is used.</p>
</dd>
<dt class="hdlist1"><code><strong>org.hibernate.core</strong></code></dt>
<dd>
<p>The default object domain appended to the object name the Manageable Bean is registered with.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-jacc"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-jacc"></a>23.19. JACC settings</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.jacc.enabled</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Is JACC enabled?</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jacc</strong></code> (e.g. <code>hibernate.jacc.allowed.org.jboss.ejb3.test.jacc.AllEntity</code>)</dt>
<dd>
<p>The property name defines the role (e.g. <code>allowed</code>) and the entity class name (e.g. <code>org.jboss.ejb3.test.jacc.AllEntity</code>), while the property value defines the authorized actions (e.g. <code>insert,update,read</code>).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jacc_context_id</strong></code></dt>
<dd>
<p>A String identifying the policy context whose PolicyConfiguration interface is to be returned. The value passed to this parameter must not be null.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-classloader"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-classloader"></a>23.20. ClassLoaders properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.classLoaders</strong></code></dt>
<dd>
<p>Used to define a <code>java.util.Collection&lt;ClassLoader&gt;</code> or the <code>ClassLoader</code> instance Hibernate should use for class-loading and resource-lookups.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.classLoader.application</strong></code></dt>
<dd>
<p>Names the <code>ClassLoader</code> used to load user application classes.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.classLoader.resources</strong></code></dt>
<dd>
<p>Names the <code>ClassLoader</code> Hibernate should use to perform resource loading.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.classLoader.hibernate</strong></code></dt>
<dd>
<p>Names the <code>ClassLoader</code> responsible for loading Hibernate classes.  By default, this is the <code>ClassLoader</code> that loaded this class.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.classLoader.environment</strong></code></dt>
<dd>
<p>Names the <code>ClassLoader</code> used when Hibernate is unable to locates classes on the <code>hibernate.classLoader.application</code> or <code>hibernate.classLoader.hibernate</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-bootstrap"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-bootstrap"></a>23.21. Bootstrap properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.integrator_provider</strong></code> (e.g. The fully qualified name of an <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/boot/spi/IntegratorProvider.html"><code>IntegratorProvider</code></a>)</dt>
<dd>
<p>Used to define a list of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/integrator/spi/Integrator.html"><code>Integrator</code></a> which is used during the bootstrap process to integrate various services.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.strategy_registration_provider</strong></code> (e.g. The fully qualified name of an <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/boot/spi/StrategyRegistrationProviderList.html"><code>StrategyRegistrationProviderList</code></a>)</dt>
<dd>
<p>Used to define a list of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/registry/selector/StrategyRegistrationProvider.html"><code>StrategyRegistrationProvider</code></a> which is used during the bootstrap process to provide registrations of strategy selector(s).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.type_contributors</strong></code> (e.g. The fully qualified name of an <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/boot/spi/TypeContributorList.html"><code>TypeContributorList</code></a>)</dt>
<dd>
<p>Used to define a list of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/boot/model/TypeContributor.html"><code>TypeContributor</code></a> which is used during the bootstrap process to contribute types.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.persister.resolver</strong></code> (e.g. The fully qualified name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/spi/PersisterClassResolver.html"><code>PersisterClassResolver</code></a> or a <code>PersisterClassResolver</code> instance)</dt>
<dd>
<p>Used to define an implementation of the <code>PersisterClassResolver</code> interface which can be used to customize how an entity or a collection is being persisted.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.persister.factory</strong></code> (e.g. The fully qualified name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/spi/PersisterFactory.html"><code>PersisterFactory</code></a> or a <code>PersisterFactory</code> instance)</dt>
<dd>
<p>Like a <code>PersisterClassResolver</code>, the <code>PersisterFactory</code> can be used to customize how an entity or a collection are being persisted.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.service.allow_crawling</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Crawl all available service bindings for an alternate registration of a given Hibernate <code>Service</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.metadata_builder_contributor</strong></code> (e.g. The instance, the class or the fully qualified class name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/boot/spi/MetadataBuilderContributor.html"><code>MetadataBuilderContributor</code></a>)</dt>
<dd>
<p>Used to define an instance, the class or the fully qualified class name of a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/boot/spi/MetadataBuilderContributor.html"><code>MetadataBuilderContributor</code></a> which can be used to configure the <code>MetadataBuilder</code> when bootstrapping via the JPA <code>EntityManagerFactory</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-misc"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-misc"></a>23.22. Miscellaneous properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.dialect_resolvers</strong></code></dt>
<dd>
<p>Names any additional <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/dialect/spi/DialectResolver.html"><code>DialectResolver</code></a> implementations to  register with the standard <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/engine/jdbc/dialect/spi/DialectFactory.html"><code>DialectFactory</code></a></p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session_factory_name</strong></code> (e.g. A JNDI name)</dt>
<dd>
<p>Setting used to name the Hibernate <code>SessionFactory</code>.
Naming the <code>SessionFactory</code> allows for it to be properly serialized across JVMs as long as the same name is used on each JVM.</p>
<div class="paragraph">
<p>If <code>hibernate.session_factory_name_is_jndi</code> is set to <code>true</code>, this is also the name under which the <code>SessionFactory</code> is bound into JNDI on startup and from which it can be obtained from JNDI.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.session_factory_name_is_jndi</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Does the value defined by <code>hibernate.session_factory_name</code> represent a JNDI namespace into which the <code>org.hibernate.SessionFactory</code> should be bound and made accessible?</p>
<div class="paragraph">
<p>Defaults to <code>true</code> for backward compatibility. Set this to <code>false</code> if naming a SessionFactory is needed for serialization purposes, but no writable JNDI context exists in the runtime environment or if the user simply does not want JNDI to be used.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.entitymanager_factory_name</strong></code> (e.g. By default, the persistence unit name is used, otherwise a randomly generated UUID)</dt>
<dd>
<p>Internally, Hibernate keeps track of all <code>EntityManagerFactory</code> instances using the <code>EntityManagerFactoryRegistry</code>. The name is used as a key to identify a given <code>EntityManagerFactory</code> reference.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.cfgfile</strong></code> (e.g. <code>hibernate.cfg.xml</code> (default value))</dt>
<dd>
<p>XML configuration file to use to configure Hibernate.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.discard_pc_on_close</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>If true, the persistence context will be discarded (think <code>clear()</code> when the method is called.
Otherwise, the persistence context will stay alive till the transaction completion: all objects will remain managed, and any change will be synchronized with the database (default to false, ie wait for transaction completion).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.ejb.metamodel.population</strong></code> (e.g. <code>enabled</code> or <code>disabled</code>, or <code>ignoreUnsupported</code> (default value))</dt>
<dd>
<p>Setting that indicates whether to build the JPA types.</p>
<div class="paragraph">
<p>Accepts three values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enabled</dt>
<dd>
<p>Do the build</p>
</dd>
<dt class="hdlist1">disabled</dt>
<dd>
<p>Do not do the build</p>
</dd>
<dt class="hdlist1">ignoreUnsupported</dt>
<dd>
<p>Do the build, but ignore any non-JPA features that would otherwise result in a failure (e.g. <code>@Any</code> annotation).</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jpa.static_metamodel.population</strong></code> (e.g. <code>enabled</code> or <code>disabled</code>, or <code>skipUnsupported</code> (default value))</dt>
<dd>
<p>Setting that controls whether we seek out JPA <em>static metamodel</em> classes and populate them.</p>
<div class="paragraph">
<p>Accepts three values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enabled</dt>
<dd>
<p>Do the population</p>
</dd>
<dt class="hdlist1">disabled</dt>
<dd>
<p>Do not do the population</p>
</dd>
<dt class="hdlist1">skipUnsupported</dt>
<dd>
<p>Do the population, but ignore any non-JPA features that would otherwise result in the population failing (e.g. <code>@Any</code> annotation).</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.delay_cdi_access</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Defines delayed access to CDI <code>BeanManager</code>. Starting in 5.1 the preferred means for CDI bootstrapping is through <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/jpa/event/spi/jpa/ExtendedBeanManager.html"><code>ExtendedBeanManager</code></a>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.resource.beans.container</strong></code> (e.g. fully-qualified class name)</dt>
<dd>
<p>Identifies an explicit <code>org.hibernate.resource.beans.container.spi.BeanContainer</code> to be used.</p>
<div class="paragraph">
<p>Note that, for CDI-based containers, setting this is not necessary.
Simply pass the <code>BeanManager</code> to use via <code>javax.persistence.bean.manager</code> and optionally specify <code>hibernate.delay_cdi_access</code>.</p>
</div>
<div class="paragraph">
<p>This setting is more meant to integrate non-CDI bean containers such as Spring.</p>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.allow_update_outside_transaction</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Setting that allows to perform update operations outside of a transaction boundary.</p>
<div class="paragraph">
<p>Accepts two values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">true</dt>
<dd>
<p>allows to flush an update out of a transaction</p>
</dd>
<dt class="hdlist1">false</dt>
<dd>
<p>does not allow</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code><strong>hibernate.collection_join_subquery</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Setting which indicates whether or not the new JOINS over collection tables should be rewritten to subqueries.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.allow_refresh_detached_entity</strong></code> (e.g. <code>true</code> (default value when using Hibernate native bootstrapping) or <code>false</code> (default value when using JPA bootstrapping))</dt>
<dd>
<p>Setting that allows to call <code>javax.persistence.EntityManager#refresh(entity)</code> or <code>Session#refresh(entity)</code> on a detached instance even when the <code>org.hibernate.Session</code> is obtained from a JPA <code>javax.persistence.EntityManager</code>.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.use_entity_where_clause_for_collections</strong></code> (e.g., <code>true</code> (default) or <code>false</code>)</dt>
<dd>
<p>Setting controls whether an entityâ€™s "where" clause, mapped using <code>@Where(clause="â€¦â€‹")</code> or `&lt;entity â€¦â€‹ where="â€¦â€‹"&gt;, is taken into account when loading one-to-many or many-to-many collections of that type of entity.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.event.merge.entity_copy_observer</strong></code> (e.g. <code>disallow</code> (default value), <code>allow</code>, <code>log</code> (testing purpose only) or fully-qualified class name)</dt>
<dd>
<p>Setting that specifies how Hibernate will respond when multiple representations of the same persistent entity ("entity copy") is detected while merging.</p>
<div class="paragraph">
<p>The possible values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">disallow (the default)</dt>
<dd>
<p>throws <code>IllegalStateException</code> if an entity copy is detected</p>
</dd>
<dt class="hdlist1">allow</dt>
<dd>
<p>performs the merge operation on each entity copy that is detected</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>(provided for testing only) performs the merge operation on each entity copy that is detected and logs information about the entity copies.
This setting requires DEBUG logging be enabled for <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/event/internal/EntityCopyAllowedLoggedObserver.html"><code>EntityCopyAllowedLoggedObserver</code></a>.</p>
<div class="paragraph">
<p>In addition, the application may customize the behavior by providing an implementation of <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/event/spi/EntityCopyObserver.html"><code>EntityCopyObserver</code></a> and setting <code>hibernate.event.merge.entity_copy_observer</code> to the class name.
When this property is set to <code>allow</code> or <code>log</code>, Hibernate will merge each entity copy detected while cascading the merge operation.
In the process of merging each entity copy, Hibernate will cascade the merge operation from each entity copy to its associations with <code>cascade=CascadeType.MERGE</code> or <code>CascadeType.ALL</code>.
The entity state resulting from merging an entity copy will be overwritten when another entity copy is merged.</p>
</div>
<div class="paragraph">
<p>For more details, check out the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-merge-gotchas">Merge gotchas</a> section.</p>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-envers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-envers"></a>23.23. Envers properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.envers.autoRegisterListeners</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>When set to <code>false</code>, the Envers entity listeners are no longer auto-registered, so you need to register them manually during the bootstrap process.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.integration.envers.enabled</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Enable or disable the Hibernate Envers <code>Service</code> integration.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.listeners.envers.autoRegister</strong></code></dt>
<dd>
<p>Legacy setting. Use <code>hibernate.envers.autoRegisterListeners</code> or <code>hibernate.integration.envers.enabled</code> instead.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-spatial"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-spatial"></a>23.24. Spatial properties</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.integration.spatial.enabled</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>Enable or disable the Hibernate Spatial <code>Service</code> integration.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.spatial.connection_finder</strong></code> (e.g. <code>org.geolatte.geom.codec.db.oracle.DefaultConnectionFinder</code>)</dt>
<dd>
<p>Define the fully-qualified name of class implementing the <code>org.geolatte.geom.codec.db.oracle.ConnectionFinder</code> interface.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configurations-internal"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#configurations-internal"></a>23.25. Internal properties</h3>
<div class="paragraph">
<p>The following configuration properties are used internally, and you shouldnâ€™t probably have to configured them in your application.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>hibernate.enable_specj_proprietary_syntax</strong></code> (e.g. <code>true</code> or <code>false</code> (default value))</dt>
<dd>
<p>Enable or disable the SpecJ proprietary mapping syntax which differs from JPA specification. Used during performance testing only.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.temp.use_jdbc_metadata_defaults</strong></code> (e.g. <code>true</code> (default value) or <code>false</code>)</dt>
<dd>
<p>This setting is used to control whether we should consult the JDBC metadata to determine certain Settings default values when the database may not be available (mainly in tools usage).</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.connection_provider.injection_data</strong></code> (e.g. <code>java.util.Map</code>)</dt>
<dd>
<p>Connection provider settings to be injected in the currently configured connection provider.</p>
</dd>
<dt class="hdlist1"><code><strong>hibernate.jandex_index</strong></code> (e.g. <code>org.jboss.jandex.Index</code>)</dt>
<dd>
<p>Names a Jandex <code>org.jboss.jandex.Index</code> instance to use.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations"></a>24. Mapping annotations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="annotations-jpa"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa"></a>24.1. JPA annotations</h3>
<div class="sect3">
<h4 id="annotations-jpa-access"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-access"></a>24.1.1. <code>@Access</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Access.html"><code>@Access</code></a> annotation is used to specify the access type of the associated entity class, mapped superclass, or embeddable class, or entity attribute.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#access">Access type</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-associationoverride"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-associationoverride"></a>24.1.2. <code>@AssociationOverride</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AssociationOverride.html"><code>@AssociationOverride</code></a> annotation is used to override an association mapping (e.g. <code>@ManyToOne</code>, <code>@OneToOne</code>, <code>@OneToMany</code>, <code>@ManyToMany</code>) inherited from a mapped superclass or an embeddable.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-override">Overriding Embeddable types</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-associationoverrides"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-associationoverrides"></a>24.1.3. <code>@AssociationOverrides</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AssociationOverrides.html"><code>@AssociationOverrides</code></a> is used to group several <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-associationoverride"><code>@AssociationOverride</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-attributeoverride"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-attributeoverride"></a>24.1.4. <code>@AttributeOverride</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AttributeOverride.html"><code>@AttributeOverride</code></a> annotation is used to override an attribute mapping inherited from a mapped superclass or an embeddable.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-override">Overriding Embeddable types</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-attributeoverrides"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-attributeoverrides"></a>24.1.5. <code>@AttributeOverrides</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AttributeOverrides.html"><code>@AttributeOverrides</code></a> is used to group several <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-attributeoverride"><code>@AttributeOverride</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-basic"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-basic"></a>24.1.6. <code>@Basic</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html"><code>@Basic</code></a> annotation is used to map a basic attribute type to a database column.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic">Basic types</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-cacheable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-cacheable"></a>24.1.7. <code>@Cacheable</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Cacheable.html"><code>@Cacheable</code></a> annotation is used to specify whether an entity should be stored in the second-level cache.</p>
</div>
<div class="paragraph">
<p>If the <code>persistence.xml</code> <code>shared-cache-mode</code> XML attribute is set to <code>ENABLE_SELECTIVE</code>, then only the entities annotated with the <code>@Cacheable</code> are going to be stored in the second-level cache.</p>
</div>
<div class="paragraph">
<p>If <code>shared-cache-mode</code> XML attribute value is <code>DISABLE_SELECTIVE</code>, then the entities marked with the <code>@Cacheable</code> annotation are not going to be stored in the second-level cache, while all the other entities are stored in the cache.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching">Caching</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-collectiontable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-collectiontable"></a>24.1.8. <code>@CollectionTable</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/CollectionTable.html"><code>@CollectionTable</code></a> annotation is used to specify the database table that stores the values of a basic or an embeddable type collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddable-collections">Collections of embeddable types</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-column"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-column"></a>24.1.9. <code>@Column</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Column.html"><code>@Column</code></a> annotation is used to specify the mapping between a basic entity attribute and the database table column.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-column-annotation"><code>@Column</code> annotation</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-columnresult"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-columnresult"></a>24.1.10. <code>@ColumnResult</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ColumnResult.html"><code>@ColumnResult</code></a> annotation is used in conjunction with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmapping"><code>@SqlResultSetMapping</code></a> or <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-constructorresult"><code>@ConstructorResult</code></a> annotations to map a SQL column for a given SELECT query.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-composite-key-entity-associations_named-query-example">Entity associations with named native queries</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-constructorresult"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-constructorresult"></a>24.1.11. <code>@ConstructorResult</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ConstructorResult.html"><code>@ConstructorResult</code></a> annotation is used in conjunction with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmapping"><code>@SqlResultSetMapping</code></a> annotations to map columns of a given SELECT query to a certain object constructor.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-multiple-scalar-values-dto-NamedNativeQuery-example">Multiple scalar values <code>NamedNativeQuery</code> with <code>ConstructorResult</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-convert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-convert"></a>24.1.12. <code>@Convert</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Convert.html"><code>@Convert</code></a> annotation is used to specify the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AttributeConverter.html"><code>AttributeConverter</code></a> implementation used to convert the currently annotated basic attribute.</p>
</div>
<div class="paragraph">
<p>If the <code>AttributeConverter</code> uses <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Converter.html#autoApply--"><code>autoApply</code></a>, then all entity attributes with the same target type are going to be converted automatically.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-attribute-converter"><code>AttributeConverter</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-converter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-converter"></a>24.1.13. <code>@Converter</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Converter.html"><code>@Converter</code></a> annotation is used to specify that the current annotate <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/AttributeConverter.html"><code>AttributeConverter</code></a> implementation can be used as a JPA basic attribute converter.</p>
</div>
<div class="paragraph">
<p>If the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Converter.html#autoApply--"><code>autoApply</code></a> attribute is set to <code>true</code>, then the JPA provider will automatically convert all basic attributes with the same Java type as defined by the current converter.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-attribute-converter"><code>AttributeConverter</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-converts"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-converts"></a>24.1.14. <code>@Converts</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Converts.html"><code>@Converts</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-convert"><code>@Convert</code></a> annotations.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-attribute-converter"><code>AttributeConverter</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-discriminatorcolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-discriminatorcolumn"></a>24.1.15. <code>@DiscriminatorColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorColumn.html"><code>@DiscriminatorColumn</code></a> annotation is used to specify the discriminator column name and the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorColumn.html#discriminatorType--">discriminator type</a> for the <code>SINGLE_TABLE</code> and <code>JOINED</code> Inheritance strategies.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator">Discriminator</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-discriminatorvalue"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-discriminatorvalue"></a>24.1.16. <code>@DiscriminatorValue</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorValue.html"><code>@DiscriminatorValue</code></a> annotation is used to specify what value of the discriminator column is used for mapping the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator">Discriminator</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-elementcollection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-elementcollection"></a>24.1.17. <code>@ElementCollection</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ElementCollection.html"><code>@ElementCollection</code></a> annotation is used to specify a collection of a basic or embeddable types.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections">Collections</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-embeddable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-embeddable"></a>24.1.18. <code>@Embeddable</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Embeddable.html"><code>@Embeddable</code></a> annotation is used to specify embeddable types. Like basic types, embeddable types do not have any identity, being managed by their owning entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddables">Embeddables</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-embedded"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-embedded"></a>24.1.19. <code>@Embedded</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Embedded.html"><code>@Embedded</code></a> annotation is used to specify that a given entity attribute represents an embeddable type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#embeddables">Embeddables</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-embeddedid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-embeddedid"></a>24.1.20. <code>@EmbeddedId</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EmbeddedId.html"><code>@EmbeddedId</code></a> annotation is used to specify the entity identifier is an embeddable type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-aggregated">Composite identifiers with <code>@EmbeddedId</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-entity"></a>24.1.21. <code>@Entity</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Entity.html"><code>@Entity</code></a> annotation is used to specify that the currently annotate class represents an entity type.
Unlike basic and embeddable types, entity types have an identity and their state is managed by the underlying Persistence Context.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity">Entity</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-entitylisteners"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-entitylisteners"></a>24.1.22. <code>@EntityListeners</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityListeners.html"><code>@EntityListeners</code></a> annotation is used to specify an array of callback listener classes that are used by the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-entityresult"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-entityresult"></a>24.1.23. <code>@EntityResult</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityResult.html"><code>@EntityResult</code></a> annotation is used with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmapping"><code>@SqlResultSetMapping</code></a> annotation to map the selected columns to an entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-composite-key-entity-associations_named-query-example">Entity associations with named native queries</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-enumerated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-enumerated"></a>24.1.24. <code>@Enumerated</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Enumerated.html"><code>@Enumerated</code></a> annotation is used to specify that an entity attribute represents an enumerated type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-enums-Enumerated"><code>@Enumerated</code> basic type</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-excludedefaultlisteners"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-excludedefaultlisteners"></a>24.1.25. <code>@ExcludeDefaultListeners</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ExcludeDefaultListeners.html"><code>@ExcludeDefaultListeners</code></a> annotation is used to specify that the currently annotated entity skips the invocation of any default listener.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-exclude-default-listener">Exclude default entity listeners</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-excludesuperclasslisteners"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-excludesuperclasslisteners"></a>24.1.26. <code>@ExcludeSuperclassListeners</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ExcludeSuperclassListeners.html"><code>@ExcludeSuperclassListeners</code></a>  annotation is used to specify that the currently annotated entity skips the invocation of listeners declared by its superclass.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-exclude-default-listener">Exclude default entity listeners</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-fieldresult"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-fieldresult"></a>24.1.27. <code>@FieldResult</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/FieldResult.html"><code>@FieldResult</code></a> annotation is used with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-entityresult"><code>@EntityResult</code></a> annotation to map the selected columns to the fields of some specific entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-composite-key-entity-associations_named-query-example">Entity associations with named native queries</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-foreignkey"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-foreignkey"></a>24.1.28. <code>@ForeignKey</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ForeignKey.html"><code>@ForeignKey</code></a> annotation is used to specify the associated foreign key of a <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumn"><code>@JoinColumn</code></a> mapping.
The <code>@ForeignKey</code> annotation is only used if the automated schema generation tool is enabled, in which case, it allows you to customize the underlying foreign key definition.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-one-example"><code>@ManyToOne</code> with <code>@ForeignKey</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-generatedvalue"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-generatedvalue"></a>24.1.29. <code>@GeneratedValue</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html"><code>@GeneratedValue</code></a> annotation specifies that the entity identifier value is automatically generated using an identity column, a database sequence, or a table generator.
Hibernate supports the <code>@GeneratedValue</code> mapping even for <code>UUID</code> identifiers.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-simple-generated">Automatically-generated identifiers</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-id"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-id"></a>24.1.30. <code>@Id</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Id.html"><code>@Id</code></a> annotation specifies the entity identifier.
An entity must always have an identifier attribute which is used when loading the entity in a given Persistence Context.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers">Identifiers</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-idclass"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-idclass"></a>24.1.31. <code>@IdClass</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/IdClass.html"><code>@IdClass</code></a> annotation is used if the current entity defined a composite identifier.
A separate class encapsulates all the identifier attributes, which are mirrored by the current entity mapping.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-composite-nonaggregated">Composite identifiers with <code>@IdClass</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-index"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-index"></a>24.1.32. <code>@Index</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Index.html"><code>@Index</code></a> annotation is used by the automated schema generation tool to create a database index.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-columns-index">Columns index</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-inheritance"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-inheritance"></a>24.1.33. <code>@Inheritance</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Inheritance.html"><code>@Inheritance</code></a> annotation is used to specify the inheritance strategy of a given entity class hierarchy.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance">Inheritance</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-joincolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumn"></a>24.1.34. <code>@JoinColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html"><code>@JoinColumn</code></a> annotation is used to specify the FOREIGN KEY column used when joining an entity association or an embeddable collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-one-example"><code>@ManyToOne</code> with <code>@JoinColumn</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-joincolumns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumns"></a>24.1.35. <code>@JoinColumns</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumns.html"><code>@JoinColumns</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumn"><code>@JoinColumn</code></a> annotations, which are used when mapping entity association or an embeddable collection using a composite identifier</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-jointable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-jointable"></a>24.1.36. <code>@JoinTable</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html"><code>@JoinTable</code></a> annotation is used to specify the link table between two other database tables.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-unidirectional-example"><code>@JoinTable</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-lob"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-lob"></a>24.1.37. <code>@Lob</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Lob.html"><code>@Lob</code></a> annotation is used to specify that the currently annotated entity attribute represents a large object type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-blob-example"><code>BLOB</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-manytomany"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-manytomany"></a>24.1.38. <code>@ManyToMany</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html"><code>@ManyToMany</code></a> annotation is used to specify a many-to-many database relationship.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many"><code>@ManyToMany</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-manytoone"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-manytoone"></a>24.1.39. <code>@ManyToOne</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html"><code>@ManyToOne</code></a> annotation is used to specify a many-to-one database relationship.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-one"><code>@ManyToOne</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkey"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkey"></a>24.1.40. <code>@MapKey</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKey.html"><code>@MapKey</code></a> annotation is used to specify the key of a <code>java.util.Map</code> association for which the key type is either the primary key or an attribute of the entity which represents the value of the map.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-unidirectional-example"><code>@MapKey</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeyclass"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeyclass"></a>24.1.41. <code>@MapKeyClass</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyClass.html"><code>@MapKeyClass</code></a> annotation is used to specify the type of the map key of a <code>java.util.Map</code> associations.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-key-class"><code>@MapKeyClass</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeycolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeycolumn"></a>24.1.42. <code>@MapKeyColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyColumn.html"><code>@MapKeyColumn</code></a> annotation is used to specify the database column which stores the key of a <code>java.util.Map</code> association for which the map key is a basic type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-custom-key-type-mapping-example"><code>@MapKeyType</code> mapping section</a> for an example of <code>@MapKeyColumn</code> annotation usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeyenumerated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeyenumerated"></a>24.1.43. <code>@MapKeyEnumerated</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyEnumerated.html"><code>@MapKeyEnumerated</code></a> annotation is used to specify that the key of <code>java.util.Map</code> association is a Java Enum.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-bidirectional-example"><code>@MapKeyEnumerated</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeyjoincolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeyjoincolumn"></a>24.1.44. <code>@MapKeyJoinColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyJoinColumn.html"><code>@MapKeyJoinColumn</code></a> annotation is used to specify that the key of <code>java.util.Map</code> association is an entity association.
The map key column is a FOREIGN KEY in a link table that also joins the <code>Map</code> ownerâ€™s table with the table where the <code>Map</code> value resides.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-value-type-entity-key-example"><code>@MapKeyJoinColumn</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeyjoincolumns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeyjoincolumns"></a>24.1.45. <code>@MapKeyJoinColumns</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyJoinColumns.html"><code>@MapKeyJoinColumns</code></a> annotation is used to group several <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeyjoincolumn"><code>@MapKeyJoinColumn</code></a> mappings when the <code>java.util.Map</code> association key uses a composite identifier.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapkeytemporal"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapkeytemporal"></a>24.1.46. <code>@MapKeyTemporal</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapKeyTemporal.html"><code>@MapKeyTemporal</code></a> annotation is used to specify that the key of <code>java.util.Map</code> association is a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/TemporalType.html"><code>@TemporalType</code></a> (e.g. <code>DATE</code>, <code>TIME</code>, <code>TIMESTAMP</code>).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-unidirectional-example"><code>@MapKeyTemporal</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mappedsuperclass"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mappedsuperclass"></a>24.1.47. <code>@MappedSuperclass</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html"><code>@MappedSuperclass</code></a> annotation is used to specify that the currently annotated type attributes are inherited by any subclass entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-mapped-superclass"><code>@MappedSuperclass</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-mapsid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-mapsid"></a>24.1.48. <code>@MapsId</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MapsId.html"><code>@MapsId</code></a> annotation is used to specify that the entity identifier is mapped by the currently annotated <code>@ManyToOne</code> or <code>@OneToOne</code> association.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-derived-mapsid"><code>@MapsId</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedattributenode"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedattributenode"></a>24.1.49. <code>@NamedAttributeNode</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedAttributeNode.html"><code>@NamedAttributeNode</code></a> annotation is used to specify each individual attribute node that needs to be fetched by an Entity Graph.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-entity-graph-example">Fetch graph</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedentitygraph"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedentitygraph"></a>24.1.50. <code>@NamedEntityGraph</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedEntityGraph.html"><code>@NamedEntityGraph</code></a> annotation is used to specify an Entity Graph that can be used by an entity query to override the default fetch plan.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-entity-graph-example">Fetch graph</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedentitygraphs"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedentitygraphs"></a>24.1.51. <code>@NamedEntityGraphs</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedEntityGraphs.html"><code>@NamedEntityGraphs</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedentitygraph"><code>@NamedEntityGraph</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namednativequeries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namednativequeries"></a>24.1.52. <code>@NamedNativeQueries</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedNativeQueries.html"><code>@NamedNativeQueries</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namednativequery"><code>@NamedNativeQuery</code></a> annotations.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namednativequery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namednativequery"></a>24.1.53. <code>@NamedNativeQuery</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedNativeQuery.html"><code>@NamedNativeQuery</code></a> annotation is used to specify a native SQL query that can be retrieved later by its name.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedqueries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedqueries"></a>24.1.54. <code>@NamedQueries</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedQueries.html"><code>@NamedQueries</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedquery"><code>@NamedQuery</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedquery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedquery"></a>24.1.55. <code>@NamedQuery</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedQuery.html"><code>@NamedQuery</code></a> annotation is used to specify a JPQL query that can be retrieved later by its name.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jpql-api-named-query-example"><code>@NamedQuery</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedstoredprocedurequeries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedstoredprocedurequeries"></a>24.1.56. <code>@NamedStoredProcedureQueries</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedStoredProcedureQueries.html"><code>@NamedStoredProcedureQueries</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedstoredprocedurequery"><code>@NamedStoredProcedureQuery</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedstoredprocedurequery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedstoredprocedurequery"></a>24.1.57. <code>@NamedStoredProcedureQuery</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedStoredProcedureQuery.html"><code>@NamedStoredProcedureQuery</code></a> annotation is used to specify a stored procedure query that can be retrieved later by its name.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-sp-named-query">Using named queries to call stored procedures</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-namedsubgraph"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedsubgraph"></a>24.1.58. <code>@NamedSubgraph</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/NamedSubgraph.html"><code>@NamedSubgraph</code></a> annotation used to specify a subgraph in an Entity Graph.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-entity-subgraph">Fetch subgraph</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-onetomany"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-onetomany"></a>24.1.59. <code>@OneToMany</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html"><code>@OneToMany</code></a> annotation is used to specify a one-to-many database relationship.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-many"><code>@OneToMany</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-onetoone"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-onetoone"></a>24.1.60. <code>@OneToOne</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html"><code>@OneToOne</code></a> annotation is used to specify a one-to-one database relationship.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one"><code>@OneToOne</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-orderby"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-orderby"></a>24.1.61. <code>@OrderBy</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderBy.html"><code>@OrderBy</code></a> annotation is used to specify the entity attributes used for sorting when fetching the currently annotated collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-ordered-list"><code>@OrderBy</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-ordercolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-ordercolumn"></a>24.1.62. <code>@OrderColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderColumn.html"><code>@OrderColumn</code></a> annotation is used to specify that the current annotation collection order should be materialized in the database.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-ordered-list-order-column-example"><code>@OrderColumn</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-persistencecontext"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistencecontext"></a>24.1.63. <code>@PersistenceContext</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceContext.html"><code>@PersistenceContext</code></a> annotation is used to specify the <code>EntityManager</code> that needs to be injected as a dependency.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant-PersistenceContext-example"><code>@PersistenceContext</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-persistencecontexts"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistencecontexts"></a>24.1.64. <code>@PersistenceContexts</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceContexts.html"><code>@PersistenceContexts</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistencecontext"><code>@PersistenceContext</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-persistenceproperty"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistenceproperty"></a>24.1.65. <code>@PersistenceProperty</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceProperty.html"><code>@PersistenceProperty</code></a> annotation is used by the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistencecontext"><code>@PersistenceContext</code></a> annotation to declare JPA provider properties that are passed to the underlying container when the <code>EntityManager</code> instance is created.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant-PersistenceContext-configurable-example"><code>@PersistenceProperty</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-persistenceunit"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistenceunit"></a>24.1.66. <code>@PersistenceUnit</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceUnit.html"><code>@PersistenceUnit</code></a> annotation is used to specify the <code>EntityManagerFactory</code> that needs to be injected as a dependency.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-jpa-compliant-PersistenceUnit-example"><code>@PersistenceUnit</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-persistenceunits"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistenceunits"></a>24.1.67. <code>@PersistenceUnits</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PersistenceUnits.html"><code>@PersistenceUnits</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-persistenceunit"><code>@PersistenceUnit</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-postload"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-postload"></a>24.1.68. <code>@PostLoad</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PostLoad.html"><code>@PostLoad</code></a> annotation is used to specify a callback method that fires after an entity is loaded.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-postpersist"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-postpersist"></a>24.1.69. <code>@PostPersist</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PostPersist.html"><code>@PostPersist</code></a> annotation is used to specify a callback method that fires after an entity is persisted.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-postremove"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-postremove"></a>24.1.70. <code>@PostRemove</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PostRemove.html"><code>@PostRemove</code></a> annotation is used to specify a callback method that fires after an entity is removed.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-postupdate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-postupdate"></a>24.1.71. <code>@PostUpdate</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PostUpdate.html"><code>@PostUpdate</code></a> annotation is used to specify a callback method that fires after an entity is updated.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-prepersist"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-prepersist"></a>24.1.72. <code>@PrePersist</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PrePersist.html"><code>@PrePersist</code></a> annotation is used to specify a callback method that fires before an entity is persisted.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-preremove"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-preremove"></a>24.1.73. <code>@PreRemove</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PreRemove.html"><code>@PreRemove</code></a> annotation is used to specify a callback method that fires before an entity is removed.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-preupdate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-preupdate"></a>24.1.74. <code>@PreUpdate</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PreUpdate.html"><code>@PreUpdate</code></a> annotation is used to specify a callback method that fires before an entity is updated.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example">JPA callbacks</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-primarykeyjoincolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-primarykeyjoincolumn"></a>24.1.75. <code>@PrimaryKeyJoinColumn</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PrimaryKeyJoinColumn.html"><code>@PrimaryKeyJoinColumn</code></a> annotation is used to specify that the primary key column of the currently annotated entity is also a foreign key to some other entity
(e.g. a base class table in a <code>JOINED</code> inheritance strategy, the primary table in a secondary table mapping, or the parent table in a <code>@OneToOne</code> relationship).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-derived-primarykeyjoincolumn"><code>@PrimaryKeyJoinColumn</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-primarykeyjoincolumns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-primarykeyjoincolumns"></a>24.1.76. <code>@PrimaryKeyJoinColumns</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PrimaryKeyJoinColumns.html"><code>@PrimaryKeyJoinColumns</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-primarykeyjoincolumn"><code>@PrimaryKeyJoinColumn</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-queryhint"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-queryhint"></a>24.1.77. <code>@QueryHint</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/QueryHint.html"><code>@QueryHint</code></a> annotation is used to specify a JPA provider hint used by a <code>@NamedQuery</code> or a <code>@NamedNativeQuery</code> annotation.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jpa-read-only-entities-native-example"><code>@QueryHint</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-secondarytable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-secondarytable"></a>24.1.78. <code>@SecondaryTable</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/SecondaryTable.html"><code>@SecondaryTable</code></a> annotation is used to specify a secondary table for the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-secondary-table-example"><code>@SecondaryTable</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-secondarytables"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-secondarytables"></a>24.1.79. <code>@SecondaryTables</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/SecondaryTables.html"><code>@SecondaryTables</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-secondarytable"><code>@SecondaryTable</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-sequencegenerator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sequencegenerator"></a>24.1.80. <code>@SequenceGenerator</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/SequenceGenerator.html"><code>@SequenceGenerator</code></a> annotation is used to specify the database sequence used by the identifier generator of the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-sequence-configured"><code>@SequenceGenerator</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-sqlresultsetmapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmapping"></a>24.1.81. <code>@SqlResultSetMapping</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/SqlResultSetMapping.html"><code>@SqlResultSetMapping</code></a> annotation is used to specify the <code>ResultSet</code> mapping of a native SQL query or stored procedure.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-composite-key-entity-associations_named-query-example"><code>SqlResultSetMapping</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-sqlresultsetmappings"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmappings"></a>24.1.82. <code>@SqlResultSetMappings</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/SqlResultSetMappings.html"><code>@SqlResultSetMappings</code></a> annotation is group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-sqlresultsetmapping"><code>@SqlResultSetMapping</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-storedprocedureparameter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-storedprocedureparameter"></a>24.1.83. <code>@StoredProcedureParameter</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/StoredProcedureParameter.html"><code>@StoredProcedureParameter</code></a> annotation is used to specify a parameter of a <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedstoredprocedurequery"><code>@NamedStoredProcedureQuery</code></a>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-sp-named-query">Using named queries to call stored procedures</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-table"></a>24.1.84. <code>@Table</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Table.html"><code>@Table</code></a> annotation is used to specify the primary table of the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-secondary-table-example"><code>@Table</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-tablegenerator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-tablegenerator"></a>24.1.85. <code>@TableGenerator</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/TableGenerator.html"><code>@TableGenerator</code></a> annotation is used to specify the database table used by the identity generator of the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-table-configured-mapping-example"><code>@TableGenerator</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-temporal"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-temporal"></a>24.1.86. <code>@Temporal</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Temporal.html"><code>@Temporal</code></a> annotation is used to specify the <code>TemporalType</code> of the currently annotated <code>java.util.Date</code> or <code>java.util.Calendar</code> entity attribute.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-datetime">Basic temporal types</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-transient"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-transient"></a>24.1.87. <code>@Transient</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Transient.html"><code>@Transient</code></a> annotation is used to specify that a given entity attribute should not be persisted.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#events-jpa-callbacks-example"><code>@Transient</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-uniqueconstraint"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-uniqueconstraint"></a>24.1.88. <code>@UniqueConstraint</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/UniqueConstraint.html"><code>@UniqueConstraint</code></a> annotation is used to specify a unique constraint to be included by the automated schema generator for the primary or secondary table associated with the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-columns-unique-constraint">Columns unique constraint</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-jpa-version"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-version"></a>24.1.89. <code>@Version</code></h4>
<div class="paragraph">
<p>The <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Version.html"><code>@Version</code></a> annotation is used to specify the version attribute used for optimistic locking.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic">Optimistic locking mapping</a> section for more info.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="annotations-hibernate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate"></a>24.2. Hibernate annotations</h3>
<div class="sect3">
<h4 id="annotations-hibernate-accesstype"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-accesstype"></a>24.2.1. <span class="line-through"><code>@AccessType</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/AccessType.html"><span class="line-through"><code>@AccessType</code></span></a> annotation is deprecated.
You should use either the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-access"><code>@Access</code></a> or the Hibernate native <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-attributeaccessor"><code>@AttributeAccessor</code></a> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-any"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-any"></a>24.2.2. <code>@Any</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Any.html"><code>@Any</code></a> annotation is used to define the <strong>any-to-one</strong> association
which can point to one one of several entity types.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-any"><code>@Any</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-anymetadef"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-anymetadef"></a>24.2.3. <code>@AnyMetaDef</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/AnyMetaDef.html"><code>@AnyMetaDef</code></a> annotation is used to provide metadata about an <code>@Any</code> or <code>@ManyToAny</code> mapping.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-any"><code>@Any</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-anymetadefs"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-anymetadefs"></a>24.2.4. <code>@AnyMetaDefs</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/AnyMetaDefs.html"><code>@AnyMetaDefs</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-anymetadef"><code>@AnyMetaDef</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-attributeaccessor"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-attributeaccessor"></a>24.2.5. <code>@AttributeAccessor</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/AttributeAccessor.html"><code>@AttributeAccessor</code></a> annotation is used to specify a custom <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/property/access/spi/PropertyAccessStrategy.html"><code>PropertyAccessStrategy</code></a>.</p>
</div>
<div class="paragraph">
<p>Should only be used to name a custom <code>PropertyAccessStrategy</code>.
For property/field access type, the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-access"><code>@Access</code></a> annotation should be preferred.</p>
</div>
<div class="paragraph">
<p>However, if this annotation is used with either value="property" or value="field", it will act just as the corresponding usage of the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-access"><code>@Access</code></a> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-batchsize"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-batchsize"></a>24.2.6. <code>@BatchSize</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/BatchSize.html"><code>@BatchSize</code></a> annotation is used to specify the size for batch loading the entries of a lazy collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-batch">Batch fetching</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-cache"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-cache"></a>24.2.7. <code>@Cache</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Cache.html"><code>@Cache</code></a> annotation is used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CacheConcurrencyStrategy.html"><code>CacheConcurrencyStrategy</code></a> of a root entity or a collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#caching">Caching</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-cascade"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-cascade"></a>24.2.8. <code>@Cascade</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Cascade.html"><code>@Cascade</code></a> annotation is used to apply the Hibernate specific <a href="http://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CascadeType.html"><code>CascadeType</code></a> strategies (e.g. <code>CascadeType.LOCK</code>, <code>CascadeType.SAVE_UPDATE</code>, <code>CascadeType.REPLICATE</code>) on a given association.</p>
</div>
<div class="paragraph">
<p>For JPA cascading, prefer using the <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/CascadeType.html"><code>javax.persistence.CascadeType</code></a> instead.</p>
</div>
<div class="paragraph">
<p>When combining both JPA and Hibernate <code>CascadeType</code> strategies, Hibernate will merge both sets of cascades.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade">Cascading</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-check"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-check"></a>24.2.9. <code>@Check</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Check.html"><code>@Check</code></a> annotation is used to specify an arbitrary SQL CHECK constraint which can be defined at the class level.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-database-checks">Database-level checks</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-collectionid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-collectionid"></a>24.2.10. <code>@CollectionId</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CollectionId.html"><code>@CollectionId</code></a> annotation is used to specify an identifier column for an idbag collection.</p>
</div>
<div class="paragraph">
<p>You might want to use the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-ordercolumn"><code>@OrderColumn</code></a> instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-collectiontype"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-collectiontype"></a>24.2.11. <code>@CollectionType</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CollectionType.html"><code>@CollectionType</code></a> annotation is used to specify a custom collection type.</p>
</div>
<div class="paragraph">
<p>The collection can also name a <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-type"><code>@Type</code></a>, which defines the Hibernate Type of the collection elements.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-custom">Custom collection types</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-columndefault"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-columndefault"></a>24.2.12. <code>@ColumnDefault</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ColumnDefault.html"><code>@ColumnDefault</code></a> annotation is used to specify the <code>DEFAULT</code> DDL value to apply when using the automated schema generator.</p>
</div>
<div class="paragraph">
<p>The same behavior can be achieved using the <code>definition</code> attribute of the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-column"><code>@Column</code></a> annotation.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#schema-generation-column-default-value">Default value for a database column</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-columns"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-columns"></a>24.2.13. <code>@Columns</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Columns.html"><code>@Columns</code></a> annotation is used to group multiple JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-column"><code>@Column</code></a> annotations.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write-composite-type-example"><code>@Columns</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-columntransformer"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-columntransformer"></a>24.2.14. <code>@ColumnTransformer</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ColumnTransformer.html"><code>@ColumnTransformer</code></a> annotation is used to customize how a given column value is read from or write into the database.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write-example"><code>@ColumnTransformer</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-columntransformers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-columntransformers"></a>24.2.15. <code>@ColumnTransformers</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ColumnTransformers.html"><code>@ColumnTransformers</code></a> annotation iis used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-columntransformer"><code>@ColumnTransformer</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-creationtimestamp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-creationtimestamp"></a>24.2.16. <code>@CreationTimestamp</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/CreationTimestamp.html"><code>@CreationTimestamp</code></a> annotation is used to specify that the currently annotated temporal type must be initialized with the current JVM timestamp value.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-CreationTimestamp"><code>@CreationTimestamp</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-discriminatorformula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-discriminatorformula"></a>24.2.17. <code>@DiscriminatorFormula</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/DiscriminatorFormula.html"><code>@DiscriminatorFormula</code></a> annotation is used to specify a Hibernate <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-formula"><code>@Formula</code></a> to resolve the inheritance discriminator value.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-single-table-discriminator-formula-example"><code>@DiscriminatorFormula</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-discriminatoroptions"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-discriminatoroptions"></a>24.2.18. <code>@DiscriminatorOptions</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/DiscriminatorOptions.html"><code>@DiscriminatorOptions</code></a> annotation is used to provide the <code>force</code> and <code>insert</code> Discriminator properties.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-discriminator">Discriminator</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-dynamicinsert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-dynamicinsert"></a>24.2.19. <code>@DynamicInsert</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/DynamicInsert.html"><code>@DynamicInsert</code></a> annotation is used to specify that the <code>INSERT</code> SQL statement should be generated whenever an entity is to be persisted.</p>
</div>
<div class="paragraph">
<p>By default, Hibernate uses a cached <code>INSERT</code> statement that sets all table columns.
When the entity is annotated with the <code>@DynamicInsert</code> annotation, the <code>PreparedStatement</code> is going to include only the non-null columns.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-CreationTimestamp"><code>@CreationTimestamp</code> mapping</a> section for more info on how <code>@DynamicInsert</code> works.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-dynamicupdate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-dynamicupdate"></a>24.2.20. <code>@DynamicUpdate</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/DynamicUpdate.html"><code>@DynamicUpdate</code></a> annotation is used to specify that the <code>UPDATE</code> SQL statement should be generated whenever an entity is modified.</p>
</div>
<div class="paragraph">
<p>By default, Hibernate uses a cached <code>UPDATE</code> statement that sets all table columns.
When the entity is annotated with the <code>@DynamicUpdate</code> annotation, the <code>PreparedStatement</code> is going to include only the columns whose values have been changed.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-managed-state-dynamic-update"><code>@DynamicUpdate</code></a> section for more info.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For reattachment of detached entities, the dynamic update is not possible without having the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-selectbeforeupdate"><code>@SelectBeforeUpdate</code></a> annotation as well.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-entity"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-entity"></a>24.2.21. <span class="line-through"><code>@Entity</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Entity.html"><span class="line-through"><code>@Entity</code></span></a> annotation is deprecated. Use the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-entity"><code>@Entity</code></a> annotation instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-fetch"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetch"></a>24.2.22. <code>@Fetch</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Fetch.html"><code>@Fetch</code></a> annotation is used to specify the Hibernate specific <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FetchMode.html"><code>FetchMode</code></a> (e.g. <code>JOIN</code>, <code>SELECT</code>, <code>SUBSELECT</code>) used for the currently annotated association:</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-fetch-annotation"><code>@Fetch</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-fetchprofile"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetchprofile"></a>24.2.23. <code>@FetchProfile</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FetchProfile.html"><code>@FetchProfile</code></a> annotation is used to specify a custom fetching profile, similar to a JPA Entity Graph.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-profile-example">Fetch mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-fetchprofile-fetchoverride"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetchprofile-fetchoverride"></a>24.2.24. <code>@FetchProfile.FetchOverride</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FetchProfile.FetchOverride.html"><code>@FetchProfile.FetchOverride</code></a> annotation is used in conjunction with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetchprofile"><code>@FetchProfile</code></a> annotation,
and itâ€™s used for overriding the fetching strategy of a particular entity association.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-strategies-dynamic-fetching-profile-example">Fetch profile</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-fetchprofiles"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetchprofiles"></a>24.2.25. <code>@FetchProfiles</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FetchProfiles.html"><code>@FetchProfiles</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-fetchprofile"><code>@FetchProfile</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filter"></a>24.2.26. <code>@Filter</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Filter.html"><code>@Filter</code></a> annotation is used to add filters to an entity or the target entity of a collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-filter-example">Filter mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filterdef"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterdef"></a>24.2.27. <code>@FilterDef</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FilterDef.html"><code>@FilterDef</code></a> annotation is used to specify a <code>@Filter</code> definition (name, default condition and parameter types, if any).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-filter-example">Filter mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filterdefs"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterdefs"></a>24.2.28. <code>@FilterDefs</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FilterDefs.html"><code>@FilterDefs</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterdef"><code>@FilterDef</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filterjointable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterjointable"></a>24.2.29. <code>@FilterJoinTable</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FilterJoinTable.html"><code>@FilterJoinTable</code></a> annotation is used to add <code>@Filter</code> capabilities to a join table collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-filter-join-table">FilterJoinTable mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filterjointables"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterjointables"></a>24.2.30. <code>@FilterJoinTables</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/FilterJoinTables.html"><code>@FilterJoinTables</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterjointable"><code>@FilterJoinTable</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-filters"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filters"></a>24.2.31. <code>@Filters</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Filters.html"><code>@Filters</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filter"><code>@Filter</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_span_class_line_through_code_foreignkey_code_span"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_span_class_line_through_code_foreignkey_code_span"></a>24.2.32. <span class="line-through"><code>@ForeignKey</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ForeignKey.html"><span class="line-through"><code>@ForeignKey</code></span></a> annotation is deprecated. Use the JPA 2.1 <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-foreignkey"><code>@ForeignKey</code></a> annotation instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-formula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-formula"></a>24.2.33. <code>@Formula</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Formula.html"><code>@Formula</code></a> annotation is used to specify an SQL fragment that is executed in order to populate a given entity attribute.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-formula-example"><code>@Formula</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-generated"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-generated"></a>24.2.34. <code>@Generated</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Generated.html"><code>@Generated</code></a> annotation is used to specify that the currently annotated entity attribute is generated by the database.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-Generated"><code>@Generated</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-generatortype"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-generatortype"></a>24.2.35. <code>@GeneratorType</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GeneratorType.html"><code>@GeneratorType</code></a> annotation is used to provide a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tuple/ValueGenerator.html"><code>ValueGenerator</code></a>
and a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenerationTime.html"><code>GenerationTime</code></a> for the currently annotated generated attribute.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-GeneratorType-example"><code>@GeneratorType</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-genericgenerator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-genericgenerator"></a>24.2.36. <code>@GenericGenerator</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenericGenerator.html"><code>@GenericGenerator</code></a> annotation can be used to configure any Hibernate identifier generator.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators-GenericGenerator"><code>@GenericGenerator</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-genericgenerators"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-genericgenerators"></a>24.2.37. <code>@GenericGenerators</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/GenericGenerators.html"><code>@GenericGenerators</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-genericgenerator"><code>@GenericGenerator</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-immutable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-immutable"></a>24.2.38. <code>@Immutable</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Immutable.html"><code>@Immutable</code></a> annotation is used to specify that the annotated entity, attribute, or collection is immutable.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-immutability"><code>@Immutable</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-index"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-index"></a>24.2.39. <span class="line-through"><code>@Index</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Index.html"><span class="line-through"><code>@Index</code></span></a> annotation is deprecated. Use the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-index"><code>@Index</code></a> annotation instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-indexcolumn"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-indexcolumn"></a>24.2.40. <span class="line-through"><code>@IndexColumn</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/IndexColumn.html"><span class="line-through"><code>@IndexColumn</code></span></a> annotation is deprecated. Use the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-ordercolumn"><code>@OrderColumn</code></a> annotation instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-joincolumnorformula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-joincolumnorformula"></a>24.2.41. <code>@JoinColumnOrFormula</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/JoinColumnOrFormula.html"><code>@JoinColumnOrFormula</code></a> annotation is used to specify that the entity association is resolved either through a FOREIGN KEY join (e.g. <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumn"><code>@JoinColumn</code></a>) or using the result of a given SQL formula (e.g. <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-joinformula"><code>@JoinFormula</code></a>).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-JoinColumnOrFormula"><code>@JoinColumnOrFormula</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-joincolumnsorformulas"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-joincolumnsorformulas"></a>24.2.42. <code>@JoinColumnsOrFormulas</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/JoinColumnsOrFormulas.html"><code>@JoinColumnsOrFormulas</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-joincolumnorformula"><code>@JoinColumnOrFormula</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-joinformula"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-joinformula"></a>24.2.43. <code>@JoinFormula</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/JoinFormula.html"><code>@JoinFormula</code></a> annotation is used as a replacement for <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-joincolumn"><code>@JoinColumn</code></a> when the association does not have a dedicated FOREIGN KEY column.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-JoinFormula"><code>@JoinFormula</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-lazycollection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-lazycollection"></a>24.2.44. <code>@LazyCollection</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyCollection.html"><code>@LazyCollection</code></a> annotation is used to specify the lazy fetching behavior of a given collection.
The possible values are given by the <code><a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyCollectionOption.html">LazyCollectionOption</a></code> enumeration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>TRUE</code></dt>
<dd>
<p>Load it when the state is requested.</p>
</dd>
<dt class="hdlist1"><code>FALSE</code></dt>
<dd>
<p>Eagerly load it.</p>
</dd>
<dt class="hdlist1"><code>EXTRA</code></dt>
<dd>
<p>Prefer extra queries over full collection loading.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>TRUE</code> and <code>FALSE</code> values are deprecated since you should be using the JPA <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/FetchType.html"><code>FetchType</code></a> attribute of the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-elementcollection"><code>@ElementCollection</code></a>, <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-onetomany"><code>@OneToMany</code></a>, or <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-manytomany"><code>@ManyToMany</code></a> collection.</p>
</div>
<div class="paragraph">
<p>The <code>EXTRA</code> value has no equivalent in the JPA specification, and itâ€™s used to avoid loading the entire collection even when the collection is accessed for the first time.
Each element is fetched individually using a secondary query.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#fetching-LazyCollection"><code>@LazyCollection</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-lazygroup"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-lazygroup"></a>24.2.45. <code>@LazyGroup</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyGroup.html"><code>@LazyGroup</code></a> annotation is used to specify that an entity attribute should be fetched along with all the other attributes belonging to the same group.</p>
</div>
<div class="paragraph">
<p>To load entity attributes lazily, bytecode enhancement is needed.
By default, all non-collection attributes are loaded in one group named "DEFAULT".</p>
</div>
<div class="paragraph">
<p>This annotation allows defining different groups of attributes to be initialized together when access one attribute in the group.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#BytecodeEnhancement-lazy-loading-example"><code>@LazyGroup</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-lazytoone"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-lazytoone"></a>24.2.46. <code>@LazyToOne</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyToOne.html"><code>@LazyToOne</code></a> annotation is used to specify the laziness options, represented by <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/LazyToOneOption.html"><code>LazyToOneOption</code></a>, available for a <code>@OneToOne</code> or <code>@ManyToOne</code> association.</p>
</div>
<div class="paragraph">
<p><code>LazyToOneOption</code> defines the following alternatives:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FALSE</dt>
<dd>
<p>Eagerly load the association. This one is not needed since the JPA <code>FetchType.EAGER</code> offers the same behavior.</p>
</dd>
<dt class="hdlist1">NO_PROXY</dt>
<dd>
<p>This option will fetch the association lazily while returning real entity object.</p>
</dd>
<dt class="hdlist1">PROXY</dt>
<dd>
<p>This option will fetch the association lazily while returning a proxy instead.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-one-to-one-bidirectional-lazy"><code>@LazyToOne</code> mapping example</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-listindexbase"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-listindexbase"></a>24.2.47. <code>@ListIndexBase</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ListIndexBase.html"><code>@ListIndexBase</code></a> annotation is used to specify the start value for a list index, as stored in the database.</p>
</div>
<div class="paragraph">
<p>By default, <code>List</code> indexes are stored starting at zero. Generally used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-ordercolumn"><code>@OrderColumn</code></a>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-customizing-ordered-list-ordinal"><code>@ListIndexBase</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-loader"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-loader"></a>24.2.48. <code>@Loader</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Loader.html"><code>@Loader</code></a> annotation is used to override the default <code>SELECT</code> query used for loading an entity loading.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-manytoany"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-manytoany"></a>24.2.49. <code>@ManyToAny</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ManyToAny.html"><code>@ManyToAny</code></a> annotation is used to specify a many-to-one association when the target type is dynamically resolved.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-many-to-any"><code>@ManyToAny</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-mapkeytype"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-mapkeytype"></a>24.2.50. <code>@MapKeyType</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/MapKeyType.html"><code>@MapKeyType</code></a> annotation is used to specify the map key type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-map-custom-key-type"><code>@MapKeyType</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-metavalue"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-metavalue"></a>24.2.51. <code>@MetaValue</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/MetaValue.html"><code>@MetaValue</code></a> annotation is used by the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-anymetadef"><code>@AnyMetaDef</code></a> annotation to specify the association between a given discriminator value and an entity type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-any"><code>@Any</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-namednativequeries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namednativequeries"></a>24.2.52. <code>@NamedNativeQueries</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedNativeQueries.html"><code>@NamedNativeQueries</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namednativequery"><code>@NamedNativeQuery</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-namednativequery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namednativequery"></a>24.2.53. <code>@NamedNativeQuery</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedNativeQuery.html"><code>@NamedNativeQuery</code></a> annotation extends the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namednativequery"><code>@NamedNativeQuery</code></a> with Hibernate specific features, like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>flush mode for this particular query</p>
</li>
<li>
<p>if the query should be cached, and which cache region should be used</p>
</li>
<li>
<p>the selected entity <code>CacheModeType</code> strategy</p>
</li>
<li>
<p>the JDBC <code>Statement</code> fetch size</p>
</li>
<li>
<p>the JDBC <code>Statement</code> execution timeout</p>
</li>
<li>
<p>if the query is a <code>CallableStatement</code>, targeting a stored procedure or a database function</p>
</li>
<li>
<p>what SQL-level comment should be sent to the database</p>
</li>
<li>
<p>if the query is read-only, hence it does not store the resulted entities into the currently running Persistence Context</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-multiple-scalar-values-dto-NamedNativeQuery-hibernate-example">Hibernate <code>@NamedNativeQuery</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-namedqueries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namedqueries"></a>24.2.54. <code>@NamedQueries</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedQueries.html"><code>@NamedQueries</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namedquery"><code>@NamedQuery</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-namedquery"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-namedquery"></a>24.2.55. <code>@NamedQuery</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NamedQuery.html"><code>@NamedQuery</code></a> annotation extends the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-namedquery"><code>@NamedQuery</code></a> with Hibernate specific features, like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>flush mode for this particular query</p>
</li>
<li>
<p>if the query should be cached, and which cache region should be used</p>
</li>
<li>
<p>the selected entity <code>CacheModeType</code> strategy</p>
</li>
<li>
<p>the JDBC <code>Statement</code> fetch size</p>
</li>
<li>
<p>the JDBC <code>Statement</code> execution timeout</p>
</li>
<li>
<p>if the query is a <code>CallableStatement</code>, targeting a stored procedure or a database function</p>
</li>
<li>
<p>what SQL-level comment should be sent to the database</p>
</li>
<li>
<p>if the query is read-only, hence it does not store the resulted entities into the currently running Persistence Context</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#jpql-api-hibernate-named-query-example"><code>@NamedQuery</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-nationalized"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-nationalized"></a>24.2.56. <code>@Nationalized</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Nationalized.html"><code>@Nationalized</code></a> annotation is used to specify that the currently annotated attribute is a character type (e.g. <code>String</code>, <code>Character</code>, <code>Clob</code>) that is stored in a nationalized column type (<code>NVARCHAR</code>, <code>NCHAR</code>, <code>NCLOB</code>).</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-nationalized-example"><code>@Nationalized</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-naturalid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-naturalid"></a>24.2.57. <code>@NaturalId</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NaturalId.html"><code>@NaturalId</code></a> annotation is used to specify that the currently annotated attribute is part of the natural id of the entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid">Natural Ids</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-naturalidcache"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-naturalidcache"></a>24.2.58. <code>@NaturalIdCache</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NaturalIdCache.html"><code>@NaturalIdCache</code></a> annotation is used to specify that the natural id values associated with the annotated entity should be stored in the second-level cache.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#naturalid-caching"><code>@NaturalIdCache</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-notfound"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-notfound"></a>24.2.59. <code>@NotFound</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NotFound.html"><code>@NotFound</code></a> annotation is used to specify the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/NotFoundAction.html"><code>NotFoundAction</code></a> strategy for when an element is not found in a given association.</p>
</div>
<div class="paragraph">
<p>The <code>NotFoundAction</code> defines with two possibilities:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>EXCEPTION</code></dt>
<dd>
<p>An exception is thrown when an element is not found (default and recommended).</p>
</dd>
<dt class="hdlist1"><code>IGNORE</code></dt>
<dd>
<p>Ignore the element when not found in the database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-not-found"><code>@NotFound</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-ondelete"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-ondelete"></a>24.2.60. <code>@OnDelete</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OnDelete.html"><code>@OnDelete</code></a> annotation is used to specify the delete strategy employed by the currently annotated collection, array or joined subclasses.
This annotation is used by the automated schema generation tool to generated the appropriate FOREIGN KEY DDL cascade directive.</p>
</div>
<div class="paragraph">
<p>The two possible strategies are defined by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OnDeleteAction.html"><code>OnDeleteAction</code></a> enumeration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CASCADE</dt>
<dd>
<p>Use the database FOREIGN KEY cascade capabilities.</p>
</dd>
<dt class="hdlist1">NO_ACTION</dt>
<dd>
<p>Take no action.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#pc-cascade-on-delete"><code>@OnDelete</code> cascade</a> chapter for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-optimisticlock"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-optimisticlock"></a>24.2.61. <code>@OptimisticLock</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLock.html"><code>@OptimisticLock</code></a> annotation is used to specify if the currently annotated attribute will trigger an entity version increment upon being modified.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-exclude-attribute">Excluding attributes</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-optimisticlocking"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-optimisticlocking"></a>24.2.62. <code>@OptimisticLocking</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLocking.html"><code>@OptimisticLocking</code></a> annotation is used to specify the currently annotated an entity optimistic locking strategy.</p>
</div>
<div class="paragraph">
<p>The four possible strategies are defined by the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OptimisticLockType.html"><code>OptimisticLockType</code></a> enumeration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NONE</dt>
<dd>
<p>The implicit optimistic locking mechanism is disabled.</p>
</dd>
<dt class="hdlist1">VERSION</dt>
<dd>
<p>The implicit optimistic locking mechanism is using a dedicated version column.</p>
</dd>
<dt class="hdlist1">ALL</dt>
<dd>
<p>The implicit optimistic locking mechanism is using <strong>all</strong> attributes as part of an expanded WHERE clause restriction for the <code>UPDATE</code> and <code>DELETE</code> SQL statements.</p>
</dd>
<dt class="hdlist1">DIRTY</dt>
<dd>
<p>The implicit optimistic locking mechanism is using the <strong>dirty</strong> attributes (the attributes that were modified) as part of an expanded WHERE clause restriction for the <code>UPDATE</code> and <code>DELETE</code> SQL statements.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-versionless">Versionless optimistic locking</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-orderby"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-orderby"></a>24.2.63. <code>@OrderBy</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/OrderBy.html"><code>@OrderBy</code></a> annotation is used to specify a <strong>SQL</strong> ordering directive for sorting the currently annotated collection.</p>
</div>
<div class="paragraph">
<p>It differs from the JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-jpa-orderby"><code>@OrderBy</code></a> annotation because the JPA annotation expects a JPQL order-by fragment, not an SQL directive.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-customizing-ordered-by-sql-clause"><code>@OrderBy</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-paramdef"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-paramdef"></a>24.2.64. <code>@ParamDef</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ParamDef.html"><code>@ParamDef</code></a> annotation is used in conjunction with <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filterdef"><code>@FilterDef</code></a> so that the Hibernate Filter can be customized with runtime-provided parameter values.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-filter-example">Filter mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-parameter"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-parameter"></a>24.2.65. <code>@Parameter</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Parameter.html"><code>@Parameter</code></a> annotation is a generic parameter (basically a key/value combination) used to parametrize other annotations,
like <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-collectiontype"><code>@CollectionType</code></a>, <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-genericgenerator"><code>@GenericGenerator</code></a>, and <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-type"><code>@Type</code></a>, <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-typedef"><code>@TypeDef</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-parent"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-parent"></a>24.2.66. <code>@Parent</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Parent.html"><code>@Parent</code></a> annotation is used to specify that the currently annotated embeddable attribute references back the owning entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-Parent"><code>@Parent</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-persister"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-persister"></a>24.2.67. <code>@Persister</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Persister.html"><code>@Persister</code></a> annotation is used to specify a custom entity or collection persister.</p>
</div>
<div class="paragraph">
<p>For entities, the custom persister must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/entity/EntityPersister.html"><code>EntityPersister</code></a> interface.</p>
</div>
<div class="paragraph">
<p>For collections, the custom persister must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/persister/collection/CollectionPersister.html"><code>CollectionPersister</code></a> interface.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-persister"><code>@Persister</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-polymorphism"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-polymorphism"></a>24.2.68. <code>@Polymorphism</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Polymorphism.html"><code>@Polymorphism</code></a> annotation is used to define the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/PolymorphismType.html"><code>PolymorphismType</code></a> Hibernate will apply to entity hierarchies.</p>
</div>
<div class="paragraph">
<p>There are two possible <code>PolymorphismType</code> options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">EXPLICIT</dt>
<dd>
<p>The currently annotated entity is retrieved only if explicitly asked.</p>
</dd>
<dt class="hdlist1">IMPLICIT</dt>
<dd>
<p>The currently annotated entity is retrieved if any of its super entity are retrieved. This is the default option.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-inheritance-polymorphism"><code>@Polymorphism</code></a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-proxy"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-proxy"></a>24.2.69. <code>@Proxy</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Proxy.html"><code>@Proxy</code></a> annotation is used to specify a custom proxy implementation for the currently annotated entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-proxy"><code>@Proxy</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-rowid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-rowid"></a>24.2.70. <code>@RowId</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/RowId.html"><code>@RowId</code></a> annotation is used to specify the database column used as a <code>ROWID</code> pseudocolumn.
For instance, Oracle defines the <a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/pseudocolumns008.htm"><code>ROWID</code> pseudocolumn</a> which provides the address of every table row.</p>
</div>
<div class="paragraph">
<p>According to Oracle documentation, <code>ROWID</code> is the fastest way to access a single row from a table.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#identifiers-rowid"><code>@RowId</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-selectbeforeupdate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-selectbeforeupdate"></a>24.2.71. <code>@SelectBeforeUpdate</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SelectBeforeUpdate.html"><code>@SelectBeforeUpdate</code></a> annotation is used to specify that the currently annotated entity state be selected from the database when determining whether to perform an update when the detached entity is reattached.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-lock-type-dirty-example"><code>OptimisticLockType.DIRTY</code> mapping</a> section for more info on how <code>@SelectBeforeUpdate</code> works.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sort"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sort"></a>24.2.72. <span class="line-through"><code>@Sort</code></span></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Sort.html"><span class="line-through"><code>@Sort</code></span></a> annotation is deprecated. Use the Hibernate specific <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sortcomparator"><code>@SortComparator</code></a> or <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sortnatural"><code>@SortNatural</code></a> annotations instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sortcomparator"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sortcomparator"></a>24.2.73. <code>@SortComparator</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SortComparator.html"><code>@SortComparator</code></a> annotation is used to specify a <code>Comparator</code> for sorting the <code>Set</code>/<code>Map</code> in-memory.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-unidirectional-sorted-set-custom-comparator-example"><code>@SortComparator</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sortnatural"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sortnatural"></a>24.2.74. <code>@SortNatural</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SortNatural.html"><code>@SortNatural</code></a> annotation is used to specify that the <code>Set</code>/<code>Map</code> should be sorted using natural sorting.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#collections-bidirectional-sorted-set-example"><code>@SortNatural</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-source"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-source"></a>24.2.75. <code>@Source</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Source.html"><code>@Source</code></a> annotation is used in conjunction with a <code>@Version</code> timestamp entity attribute indicating
the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SourceType.html"><code>SourceType</code></a> of the timestamp value.</p>
</div>
<div class="paragraph">
<p>The <code>SourceType</code> offers two options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DB</dt>
<dd>
<p>Get the timestamp from the database.</p>
</dd>
<dt class="hdlist1">VM</dt>
<dd>
<p>Get the timestamp from the current JVM.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#locking-optimistic-version-timestamp-source-mapping-example">Database-generated version timestamp mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sqldelete"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sqldelete"></a>24.2.76. <code>@SQLDelete</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SQLDelete.html"><code>@SQLDelete</code></a> annotation is used to specify a custom SQL <code>DELETE</code> statement for the currently annotated entity or collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sqldeleteall"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sqldeleteall"></a>24.2.77. <code>@SQLDeleteAll</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SQLDeleteAll.html"><code>@SQLDeleteAll</code></a> annotation is used to specify a custom SQL <code>DELETE</code> statement when removing all elements of the currently annotated collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sqlfragmentalias"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sqlfragmentalias"></a>24.2.78. <code>@SqlFragmentAlias</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SqlFragmentAlias.html"><code>@SqlFragmentAlias</code></a> annotation is used to specify an alias for a Hibernate <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-filter"><code>@Filter</code></a>.</p>
</div>
<div class="paragraph">
<p>The alias (e.g. <code>myAlias</code>) can then be used in the <code>@Filter</code> <code>condition</code> clause using the <code>{alias}</code> (e.g. <code>{myAlias}</code>) placeholder.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-filter-sql-fragment-alias"><code>@SqlFragmentAlias</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sqlinsert"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sqlinsert"></a>24.2.79. <code>@SQLInsert</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SQLInsert.html"><code>@SQLInsert</code></a> annotation is used to specify a custom SQL <code>INSERT</code> statement for the currently annotated entity or collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-sqlupdate"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-sqlupdate"></a>24.2.80. <code>@SQLUpdate</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/SQLUpdate.html"><code>@SQLUpdate</code></a> annotation is used to specify a custom SQL <code>UPDATE</code> statement for the currently annotated entity or collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-example">Custom CRUD mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-subselect"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-subselect"></a>24.2.81. <code>@Subselect</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Subselect.html"><code>@Subselect</code></a> annotation is used to specify an immutable and read-only entity using a custom SQL <code>SELECT</code> statement.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-sql-query-mapping">Mapping the entity to a SQL query</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-synchronize"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-synchronize"></a>24.2.82. <code>@Synchronize</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Synchronize.html"><code>@Synchronize</code></a> annotation is usually used in conjunction with the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-subselect"><code>@Subselect</code></a> annotation to specify the list of database tables used by the <code>@Subselect</code> SQL query.</p>
</div>
<div class="paragraph">
<p>With this information in place, Hibernate will properly trigger an entity flush whenever a query targeting the <code>@Subselect</code> entity is to be executed while the Persistence Context has scheduled some insert/update/delete actions against the database tables used by the <code>@Subselect</code> SQL query.</p>
</div>
<div class="paragraph">
<p>Therefore, the <code>@Synchronize</code> annotation prevents the derived entity from returning stale data when executing entity queries against the <code>@Subselect</code> entity.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-sql-query-mapping">Mapping the entity to a SQL query</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-table"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-table"></a>24.2.83. <code>@Table</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Table.html"><code>@Table</code></a> annotation is used to specify additional information to a JPA <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-table"><code>@Table</code></a> annotation, like custom <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code> statements or a specific <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/FetchMode.html"><code>FetchMode</code></a>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#sql-custom-crud-secondary-table-example"><code>@SecondaryTable</code> mapping</a> section for more info about Hibernate-specific <code>@Table</code> mapping.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-tables"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-tables"></a>24.2.84. <code>@Tables</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Tables.html"><code>@Tables</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-table"><code>@Table</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-target"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-target"></a>24.2.85. <code>@Target</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Target.html"><code>@Target</code></a> annotation is used to specify an explicit target implementation when the currently annotated association is using an interface type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-Target"><code>@Target</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-tuplizer"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-tuplizer"></a>24.2.86. <code>@Tuplizer</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Tuplizer.html"><code>@Tuplizer</code></a> annotation is used to specify a custom tuplizer for the currently annotated entity or embeddable.</p>
</div>
<div class="paragraph">
<p>For entities, the tupelizer must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tuple/entity/EntityTuplizer.html"><code>EntityTuplizer</code></a> interface.</p>
</div>
<div class="paragraph">
<p>For embeddables, the tupelizer must implement the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/tuple/component/ComponentTuplizer.html"><code>ComponentTuplizer</code></a> interface.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#entity-tuplizer"><code>@Tuplizer</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-tuplizers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-tuplizers"></a>24.2.87. <code>@Tuplizers</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Tuplizers.html"><code>@Tuplizers</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-tuplizer"><code>@Tuplizer</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-type"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-type"></a>24.2.88. <code>@Type</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Type.html"><code>@Type</code></a> annotation is used to specify the Hibernate <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/type/Type.html"><code>@Type</code></a> used by the currently annotated basic attribute.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type-BitSetType-mapping-example"><code>@Type</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-typedef"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-typedef"></a>24.2.89. <code>@TypeDef</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/TypeDef.html"><code>@TypeDef</code></a> annotation is used to specify a <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/type/Type.html"><code>@Type</code></a> definition which can later be reused for multiple basic attribute mappings.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#basic-custom-type-BitSetTypeDef-mapping-example"><code>@TypeDef</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-typedefs"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-typedefs"></a>24.2.90. <code>@TypeDefs</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/TypeDefs.html"><code>@TypeDefs</code></a> annotation is used to group multiple <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-typedef"><code>@TypeDef</code></a> annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-updatetimestamp"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-updatetimestamp"></a>24.2.91. <code>@UpdateTimestamp</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/UpdateTimestamp.html"><code>@UpdateTimestamp</code></a> annotation is used to specify that the currently annotated timestamp attribute should be updated with the current JVM timestamp whenever the owning entity gets modified.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.util.Calendar</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.sql.Time</code></p>
</li>
<li>
<p><code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-UpdateTimestamp"><code>@UpdateTimestamp</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-valuegenerationtype"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-valuegenerationtype"></a>24.2.92. <code>@ValueGenerationType</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/ValueGenerationType.html"><code>@ValueGenerationType</code></a> annotation is used to specify that the current annotation type should be used as a generator annotation type.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-database-generated-value-example"><code>@ValueGenerationType</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-where"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-where"></a>24.2.93. <code>@Where</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/Where.html"><code>@Where</code></a> annotation is used to specify a custom SQL <code>WHERE</code> clause used when fetching an entity or a collection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-where-example"><code>@Where</code> mapping</a> section for more info.</p>
</div>
</div>
<div class="sect3">
<h4 id="annotations-hibernate-wherejointable"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#annotations-hibernate-wherejointable"></a>24.2.94. <code>@WhereJoinTable</code></h4>
<div class="paragraph">
<p>The <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/WhereJoinTable.html"><code>@WhereJoinTable</code></a> annotation is used to specify a custom SQL <code>WHERE</code> clause used when fetching a join collection table.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-where-join-table"><code>@WhereJoinTable</code> mapping</a> section for more info.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best-practices"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices"></a>25. Performance Tuning and Best Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every enterprise system is unique. However, having a very efficient data access layer is a common requirement for many enterprise applications.
Hibernate comes with a great variety of features that can help you tune the data access layer.</p>
</div>
<div class="sect2">
<h3 id="best-practices-schema"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-schema"></a>25.1. Schema management</h3>
<div class="paragraph">
<p>Although Hibernate provides the <code>update</code> option for the <code>hibernate.hbm2ddl.auto</code> configuration property,
this feature is not suitable for a production environment.</p>
</div>
<div class="paragraph">
<p>An automated schema migration tool (e.g. <a href="https://flywaydb.org/">Flyway</a>, <a href="http://www.liquibase.org/">Liquibase</a>) allows you to use any database-specific DDL feature (e.g. Rules, Triggers, Partitioned Tables).
Every migration should have an associated script, which is stored on the Version Control System, along with the application source code.</p>
</div>
<div class="paragraph">
<p>When the application is deployed on a production-like QA environment, and the deploy worked as expected, then pushing the deploy to a production environment should be straightforward since the latest schema migration was already tested.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should always use an automatic schema migration tool and have all the migration scripts stored in the Version Control System.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-logging"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-logging"></a>25.2. Logging</h3>
<div class="paragraph">
<p>Whenever youâ€™re using a framework that generates SQL statements on your behalf, you have to ensure that the generated statements are the ones that you intended in the first place.</p>
</div>
<div class="paragraph">
<p>There are several alternatives to logging statements.
You can log statements by configuring the underlying logging framework.
For Log4j, you can use the following appenders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pun">###</span><span class="pln"> log just the SQL
log4j</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">SQL</span><span class="pun">=</span><span class="pln">debug

</span><span class="pun">###</span><span class="pln"> log JDBC bind parameters </span><span class="pun">###</span><span class="pln">
log4j</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">type</span><span class="pun">=</span><span class="pln">trace
log4j</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">type</span><span class="pun">.</span><span class="pln">descriptor</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">=</span><span class="pln">trace</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are some other alternatives like using datasource-proxy or p6spy.
The advantage of using a JDBC <code>Driver</code> or <code>DataSource</code> proxy is that you can go beyond simple SQL logging:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>statement execution time</p>
</li>
<li>
<p>JDBC batching logging</p>
</li>
<li>
<p><a href="https://github.com/vladmihalcea/flexy-pool">database connection monitoring</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another advantage of using a <code>DataSource</code> proxy is that you can assert the number of executed statements at test time.
This way, you can have the integration tests fail when a N+1 query issue is automatically detected.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While simple statement logging is fine, using <a href="https://github.com/ttddyy/datasource-proxy">datasource-proxy</a> or <a href="https://github.com/p6spy/p6spy">p6spy</a> is even better.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-jdbc-batching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-jdbc-batching"></a>25.3. JDBC batching</h3>
<div class="paragraph">
<p>JDBC allows us to batch multiple SQL statements and to send them to the database server into a single request.
This saves database roundtrips, and so it <a href="https://leanpub.com/high-performance-java-persistence/read#jdbc-batch-updates">reduces response time significantly</a>.</p>
</div>
<div class="paragraph">
<p>Not only <code>INSERT</code> and <code>UPDATE</code> statements, but even <code>DELETE</code> statements can be batched as well.
For <code>INSERT</code> and <code>UPDATE</code> statements, make sure that you have all the right configuration properties in place, like ordering inserts and updates and activating batching for versioned data.
Check out this article for more details on this topic.</p>
</div>
<div class="paragraph">
<p>For <code>DELETE</code> statements, there is no option to order parent and child statements, so cascading can interfere with the JDBC batching process.</p>
</div>
<div class="paragraph">
<p>Unlike any other framework which doesnâ€™t automate SQL statement generation, Hibernate makes it very easy to activate JDBC-level batching as indicated in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#batch">Batching chapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-mapping"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-mapping"></a>25.4. Mapping</h3>
<div class="paragraph">
<p>Choosing the right mappings is very important for a high-performance data access layer.
From the identifier generators to associations, there are many options to choose from, yet not all choices are equal from a performance perspective.</p>
</div>
<div class="sect3">
<h4 id="best-practices-mapping-identifiers"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-mapping-identifiers"></a>25.4.1. Identifiers</h4>
<div class="paragraph">
<p>When it comes to identifiers, you can either choose a natural id or a synthetic key.</p>
</div>
<div class="paragraph">
<p>For natural identifiers, the <strong>assigned</strong> identifier generator is the right choice.</p>
</div>
<div class="paragraph">
<p>For synthetic keys, the application developer can either choose a randomly generates fixed-size sequence (e.g. UUID) or a natural identifier.
Natural identifiers are very practical, being more compact than their UUID counterparts, so there are multiple generators to choose from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IDENTITY</code></p>
</li>
<li>
<p><code>SEQUENCE</code></p>
</li>
<li>
<p><code>TABLE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although the <code>TABLE</code> generator addresses the portability concern, in reality, it performs poorly because it requires emulating a database sequence using a separate transaction and row-level locks.
For this reason, the choice is usually between <code>IDENTITY</code> and <code>SEQUENCE</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the underlying database supports sequences, you should always use them for your Hibernate entity identifiers.</p>
</div>
<div class="paragraph">
<p>Only if the relational database does not support sequences (e.g. MySQL 5.7), you should use the <code>IDENTITY</code> generators.
However, you should keep in mind that the <code>IDENTITY</code> generators disables JDBC batching for <code>INSERT</code> statements.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If youâ€™re using the <code>SEQUENCE</code> generator, then you should be using the enhanced identifier generators that were enabled by default in Hibernate 5.
The <strong>pooled</strong> and the <strong>pooled-lo</strong> optimizers are very useful to reduce the number of database roundtrips when writing multiple entities per database transaction.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-mapping-associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-mapping-associations"></a>25.4.2. Associations</h4>
<div class="paragraph">
<p>JPA offers four entity association types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ManyToOne</code></p>
</li>
<li>
<p><code>@OneToOne</code></p>
</li>
<li>
<p><code>@OneToMany</code></p>
</li>
<li>
<p><code>@ManyToMany</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And an <code>@ElementCollection</code> for collections of embeddables.</p>
</div>
<div class="paragraph">
<p>Because object associations can be bidirectional, there are many possible combinations of associations.
However, not every possible association type is efficient from a database perspective.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The closer the association mapping is to the underlying database relationship, the better it will perform.</p>
</div>
<div class="paragraph">
<p>On the other hand, the more exotic the association mapping, the better the chance of being inefficient.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Therefore, the <code>@ManyToOne</code> and the <code>@OneToOne</code> child-side association are best to represent a <code>FOREIGN KEY</code> relationship.</p>
</div>
<div class="paragraph">
<p>The parent-side <code>@OneToOne</code> association requires bytecode enhancement
so that the association can be loaded lazily. Otherwise, the parent-side is always fetched even if the association is marked with <code>FetchType.LAZY</code>.</p>
</div>
<div class="paragraph">
<p>For this reason, itâ€™s best to map <code>@OneToOne</code> association using <code>@MapsId</code> so that the <code>PRIMARY KEY</code> is shared between the child and the parent entities.
When using <code>@MapsId</code>, the parent-side becomes redundant since the child-entity can be easily fetched using the parent entity identifier.</p>
</div>
<div class="paragraph">
<p>For collections, the association can be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unidirectional</p>
</li>
<li>
<p>bidirectional</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For unidirectional collections, <code>Sets</code> are the best choice because they generate the most efficient SQL statements.
Unidirectional <code>Lists</code> are less efficient than a <code>@ManyToOne</code> association.</p>
</div>
<div class="paragraph">
<p>Bidirectional associations are usually a better choice because the <code>@ManyToOne</code> side controls the association.</p>
</div>
<div class="paragraph">
<p>Embeddable collections (<code>`@ElementCollection</code>) are unidirectional associations, hence <code>Sets</code> are the most efficient, followed by ordered <code>Lists</code>, whereas bags (unordered <code>Lists</code>) are the least efficient.</p>
</div>
<div class="paragraph">
<p>The <code>@ManyToMany</code> annotation is rarely a good choice because it treats both sides as unidirectional associations.</p>
</div>
<div class="paragraph">
<p>For this reason, itâ€™s much better to map the link table as depicted in the <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#associations-many-to-many-bidirectional-with-link-entity-lifecycle-example">Bidirectional many-to-many with link entity lifecycle</a> section.
Each <code>FOREIGN KEY</code> column will be mapped as a <code>@ManyToOne</code> association.
On each parent-side, a bidirectional <code>@OneToMany</code> association is going to map to the aforementioned <code>@ManyToOne</code> relationship in the link entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just because you have support for collections, it does not mean that you have to turn any one-to-many database relationship into a collection.</p>
</div>
<div class="paragraph">
<p>Sometimes, a <code>@ManyToOne</code> association is sufficient, and the collection can be simply replaced by an entity query which is easier to paginate or filter.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-inheritance"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-inheritance"></a>25.5. Inheritance</h3>
<div class="paragraph">
<p>JPA offers <code>SINGLE_TABLE</code>, <code>JOINED</code>, and <code>TABLE_PER_CLASS</code> to deal with inheritance mapping, and each of these strategies has advantages and disadvantages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SINGLE_TABLE</code> performs the best in terms of executed SQL statements. However, you cannot use <code>NOT NULL</code> constraints on the column-level. You can still use triggers and rules to enforce such constraints, but itâ€™s not as straightforward.</p>
</li>
<li>
<p><code>JOINED</code> addresses the data integrity concerns because every subclass is associated with a different table.
Polymorphic queries or <code>@OneToMany</code> base class associations donâ€™t perform very well with this strategy.
However, polymorphic <code>@ManyToOne</code> associations are fine, and they can provide a lot of value.</p>
</li>
<li>
<p><code>TABLE_PER_CLASS</code> should be avoided since it does not render efficient SQL statements.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-fetching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-fetching"></a>25.6. Fetching</h3>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Fetching too much data is the number one performance issue for the vast majority of JPA applications.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate supports both entity queries (JPQL/HQL and Criteria API) and native SQL statements.
Entity queries are useful only if you need to modify the fetched entities, therefore benefiting from the automatic dirty checking mechanism.</p>
</div>
<div class="paragraph">
<p>For read-only transactions, you should fetch DTO projections because they allow you to select just as many columns as you need to fulfill a certain business use case.
This has many benefits like reducing the load on the currently running Persistence Context because DTO projections donâ€™t need to be managed.</p>
</div>
<div class="sect3">
<h4 id="best-practices-fetching-associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-fetching-associations"></a>25.6.1. Fetching associations</h4>
<div class="paragraph">
<p>Related to associations, there are two major fetch strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EAGER</code></p>
</li>
<li>
<p><code>LAZY</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>EAGER</code> fetching is almost always a bad choice.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prior to JPA, Hibernate used to have all associations as <code>LAZY</code> by default.
However, when JPA 1.0 specification emerged, it was thought that not all providers would use Proxies. Hence, the <code>@ManyToOne</code> and the <code>@OneToOne</code> associations are now <code>EAGER</code> by default.</p>
</div>
<div class="paragraph">
<p>The <code>EAGER</code> fetching strategy cannot be overwritten on a per query basis, so the association is always going to be retrieved even if you donâ€™t need it.
More, if you forget to <code>JOIN FETCH</code> an <code>EAGER</code> association in a JPQL query, Hibernate will initialize it with a secondary statement, which in turn can lead to N+1 query issues.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So, <code>EAGER</code> fetching is to be avoided. For this reason, itâ€™s better if all associations are marked as <code>LAZY</code> by default.</p>
</div>
<div class="paragraph">
<p>However, <code>LAZY</code> associations must be initialized prior to being accessed. Otherwise, a <code>LazyInitializationException</code> is thrown.
There are good and bad ways to treat the <code>LazyInitializationException</code>.</p>
</div>
<div class="paragraph">
<p>The best way to deal with <code>LazyInitializationException</code> is to fetch all the required associations prior to closing the Persistence Context.
The <code>JOIN FETCH</code> directive is good for <code>@ManyToOne</code> and <code>OneToOne</code> associations, and for at most one collection (e.g. <code>@OneToMany</code> or <code>@ManyToMany</code>).
If you need to fetch multiple collections, to avoid a Cartesian Product, you should use secondary queries which are triggered either by navigating the <code>LAZY</code> association or by calling <code>Hibernate#initialize(proxy)</code> method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-caching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#best-practices-caching"></a>25.7. Caching</h3>
<div class="paragraph">
<p>Hibernate has two caching layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the first-level cache (Persistence Context) which provides application-level repeatable reads.</p>
</li>
<li>
<p>the second-level cache which, unlike application-level caches, it doesnâ€™t store entity aggregates but normalized dehydrated entity entries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first-level cache is not a caching solution "per se", being more useful for ensuring <code>READ COMMITTED</code> isolation level.</p>
</div>
<div class="paragraph">
<p>While the first-level cache is short-lived, being cleared when the underlying <code>EntityManager</code> is closed, the second-level cache is tied to an <code>EntityManagerFactory</code>.
Some second-level caching providers offer support for clusters. Therefore, a node needs only to store a subset of the whole cached data.</p>
</div>
<div class="paragraph">
<p>Although the second-level cache can reduce transaction response time since entities are retrieved from the cache rather than from the database,
there are other options to achieve the same goal,
and you should consider these alternatives prior to jumping to a second-level cache layer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tuning the underlying database cache so that the working set fits into memory, therefore reducing Disk I/O traffic.</p>
</li>
<li>
<p>optimizing database statements through JDBC batching, statement caching, indexing can reduce the average response time, therefore increasing throughput as well.</p>
</li>
<li>
<p>database replication is also a very valuable option to increase read-only transaction throughput</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After properly tuning the database, to further reduce the average response time and increase the system throughput, application-level caching becomes inevitable.</p>
</div>
<div class="paragraph">
<p>Typically, a key-value application-level cache like <a href="https://memcached.org/">Memcached</a> or <a href="http://redis.io/">Redis</a> is a common choice to store data aggregates.
If you can duplicate all data in the key-value store, you have the option of taking down the database system for maintenance without completely losing availability since read-only traffic can still be served from the cache.</p>
</div>
<div class="paragraph">
<p>One of the main challenges of using an application-level cache is ensuring data consistency across entity aggregates.
Thatâ€™s where the second-level cache comes to the rescue.
Being tightly integrated with Hibernate, the second-level cache can provide better data consistency since entries are cached in a normalized fashion, just like in a relational database.
Changing a parent entity only requires a single entry cache update, as opposed to cache entry invalidation cascading in key-value stores.</p>
</div>
<div class="paragraph">
<p>The second-level cache provides four cache concurrency strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ_ONLY</code></p>
</li>
<li>
<p><code>NONSTRICT_READ_WRITE</code></p>
</li>
<li>
<p><code>READ_WRITE</code></p>
</li>
<li>
<p><code>TRANSACTIONAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>READ_WRITE</code> is a very good default concurrency strategy since it provides strong consistency guarantees without compromising throughput.
The <code>TRANSACTIONAL</code> concurrency strategy uses JTA. Hence, itâ€™s more suitable when entities are frequently modified.</p>
</div>
<div class="paragraph">
<p>Both <code>READ_WRITE</code> and <code>TRANSACTIONAL</code> use write-through caching, while <code>NONSTRICT_READ_WRITE</code> is a read-through caching strategy.
For this reason, <code>NONSTRICT_READ_WRITE</code> is not very suitable if entities are changed frequently.</p>
</div>
<div class="paragraph">
<p>When using clustering, the second-level cache entries are spread across multiple nodes.
When using <a href="http://blog.infinispan.org/2015/10/hibernate-second-level-cache.html">Infinispan distributed cache</a>, only <code>READ_WRITE</code> and <code>NONSTRICT_READ_WRITE</code> are available for read-write caches.
Bear in mind that <code>NONSTRICT_READ_WRITE</code> offers a weaker consistency guarantee since stale updates are possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more about Hibernate Performance Tuning, check out the <a href="https://www.youtube.com/watch?v=BTdTEe9QL5k&amp;t=1s">High-Performance Hibernate</a> presentation from Devoxx France.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-legacy-bootstrap"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-bootstrap"></a>26. Legacy Bootstrapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The legacy way to bootstrap a SessionFactory is via the <code>org.hibernate.cfg.Configuration</code> object.
<code>Configuration</code> represents, essentially, a single point for specifying all aspects of building the <code>SessionFactory</code>: everything from settings, to mappings, to strategies, etc.
I like to think of <code>Configuration</code> as a big pot to which we add a bunch of stuff (mappings, settings, etc) and from which we eventually get a <code>SessionFactory.</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are some significant draw backs to this approach which led to its deprecation and the development of the new approach, which is discussed in  <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#bootstrap-native">Native Bootstrapping</a>.
<code>Configuration</code> is semi-deprecated but still available for use, in a limited form that eliminates these drawbacks.
"Under the covers", <code>Configuration</code> uses the new bootstrapping code, so the things available there as also available here in terms of auto-discovery.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can obtain the <code>Configuration</code> by instantiating it directly.
You then specify mapping metadata (XML mapping documents, annotated classes) that describe your applications object model and its mapping to a SQL database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Configuration</span><span class="pln"> cfg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Configuration</span><span class="pun">()</span><span class="pln">
    </span><span class="com">// addResource does a classpath resource lookup</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="str">"Item.hbm.xml"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addResource</span><span class="pun">(</span><span class="str">"Bid.hbm.xml"</span><span class="pun">)</span><span class="pln">

    </span><span class="com">// calls addResource using "/org/hibernate/auction/User.hbm.xml"</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addClass</span><span class="pun">(`</span><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">auction</span><span class="pun">.</span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">`)</span><span class="pln">

    </span><span class="com">// parses Address class for mapping annotations</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addAnnotatedClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Address</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

    </span><span class="com">// reads package-level (package-info.class) annotations in the named package</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addPackage</span><span class="pun">(</span><span class="pln"> </span><span class="str">"org.hibernate.auction"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">

    </span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="str">"hibernate.dialect"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"org.hibernate.dialect.H2Dialect"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="str">"hibernate.connection.datasource"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"java:comp/env/jdbc/test"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="str">"hibernate.order_updates"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are other ways to specify Configuration information, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Place a file named hibernate.properties in a root directory of the classpath</p>
</li>
<li>
<p>Pass an instance of java.util.Properties to <code>Configuration#setProperties</code></p>
</li>
<li>
<p>Via a <code>hibernate.cfg.xml</code> file</p>
</li>
<li>
<p>System properties using Java <code>-Dproperty=value</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_migration"></a>27. Migration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mapping Configuration methods to the corresponding methods in the new APIs..</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#add(XmlDocument)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#add(XmlDocument)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addXML</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addXML</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addCacheableFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addCacheableFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addURL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addInputStream</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addInputStream</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addResource</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addAnnotatedClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addAnnotatedClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addPackage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addPackage</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addJar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addJar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addDirectory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addDirectory</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#registerTypeContributor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#registerTypeContributor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#registerTypeOverride</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#registerTypeOverride</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setProperty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setProperty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#addProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setNamingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setNamingStrategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setImplicitNamingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setImplicitNamingStrategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setPhysicalNamingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setPhysicalNamingStrategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#configure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#configure</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setInterceptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setInterceptor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setEntityNotFoundDelegate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setEntityNotFoundDelegate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setSessionFactoryObserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setSessionFactoryObserver</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setCurrentTenantIdentifierResolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Configuration#setCurrentTenantIdentifierResolver</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="appendix-legacy-domain-model"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-domain-model"></a>28. Legacy Domain Model</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="title">Example 669. Declaring a version property in <code>hbm.xml</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="com">&lt;!--
  ~ Hibernate, Relational Persistence for Idiomatic Java
  ~
  ~ License: GNU Lesser General Public License (LGPL), version 2.1 or later.
  ~ See the lgpl.txt file in the root directory or &lt;http://www.gnu.org/licenses/lgpl-2.1.html&gt;.
  --&gt;</span><span class="pln">
</span><span class="tag">&lt;version</span><span class="pln">
    </span><span class="atn">column</span><span class="pun">=</span><span class="atv">"version_column"</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"propertyName"</span><span class="pln">
    </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"typename"</span><span class="pln">
    </span><span class="atn">access</span><span class="pun">=</span><span class="atv">"field|property|ClassName"</span><span class="pln">
    </span><span class="atn">unsaved-value</span><span class="pun">=</span><span class="atv">"null|negative|undefined"</span><span class="pln">
    </span><span class="atn">generated</span><span class="pun">=</span><span class="atv">"never|always"</span><span class="pln">
    </span><span class="atn">insert</span><span class="pun">=</span><span class="atv">"true|false"</span><span class="pln">
    </span><span class="atn">node</span><span class="pun">=</span><span class="atv">"element-name|@attribute-name|element/@attribute|."</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the column holding the version number. Optional, defaults to the property name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a property of the persistent class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the version number. Optional, defaults to <code>integer</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hibernateâ€™s strategy for accessing the property value. Optional, defaults to <code>property</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsaved-value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that an instance is newly instantiated and thus unsaved.
This distinguishes it from detached instances that were saved or loaded in a previous session.
The default value, <code>undefined</code>, indicates that the identifier property value should be used. Optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the version property value is generated by the database. Optional, defaults to <code>never</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to include the <code>version</code> column in SQL <code>insert</code> statements.
Defaults to <code>true</code>, but you can set it to <code>false</code> if the database column is defined with a default value of <code>0</code>.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 670. The timestamp element in <code>hbm.xml</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="com">&lt;!--
  ~ Hibernate, Relational Persistence for Idiomatic Java
  ~
  ~ License: GNU Lesser General Public License (LGPL), version 2.1 or later.
  ~ See the lgpl.txt file in the root directory or &lt;http://www.gnu.org/licenses/lgpl-2.1.html&gt;.
  --&gt;</span><span class="pln">
</span><span class="tag">&lt;timestamp</span><span class="pln">
    </span><span class="atn">column</span><span class="pun">=</span><span class="atv">"timestamp_column"</span><span class="pln">
    </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"propertyName"</span><span class="pln">
    </span><span class="atn">access</span><span class="pun">=</span><span class="atv">"field|property|ClassName"</span><span class="pln">
    </span><span class="atn">unsaved-value</span><span class="pun">=</span><span class="atv">"null|undefined"</span><span class="pln">
    </span><span class="atn">source</span><span class="pun">=</span><span class="atv">"vm|db"</span><span class="pln">
    </span><span class="atn">generated</span><span class="pun">=</span><span class="atv">"never|always"</span><span class="pln">
    </span><span class="atn">node</span><span class="pun">=</span><span class="atv">"element-name|@attribute-name|element/@attribute|."</span><span class="pln">
</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the column which holds the timestamp. Optional, defaults to the property name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a JavaBeans style property of Java type <code>Date</code> or <code>Timestamp</code> of the persistent class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The strategy Hibernate uses to access the property value. Optional, defaults to <code>property</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsaved-value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A version property which indicates that the instance is newly instantiated and unsaved.
This distinguishes it from detached instances that were saved or loaded in a previous session.
The default value of <code>undefined</code> indicates that Hibernate uses the identifier property value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Hibernate retrieves the timestamp from the database or the current JVM.
Database-based timestamps incur an overhead because Hibernate needs to query the database each time to determine the incremental next value.
However, database-derived timestamps are safer to use in a clustered environment.
Not all database dialects are known to support the retrieval of the databaseâ€™s current timestamp.
Others may also be unsafe for locking because of lack of precision.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the timestamp property value is generated by the database. Optional, defaults to <code>never</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="appendix-legacy-criteria"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-criteria"></a>29. Legacy Hibernate Criteria Queries</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This appendix covers the legacy Hibernate <code>org.hibernate.Criteria</code> API, which should be considered deprecated.</p>
</div>
<div class="paragraph">
<p>New development should focus on the JPA javax.persistence.criteria.CriteriaQuery API.
Eventually, Hibernate-specific criteria features will be ported as extensions to the JPA <code>javax.persistence.criteria.CriteriaQuery</code>.
For details on the JPA APIs, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria">Criteria</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hibernate features an intuitive, extensible criteria query API.</p>
</div>
<div class="sect2">
<h3 id="criteria-creating"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-creating"></a>29.1. Creating a <code>Criteria</code> instance</h3>
<div class="paragraph">
<p>The interface <code>org.hibernate.Criteria</code> represents a query against a particular persistent class.
The <code>Session</code> is a factory for <code>Criteria</code> instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Criteria</span><span class="pln"> crit </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">
crit</span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="lit">50</span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> crit</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-entity-name"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-entity-name"></a>29.2. JPA vs. Hibernate entity name</h3>
<div class="paragraph">
<p>When using the <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/SharedSessionContract.html#createCriteria-java.lang.String-"><code>Session#createCriteria(String entityName)</code> or <code>StatelessSession#createCriteria(String entityName)</code></a>,
the <strong>entityName</strong> means the fully-qualified name of the underlying entity and not the name denoted by the <code>name</code> attribute of the JPA <code>@Entity</code> annotation.</p>
</div>
<div class="paragraph">
<p>Considering you have the following entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="lit">@Entity</span><span class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ApplicationEvent"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Id</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you provide the JPA entity name to a legacy Criteria query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Event</span><span class="pun">&gt;</span><span class="pln"> events </span><span class="pun">=</span><span class="pln">
    entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="pln"> </span><span class="str">"ApplicationEvent"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hibernate is going to throw the following <code>MappingException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-bash" data-lang="bash"><span class="pln">org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="typ">MappingException</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Unknown</span><span class="pln"> entity</span><span class="pun">:</span><span class="pln"> </span><span class="typ">ApplicationEvent</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, the Hibernate entity name (the fully qualified class name) works just fine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Event</span><span class="pun">&gt;</span><span class="pln"> events </span><span class="pun">=</span><span class="pln">
    entityManager</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Session</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more about this topic, check out the <a href="https://hibernate.atlassian.net/browse/HHH-2597">HHH-2597</a> JIRA issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-narrowing"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-narrowing"></a>29.3. Narrowing the result set</h3>
<div class="paragraph">
<p>An individual query criterion is an instance of the interface <code>org.hibernate.criterion.Criterion</code>.
The class <code>org.hibernate.criterion.Restrictions</code> defines factory methods for obtaining certain built-in <code>Criterion</code> types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Fritz%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">between</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">,</span><span class="pln"> minWeight</span><span class="pun">,</span><span class="pln"> maxWeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Restrictions can be grouped logically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Fritz%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">or</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">isNull</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">in</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Fritz"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Izi"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Pk"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">disjunction</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">isNull</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a range of built-in criterion types (<code>Restrictions</code> subclasses).
One of the most useful <code>Restrictions</code> allows you to specify SQL directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">sqlRestriction</span><span class="pun">(</span><span class="str">"lower({alias}.name) like lower(?)"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Fritz%"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Hibernate</span><span class="pun">.</span><span class="pln">STRING</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>{alias}</code> placeholder will be replaced by the row alias of the queried entity.</p>
</div>
<div class="paragraph">
<p>You can also obtain a criterion from a <code>Property</code> instance.
You can create a <code>Property</code> by calling <code>Property.forName()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Property</span><span class="pln"> age </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">disjunction</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> age</span><span class="pun">.</span><span class="pln">isNull</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> age</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> age</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> age</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">in</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Fritz"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Izi"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Pk"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-ordering"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-ordering"></a>29.4. Ordering the results</h3>
<div class="paragraph">
<p>You can order the results using <code>org.hibernate.criterion.Order</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"F%"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">nulls</span><span class="pun">(</span><span class="typ">NullPrecedence</span><span class="pun">.</span><span class="pln">LAST</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="lit">50</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">like</span><span class="pun">(</span><span class="str">"F%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">asc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"age"</span><span class="pun">).</span><span class="pln">desc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="lit">50</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-associations"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-associations"></a>29.5. Associations</h3>
<div class="paragraph">
<p>By navigating associations using <code>createCriteria()</code> you can specify constraints upon related entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"F%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="str">"kittens"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"F%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second <code>createCriteria()</code> returns a new instance of <code>Criteria</code> that refers to the elements of the <code>kittens</code> collection.</p>
</div>
<div class="paragraph">
<p>There is also an alternate form that is useful in certain circumstances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createAlias</span><span class="pun">(</span><span class="str">"kittens"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"kt"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createAlias</span><span class="pun">(</span><span class="str">"mate"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mt"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eqProperty</span><span class="pun">(</span><span class="str">"kt.name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mt.name"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(<code>createAlias()</code> does not create a new instance of <code>Criteria</code>.)</p>
</div>
<div class="paragraph">
<p>The kittens collections held by the <code>Cat</code> instances returned by the previous two queries are <em>not</em> pre-filtered by the criteria.
If you want to retrieve just the kittens that match the criteria, you must use a <code>ResultTransformer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="str">"kittens"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"kt"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"F%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setResultTransformer</span><span class="pun">(</span><span class="typ">Criteria</span><span class="pun">.</span><span class="pln">ALIAS_TO_ENTITY_MAP</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Iterator</span><span class="pln"> iter </span><span class="pun">=</span><span class="pln"> cats</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> iter</span><span class="pun">.</span><span class="pln">hasNext</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Map</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Map</span><span class="pun">)</span><span class="pln"> iter</span><span class="pun">.</span><span class="pln">next</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">Cat</span><span class="pln"> cat </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">)</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="typ">Criteria</span><span class="pun">.</span><span class="pln">ROOT_ALIAS</span><span class="pun">);</span><span class="pln">
    </span><span class="typ">Cat</span><span class="pln"> kitten </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">)</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="str">"kt"</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you may manipulate the result set using a left outer join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
   </span><span class="pun">.</span><span class="pln">createAlias</span><span class="pun">(</span><span class="str">"mate"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mt"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Criteria</span><span class="pun">.</span><span class="pln">LEFT_JOIN</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"mt.name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"good%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
   </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"mt.age"</span><span class="pun">))</span><span class="pln">
   </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return all of the `Cat`s with a mate whose name starts with "good" ordered by their mateâ€™s age, and all cats who do not have a mate.
This is useful when there is a need to order or limit in the database prior to returning complex/large result sets,
and removes many instances where multiple queries would have to be performed and the results unioned by Java in memory.</p>
</div>
<div class="paragraph">
<p>Without this feature, first all of the cats without a mate would need to be loaded in one query.</p>
</div>
<div class="paragraph">
<p>A second query would need to retrieve the cats with mates whoâ€™s name started with "good" sorted by the mates age.</p>
</div>
<div class="paragraph">
<p>Thirdly, in memory; the lists would need to be joined manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-dynamicfetching"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-dynamicfetching"></a>29.6. Dynamic association fetching</h3>
<div class="paragraph">
<p>You can specify association fetching semantics at runtime using <code>setFetchMode()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> sess</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">like</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Fritz%"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setFetchMode</span><span class="pun">(</span><span class="str">"mate"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">EAGER</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setFetchMode</span><span class="pun">(</span><span class="str">"kittens"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FetchMode</span><span class="pun">.</span><span class="pln">EAGER</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query will fetch both <code>mate</code> and <code>kittens</code> by outer join.</p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-components"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-components"></a>29.7. Components</h3>
<div class="paragraph">
<p>To add a restriction against a property of an embedded component, the component property name should be prepended to the property name when creating the <code>Restriction</code>.
The criteria object should be created on the owning entity, and cannot be created on the component itself.
For example, suppose the <code>Cat</code> has a component property <code>fullName</code> with sub-properties <code>firstName</code> and <code>lastName</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"fullName.lastName"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Cattington"</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: this does not apply when querying collections of components, for that see below <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-collections">Collections</a></p>
</div>
</div>
<div class="sect2">
<h3 id="criteria-collections"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-collections"></a>29.8. Collections</h3>
<div class="paragraph">
<p>When using criteria against collections, there are two distinct cases.
One is if the collection contains entities (eg. <code>&lt;one-to-many/&gt;</code> or <code>&lt;many-to-many/&gt;</code>) or components (<code>&lt;composite-element/&gt;</code> ),
and the second is if the collection contains scalar values (<code>&lt;element/&gt;</code>).
In the first case, the syntax is as given above in the section <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-associations">Associations</a> where we restrict the <code>kittens</code> collection.
Essentially, we create a <code>Criteria</code> object against the collection property and restrict the entity or component properties using that instance.</p>
</div>
<div class="paragraph">
<p>For querying a collection of basic values, we still create the <code>Criteria</code> object against the collection,
but to reference the value, we use the special property "elements".
For an indexed collection, we can also reference the index property using the special property "indices".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="str">"nickNames"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"elements"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"BadBoy"</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-examples"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-examples"></a>29.9. Example queries</h3>
<div class="paragraph">
<p>The class <code>org.hibernate.criterion.Example</code> allows you to construct a query criterion from a given instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Cat</span><span class="pln"> cat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Cat</span><span class="pun">();</span><span class="pln">
cat</span><span class="pun">.</span><span class="pln">setSex</span><span class="pun">(</span><span class="str">'F'</span><span class="pun">);</span><span class="pln">
cat</span><span class="pun">.</span><span class="pln">setColor</span><span class="pun">(</span><span class="typ">Color</span><span class="pun">.</span><span class="pln">BLACK</span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Example</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">cat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Version properties, identifiers and associations are ignored.
By default, null valued properties are excluded.</p>
</div>
<div class="paragraph">
<p>You can adjust how the <code>Example</code> is applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Example</span><span class="pln"> example </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Example</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">cat</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">excludeZeroes</span><span class="pun">()</span><span class="pln">           </span><span class="com">//exclude zero valued properties</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">excludeProperty</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">)</span><span class="pln">  </span><span class="com">//exclude the property named "color"</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">ignoreCase</span><span class="pun">()</span><span class="pln">              </span><span class="com">//perform case insensitive string comparisons</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">enableLike</span><span class="pun">();</span><span class="pln">             </span><span class="com">//use like for string comparisons</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">example</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can even use examples to place criteria upon associated objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Example</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">cat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="str">"mate"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Example</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln"> cat</span><span class="pun">.</span><span class="pln">getMate</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-projection"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-projection"></a>29.10. Projections, aggregation and grouping</h3>
<div class="paragraph">
<p>The class <code>org.hibernate.criterion.Projections</code> is a factory for <code>Projection</code> instances.
You can apply a projection to a query by calling <code>setProjection()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">rowCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Color</span><span class="pun">.</span><span class="pln">BLACK</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">projectionList</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">rowCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">avg</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">groupProperty</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no explicit "group by" necessary in a criteria query.
Certain projection types are defined to be <em>grouping projections</em>, which also appear in the SQL <code>group by</code> clause.</p>
</div>
<div class="paragraph">
<p>An alias can be assigned to a projection so that the projected value can be referred to in restrictions or orderings.
Here are two different ways to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">alias</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">groupProperty</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"colr"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"colr"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">groupProperty</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">).</span><span class="pln">as</span><span class="pun">(</span><span class="str">"colr"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"colr"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>alias()</code> and <code>as()</code> methods simply wrap a projection instance in another, aliased, instance of <code>Projection</code>.
As a shortcut, you can assign an alias when you add the projection to a projection list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">projectionList</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">rowCount</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"catCountByColor"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">avg</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"avgWeight"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"maxWeight"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">groupProperty</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"color"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">(</span><span class="str">"catCountByColor"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">(</span><span class="str">"avgWeight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Domestic</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="str">"cat"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">createAlias</span><span class="pun">(</span><span class="str">"kittens"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"kit"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">projectionList</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">property</span><span class="pun">(</span><span class="str">"cat.name"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"catName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">property</span><span class="pun">(</span><span class="str">"kit.name"</span><span class="pun">),</span><span class="pln"> </span><span class="str">"kitName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"catName"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">asc</span><span class="pun">(</span><span class="str">"kitName"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>Property.forName()</code> to express projections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="typ">Color</span><span class="pun">.</span><span class="pln">BLACK</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">projectionList</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">rowCount</span><span class="pun">().</span><span class="pln">as</span><span class="pun">(</span><span class="str">"catCountByColor"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">avg</span><span class="pun">().</span><span class="pln">as</span><span class="pun">(</span><span class="str">"avgWeight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">max</span><span class="pun">().</span><span class="pln">as</span><span class="pun">(</span><span class="str">"maxWeight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"color"</span><span class="pun">).</span><span class="pln">group</span><span class="pun">().</span><span class="pln">as</span><span class="pun">(</span><span class="str">"color"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">(</span><span class="str">"catCountByColor"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">addOrder</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Order</span><span class="pun">.</span><span class="pln">desc</span><span class="pun">(</span><span class="str">"avgWeight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="criteria-detachedqueries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#criteria-detachedqueries"></a>29.11. Detached queries and subqueries</h3>
<div class="paragraph">
<p>The <code>DetachedCriteria</code> class allows you to create a query outside the scope of a session and then execute it using an arbitrary <code>Session</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DetachedCriteria</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DetachedCriteria</span><span class="pun">.</span><span class="pln">forClass</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"sex"</span><span class="pun">).</span><span class="pln">eq</span><span class="pun">(</span><span class="str">'F'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Session</span><span class="pln"> session </span><span class="pun">=</span><span class="pln"> </span><span class="pun">....;</span><span class="pln">
</span><span class="typ">Transaction</span><span class="pln"> txn </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">beginTransaction</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> results </span><span class="pun">=</span><span class="pln"> query</span><span class="pun">.</span><span class="pln">getExecutableCriteria</span><span class="pun">(</span><span class="pln">session</span><span class="pun">).</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="lit">100</span><span class="pun">).</span><span class="pln">list</span><span class="pun">();</span><span class="pln">
txn</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">();</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>DetachedCriteria</code> can also be used to express a subquery.
<code>Criterion</code> instances involving subqueries can be obtained via <code>Subqueries</code> or <code>Property</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DetachedCriteria</span><span class="pln"> avgWeight </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DetachedCriteria</span><span class="pun">.</span><span class="pln">forClass</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">avg</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">gt</span><span class="pun">(</span><span class="pln">avgWeight</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DetachedCriteria</span><span class="pln"> weights </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DetachedCriteria</span><span class="pun">.</span><span class="pln">forClass</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Subqueries</span><span class="pun">.</span><span class="pln">geAll</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">,</span><span class="pln"> weights</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Correlated subqueries are also possible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DetachedCriteria</span><span class="pln"> avgWeightForSex </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DetachedCriteria</span><span class="pun">.</span><span class="pln">forClass</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="str">"cat2"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">avg</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"cat2.sex"</span><span class="pun">).</span><span class="pln">eqProperty</span><span class="pun">(</span><span class="str">"cat.sex"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">Cat</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="str">"cat"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Property</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">gt</span><span class="pun">(</span><span class="pln">avgWeightForSex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of multi-column restriction based on a subquery:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">DetachedCriteria</span><span class="pln"> sizeQuery </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DetachedCriteria</span><span class="pun">.</span><span class="pln">forClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Man</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setProjection</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">projectionList</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"weight"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                                                </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Projections</span><span class="pun">.</span><span class="pln">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"height"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">eq</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"John"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Woman</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Subqueries</span><span class="pun">.</span><span class="pln">propertiesEq</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"weight"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"height"</span><span class="pln"> </span><span class="pun">},</span><span class="pln"> sizeQuery </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-criteria-naturalid"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#query-criteria-naturalid"></a>29.12. Queries by natural identifier</h3>
<div class="paragraph">
<p>For most queries, including criteria queries, the query cache is not efficient because query cache invalidation occurs too frequently.
However, there is a special kind of query where you can optimize the cache invalidation algorithm: lookups by a constant natural key.
In some applications, this kind of query occurs frequently.
The Criteria API provides special provision for this use case.</p>
</div>
<div class="paragraph">
<p>First, map the natural key of your entity using <code>&lt;natural-id&gt;</code> and enable use of the second-level cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"User"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;cache</span><span class="pln"> </span><span class="atn">usage</span><span class="pun">=</span><span class="atv">"read-write"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;id</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"id"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;generator</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"increment"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/id&gt;</span><span class="pln">
    </span><span class="tag">&lt;natural-id&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"name"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"org"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/natural-id&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"password"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/class&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This functionality is not intended for use with entities with <em>mutable</em> natural keys.</p>
</div>
<div class="paragraph">
<p>Once you have enabled the Hibernate query cache, the <code>Restrictions.naturalId()</code> allows you to make use of the more efficient cache algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">session</span><span class="pun">.</span><span class="pln">createCriteria</span><span class="pun">(</span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Restrictions</span><span class="pun">.</span><span class="pln">naturalId</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">set</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"gavin"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">set</span><span class="pun">(</span><span class="str">"org"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"hb"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">).</span><span class="pln">setCacheable</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">uniqueResult</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-legacy-native-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#appendix-legacy-native-queries"></a>30. Legacy Hibernate Native Queries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="legacy-sql-named-queries"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-sql-named-queries"></a>30.1. Legacy Named SQL queries</h3>
<div class="paragraph">
<p>Named SQL queries can also be defined during mapping and called in exactly the same way as a named HQL query.
In this case, you do <em>not</em> need to call <code>addEntity()</code> anymore.</p>
</div>
<div class="exampleblock">
<div class="title">Example 671. Named sql query using the <code>&lt;sql-query&gt;</code> mapping element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"persons"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"person"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"eg.Person"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex}
    FROM PERSON person
    WHERE person.NAME LIKE :namePattern
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 672. Execution of a named query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pln"> people </span><span class="pun">=</span><span class="pln"> session
    </span><span class="pun">.</span><span class="pln">getNamedQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"persons"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"namePattern"</span><span class="pun">,</span><span class="pln"> namePattern </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setMaxResults</span><span class="pun">(</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;return-join&gt;</code> element is use to join associations and the <code>&lt;load-collection&gt;</code> element is used to define queries which initialize collections.</p>
</div>
<div class="exampleblock">
<div class="title">Example 673. Named sql query with association</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"personsWith"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"person"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"eg.Person"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;return-join</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"address"</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"person.mailingAddress"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A named SQL query may return a scalar value.
You must declare the column alias and Hibernate type using the <code>&lt;return-scalar&gt;</code> element:</p>
</div>
<div class="exampleblock">
<div class="title">Example 674. Named query returning a scalar</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"mySqlQuery"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return-scalar</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"name"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;return-scalar</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"age"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"long"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT p.NAME AS name,
           p.AGE AS age,
    FROM PERSON p WHERE p.NAME LIKE 'Hiber%'
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can externalize the resultset mapping information in a <code>&lt;resultset&gt;</code> element which will allow you to either reuse them across several named queries or through the <code>setResultSetMapping()</code> API.</p>
</div>
<div class="exampleblock">
<div class="title">Example 675. &lt;resultset&gt; mapping used to externalize mappinginformation</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;resultset</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"personAddress"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"person"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"eg.Person"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;return-join</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"address"</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"person.mailingAddress"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/resultset&gt;</span><span class="pln">

</span><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"personsWith"</span><span class="pln"> </span><span class="atn">resultset-ref</span><span class="pun">=</span><span class="atv">"personAddress"</span><span class="tag">&gt;</span><span class="pln">
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can, alternatively, use the resultset mapping information in your hbm files directly in Java code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 676. Programmatically specifying the result mapping information</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">List</span><span class="pln"> cats </span><span class="pun">=</span><span class="pln"> session
    </span><span class="pun">.</span><span class="pln">createSQLQuery</span><span class="pun">(</span><span class="pln"> </span><span class="str">"select {cat.*}, {kitten.*} from cats cat, cats kitten where kitten.mother = cat.id"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">setResultSetMapping</span><span class="pun">(</span><span class="str">"catAndKitten"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">list</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-propertyresults"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-propertyresults"></a>30.2. Legacy return-property to explicitly specify column/alias names</h3>
<div class="paragraph">
<p>You can explicitly tell Hibernate what column aliases to use with <code>&lt;return-property&gt;</code>, instead of using the <code>{}</code> syntax to let Hibernate inject its own aliases.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"mySqlQuery"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"person"</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"eg.Person"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"name"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"myName"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"age"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"myAge"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"sex"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"mySex"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/return&gt;</span><span class="pln">
    SELECT person.NAME AS myName,
           person.AGE AS myAge,
           person.SEX AS mySex,
    FROM PERSON person WHERE person.NAME LIKE :name
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;return-property&gt;</code> also works with multiple columns.
This solves a limitation with the <code>{}</code> syntax which cannot allow fine grained control of multi-column properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"organizationCurrentEmployments"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"emp"</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Employment"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"salary"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-column</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"VALUE"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-column</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"CURRENCY"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/return-property&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"endDate"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"myEndDate"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/return&gt;</span><span class="pln">
        SELECT EMPLOYEE AS {emp.employee}, EMPLOYER AS {emp.employer},
        STARTDATE AS {emp.startDate}, ENDDATE AS {emp.endDate},
        REGIONCODE as {emp.regionCode}, EID AS {emp.id}, VALUE, CURRENCY
        FROM EMPLOYMENT
        WHERE EMPLOYER = :id AND ENDDATE IS NULL
        ORDER BY STARTDATE ASC
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>&lt;return-property&gt;</code> was used in combination with the <code>{}</code> syntax for injection.
This allows users to choose how they want to refer column and properties.</p>
</div>
<div class="paragraph">
<p>If your mapping has a discriminator you must use <code>&lt;return-discriminator&gt;</code> to specify the discriminator column.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sp_query"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-sp_query"></a>30.3. Legacy stored procedures for querying</h3>
<div class="paragraph">
<p>Hibernate provides support for queries via stored procedures and functions.
Most of the following documentation is equivalent for both.
The stored procedure/function must return a resultset as the first out-parameter to be able to work with Hibernate.
An example of such a stored function in Oracle 9 and higher is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pln">CREATE OR REPLACE FUNCTION selectAllEmployments
    RETURN SYS_REFCURSOR
AS
    st_cursor SYS_REFCURSOR;
BEGIN
    OPEN st_cursor FOR
        SELECT EMPLOYEE, EMPLOYER,
        STARTDATE, ENDDATE,
        REGIONCODE, EID, VALUE, CURRENCY
        FROM EMPLOYMENT;
    RETURN  st_cursor;
END;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use this query in Hibernate you need to map it via a named query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"selectAllEmployees_SP"</span><span class="pln"> </span><span class="atn">callable</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pun">=</span><span class="atv">"emp"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"Employment"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"employee"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"EMPLOYEE"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"employer"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"EMPLOYER"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"startDate"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"STARTDATE"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"endDate"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"ENDDATE"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"regionCode"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"REGIONCODE"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"id"</span><span class="pln"> </span><span class="atn">column</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"EID"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;return-property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"salary"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-column</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"VALUE"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-column</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"CURRENCY"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/return-property&gt;</span><span class="pln">
    </span><span class="tag">&lt;/return&gt;</span><span class="pln">
    { ? = call selectAllEmployments() }
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Stored procedures currently only return scalars and entities.
<code>&lt;return-join&gt;</code> and <code>&lt;load-collection&gt;</code> are not supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-limits-storedprocedures"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-sql-limits-storedprocedures"></a>30.4. Legacy rules/limitations for using stored procedures</h3>
<div class="paragraph">
<p>You cannot use stored procedures with Hibernate unless you follow some procedure/function rules.
If they do not follow those rules they are not usable with Hibernate.
If you still want to use these procedures you have to execute them via <code>session.doWork()</code>.</p>
</div>
<div class="paragraph">
<p>The rules are different for each database since database vendors have different stored procedure semantics/syntax.</p>
</div>
<div class="paragraph">
<p>Stored procedure queries cannot be paged with <code>setFirstResult()/setMaxResults()</code>.</p>
</div>
<div class="paragraph">
<p>The recommended call form is standard SQL92: <code>{ ? = call functionName(&lt;parameters&gt;) }</code> or <code>{ ? = call procedureName(&lt;parameters&gt;}</code>.
Native call syntax is not supported.</p>
</div>
<div class="paragraph">
<p>For Oracle the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A function must return a result set.
The first parameter of a procedure must be an <code>OUT</code> that returns a result set.
This is done by using a <code>SYS_REFCURSOR</code> type in Oracle 9 or 10.
In Oracle you need to define a <code>REF CURSOR</code> type.
See Oracle literature for further information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Sybase or MS SQL server the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The procedure must return a result set.
Note that since these servers can return multiple result sets and update counts, Hibernate will iterate the results and take the first result that is a result set as its return value.
Everything else will be discarded.</p>
</li>
<li>
<p>If you can enable <code>SET NOCOUNT ON</code> in your procedure it will probably be more efficient, but this is not a requirement.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-cud"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-sql-cud"></a>30.5. Legacy custom SQL for create, update and delete</h3>
<div class="paragraph">
<p>Hibernate can use custom SQL for create, update, and delete operations.
The SQL can be overridden at the statement level or individual column level.
This section describes statement overrides.
For columns, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write">Column transformers: read and write expressions</a>.
The following example shows how to define custom SQL operations using annotations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 677. Custom CRUD XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Person"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;id</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"id"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;generator</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"increment"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/id&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"name"</span><span class="pln"> </span><span class="atn">not-null</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"true"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;sql-insert&gt;</span><span class="pln">INSERT INTO PERSON (NAME, ID) VALUES ( UPPER(?), ? )</span><span class="tag">&lt;/sql-insert&gt;</span><span class="pln">
    </span><span class="tag">&lt;sql-update&gt;</span><span class="pln">UPDATE PERSON SET NAME=UPPER(?) WHERE ID=?</span><span class="tag">&lt;/sql-update&gt;</span><span class="pln">
    </span><span class="tag">&lt;sql-delete&gt;</span><span class="pln">DELETE FROM PERSON WHERE ID=?</span><span class="tag">&lt;/sql-delete&gt;</span><span class="pln">
</span><span class="tag">&lt;/class&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you expect to call a store procedure, be sure to set the <code>callable</code> attribute to <code>true</code>, in annotations as well as in xml.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To check that the execution happens correctly, Hibernate allows you to define one of those three strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none: no check is performed: the store procedure is expected to fail upon issues</p>
</li>
<li>
<p>count: use of rowcount to check that the update is successful</p>
</li>
<li>
<p>param: like COUNT but using an output parameter rather that the standard mechanism</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define the result check style, use the <code>check</code> parameter which is again available in annotations as well as in xml.</p>
</div>
<div class="paragraph">
<p>Last but not least, stored procedures are in most cases required to return the number of rows inserted, updated and deleted.
Hibernate always registers the first statement parameter as a numeric output parameter for the CUD operations:</p>
</div>
<div class="exampleblock">
<div class="title">Example 678. Stored procedures and their return value</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">CREATE OR REPLACE FUNCTION updatePerson </span><span class="pun">(</span><span class="pln">uid IN NUMBER</span><span class="pun">,</span><span class="pln"> uname IN VARCHAR2</span><span class="pun">)</span><span class="pln">
    RETURN NUMBER IS
</span><span class="kwd">BEGIN</span><span class="pln">

    update PERSON
    </span><span class="kwd">set</span><span class="pln">
        NAME </span><span class="pun">=</span><span class="pln"> uname</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">where</span><span class="pln">
        ID </span><span class="pun">=</span><span class="pln"> uid</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> SQL</span><span class="pun">%</span><span class="pln">ROWCOUNT</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">END</span><span class="pln"> updatePerson</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-sql-load"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#legacy-sql-load"></a>30.6. Legacy custom SQL for loading</h3>
<div class="paragraph">
<p>You can also declare your own SQL (or HQL) queries for entity loading.
As with inserts, updates, and deletes, this can be done at the individual column level as described in
For columns, see <a href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#mapping-column-read-and-write">Column transformers: read and write expressions</a> or at the statement level.
Here is an example of a statement level override:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"person"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"pers"</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Person"</span><span class="pln"> </span><span class="atn">lock-mod</span><span class="pln"> </span><span class="atn">e</span><span class="pun">=</span><span class="pln"> </span><span class="atv">"upgrade"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT NAME AS {pers.name}, ID AS {pers.id}
    FROM PERSON
    WHERE ID=?
    FOR UPDATE
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is just a named query declaration, as discussed earlier. You can reference this named query in a class mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Person"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;id</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"id"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;generator</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"increment"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/id&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"name"</span><span class="pln"> </span><span class="atn">not-null</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"true"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;loader</span><span class="pln"> </span><span class="atn">query-ref</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"person"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/class&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This even works with stored procedures.</p>
</div>
<div class="paragraph">
<p>You can even define a query for collection loading:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;set</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"employments"</span><span class="pln"> </span><span class="atn">inverse</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;key/&gt;</span><span class="pln">
    </span><span class="tag">&lt;one-to-many</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Employment"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;loader</span><span class="pln"> </span><span class="atn">query-ref</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"employments"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/set&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"employments"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;load-collection</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"emp"</span><span class="pln"> </span><span class="atn">role</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Person.employments"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT {emp.*}
    FROM EMPLOYMENT emp
    WHERE EMPLOYER = :id
    ORDER BY STARTDATE ASC, EMPLOYEE ASC
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define an entity loader that loads a collection by join fetching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;sql-query</span><span class="pln"> </span><span class="atn">name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"person"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;return</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"pers"</span><span class="pln"> </span><span class="atn">class</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"Person"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;return-join</span><span class="pln"> </span><span class="atn">alias</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"emp"</span><span class="pln"> </span><span class="atn">property</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"pers.employments"</span><span class="tag">/&gt;</span><span class="pln">
    SELECT NAME AS {pers.*}, {emp.*}
    FROM PERSON pers
    LEFT OUTER JOIN EMPLOYMENT emp
        ON pers.ID = emp.PERSON_ID
    WHERE ID=?
</span><span class="tag">&lt;/sql-query&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html#_references"></a>31. References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="PoEAA"></a>[PoEAA] Martin Fowler. Patterns of Enterprise Application Architecture.
Addison-Wesley Publishing Company. 2003.</p>
</li>
<li>
<p><a id="JPwH"></a>[JPwH] Christian Bauer &amp; Gavin King. <a href="http://www.manning.com/bauer2">Java Persistence with Hibernate</a>. Manning Publications Co. 2007.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-08-05 13:57:33 PDT
</div>
</div>
<link rel="stylesheet" href="./Hibernate ORM 5.3.18.Final User Guide_files/prettify.min.css">
<script src="./Hibernate ORM 5.3.18.Final User Guide_files/prettify.min.js.download"></script>
<script>prettyPrint()</script>

<div id="UMS_TOOLTIP" style="position: absolute; cursor: pointer; z-index: 2147483647; background: transparent; top: -100000px; left: -100000px;"></div></body><umsdataelement id="UMSSendDataEventElement" data="http://docs.jboss.org/hibernate/orm/5.3/topical/html_single/" docguid="null"></umsdataelement></html>